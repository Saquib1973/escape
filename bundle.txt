================================================================================
CODEBASE COMBINED FILE
Folder: entire codebase
Generated: 2026-01-16T08:35:09.038Z
Total Files: 164
================================================================================


================================================================================
FILE: .gitignore
================================================================================
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

/src/generated/prisma



================================================================================
FILE: README.md
================================================================================
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.



================================================================================
FILE: bundle.js
================================================================================
const fs = require('fs');
const path = require('path');

// Get target folder from command line arguments
const targetFolder = process.argv[2];

// Configuration
const OUTPUT_FILE = 'bundle.txt';
const ROOT_DIR = path.join(__dirname, '.');

// Directories and files to exclude
const EXCLUDE_DIRS = [
  'node_modules',
  '.next',
  '.git',
  'dist',
  'build',
  'coverage',
  '.vscode',
  '.idea',
  'out',
  '.turbo',
];

const EXCLUDE_FILES = [
  '.DS_Store',
  'package-lock.json',
  'yarn.lock',
  'pnpm-lock.yaml',
  '.env',
  '.env.local',
  '.env.production',
  OUTPUT_FILE,
];

// File extensions to include (add more as needed)
const INCLUDE_EXTENSIONS = [
  '.js',
  '.jsx',
  '.ts',
  '.tsx',
  '.json',
  '.css',
  '.scss',
  '.md',
  '.txt',
  '.yml',
  '.yaml',
  '.prisma',
  '.sql',
  '.env.example',
  '.mjs',
  '.cjs',
];

// Special files to always include
const ALWAYS_INCLUDE = [
  'package.json',
  'tsconfig.json',
  'next.config.ts',
  'next.config.js',
  'tailwind.config.js',
  'tailwind.config.ts',
  'README.md',
  '.gitignore',
  'Dockerfile',
  '.dockerignore',
];

function shouldIncludeFile(fileName, filePath) {
  // Check if it's in the always include list
  if (ALWAYS_INCLUDE.includes(fileName)) {
    return true;
  }

  // Check if it's in exclude list
  if (EXCLUDE_FILES.includes(fileName)) {
    return false;
  }

  // Check file extension
  const ext = path.extname(fileName);
  return INCLUDE_EXTENSIONS.includes(ext);
}

function shouldExcludeDir(dirName) {
  return EXCLUDE_DIRS.includes(dirName);
}

function getAllFiles(dirPath, arrayOfFiles = []) {
  const files = fs.readdirSync(dirPath);

  files.forEach((file) => {
    const fullPath = path.join(dirPath, file);
    const stat = fs.statSync(fullPath);

    if (stat.isDirectory()) {
      if (!shouldExcludeDir(file)) {
        arrayOfFiles = getAllFiles(fullPath, arrayOfFiles);
      }
    } else {
      if (shouldIncludeFile(file, fullPath)) {
        arrayOfFiles.push(fullPath);
      }
    }
  });

  return arrayOfFiles;
}

function getRelativePath(filePath) {
  return path.relative(ROOT_DIR, filePath).replace(/\\/g, '/');
}

function combineCodebase() {
  // Determine the directory to scan
  let scanDir = ROOT_DIR;
  let folderName = 'entire codebase';
  
  if (targetFolder) {
    scanDir = path.isAbsolute(targetFolder) 
      ? targetFolder 
      : path.join(ROOT_DIR, targetFolder);
    
    // Check if the target folder exists
    if (!fs.existsSync(scanDir)) {
      console.error(`âŒ Error: Folder "${targetFolder}" does not exist`);
      process.exit(1);
    }
    
    if (!fs.statSync(scanDir).isDirectory()) {
      console.error(`âŒ Error: "${targetFolder}" is not a directory`);
      process.exit(1);
    }
    
    folderName = targetFolder;
  }
  
  console.log(`ðŸ” Scanning ${folderName}...`);
  
  const allFiles = getAllFiles(scanDir);
  console.log(`ðŸ“ Found ${allFiles.length} files to include`);

  let output = '';
  output += '=' .repeat(80) + '\n';
  output += 'CODEBASE COMBINED FILE\n';
  output += `Folder: ${folderName}\n`;
  output += `Generated: ${new Date().toISOString()}\n`;
  output += `Total Files: ${allFiles.length}\n`;
  output += '='.repeat(80) + '\n\n';

  // Sort files by path for better organization
  allFiles.sort();

  allFiles.forEach((filePath, index) => {
    const relativePath = getRelativePath(filePath);
    console.log(`ðŸ“„ Processing [${index + 1}/${allFiles.length}]: ${relativePath}`);

    try {
      const content = fs.readFileSync(filePath, 'utf8');
      
      output += '\n' + '='.repeat(80) + '\n';
      output += `FILE: ${relativePath}\n`;
      output += '='.repeat(80) + '\n';
      output += content;
      output += '\n\n';
    } catch (error) {
      console.error(`âŒ Error reading ${relativePath}:`, error.message);
      output += '\n' + '='.repeat(80) + '\n';
      output += `FILE: ${relativePath}\n`;
      output += '='.repeat(80) + '\n';
      output += `[ERROR: Could not read file - ${error.message}]\n\n`;
    }
  });

  // Write output file
  const outputPath = path.join(ROOT_DIR, OUTPUT_FILE);
  fs.writeFileSync(outputPath, output, 'utf8');
  
  const stats = fs.statSync(outputPath);
  const fileSizeInMB = (stats.size / (1024 * 1024)).toFixed(2);
  
  console.log('\nâœ… Success!');
  console.log(`ðŸ“ Output file: ${OUTPUT_FILE}`);
  console.log(`ðŸ“Š File size: ${fileSizeInMB} MB`);
  console.log(`ðŸ“ Total files combined: ${allFiles.length}`);
}

// Run the script
try {
  if (process.argv.includes('--help') || process.argv.includes('-h')) {
    console.log('Usage: node combine-codebase.js [folder-path]');
    console.log('\nExamples:');
    console.log('  node combine-codebase.js              # Combine entire codebase');
    console.log('  node combine-codebase.js src          # Combine only the src folder');
    console.log('  node combine-codebase.js src/app      # Combine only the src/app folder');
    console.log('  node combine-codebase.js components   # Combine only the components folder');
    process.exit(0);
  }
  
  combineCodebase();
} catch (error) {
  console.error('âŒ Fatal error:', error);
  process.exit(1);
}



================================================================================
FILE: combine.txt
================================================================================
================================================================================
CODEBASE COMBINED FILE
Folder: src/components
Generated: 2025-12-29T11:16:32.351Z
Total Files: 57
================================================================================


================================================================================
FILE: src/components/activity/activity-date-picker.tsx
================================================================================
'use client'

import React, { useState } from 'react'
import { Calendar, Clock } from 'lucide-react'

interface ActivityDatePickerProps {
  selectedDate: Date
  onDateChange: (date: Date) => void
  className?: string
  disabled?: boolean
}

export default function ActivityDatePicker({
  selectedDate,
  onDateChange,
  className = '',
  disabled = false
}: Readonly<ActivityDatePickerProps>) {
  const [isOpen, setIsOpen] = useState(false)
  const [tempDate, setTempDate] = useState(selectedDate)

  const today = new Date()
  const maxDate = today.toISOString().split('T')[0]
  const minDate = new Date(today.getFullYear() - 1, 0, 1).toISOString().split('T')[0]

  const handleDateChange = (dateString: string) => {
    const newDate = new Date(dateString)
    setTempDate(newDate)
  }

  const handleConfirm = () => {
    onDateChange(tempDate)
    setIsOpen(false)
  }

  const handleCancel = () => {
    setTempDate(selectedDate)
    setIsOpen(false)
  }

  const formatDisplayDate = (date: Date) => {
    const isToday = date.toDateString() === today.toDateString()
    const isYesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000).toDateString() === date.toDateString()

    if (isToday) return 'Today'
    if (isYesterday) return 'Yesterday'

    return date.toLocaleDateString('en-US', {
      weekday: 'short',
      month: 'short',
      day: 'numeric',
      year: date.getFullYear() !== today.getFullYear() ? 'numeric' : undefined
    })
  }

  return (
    <div className={`relative ${className}`}>
      <button
        type="button"
        onClick={() => !disabled && setIsOpen(!isOpen)}
        onKeyDown={(e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault()
            if (!disabled) {
              setIsOpen(!isOpen)
            }
          }
        }}
        disabled={disabled}
        className={`
          flex items-center gap-2 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg
          text-sm text-gray-300 hover:bg-gray-700 hover:border-gray-600
          transition-colors duration-200
          ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}
          ${isOpen ? 'bg-gray-700 border-gray-600' : ''}
        `}
      >
        <Calendar className="w-4 h-4" />
        <span>{formatDisplayDate(selectedDate)}</span>
        <Clock className="w-3 h-3" />
      </button>

      {isOpen && (
        <>
          {/* Backdrop */}
          <div
            className="fixed inset-0 z-10"
            onClick={handleCancel}
            onKeyDown={(e) => {
              if (e.key === 'Escape') {
                handleCancel()
              }
            }}
            role="button"
            tabIndex={0}
            aria-label="Close date picker"
          />

          {/* Date picker modal */}
          <div className="absolute top-full left-0 mt-2 z-20 bg-gray-800 border border-gray-700 rounded-lg shadow-xl p-4 min-w-64">
            <div className="mb-4">
              <h3 className="text-sm font-medium text-white mb-2">
                Select Activity Date
              </h3>
              <p className="text-xs text-gray-400">
                Choose the date when this activity occurred
              </p>
            </div>

            <div className="mb-4">
              <label htmlFor="activity-date-input" className="block text-xs font-medium text-gray-300 mb-2">
                Date
              </label>
              <input
                id="activity-date-input"
                type="date"
                value={tempDate.toISOString().split('T')[0]}
                onChange={(e) => handleDateChange(e.target.value)}
                min={minDate}
                max={maxDate}
                className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
              />
            </div>

            <div className="mb-4">
              <label htmlFor="activity-time-input" className="block text-xs font-medium text-gray-300 mb-2">
                Time (Optional)
              </label>
              <input
                id="activity-time-input"
                type="time"
                value={tempDate.toTimeString().slice(0, 5)}
                onChange={(e) => {
                  const [hours, minutes] = e.target.value.split(':')
                  const newDate = new Date(tempDate)
                  newDate.setHours(parseInt(hours) || 0, parseInt(minutes) || 0)
                  setTempDate(newDate)
                }}
                className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
              />
            </div>

            <div className="flex gap-2 justify-end">
              <button
                type="button"
                onClick={handleCancel}
                className="px-3 py-1.5 text-xs text-gray-400 hover:text-white transition-colors"
              >
                Cancel
              </button>
              <button
                type="button"
                onClick={handleConfirm}
                className="px-3 py-1.5 bg-green-600 text-white text-xs rounded-lg hover:bg-green-700 transition-colors"
              >
                Confirm
              </button>
            </div>
          </div>
        </>
      )}
    </div>
  )
}



================================================================================
FILE: src/components/activity/activity-heatmap.tsx
================================================================================
'use client'

import { useSession } from 'next-auth/react'
import React from 'react'
import MovieDetailPanel from './movie-detail-panel'
import { MovieDetail } from './types'
import { ChevronLeft, ChevronRight } from 'lucide-react'
import { useDebounce } from '@/hooks/useDebounce'

interface HeatmapData {
  activities: Record<string, MovieDetail[]>
  startOfMonth: string
  endOfMonth: string
}

interface ActivityHeatmapProps {
  className?: string
}

export default function ActivityHeatmap({
  className = '',
}: Readonly<ActivityHeatmapProps>) {
  const { data: session } = useSession()
  const userId = session?.user?.id
  const [data, setData] = React.useState<HeatmapData | null>(null)
  const [loading, setLoading] = React.useState(true)
  const [selectedDate, setSelectedDate] = React.useState<string | null>(null)
  const [selectedMovies, setSelectedMovies] = React.useState<MovieDetail[]>([])
  const [currentMonth, setCurrentMonth] = React.useState(new Date())
  const today = new Date()
  const debouncedMonth = useDebounce(currentMonth, 400)

  React.useEffect(() => {
    if (!userId) {
      setLoading(false)
      return
    }

    const fetchHeatmapData = async () => {
      try {
        const response = await fetch(
          `/api/activity/heatmap?month=${debouncedMonth.toISOString()}`
        )
        if (!response.ok) {
          throw new Error('Failed to fetch heatmap data')
        }
        const result = await response.json()
        setData(result)
      } catch (error) {
        console.error('Error fetching heatmap data:', error)
      } finally {
        setLoading(false)
      }
    }

    // Show loading state when refetching (e.g., when month changes)
    setLoading(true)
    fetchHeatmapData()
  }, [userId, debouncedMonth])

  const handleDateClick = (dateStr: string, movies: MovieDetail[]) => {
    setSelectedDate(dateStr)
    setSelectedMovies(movies)
  }

  const closeModal = () => {
    setSelectedDate(null)
    setSelectedMovies([])
  }

  const goToPreviousMonth = () => {
    setCurrentMonth(
      new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1)
    )
  }

  const goToNextMonth = () => {
    setCurrentMonth(
      new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1)
    )
  }

  const goToCurrentMonth = () => {
    setCurrentMonth(new Date(today.getFullYear(), today.getMonth(), 1))
  }

  if (loading) {
    return (
      <div className={`activity-heatmap ${className}`}>
        <div className="bg-dark-gray-2 p-4 animate-pulse">
          <div className="h-6 ml-auto bg-dark-gray mb-4 w-32"></div>
          <div className="h-[250px] md:h-[300px] w-full bg-dark-gray"></div>
        </div>
      </div>
    )
  }

  if (!userId) {
    return (
      <div className={`activity-heatmap ${className}`}>
        <div className="text-center text-gray-500 py-4">
          Please log in to view activity calendar
        </div>
      </div>
    )
  }

  if (!data) {
    return (
      <div className={`activity-heatmap ${className}`}>
        <div className="text-center text-gray-500 py-4">No activity data</div>
      </div>
    )
  }

  const generateCalendarGrid = () => {
    const startDate = new Date(data.startOfMonth)
    const endDate = new Date(data.endOfMonth)
    const today = new Date()

    const grid = []
    const currentDate = new Date(startDate)

    // Add empty cells for days before the first day of the month
    const firstDayOfWeek = startDate.getDay()
    for (let i = 0; i < firstDayOfWeek; i++) {
      grid.push({ date: null, count: 0, movies: [], isToday: false })
    }

    while (currentDate <= endDate) {
      const dateStr = currentDate.toISOString().split('T')[0]
      const movies = data.activities[dateStr] || []
      const count = movies.length
      const isToday = currentDate.toDateString() === today.toDateString()

      grid.push({
        date: new Date(currentDate),
        dateStr,
        count,
        movies,
        isToday,
      })

      currentDate.setDate(currentDate.getDate() + 1)
    }

    return grid
  }

  const calendarGrid = generateCalendarGrid()

  const getIntensityClass = (count: number) => {
    if (count === 0) return 'bg-dark-gray'
    if (count === 1) return 'bg-light-green/50'
    if (count === 2) return 'bg-light-green/70'
    if (count >= 3) return 'bg-light-green'
    return 'bg-light-green'
  }

  return (
    <div className={`activity-heatmap ${className}`}>
      <div className="bg-dark-gray-2">
        {/* Header */}
        <div className="flex items-center justify-end pt-4 px-4 mb-6 gap-2">
          <h3 className="text-lg font-semibold mr-2">
            {currentMonth.toLocaleDateString('en-US', {
              month: 'long',
              year: 'numeric',
            })}
          </h3>
          <button
            onClick={goToCurrentMonth}
            className="px-2 py-1 bg-dark-gray text-sm hover:bg-dark-gray-hover"
            disabled={
              currentMonth.getFullYear() === today.getFullYear() &&
              currentMonth.getMonth() === today.getMonth()
            }
          >
            Today
          </button>
          <button onClick={goToPreviousMonth} className="p-1 bg-dark-gray ">
            <ChevronLeft className="size-5" />
          </button>
          <button onClick={goToNextMonth} className="p-1 bg-dark-gray ">
            <ChevronRight className="size-5" />
          </button>
        </div>

        {/* Day labels */}
        <div className="grid grid-cols-7 gap-1 mb-2">
          {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day) => (
            <div
              key={day}
              className="text-center text-xs font-medium text-gray-300"
            >
              {day}
            </div>
          ))}
        </div>

        {/* Calendar grid */}
        <div className="grid grid-cols-7">
          {calendarGrid.map((day, index) => (
            <button
              key={`day-${day.date?.toISOString() || index}`}
              onClick={() =>
                day.date && handleDateClick(day.dateStr, day.movies)
              }
              disabled={!day.date}
              className={`
                p-3 md:p-5 text-sm
                ${day.date ? getIntensityClass(day.count) : 'bg-dark-gray-2'}
                ${day.isToday ? 'bg-dark-gray-hover' : ''}
                ${day.date ? 'cursor-pointer' : 'cursor-default'}
              `}
              title={
                day.date
                  ? `${day.date.toLocaleDateString()}: ${
                      day.count
                    } movies watched`
                  : ''
              }
            >
              <div className="flex items-center justify-center h-full">
                {day.date ? day.date.getDate() : ''}
              </div>
            </button>
          ))}
        </div>

        {/* Modal */}
        {selectedDate && (
          <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-10">
            <div className="bg-dark-gray-2 p-4 max-w-sm w-full max-h-[70vh] overflow-auto">
              <MovieDetailPanel
                date={selectedDate}
                movies={selectedMovies}
                onClose={closeModal}
              />
            </div>
          </div>
        )}
      </div>
    </div>
  )
}



================================================================================
FILE: src/components/activity/activity-stats.tsx
================================================================================
'use client'

import React from 'react'

interface ActivityStatsProps {
  userId: string
  className?: string
}

interface ActivityStatsData {
  totalActivities: number
  yearActivities: number
  monthActivities: number
  weekActivities: number
}

export default function ActivityStats({
  userId,
  className = '',
}: Readonly<ActivityStatsProps>) {
  const [stats, setStats] = React.useState<ActivityStatsData | null>(null)
  const [loading, setLoading] = React.useState(true)

  React.useEffect(() => {
    const fetchStats = async () => {
      try {
        const response = await fetch('/api/activity/stats')
        if (!response.ok) {
          throw new Error('Failed to fetch activity stats')
        }
        const data = await response.json()
        setStats(data)
      } catch (error) {
        console.error('Error fetching activity stats:', error)
      } finally {
        setLoading(false)
      }
    }

    fetchStats()
  }, [userId])

  if (loading) {
    return (
      <div className={`activity-stats ${className}`}>
        <div className="grid grid-cols-4 gap-3">
          {['total', 'year', 'month', 'week'].map((type) => (
            <div
              key={`loading-skeleton-${type}`}
              className="bg-dark-gray-2 p-3 animate-pulse"
            >
              <div className="h-10 bg-dark-gray"></div>
            </div>
          ))}
        </div>
      </div>
    )
  }

  if (!stats) {
    return (
      <div className={`activity-stats ${className}`}>
        <div className="text-center text-gray-500 py-4">No activity data</div>
      </div>
    )
  }

  const statItems = [
    { label: 'Total', value: stats.totalActivities },
    { label: 'This Year', value: stats.yearActivities },
    { label: 'This Month', value: stats.monthActivities },
    { label: 'This Week', value: stats.weekActivities },
  ]

  return (
    <div className={`activity-stats ${className}`}>
      <div className="grid grid-cols-4 gap-3">
        {statItems.map((item) => (
          <div key={item.label} className="bg-dark-gray-hover p-3">
            <div className="text-center">
              <div className="text-xl font-semibold text-gray-300">
                {item.value}
              </div>
              <div className="text-sm text-gray-500">{item.label}</div>
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}



================================================================================
FILE: src/components/activity/activity.tsx
================================================================================
import React from 'react'
import ActivityStats from './activity-stats'
import { getSession } from '@/lib'
import ActivityHeatmap from './activity-heatmap'

const Activity = async () => {
  const session = await getSession()

  return (
    <div className="space-y-8">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-white mb-2">Welcome back!</h1>
        <p className="text-gray-300">
          Here&apos;s an overview of your movie and series watching activity
        </p>
      </div>

      {/* Activity Overview */}
      <div className="space-y-8">
        <div>
          <ActivityStats userId={session?.user.id || ''} />
        </div>

        <div>
          <ActivityHeatmap />
        </div>
      </div>

    </div>
  )
}

export default Activity



================================================================================
FILE: src/components/activity/movie-detail-panel.tsx
================================================================================
'use client'

import React from 'react'
import { X, Star, Film, Tv } from 'lucide-react'
import { MovieDetail, formatDate, getRatingColor, getRatingStars } from './types'

interface MovieDetailPanelProps {
  date: string
  movies: MovieDetail[]
  onClose: () => void
}

export default function MovieDetailPanel({
  date,
  movies,
  onClose
}: Readonly<MovieDetailPanelProps>) {

  return (
    <div className="p-4">
      {/* Header */}
      <div className="flex items-center justify-between mb-4 border-b border-gray-200 pb-3">
        <div className="flex items-center gap-2">
          <h4 className="text-lg font-semibold text-gray-900">
            {formatDate(date)}
          </h4>
          <span className="text-sm text-gray-500">
            ({movies.length} {movies.length === 1 ? 'movie' : 'movies'})
          </span>
        </div>
        <button
          onClick={onClose}
          className="p-1 hover:bg-gray-100 rounded transition-colors"
        >
          <X className="w-5 h-5 text-gray-500" />
        </button>
      </div>

      {/* Content */}
      <div className="max-h-64 overflow-y-auto">
        {movies.length === 0 ? (
          <div className="text-center text-gray-500 py-8 text-sm">
            No movies watched on this date
          </div>
        ) : (
          <div className="space-y-3">
            {movies.map((movie, index) => (
              <div
                key={`${movie.contentId}-${index}`}
                className="bg-gray-50 rounded-lg p-3 hover:bg-gray-100 transition-colors border border-gray-200"
              >
                <div className="flex items-center gap-3">
                  <div className="flex-shrink-0">
                    {movie.metadata.contentType === 'tv_series' ? (
                      <Tv className="w-5 h-5 text-blue-600" />
                    ) : (
                      <Film className="w-5 h-5 text-blue-600" />
                    )}
                  </div>

                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <h5 className="font-medium text-gray-900 truncate text-sm">
                        {movie.metadata.reviewTitle || `Content ${movie.contentId.slice(0, 8)}`}
                      </h5>
                      {movie.metadata.isSpoiler && (
                        <span className="px-2 py-1 text-xs bg-red-100 text-red-700 rounded">
                          Spoiler
                        </span>
                      )}
                    </div>

                    <div className="flex items-center gap-3 text-xs text-gray-600">
                      <span className="capitalize">
                        {movie.metadata.contentType || 'movie'}
                      </span>

                      {movie.metadata.rating && (
                        <div className="flex items-center gap-1">
                          <Star className="w-3 h-3" />
                          <span className={getRatingColor(movie.metadata.rating)}>
                            {getRatingStars(movie.metadata.rating)}/5
                          </span>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}



================================================================================
FILE: src/components/activity/types.ts
================================================================================
export interface MovieDetail {
  contentId: string
  metadata: {
    contentType?: 'movie' | 'tv_series'
    rating?: string
    isSpoiler?: boolean
    reviewTitle?: string
    loggedAt?: string
  }
  activityType: string
}

export const formatDate = (dateStr: string) => {
  return new Date(dateStr).toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
}

export const getRatingColor = (rating: string) => {
  switch (rating) {
    case 'LEGENDARY': return 'text-yellow-400'
    case 'MUST_WATCH': return 'text-green-400'
    case 'ONE_TIME_WATCH': return 'text-blue-400'
    case 'TIMEPASS': return 'text-orange-400'
    case 'TRASH': return 'text-red-400'
    default: return 'text-gray-400'
  }
}

export const getRatingStars = (rating: string) => {
  const ratingMap: Record<string, number> = {
    'TRASH': 1,
    'TIMEPASS': 2,
    'ONE_TIME_WATCH': 3,
    'MUST_WATCH': 4,
    'LEGENDARY': 5
  }
  return ratingMap[rating] || 0
}



================================================================================
FILE: src/components/ai-recommendation-component.tsx
================================================================================
'use client'
import { motion } from 'framer-motion';
import { Bot } from 'lucide-react';
import { useSession } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import { useMemo, useState } from 'react';
import { useMutation } from '@tanstack/react-query';

type Props = {
  contextType?: 'movie' | 'tv'
  contextId?: string
  likedMovies?: string[]
  likedTV?: string[]
  title?: string
}

type Rec = {
  type: 'movie' | 'tv'
  id: string
  title: string
}

const AiRecommendationComponent = ({
  contextType,
  contextId,
  likedMovies,
  likedTV,
  title,
}: Props) => {
  const [items, setItems] = useState<Rec[]>([])
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [hasFetched, setHasFetched] = useState(false)

  const body = useMemo(
    () => ({ contextType, contextId, likedMovies, likedTV }),
    [contextType, contextId, likedMovies, likedTV]
  )
  const { status } = useSession()
  const router = useRouter()

  const containerVariants = {
    hidden: {},
    show: {
      transition: {
        staggerChildren: 0.06,
        delayChildren: 0.06,
      },
    },
  }

  const itemVariants = {
    hidden: { opacity: 0, x: -4 },
    show: { opacity: 1, x: 0 },
  }

  const skeletonKeys = ['a','b','c','d','e','f','g','h']

  const { mutateAsync: generateRecs } = useMutation({
    mutationKey: ['ai', 'recommendations'],
    mutationFn: async (payload: unknown) => {
      const resp = await fetch('/api/ai/recommendations', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      })
      if (!resp.ok) throw new Error('Failed to fetch recommendations')
      return resp.json() as Promise<{ items?: Rec[] }>
    },
  })

  const fetchRecommendations = async () => {
    if (status !== 'authenticated') return

    try {
      setLoading(true)
      setError(null)
      const data = await generateRecs(body)
      setItems(Array.isArray(data?.items) ? data.items : [])
      setHasFetched(true)
    } catch (e) {
      const message = e instanceof Error ? e.message : String(e)
      setError(message)
    } finally {
      setLoading(false)
    }
  }

  if (status !== 'loading' && status !== 'authenticated')
    return null

  return (
    <div className="my-4 text-gray-300 max-md:px-4">
      {/* Content area that changes based on state */}
      <div className="min-h-[40px]">
        {!hasFetched && !loading && !error && (
          <button
            onClick={fetchRecommendations}
            className=" text-white cursor-pointer hover:text-light-green rounded-md text-sm font-medium transition-colors flex gap-1 items-center"
          >
            <Bot className="size-5" />
            <span>Get AI Recommendations for {title}</span>
          </button>
        )}

        {error && (
          <div className="text-red-400 text-sm">
            Failed to fetch recommendations.{' '}
            <button
              onClick={fetchRecommendations}
              className="ml-2 text-light-green hover:text-light-green/80 underline"
            >
              Try again
            </button>
          </div>
        )}

        {loading && (
          <div className="space-y-3">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <div className="animate-spin rounded-full h-4 w-4 border-2 border-light-green border-t-transparent"></div>
              <span>Generating AI recommendations...</span>
            </div>
            <div className="flex flex-wrap gap-2" aria-busy="true">
              {skeletonKeys.map((key) => (
                <div
                  key={`skeleton-${key}`}
                  className="animate-pulse bg-dark-gray-hover/60 h-7 w-24 rounded"
                />
              ))}
            </div>
          </div>
        )}

        {hasFetched && items.length > 0 && !loading && (
          <motion.div
            className="flex flex-wrap gap-2"
            variants={containerVariants}
            initial="hidden"
            animate="show"
          >
            {items.map((rec) => {
              const href = `/search?q=${encodeURIComponent(
                rec.title.toLowerCase()
              )}`
              return (
                <motion.button
                  key={`${rec.type}-${rec.id}`}
                  variants={itemVariants}
                  onClick={() => router.push(href)}
                  className="bg-dark-gray-hover text-white px-3 py-1 text-sm transition-colors hover:bg-dark-gray-hover/80 rounded"
                >
                  {rec.title}
                </motion.button>
              )
            })}
          </motion.div>
        )}

        {hasFetched && items.length === 0 && !loading && (
          <div className="text-gray-400 text-sm">
            No recommendations available at the moment.{' '}
            <button
              onClick={fetchRecommendations}
              className="ml-2 text-light-green hover:text-light-green/80 underline"
            >
              Try again
            </button>
          </div>
        )}
      </div>
    </div>
  )
}

export default AiRecommendationComponent



================================================================================
FILE: src/components/animate-page-wrapper.tsx
================================================================================
'use client'

import { cn } from '@/lib'
import { AnimatePresence, motion } from 'framer-motion'
import React from 'react'

interface AnimatePageWrapperProps {
  children: React.ReactNode
  className?: string
}

const AnimatePageWrapper: React.FC<AnimatePageWrapperProps> = ({
  children,
  className,
}) => {
  return (
    <AnimatePresence mode='wait'>
      <motion.div
        className={cn(className)}
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        transition={{ duration: 0.5, ease: 'easeInOut' }}
      >
        {children}
      </motion.div>
    </AnimatePresence>
  )
}

export default AnimatePageWrapper



================================================================================
FILE: src/components/buttons/google-button.tsx
================================================================================
'use client'
import { signIn } from 'next-auth/react'
import Image from 'next/image'
import { useState } from 'react'
import Loader from '../loader'

export function GoogleButton() {
  const [isLoading, setIsLoading] = useState(false)

  const handleGoogleSignIn = async () => {
    setIsLoading(true)
    try {
      await signIn('google', { callbackUrl: '/' })
    } catch (error) {
      console.error('Google sign in error:', error)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <button
      onClick={handleGoogleSignIn}
      disabled={isLoading}
      className="bg-dark-gray text-gray-300 flex gap-2 py-3 cursor-pointer p-2 w-full justify-center items-center disabled:cursor-not-allowed disabled:opacity-50"
    >
      <Image
        alt="google"
        height={28}
        width={28}
        className="size-5"
        src={'/google.png'}
      />
      {!isLoading ? (
        <p>Continue with Google</p>
      ) : (
        <Loader color="#ffffff" className="" size="sm" />
      )}
    </button>
  )
}



================================================================================
FILE: src/components/buttons/share-button.tsx
================================================================================
'use client'

import { motion } from 'framer-motion'
import { Share2 } from 'lucide-react'
import { useState } from 'react'

interface ShareButtonProps {
  className?: string
}

const ShareButton: React.FC<ShareButtonProps> = ({ className = '' }) => {
  const [copied, setCopied] = useState(false)
  const [shouldAnimate, setShouldAnimate] = useState(false)

  const handleShare = async () => {
    const urlToShare = typeof window !== 'undefined' ? window.location.href : ''

    try {
      await navigator.clipboard.writeText(urlToShare)
      setShouldAnimate(true)
      setCopied(true)

      // Reset after 2 seconds
      setTimeout(() => {
        setCopied(false)
      }, 2000)
    } catch (error) {
      console.error('Failed to copy URL:', error)
      // Fallback for older browsers
      const textArea = document.createElement('textarea')
      textArea.value = urlToShare
      document.body.appendChild(textArea)
      textArea.select()
      document.execCommand('copy')
      document.body.removeChild(textArea)
      setShouldAnimate(true)
      setCopied(true)

      setTimeout(() => {
        setCopied(false)
      }, 2000)
    }
  }

  return (
    <button
      onClick={handleShare}
      className={`flex items-center w-full gap-3 px-3 py-2 text-sm transition-colors ${className} ${
        copied
          ? 'text-light-green'
          : 'text-gray-300 hover:bg-dark-gray-hover hover:text-white'
      }`}
      title="Share URL"
    >
      <Share2 className="size-4" />
      <motion.span
        key={copied ? 'copied' : 'share'}
        initial={shouldAnimate ? { x: 20, opacity: 0 } : { x: 0, opacity: 1 }}
        animate={{ x: 0, opacity: 1 }}
        exit={shouldAnimate ? { x: -20, opacity: 0 } : { x: 0, opacity: 1 }}
        transition={{ duration: 0.4, ease: 'easeInOut' }}
      >
        {copied ? 'Copied!' : 'Share'}
      </motion.span>
    </button>
  )
}

export default ShareButton



================================================================================
FILE: src/components/buttons/signout-button.tsx
================================================================================
'use client'

import { signOut } from 'next-auth/react'

export function SignOutButton() {
  return (
    <button
      onClick={() => signOut({ callbackUrl: '/' })}
      className="bg-red-500 text-white px-4 py-2 rounded"
    >
      Sign Out
    </button>
  )
}



================================================================================
FILE: src/components/cinema-list.tsx
================================================================================
'use client'

import { MoveRight, Star } from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import React, { useCallback, useEffect, useMemo, useState } from 'react'
import { motion } from 'framer-motion'
import { MediaItem } from '../types/media'
import CinemaListLoadingSkeleton from './skeletons/cinema-list-loading-skeleton'
import { cn } from '@/lib'
import { useQuery } from '@tanstack/react-query'
import Header from './header'
import MediaItemDropdown from './media-item-dropdown'
interface CinemaListProps {
  title: string
  subHeading?: string
  items?: MediaItem[]
  apiUrl?: string
  linkPath?: (id: number) => string
  scrollContainerClass?: string
  showMoreLink?: string
  getYear?: (item: MediaItem) => number
  getTitle?: (item: MediaItem) => string
  showRating?: boolean
  showEmptyState?: boolean
  className?: string
  contentType?: 'movie' | 'tv_series'
  showDropdown?: boolean
  onWatchlistToggle?: (item: MediaItem) => void
  getWatchlistStatus?: (item: MediaItem) => boolean
}

const CinemaList: React.FC<CinemaListProps> = ({
  title,
  subHeading,
  items: itemsProp,
  apiUrl,
  linkPath,
  scrollContainerClass = 'cinema-scroll-container',
  showMoreLink,
  getYear,
  getTitle,
  showRating = true,
  showEmptyState = false,
  className,
  contentType = 'movie',
  showDropdown = false,
  onWatchlistToggle,
  getWatchlistStatus,
}) => {
  const [localWatchlistIds, setLocalWatchlistIds] = useState<Set<number>>(new Set())
  const shouldFetch = (!itemsProp || itemsProp.length === 0) && Boolean(apiUrl)

  const { data, isLoading, isError, error, refetch, isFetching } = useQuery<{
    results?: MediaItem[]
  }>({
    queryKey: ['cinema-list', apiUrl],
    queryFn: async () => {
      if (!apiUrl) return { results: [] }
      const response = await fetch(apiUrl)
      if (!response.ok) {
        throw new Error('Failed to load data')
      }
      return response.json()
    },
    enabled: shouldFetch,
    retry: 3,
    retryDelay: (attempt) => Math.min(1000 * 2 ** attempt, 5000),
  })

  const fetchedItems = useMemo(() => data?.results ?? [], [data])
  const items: MediaItem[] = useMemo(() => {
    return itemsProp && itemsProp.length > 0 ? itemsProp : fetchedItems
  }, [itemsProp, fetchedItems])

  // Prefetch saved status for current user so UI reflects saved/not-saved on open
  useEffect(() => {
    if (getWatchlistStatus) return
    let cancelled = false
    const load = async () => {
      try {
        const res = await fetch('/api/user/watchlist', { cache: 'no-store' })
        if (!res.ok) return
        const data = await res.json() as { items?: { contentId: string }[] }
        const ids = new Set<number>()
        for (const it of data.items ?? []) {
          const n = Number(it.contentId)
          if (!Number.isNaN(n)) ids.add(n)
        }
        if (!cancelled) setLocalWatchlistIds(ids)
      } catch {
        // ignore
      }
    }
    void load()
    return () => {
      cancelled = true
    }
  }, [getWatchlistStatus])

  const isSaved = useCallback(
    (item: MediaItem) => {
      if (getWatchlistStatus) return getWatchlistStatus(item)
      return localWatchlistIds.has(item.id)
    },
    [getWatchlistStatus, localWatchlistIds]
  )

  const toggleWatchlist = useCallback(
    async (item: MediaItem) => {
      const currentlySaved = isSaved(item)
      const idNum = item.id
      const idStr = String(idNum)

      // Optimistic update
      setLocalWatchlistIds(prev => {
        const next = new Set(prev)
        if (currentlySaved) next.delete(idNum)
        else next.add(idNum)
        return next
      })

      try {
        if (currentlySaved) {
          const res = await fetch(`/api/user/watchlist/${idStr}`, { method: 'DELETE' })
          if (!res.ok) throw new Error('Failed to remove from watchlist')
        } else {
          const res = await fetch(`/api/user/watchlist`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contentId: idStr,
              contentType,
              posterPath: item.poster_path ?? null,
            }),
          })
          if (!res.ok) throw new Error('Failed to save to watchlist')
        }
        onWatchlistToggle?.(item)
      } catch (err) {
        console.error('Watchlist toggle failed', err)
        // Revert optimistic update on failure
        setLocalWatchlistIds(prev => {
          const next = new Set(prev)
          if (currentlySaved) next.add(idNum)
          else next.delete(idNum)
          return next
        })
      }
    },
    [contentType, isSaved, onWatchlistToggle]
  )

  // Default helper functions
  const defaultGetYear = useCallback((item: MediaItem) => {
    return new Date(item.release_date as string).getFullYear()
  }, [])

  const defaultGetTitle = useCallback((item: MediaItem) => {
    return item.title as string
  }, [])

  const defaultLinkPath = useCallback((id: number) => {
    return `/movie/${id}`
  }, [])

  // Use provided functions or defaults
  const finalGetYear = getYear || defaultGetYear
  const finalGetTitle = getTitle || defaultGetTitle
  const finalLinkPath = linkPath || defaultLinkPath

  // fetching is handled by useQuery

  // Animation variants
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.1,
        delayChildren: 0.2,
      },
    },
  }

  const itemVariants = {
    hidden: {
      opacity: 0,
      x: 10,
    },
    visible: {
      opacity: 1,
      x: 0,
      transition: {
        type: 'spring' as const,
        stiffness: 100,
        damping: 12,
      },
    },
  }

  const handleScroll = (direction: 'left' | 'right') => {
    const container = document.querySelector(`.${scrollContainerClass}`)
    if (container) {
      const scrollAmount = direction === 'left' ? -400 : 400
      container.scrollBy({ left: scrollAmount, behavior: 'smooth' })
    }
  }

  const renderHeader = () => (
    <div className={`flex justify-between items-center`}>
      <Header className="mb-0" title={title} subHeading={subHeading} />
      <div className="flex gap-2 h-fit">
        <button
          onClick={() => handleScroll('left')}
          className="p-2 bg-dark-gray hover:bg-dark-gray-hover transition-colors"
          aria-label="Scroll left"
        >
          <svg
            className="w-5 h-5 text-gray-300"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <button
          onClick={() => handleScroll('right')}
          className="p-2 bg-dark-gray hover:bg-dark-gray-hover transition-colors"
          aria-label="Scroll right"
        >
          <svg
            className="w-5 h-5 text-gray-300"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M9 5l7 7-7 7"
            />
          </svg>
        </button>
      </div>
    </div>
  )

  const renderContent = () => {
    if (isLoading) {
      return <CinemaListLoadingSkeleton itemCount={8} />
    }
    if (isError) {
      return (
        <div className="w-full h-72 flex flex-col items-center justify-center gap-3">
          <div className="text-red-400">
            {error instanceof Error ? error.message : 'Failed to load data'}
          </div>
          <button
            onClick={() => {
              if (!isFetching) {
                void refetch()
              }
            }}
            disabled={isFetching}
            className={`px-4 py-2 bg-dark-gray hover:bg-dark-gray-hover text-gray-200 disabled:opacity-60 disabled:cursor-not-allowed transition-colors`}
          >
            {isFetching ? 'Retrying...' : 'Retry'}
          </button>
        </div>
      )
    }
    if (showEmptyState && items.length === 0) {
      return (
        <div className="w-full h-72 flex items-center justify-center">
          <div className="text-gray-400">No recommendations available</div>
        </div>
      )
    }

    return (
      <>
        <div className="w-full h-fit">
          <motion.div
            className={`${scrollContainerClass} flex gap-2 h-full overflow-x-auto scrollbar-hide`}
            variants={containerVariants}
            initial="hidden"
            animate="visible"
          >
            {items.map((item,index) => (
              <motion.div key={item.id} className={`${index===0 ? "md:ml-3":""}`} variants={itemVariants}>
                <div className="flex-shrink-0 group w-36 block h-full relative">
                  <div className="bg-dark-gray-2 overflow-hidden h-full">
                    <div className="flex flex-col w-full h-full">
                      <div className="h-full flex items-center justify-center overflow-hidden relative">
                        <Link
                          href={finalLinkPath(item.id)}
                          className="block w-full h-full"
                        >
                          {item.poster_path ? (
                            <Image
                              src={`https://image.tmdb.org/t/p/w500${item.poster_path}`}
                              alt={finalGetTitle(item)}
                              width={160}
                              height={240}
                              className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                            />
                          ) : (
                            <div className="text-center text-gray-400">
                              <div className="w-16 h-40 mb-2 mx-auto bg-gray-700"></div>
                              <p className="text-sm font-medium">No Image</p>
                            </div>
                          )}
                        </Link>
                      </div>

                      {showRating && (
                        <div className="flex items-center p-2 justify-between text-xs text-gray-500">
                          <span>{finalGetYear(item)}</span>
                          <span className="flex items-center gap-1">
                            <Star className="size-3 fill-light-green text-light-green" />
                            {item.vote_average.toFixed(1)}
                          </span>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* Dropdown Menu - positioned relative to the card container */}
                  {showDropdown && (
                    <div className="absolute top-1 right-1">
                      <MediaItemDropdown
                        item={{
                          id: item.id,
                          title: finalGetTitle(item),
                          poster_path: item.poster_path,
                          release_date: item.release_date,
                        }}
                        contentType={contentType}
                        onWatchlistToggle={() => toggleWatchlist(item)}
                        isInWatchlist={isSaved(item)}
                      />
                    </div>
                  )}
                </div>
              </motion.div>
            ))}
          </motion.div>
        </div>

        {showMoreLink && (
          <div className="flex justify-end">
            <Link
              href={showMoreLink}
              className="text-gray-300 hover:text-white text-sm transition-all flex gap-1 items-center justify-center"
            >
              See more
              <MoveRight className="size-5" />
            </Link>
          </div>
        )}
      </>
    )
  }

  return (
    <div
      className={cn(
        'relative w-full max-w-6xl flex flex-col gap-4 mb-6',
        className
      )}
    >
      {renderHeader()}
      {renderContent()}
    </div>
  )
}

export default CinemaList



================================================================================
FILE: src/components/error/user-error-screen.tsx
================================================================================
import React from 'react'

const UserErrorScreen = () => {
  return (
    <div>UserErrorScreen</div>
  )
}

export default UserErrorScreen


================================================================================
FILE: src/components/footer.tsx
================================================================================
import { Facebook, Instagram, Twitter, Youtube } from 'lucide-react'
import Link from 'next/link'
import React from 'react'


const socialLinks = [
  {
    name: 'Instagram',
    link: 'https://instagram.com',
    icon: (
      <Instagram className='size-4' />
    ),
  },
  {
    name: 'Twitter',
    link: 'https://twitter.com',
    icon: (
      <Twitter className="size-4"
      />
    ),
  },
  {
    name: 'Facebook',
    link: 'https://facebook.com',
    icon: (
      <Facebook className="size-4" />
    ),
  },
  {
    name: 'YouTube',
    link: 'https://youtube.com',
    icon: (
      <Youtube className='size-4' />
    ),
  },
]

const Footer = () => {
  return (
    <footer className="flex items-center justify-center w-full text-gray-300">
      <div className="max-w-5xl w-full mx-auto px-4 md:px-0 py-3">
        <div className=" flex justify-between items-center">
          <div className="text-sm text-gray-400">
            Â© 2025 Escape. All rights reserved.
          </div>
          <div className="flex justify-center md:justify-start md:gap-2">
            {socialLinks.map((social, index) => (
              <Link
                key={index + social.name}
                href={social.link}
                target="_blank"
                rel="noopener noreferrer"
                className="text-gray-400 hover:text-white transition-colors duration-200 p-1 md:p-2"
                aria-label={social.name}
              >
                {social.icon}
              </Link>
            ))}
          </div>
        </div>
      </div>
    </footer>
  )
}

export default Footer



================================================================================
FILE: src/components/forms/create-post-form.tsx
================================================================================
'use client'

import { createPost, type RatingEnum } from '@/app/(user)/post/actions'
import { getRatingLabel } from '@/lib'
import { motion } from 'framer-motion'
import { X } from 'lucide-react'
import { useState } from 'react'
import Loader from '../loader'
import Input from '../input'
import TextArea from '../text-area'
import ActivityDatePicker from '../activity/activity-date-picker'
interface CreatePostFormProps {
  movieId: string
  movieTitle: string
  contentType?: 'movie' | 'tv_series'
  posterPath?: string | null
  onClose: () => void
  onSuccess?: () => void
}

export function CreatePostForm({
  movieId,
  movieTitle,
  contentType = 'movie',
  posterPath = null,
  onClose,
  onSuccess,
}: Readonly<CreatePostFormProps>) {
  const [title, setTitle] = useState('')
  const [content, setContent] = useState('')
  const [rating, setRating] = useState<RatingEnum | null>(null)
  const [isSpoiler, setIsSpoiler] = useState(false)
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState('')
  const [activityDate, setActivityDate] = useState(new Date())
  const [useCustomDate, setUseCustomDate] = useState(false)

  const ratingOptions: RatingEnum[] = [
    'TRASH',
    'TIMEPASS',
    'ONE_TIME_WATCH',
    'MUST_WATCH',
    'LEGENDARY',
  ]

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      await createPost({
        title: title.trim() || null,
        content: content.trim(),
        rating: rating || null,
        isSpoiler,
        contentId: movieId,
        contentType,
        posterPath,
        activityDate: useCustomDate ? activityDate : undefined,
      })

      onSuccess?.()
      onClose()
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to create post')
    } finally {
      setIsLoading(false)
    }
  }

  const renderRatingSelect = () => (
    <select
      value={rating ?? ''}
      onChange={(e) => setRating((e.target.value || null) as RatingEnum | null)}
      className="text-white placeholder:text-gray-300 bg-dark-gray outline-none w-full p-2 px-4 text-base focus:ring-1 focus:ring-light-green"
    >
      <option value="">No rating</option>
      {ratingOptions.map((opt) => (
        <option key={opt} value={opt}>
          {getRatingLabel(opt)}
        </option>
      ))}
    </select>
  )

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 100 }}
      exit={{ opacity: 0 }}
      className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    >
      <div className="bg-dark-gray-2 max-w-xl w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          {/* Header */}
          <div className="flex justify-between items-center mb-2">
            <div className="py-2">
              <h2 className="text-2xl font-bold text-white">Create Post</h2>
              <p className="text-gray-400 text-sm">
                Share your thoughts about {movieTitle}
              </p>
            </div>
            <button
              onClick={onClose}
              className="text-gray-300 cursor-pointer hover:text-white transition-colors"
            >
              <X className="w-6 h-6" />
            </button>
          </div>

          {/* Form */}
          <form onSubmit={handleSubmit} className="">
            {/* Title */}
            <div className="flex flex-col gap-1 py-2">
              <label
                htmlFor="title"
                className="block text-sm font-medium text-gray-300 mb-2"
              >
                Title
              </label>
              <Input
                type="text"
                id="title"
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                placeholder="Give your post a catchy title..."
                className="focus:ring-1 focus:ring-light-green"
              />
            </div>

            {/* Rating */}
            <div className="flex flex-col gap-1 py-2">
              <label
                htmlFor="rating"
                className="block text-sm font-medium text-gray-300 mb-2"
              >
                Your Rating
              </label>
              <div id="rating">{renderRatingSelect()}</div>
            </div>

            {/* Content */}
            <div className="flex flex-col gap-1 py-2">
              <label
                htmlFor="content"
                className="block text-sm font-medium text-gray-300 mb-2"
              >
                Review Content
              </label>
              <TextArea
                id="content"
                value={content}
                onChange={(e) => setContent(e.target.value)}
                placeholder={`Share your thoughts about this ${
                  contentType === 'tv_series' ? 'TV series' : 'movie'
                }...`}
                required
                rows={6}
                className="focus:ring-1 focus:ring-light-green"
              />
            </div>

            {/* Spoiler Checkbox */}
            <div className="flex items-center gap-1 py-2">
              <Input
                type="checkbox"
                id="spoiler"
                checked={isSpoiler}
                onChange={(e) => setIsSpoiler(e.target.checked)}
                className="size-4 accent-light-green"
              />
              <label htmlFor="spoiler" className="ml-1 text-gray-300">
                has spoilers ?
              </label>
            </div>

            {/* Activity Date Section */}
            <div className="py-2">
              <div className="flex items-center gap-2 mb-3">
                <Input
                  type="checkbox"
                  id="useCustomDate"
                  checked={useCustomDate}
                  onChange={(e) => setUseCustomDate(e.target.checked)}
                  className="size-4 accent-light-green"
                />
                <label htmlFor="useCustomDate" className="text-gray-300">
                  Log this activity for a different date
                </label>
              </div>

              {useCustomDate && (
                <div className="ml-6">
                  <label htmlFor="activity-date" className="block text-sm font-medium text-gray-300 mb-2">
                    Activity Date
                  </label>
                  <ActivityDatePicker
                    selectedDate={activityDate}
                    onDateChange={setActivityDate}
                    disabled={isLoading}
                  />
                  <p className="text-xs text-gray-400 mt-1">
                    When did you actually watch this {contentType === 'tv_series' ? 'series' : 'movie'}?
                  </p>
                </div>
              )}
            </div>

            {/* Error Message */}
            {error && (
              <div className="text-red-400 text-sm bg-red-900/20 border border-red-500/30 rounded-md p-3">
                {error}
              </div>
            )}

            {/* Buttons */}
            <div className="flex gap-3 pt-4">
              <button
                type="button"
                onClick={onClose}
                className="flex-1 px-4 py-2 bg-dark-gray cursor-pointer text-white"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={isLoading || !content.trim()}
                className="flex-1 px-4 py-2 bg-light-green text-white cursor-pointer hover:bg-light-green disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                {isLoading ? <Loader color="white" size="sm" /> : 'Create Post'}
              </button>
            </div>
          </form>
        </div>
      </div>
    </motion.div>
  )
}



================================================================================
FILE: src/components/forms/log-watching-form.tsx
================================================================================
'use client'

import { Calendar, Film, Tv, X } from 'lucide-react'
import { useSession } from 'next-auth/react'
import React, { useState } from 'react'
import { motion } from 'framer-motion'
import Input from '../input'
import Loader from '../loader'

interface LogWatchingFormProps {
  contentId: string
  contentType: 'movie' | 'tv_series'
  contentTitle: string
  posterPath?: string
  onClose: () => void
  onSuccess?: () => void
}

export default function LogWatchingForm({
  contentId,
  contentType,
  contentTitle,
  posterPath,
  onClose,
  onSuccess,
}: Readonly<LogWatchingFormProps>) {
  const { data: session } = useSession()
  const [selectedDate, setSelectedDate] = useState(new Date())
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!session?.user?.id) {
      setError('You must be logged in to log watching activity')
      return
    }

    setIsSubmitting(true)
    setError(null)

    try {
      const response = await fetch('/api/activity/log', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          activityType: contentType === 'tv_series' ? 'series_watched' : 'movie_watched',
          activityDate: selectedDate.toISOString(),
          contentId,
          metadata: {
            contentType,
            contentTitle,
            posterPath,
            loggedAt: new Date().toISOString(),
          },
        }),
      })

      if (!response.ok) {
        const errorData = await response.json()
        throw new Error(errorData.error || 'Failed to log activity')
      }

      onSuccess?.()
      onClose()
    } catch (err) {
      console.error('Error logging watching activity:', err)
      setError('Failed to log watching activity. Please try again.')
    } finally {
      setIsSubmitting(false)
    }
  }

  const formatDate = (date: Date) => {
    return date.toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    })
  }

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 100 }}
      exit={{ opacity: 0 }}
      className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    >
      <div className="bg-dark-gray-2 max-w-xl w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          {/* Header */}
          <div className="flex justify-between items-center mb-2">
            <div className="py-2">
              <h2 className="text-2xl font-bold text-white">Log Watching Activity</h2>
              <p className="text-gray-400 text-sm">
                Track when you watched {contentTitle}
              </p>
            </div>
            <button
              onClick={onClose}
              className="text-gray-300 cursor-pointer hover:text-white transition-colors"
            >
              <X className="w-6 h-6" />
            </button>
          </div>

          {/* Form */}
          <form onSubmit={handleSubmit} className="">
            {/* Content Info */}
            <div className="flex flex-col gap-1 py-2">
              <div className="flex items-center gap-3 p-3 bg-dark-gray rounded-lg">
                {contentType === 'tv_series' ? (
                  <Tv className="w-5 h-5 text-blue-400" />
                ) : (
                  <Film className="w-5 h-5 text-blue-400" />
                )}
                <div>
                  <h4 className="text-white font-medium">{contentTitle}</h4>
                  <p className="text-sm text-gray-400 capitalize">
                    {contentType === 'tv_series' ? 'TV Series' : 'Movie'}
                  </p>
                </div>
              </div>
            </div>

            {/* Date Selection */}
            <div className="flex flex-col gap-1 py-2">
              <label htmlFor="watch-date" className="block text-sm font-medium text-gray-300 mb-2">
                When did you watch this?
              </label>
              <div className="relative">
                <Calendar className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
                <Input
                  id="watch-date"
                  type="date"
                  value={selectedDate.toISOString().split('T')[0]}
                  onChange={(e) => setSelectedDate(new Date(e.target.value))}
                  className="pl-10 focus:ring-1 focus:ring-light-green"
                  required
                />
              </div>
              <p className="text-xs text-gray-400 mt-1">
                Selected: {formatDate(selectedDate)}
              </p>
            </div>

            {/* Error Message */}
            {error && (
              <div className="text-red-400 text-sm bg-red-900/20 border border-red-500/30 rounded-md p-3">
                {error}
              </div>
            )}

            {/* Buttons */}
            <div className="flex gap-3 pt-4">
              <button
                type="button"
                onClick={onClose}
                className="flex-1 px-4 py-2 bg-dark-gray cursor-pointer text-white"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={isSubmitting}
                className="flex-1 px-4 py-2 bg-light-green text-white cursor-pointer hover:bg-light-green disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                {isSubmitting ? <Loader color="white" size="sm" /> : 'Log Activity'}
              </button>
            </div>
          </form>
        </div>
      </div>
    </motion.div>
  )
}



================================================================================
FILE: src/components/forms/signin-form.tsx
================================================================================
'use client'

import { signIn } from 'next-auth/react'
import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Loader from '../loader'
import Input from '../input'

export function SignInForm() {
  // states
  const [status, setStatus] = useState({
    guestLogin: false,
    login: false,
  })

  const [data, setData] = useState({
    email: '',
    password: '',
  })
  const [error, setError] = useState('')
  const router = useRouter()

  // form submit function
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    setError('')
    setStatus({ ...status, login: true })
    const result = await signIn('credentials', {
      redirect: false,
      email: data.email,
      password: data.password,
    })

    if (result?.error) {
      setError(result.error)
      setStatus({ ...status, login: false })
    } else {
      setStatus({ ...status, login: false })
      router.push('/')
    }
  }
  const handleGuestLogin = async () => {
    setError('')
    setStatus({ ...status, guestLogin: true })
    const result = await signIn('credentials', {
      redirect: false,
      email: 'guest@escape.com',
      password: 'guest',
    })

    if (result?.error) {
      setError(result.error)
      setStatus({ ...status, guestLogin: false })
    } else {
      setStatus({ ...status, guestLogin: false })
      router.push('/')
    }
  }

  return (
    <form onSubmit={handleSubmit} className="w-full flex flex-col gap-2">
      <Input
        disabled={status.login}
        type="email"
        value={data.email}
        onChange={(e) => setData({ ...data, email: e.target.value })}
        placeholder="Email"
        required
        variant="primary"
      />
      <Input
        disabled={status.login}
        type="password"
        value={data.password}
        onChange={(e) => setData({ ...data, password: e.target.value })}
        placeholder="Password"
        required
        variant="primary"
      />
      {error && <p className="text-red-500">{error}</p>}
      <button
        type="submit"
        className="bg-light-green mt-2 text-white cursor-pointer p-2 w-full"
      >
        {!status.login ? (
          'Sign In'
        ) : (
          <Loader color="#ffffff" className="" size="sm" />
        )}
      </button>
      <button
        type="button"
        onClick={handleGuestLogin}
        className="bg-dark-gray-2 text-white cursor-pointer p-2 w-full"
      >
        {!status.guestLogin ? (
          'Login as guest'
        ) : (
          <Loader color="#ffffff" className="" size="sm" />
        )}
      </button>
    </form>
  )
}



================================================================================
FILE: src/components/forms/signup-form.tsx
================================================================================
'use client'

import { signup } from '@/app/(auth)/signup/actions'
import { signIn } from 'next-auth/react'
import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Loader from '../loader'
import Input from '../input'

export function SignUpForm() {
  //states
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)
  const [data, setData] = useState({
    name: '',
    email: '',
    password: '',
  })
  const router = useRouter()

  // function to handle form submission
  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()

    setError('')
    setIsLoading(true)

    try {
      const result = await signup(data)

      if (result?.success) {
        const loginResult = await signIn('credentials', {
          redirect: false,
          email: data.email,
          password: data.password,
        })

        if (loginResult?.error) {
          setError('Signup successful but login failed. Please try logging in manually.')
        } else {
          router.push('/')
        }
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Signup failed')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="w-full flex flex-col gap-2">
      <Input
        disabled={isLoading}
        type="text"
        value={data.name}
        onChange={(e) => setData({...data, name:e.target.value})}
        placeholder="Name"
        required
        variant='primary'
      />
      <Input
        disabled={isLoading}
        type="email"
        value={data.email}
        onChange={(e) => setData({...data, email:e.target.value})}
        placeholder="Email"
        required
        variant='primary'
      />
      <Input
        disabled={isLoading}
        type="password"
        value={data.password}
        onChange={(e) => setData({...data, password:e.target.value})}
        placeholder="Password"
        required
        variant='primary'
      />
      {error && <p className="text-red-500">{error}</p>}
      <button
        type="submit"
        disabled={isLoading}
        className="bg-light-green my-2 text-white cursor-pointer p-2 w-full disabled:cursor-not-allowed disabled:opacity-50"
      >
        {!isLoading ? (
          'Sign Up'
        ) : (
          <Loader color="#ffffff" className="" size="sm" />
        )}
      </button>
    </form>
  )
}



================================================================================
FILE: src/components/header.tsx
================================================================================
import { cn } from '@/lib'
import React from 'react'

interface HeaderProps {
  title: string
  subHeading?: string
  className?:string
}

const Header = ({ title, subHeading,className }: HeaderProps) => {
  return (
    <div className={cn('mb-6',className)}>
      <div className="flex items-center gap-3 mb-2">
        <div className="w-0.5 h-8 bg-light-green rounded-full"></div>
        <h1 className="text-2xl text-gray-200 font-light">{title}</h1>
      </div>
      {subHeading && <div className="max-md:hidden text-sm text-gray-400">{subHeading}</div>}
    </div>
  )
}

export default Header



================================================================================
FILE: src/components/input.tsx
================================================================================
import { cn } from '@/lib'
import React, { forwardRef } from 'react'

interface InputProps {
  id?: string
  disabled?: boolean
  value?: string
  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void
  placeholder?: string
  required?: boolean
  type?: 'text' | 'checkbox' | 'email' | 'password' | 'date'
  className?: string
  variant?: 'primary' | 'secondary'
  size?: 'sm' | 'md' | 'lg'
  autoFocus?: boolean
  checked?: boolean
}

const Input = forwardRef<HTMLInputElement, InputProps>(({
  id = '',
  disabled = false,
  type = 'text',
  value = '',
  onChange,
  required = false,
  placeholder,
  className = '',
  variant = 'primary',
  size = 'md',
  checked = false,
  autoFocus = false,
}, ref) => {
  const currentClassName = {
    primary:
      'text-white placeholder:text-gray-300 bg-dark-gray outline-none w-full',
    secondary:
      'text-white placeholder:text-gray-300 bg-dark-gray-2 outline-none w-full',
  }

  const sizeClasses = {
    sm: 'text-sm p-1.5 px-3',
    md: 'text-base p-2 px-4',
    lg: 'text-base p-3 px-5',
  }
  return (
    <input
      ref={ref}
      id={id}
      disabled={disabled}
      type={type}
      value={value}
      onChange={onChange}
      placeholder={placeholder}
      required={required}
      checked={checked}
      autoFocus={autoFocus}
      className={cn(currentClassName[variant], sizeClasses[size], className)}
    />
  )
})

Input.displayName = 'Input'

export default Input



================================================================================
FILE: src/components/loader.tsx
================================================================================
import React from 'react'

interface LoaderProps {
  size?: 'sm' | 'md' | 'lg' | 'xl'
  color?: string
  className?: string,
  text?:string
}

const Loader: React.FC<LoaderProps> = ({
  size = 'lg',
  color = '#009D1A',
  className = '',
  text,
}) => {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-6 h-6',
    lg: 'w-8 h-8',
    xl: 'w-12 h-12',
  }
  const textSize = {
    sm: "text-xs",
    md: "text-xs",
    lg:"text-sm",
    xl:"text-base"
  }

  return (
    <div className={`inline-block w-fit ${sizeClasses[size]} ${className}`}>
      <svg
        className={`animate-spin w-full h-full`}
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle
          cx="12"
          cy="12"
          r="10"
          stroke={color}
          strokeWidth="2"
          strokeLinecap="round"
          strokeDasharray="31.416"
          strokeDashoffset="31.416"
          className="animate-dash"
        />
      </svg>
      <span className={`text-gray-300 ${textSize[size]}`}>{text}</span>
    </div>
  )
}

export default Loader


================================================================================
FILE: src/components/media-item-dropdown.tsx
================================================================================
'use client'

import { Bookmark, Bug, Calendar, MoreVertical, Plus, X } from 'lucide-react'
import { useSession } from 'next-auth/react'
import { useRouter } from 'next/navigation'
import React, { useRef, useState, useEffect } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import LogWatchingForm from './forms/log-watching-form'
import { CreatePostForm } from './forms/create-post-form'
import ShareButton from './buttons/share-button'

/**
 * MediaItemDropdown - A reusable dropdown component for media items
 *
 * Features:
 * - Three-dot menu that appears on hover
 * - Review functionality
 * - Log Watching functionality with date selection
 * - Add/Remove from Watchlist functionality
 * - Share functionality (copies URL to clipboard)
 * - Report functionality
 * - Consistent styling with the rest of the app
 *
 * Usage:
 * <MediaItemDropdown
 *   item={{
 *     id: 123,
 *     title: "Movie Title",
 *     poster_path: "/path/to/poster.jpg",
 *     release_date: "2024-01-01"
 *   }}
 *   contentType="movie" // or "tv_series"
 *   onWatchlistToggle={() => console.log('Toggle watchlist')}
 *   isInWatchlist={false}
 * />
 */

interface MediaItemDropdownProps {
  item: {
    id: number
    title: string
    poster_path?: string | null
    release_date?: string
  }
  contentType: 'movie' | 'tv_series'
  onWatchlistToggle?: () => void
  isInWatchlist?: boolean
  customButton?: React.ReactNode
}

export default function MediaItemDropdown({
  item,
  contentType,
  onWatchlistToggle,
  isInWatchlist = false,
  customButton,
}: Readonly<MediaItemDropdownProps>) {
  const { data: session } = useSession()
  const router = useRouter()
  const [isOpen, setIsOpen] = useState(false)
  const [showLogForm, setShowLogForm] = useState(false)
  const [showCreatePost, setShowCreatePost] = useState(false)
  const [isSmallScreen, setIsSmallScreen] = useState(false)
  const dropdownRef = useRef<HTMLDivElement>(null)
  const buttonRef = useRef<HTMLButtonElement>(null)

  // Detect screen size
  useEffect(() => {
    const checkScreenSize = () => {
      setIsSmallScreen(window.innerWidth < 768) // md breakpoint
    }

    checkScreenSize()
    window.addEventListener('resize', checkScreenSize)

    return () => {
      window.removeEventListener('resize', checkScreenSize)
    }
  }, [])

  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        dropdownRef.current &&
        !dropdownRef.current.contains(event.target as Node)
      ) {
        setIsOpen(false)
      }
    }

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isOpen])

  const handleCreatePost = () => {
    setIsOpen(false)
    if (!session) {
      router.push('/signin')
      return
    }
    setShowCreatePost(true)
  }

  const handleLogWatching = () => {
    setIsOpen(false)
    if (!session) {
      router.push('/signin')
      return
    }
    setShowLogForm(true)
  }

  const handleWatchlist = () => {
    setIsOpen(false)
    if (!session) {
      router.push('/signin')
      return
    }
    onWatchlistToggle?.()
  }

  const handleReport = () => {
    setIsOpen(false)
    // For now, just show an alert. In a real app, this would open a report form or modal
    alert('Content reported. Thank you for your feedback!')
  }

  const handleButtonClick = () => {
    setIsOpen(!isOpen)
  }

  return (
    <>
      <div className="relative" ref={dropdownRef}>
        {customButton ? (
          <button type="button" onClick={handleButtonClick} className="inline-flex">
            {customButton}
          </button>
        ) : (
          <button
            ref={buttonRef}
            onClick={handleButtonClick}
            className={`absolute top-1 right-1 p-1 bg-dark-gray cursor-pointer ${
              isOpen
                ? 'opacity-100 md:opacity-100'
                : 'md:opacity-0 group-hover:opacity-100'
            } transition-opacity z-40`}
            aria-label="More options"
          >
            <MoreVertical className="size-4 text-white" />
          </button>
        )}

        <AnimatePresence mode="wait">
          {isOpen && (
            <>
              {isSmallScreen ? (
                // Full screen modal for small screens
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  transition={{ duration: 0.2 }}
                  className="fixed inset-0 bg-black/50 z-[100] flex items-end"
                  onClick={() => setIsOpen(false)}
                >
                  <motion.div
                    initial={{ y: '100%' }}
                    animate={{ y: 0 }}
                    exit={{ y: '100%' }}
                    transition={{ duration: 0.3, ease: 'easeOut' }}
                    className="w-full bg-dark-gray-2 border-t border-white/5 rounded-t-2xl py-6"
                    onClick={(e) => e.stopPropagation()}
                  >
                    {/* Header */}
                    <div className="flex items-center justify-between mb-6 px-6">
                      <h3 className="text-xl font-light text-white">Options</h3>
                      <button
                        onClick={() => setIsOpen(false)}
                        className="p-2 bg-dark-gray-hover transition-colors"
                      >
                        <X className="size-5 text-gray-300" />
                      </button>
                    </div>

                    {/* Menu Items */}
                    <div className="flex flex-col gap-2">
                      <motion.button
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.1, duration: 0.2 }}
                        onClick={handleCreatePost}
                        className="flex items-center gap-4 px-4 py-4 text-base text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                      >
                        <Plus className="size-5" />
                        Review
                      </motion.button>
                      <motion.button
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.15, duration: 0.2 }}
                        onClick={handleLogWatching}
                        className="flex items-center gap-4 px-4 py-4 text-base text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                      >
                        <Calendar className="size-5" />
                        Log
                      </motion.button>
                      <motion.button
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.2, duration: 0.2 }}
                        onClick={handleWatchlist}
                        className="flex items-center gap-4 px-4 py-4 text-base text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                      >
                        <Bookmark
                          className={`size-5 ${
                            isInWatchlist
                              ? 'fill-light-green text-light-green'
                              : ''
                          }`}
                        />
                        Save
                      </motion.button>
                      <motion.div
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.25, duration: 0.2 }}
                        className="px-4 py-4 hover:bg-dark-gray-hover transition-colors"
                      >
                        <ShareButton />
                      </motion.div>
                      <motion.button
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.3, duration: 0.2 }}
                        onClick={handleReport}
                        className="flex items-center gap-4 px-4 py-4 text-base text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                      >
                        <Bug className="size-5" />
                        Report
                      </motion.button>
                    </div>
                  </motion.div>
                </motion.div>
              ) : (
                // Regular dropdown for larger screens
                // Regular dropdown for larger screens
                <motion.div
                  initial={{ opacity: 0, scale: 0.95 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.95 }}
                  transition={{ duration: 0.15, ease: 'easeOut' }}
                  className="absolute right-1 translate-y-7 top-full bg-dark-gray-2 border border-white/15 z-40 w-[140px] shadow-sm"
                >
                  <div className="flex flex-col gap-1">
                    <motion.button
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.1, duration: 0.15 }}
                      onClick={handleCreatePost}
                      className="flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                    >
                      <Plus className="size-4" />
                      Review
                    </motion.button>
                    <motion.button
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.125, duration: 0.15 }}
                      onClick={handleLogWatching}
                      className="flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                    >
                      <Calendar className="size-4" />
                      Log
                    </motion.button>
                    <motion.button
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.15, duration: 0.15 }}
                      onClick={handleWatchlist}
                      className="flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                    >
                      <Bookmark
                        className={`size-4 ${
                          isInWatchlist
                            ? 'fill-light-green text-light-green'
                            : ''
                        }`}
                      />
                      Save
                    </motion.button>
                    <motion.div
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.175, duration: 0.15 }}
                    >
                      <ShareButton />
                    </motion.div>
                    <motion.button
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.2, duration: 0.15 }}
                      onClick={handleReport}
                      className="flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                    >
                      <Bug className="size-4" />
                      Report
                    </motion.button>
                  </div>
                </motion.div>
              )}
            </>
          )}
        </AnimatePresence>
      </div>

      {/* Log Watching Form */}
      <AnimatePresence mode="wait">
        {showLogForm && (
          <LogWatchingForm
            contentId={item.id.toString()}
            contentType={contentType}
            contentTitle={item.title}
            posterPath={item.poster_path || undefined}
            onClose={() => setShowLogForm(false)}
            onSuccess={() => {
              // Optionally refresh data or show success message
            }}
          />
        )}
      </AnimatePresence>

      {/* Review Form */}
      <AnimatePresence mode="wait">
        {showCreatePost && (
          <CreatePostForm
            movieId={item.id.toString()}
            movieTitle={item.title}
            contentType={contentType}
            posterPath={item.poster_path}
            onClose={() => setShowCreatePost(false)}
            onSuccess={() => {
              // Optionally refresh data or show success message
            }}
          />
        )}
      </AnimatePresence>
    </>
  )
}



================================================================================
FILE: src/components/navbar.tsx
================================================================================
'use client'

import { ChevronDown, LogOut, Search, X } from 'lucide-react'
import { signOut, useSession } from 'next-auth/react'
import Image from 'next/image'
import Link from 'next/link'
import { useRouter } from 'next/navigation'
import { useEffect, useRef, useState } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import Loader from './loader'
import Input from './input'

const navbarItems = [
  {
    name: 'lists',
    link: '/lists',
  },
  {
    name: 'trending',
    link: '/trending',
  },
]

const Navbar = () => {
  const [isSearchOpen, setIsSearchOpen] = useState(false)
  const [searchQuery, setSearchQuery] = useState('')
  const handleSearchToggle = () => {
    setIsSearchOpen(!isSearchOpen)
    if (isSearchOpen) {
      setSearchQuery('')
    }
  }
  const router = useRouter()
  const handleSearchSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    router.push('/search?q=' + searchQuery)
  }

  const searchInputRef = useRef<HTMLInputElement>(null)

  useEffect(() => {
    if (isSearchOpen && searchInputRef.current) {
      setTimeout(() => {
        searchInputRef.current?.focus()
      }, 50)
    }

    return () => {}
  }, [isSearchOpen])
  const container = useRef<HTMLDivElement>(null)
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        container.current &&
        !container.current.contains(event.target as Node) &&
        isSearchOpen
      ) {
        setIsSearchOpen(false)
      }
    }

    if (isSearchOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isSearchOpen])

  return (
    <div className="sticky max-md:px-2 max-md:pl-4 top-0 left-0 right-0 bg-dark-gray z-50 w-full ">
      <div className="w-full flex justify-center items-center">
        <div className="w-full max-w-5xl">
          <div className="flex items-center justify-between gap-2 md:gap-4 h-13 md:h-14 min-w-0">
            <Link href={'/'} className="flex items-center gap-2">
              <div className="flex space-x-1">
                <Image
                  alt="logo"
                  className=""
                  src={'/logo-light.png'}
                  width={20}
                  height={20}
                />
              </div>
              <span className="text-xl text-white max-md:hidden">Escape</span>
            </Link>

            <div className="flex items-center gap-1 md:gap-2 min-w-0">
              <div
                className={`flex items-center gap-2 md:gap-3 font-light transition-all duration-300 ${
                  isSearchOpen
                    ? 'opacity-0 scale-95 translate-x-2 pointer-events-none'
                    : 'opacity-100 scale-100 translate-x-0'
                }`}
              >
                {navbarItems.map((item, index) => {
                  return (
                    <Link
                      key={index + item.name}
                      href={item.link}
                      className={`text-gray-300 capitalize hover:text-white transition-colors text-sm md:text-base ${isSearchOpen ? "hidden":""}`}
                    >
                      {item.name}
                    </Link>
                  )
                })}
              </div>

              {/* Search Input */}
              <div
                ref={container}
                className={`transition-all duration-300 ease-in-out ${
                  isSearchOpen
                    ? 'w-48 md:w-64 opacity-100 scale-100'
                    : 'w-0 opacity-0 scale-95 overflow-hidden'
                }`}
              >
                <form onSubmit={handleSearchSubmit} className="relative">
                  <Input
                    type="text"
                    ref={searchInputRef}
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    placeholder="Search..."
                    variant="secondary"
                    autoFocus={isSearchOpen}

                  />
                </form>
              </div>

              <button
                className={`flex gap-1 justify-center h-full items-center p-2 transition-all duration-300 ${
                  isSearchOpen ? 'bg-light-green text-white' : 'text-gray-300'
                }`}
                onClick={
                  !isSearchOpen ? handleSearchToggle : handleSearchSubmit
                }
              >
                <Search className="w-5 h-5" />
              </button>
              <RenderAuthSection />
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}

const RenderAuthSection = () => {
  const dropdownItems = [
    {
      name: 'profile',
      link: '/profile',
    },
    {
      name: 'watchlist',
      link: '/profile/watchlist',
    },
    {
      name: 'lists',
      link: '/profile/lists',
    },
    {
      name: 'reviews',
      link: '/profile/reviews',
    },
    {
      name: 'notifications',
      link: '/profile/notifications',
    },
    {
      name: 'settings',
      link: '/settings',
    },

  ]
  const { data: session, status } = useSession()
  const [isDropdownOpen, setIsDropdownOpen] = useState(false)
  const [isHovered, setIsHovered] = useState(false)

  // Handle click outside behavior for mobile
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      const target = event.target as Element
      const isMobile = window.innerWidth < 768

      if (isMobile) {
        if (!target.closest('.dropdown-container')) {
          setIsDropdownOpen(false)
        }
      }
    }

    if (isDropdownOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isDropdownOpen])

  if ( status === 'loading') {
    return (
      <div className="cursor-not-allowed w-10 max-md:rounded-full md:w-36 h-10 bg-dark-gray-hover flex items-center justify-center text-gray-600 gap-1 animate-pulse">
        <span className='max-md:hidden'>Loading</span>
        <Loader size="sm" />
      </div>
    )
  }

  if (session) {
    const userImage = session.user.image ?? ""
    const username = session.user?.name?.split(' ')[0]
    const menuVariants = {
      open: {
        transition: {
          staggerChildren: 0.05,
          delayChildren: 0,
        },
      },
      closed: {
        transition: {
          staggerChildren: 0.05,
          staggerDirection: -1,
        },
      },
    }
    const itemVariants = {
      closed: { opacity: 0, x: -10 },
      open: { opacity: 1, x: 0 },
    }
    return (
      <div
        className="relative w-10 md:w-36 group dropdown-container"
        onMouseEnter={() => {
          // Keep dropdown open when hovering over the entire container
          if (window.innerWidth >= 768) {
            setIsHovered(true)
          }
        }}
        onMouseLeave={() => {
          // Close on hover leave for desktop
          if (window.innerWidth >= 768) {
            setIsHovered(false)
          }
        }}
        role="menu"
        aria-label="User profile dropdown"
        tabIndex={-1}
      >
        <button
          className={`flex w-full max-md:rounded-full h-10 justify-center md:justify-around items-center md:space-x-2  md:p-4 transition-colors ${
            isDropdownOpen || isHovered
              ? 'bg-dark-gray-2'
              : 'bg-dark-gray-hover group-hover:bg-dark-gray-2'
          }`}
          onClick={() => {
            // Only toggle on mobile devices
            if (window.innerWidth < 768) {
              setIsDropdownOpen(!isDropdownOpen)
            }
          }}
        >
          <div className="md:size-8 size-10 bg-light-green rounded-full flex items-center justify-center">
            <Image
              src={userImage}
              className="rounded-full"
              alt="Profile"
              width={34}
              height={34}
              unoptimized={userImage.includes('dicebear')}
            />
          </div>
          <span className="text-gray-300 text-sm hidden md:block">
            {username || 'Profile'}
          </span>
          <motion.div
            animate={{ rotate: isDropdownOpen || isHovered ? 180 : 0 }}
            transition={{ duration: 0.2, ease: 'easeInOut' }}
          >
            <ChevronDown className="size-4 max-md:hidden text-gray-300" />
          </motion.div>
        </button>
        {/* Dropdown Menu */}
        <AnimatePresence mode="wait">
          {(isDropdownOpen || isHovered) && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, transition: { delay: innerWidth<768 ? 0.56 : 0 } }}
              transition={{
                ease: 'easeOut',
                type: 'spring',
                stiffness: 300,
                damping: 30,
              }}
              className="fixed md:absolute right-0 z-[100] border border-dark-gray-2 top-0 md:top-full inset-0 md:inset-auto h-screen md:h-auto w-screen md:w-36 bg-dark-gray-2"
            >
              <motion.div
                className="flex flex-col h-full md:h-auto pt-4 md:pt-0 px-0"
                variants={menuVariants}
                initial="closed"
                animate="open"
                exit="closed"
              >
                {/* Close Button */}
                <motion.div
                  className="flex justify-end mb-4 md:hidden pr-4"
                >
                  <button
                    onClick={() => {
                      setIsDropdownOpen(false)
                      setIsHovered(false)
                    }}
                    className="p-2 mr-2 text-gray-300 hover:text-white hover:bg-dark-gray-hover transition-colors"
                  >
                    <X className="w-6 h-6" />
                  </button>
                </motion.div>
                {dropdownItems.map((item, index) => {
                  return (
                    <motion.div key={item.name + index} variants={itemVariants}>
                      <Link
                        href={item.link}
                        className="block capitalize px-4 py-4 md:py-2 text-lg md:text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors border-b border-dark-gray-hover md:border-b-0 max-md:text-2xl"
                        onClick={() => {
                          // Close dropdown when clicking any menu item
                          setIsDropdownOpen(false)
                          setIsHovered(false)
                        }}
                      >
                        {item.name}
                      </Link>
                    </motion.div>
                  )
                })}
                <motion.div variants={itemVariants}>
                  <button
                    onClick={() => {
                      signOut({ callbackUrl: '/' })
                      // Close dropdown when clicking sign out
                      setIsDropdownOpen(false)
                      setIsHovered(false)
                    }}
                    className="w-full cursor-pointer text-left px-4 py-4 md:py-2 text-lg md:text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors flex items-center space-x-2 border-b border-dark-gray-hover md:border-b-0 max-md:text-2xl"
                  >
                    <LogOut className="size-5 md:w-4 md:h-4" />
                    <span>Sign Out</span>
                  </button>
                </motion.div>
              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    )
  }

  return (
    <div className="flex w-20 md:w-36 items-center">
      <Link
        href="/signin"
        className="md:hidden w-full h-10 text-gray-300 bg-dark-gray-hover transition-colors px-2 flex items-center justify-center"
      >
        SignIn
      </Link>
      <Link
        href="/signin"
        className="max-md:hidden w-full h-10 text-gray-300 bg-dark-gray-hover transition-colors px-4 flex items-center justify-center"
      >
        Get Started
      </Link>
    </div>
  )
}

export default Navbar



================================================================================
FILE: src/components/page/building.tsx
================================================================================
import Link from 'next/link'

export const Building = () => {
  return (
    <section className="relative grid place-content-center overflow-hidden px-4 py-24 text-slate-200">
      <div className="relative z-10 flex flex-col items-center">
        <span className="text-4xl bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
          Building in progress
        </span>

        <p className="my-8 max-w-2xl text-center text-lg leading-relaxed text-slate-300 md:text-xl md:leading-relaxed">
          We&apos;re working hard to bring you an incredible experience. Come
          back later to explore this page.
        </p>
      </div>
      <Link
        href={'/'}
        className="bg-dark-gray w-fit mx-auto px-4 py-2 my-4 text-gray-300 cursor-pointer"
      >
        Please Take Me Home
      </Link>
    </section>
  )
}

export default Building



================================================================================
FILE: src/components/page/home/feed-component.tsx
================================================================================
import { getAllFeedPosts } from '@/app/(user)/post/actions'
import Header from '@/components/header'
import PostList from '@/components/post-list'
import { getPosterUrl, hideContent } from '@/lib'
import { Suspense } from 'react'

function FeedSkeleton() {
  return (
    <div className="w-full py-10">
      <h1 className="text-2xl text-gray-300 mb-4">Reviews</h1>
      <div className="flex flex-col gap-3">
        {Array.from({ length: 3 }, (_, i) => (
          <div key={`loading-skeleton-${i}`} className="p-6 px-4 animate-pulse">
            <div className="flex gap-4">
              <div className="flex-shrink-0">
                <div className="w-36 h-48 bg-dark-gray"></div>
              </div>
              <div className="flex flex-col min-w-0 w-full">
                <div className="flex items-center gap-1 mb-2">
                  <div className="w-8 h-8 bg-dark-gray rounded-full"></div>
                  <div className="h-4 bg-dark-gray w-20"></div>
                </div>
                <div className="mb-1">
                  <div className="h-6 bg-dark-gray w-48 mb-1"></div>
                  <div className="h-4 bg-dark-gray w-12"></div>
                </div>
                <div className="flex items-center gap-3 mb-1">
                  <div className="flex gap-1">
                    {Array.from({ length: 5 }, (_, j) => (
                      <div key={j} className="w-4 h-4 bg-dark-gray"></div>
                    ))}
                  </div>
                  <div className="flex items-center gap-1">
                    <div className="w-4 h-4 bg-dark-gray"></div>
                    <div className="h-4 bg-dark-gray w-6"></div>
                  </div>
                </div>
                <div className="mb-4">
                  <div className="h-3 bg-dark-gray w-full mb-1"></div>
                  <div className="h-3 bg-dark-gray w-5/6 mb-1"></div>
                  <div className="h-3 bg-dark-gray w-4/5"></div>
                </div>
                <div className="flex items-center gap-2">
                  <div className="flex items-center gap-2">
                    <div className="w-4 h-4 bg-dark-gray"></div>
                    <div className="h-4 bg-dark-gray w-20"></div>
                  </div>
                  <div className="h-4 bg-dark-gray w-12"></div>
                </div>
              </div>
            </div>
            <div className="mt-6 w-[80%] mx-auto h-0.5 bg-dark-gray"></div>
          </div>
        ))}
      </div>
    </div>
  )
}

async function FeedServer() {
  try {
    const posts = await getAllFeedPosts()

    if (posts.length === 0) {
      return (
        <div className="py-6 text-center ">
          <p className="text-gray-400">
            No reviews yet. Be the first to share your thoughts!
          </p>
        </div>
      )
    }

    const genericPosts = posts.map((post) => {
      const posterUrl = getPosterUrl(post.movie?.posterPath ?? null, 'w500')
      const isSpoiler = post.isSpoiler
      const safeTitle = isSpoiler
        ? hideContent(post.title ?? '')
        : post.title ?? null
      const safeContent = isSpoiler ? hideContent(post.content) : post.content

      return {
        id: post.id,
        title: safeTitle,
        content: safeContent,
        rating: post.rating,
        isSpoiler,
        createdAt: post.createdAt,
        posterUrl,
        user: {
          name: post.user?.name ?? null,
          image: post.user?.image ?? null,
        },
        movie: post.movie
          ? {
              id: post.movie.id,
              type: post.movie.type,
              posterPath: post.movie.posterPath,
            }
          : undefined,
        likes: post.likes,
        dislikes: post.dislikes,
        _count: { comments: post._count.comments },
      }
    })
    return (
      <div className="">
        <Header title="Reviews" subHeading='Discover top reviews' />
        <PostList
          posts={genericPosts}
          emptyText="No reviews yet. Be the first to share your thoughts!"
        />
      </div>
    )
  } catch (error) {
    console.error('Error fetching feed data:', error)
    return (
      <div className="py-6 text-center">
        <p className="text-red-400">Failed to load reviews</p>
      </div>
    )
  }
}

export default function FeedComponent() {
  return (
    <Suspense fallback={<FeedSkeleton />}>
      <div className="w-full">
        <FeedServer />
      </div>
    </Suspense>
  )
}



================================================================================
FILE: src/components/page/home/in-cinema-component.tsx
================================================================================
'use client'

import React from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../types/media'

const InCinemaComponent = () => {
  const getYear = (item: MediaItem) => {
    return new Date(item.release_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  return (
    <CinemaList
      title="Now in Cinema"
      subHeading="Discover what's trending in cinema"
      apiUrl="/api/now-playing"
      linkPath={(id) => `/movie/${id}`}
      scrollContainerClass="cinema-scroll-container"
      showMoreLink="/cinema"
      getYear={getYear}
      getTitle={getTitle}
      showEmptyState={true}
      contentType="movie"
      showDropdown={true}
    />
  )
}

export default InCinemaComponent


================================================================================
FILE: src/components/page/home/trending-movie-component.tsx
================================================================================
'use client'

import React, { useState } from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../types/media'

const TrendingMovieComponent = () => {
  const [watchlistItems, setWatchlistItems] = useState<Set<number>>(new Set())

  const getYear = (item: MediaItem) => {
    return new Date(item.release_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  const handleWatchlistToggle = (item: MediaItem) => {
    setWatchlistItems(prev => {
      const newSet = new Set(prev)
      if (newSet.has(item.id)) {
        newSet.delete(item.id)
      } else {
        newSet.add(item.id)
      }
      return newSet
    })
  }

  const getWatchlistStatus = (item: MediaItem) => {
    return watchlistItems.has(item.id)
  }

  return (
    <CinemaList
      title="Trending Movies"
      subHeading="Discover trending movies"
      apiUrl="/api/popular-movie"
      linkPath={(id) => `/movie/${id}`}
      scrollContainerClass="trending-scroll-container"
      showMoreLink="/trending"
      getYear={getYear}
      getTitle={getTitle}
      showEmptyState={true}
      contentType="movie"
      showDropdown={true}
      onWatchlistToggle={handleWatchlistToggle}
      getWatchlistStatus={getWatchlistStatus}
    />
  )
}

export default TrendingMovieComponent



================================================================================
FILE: src/components/page/home/trending-web-series-component.tsx
================================================================================
'use client'

import React, { useState } from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../types/media'

const TrendingWebSeriesComponent = () => {
  const [watchlistItems, setWatchlistItems] = useState<Set<number>>(new Set())

  const getYear = (item: MediaItem) => {
    return new Date(item.first_air_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  const handleWatchlistToggle = (item: MediaItem) => {
    setWatchlistItems(prev => {
      const newSet = new Set(prev)
      if (newSet.has(item.id)) {
        newSet.delete(item.id)
      } else {
        newSet.add(item.id)
      }
      return newSet
    })
  }

  const getWatchlistStatus = (item: MediaItem) => {
    return watchlistItems.has(item.id)
  }

  return (
    <CinemaList
      title="Trending Web Series"
      subHeading='Discover trending webseries'
      apiUrl="/api/trending-series"
      linkPath={(id) => `/web-series/${id}`}
      scrollContainerClass="trending-tv-scroll-container"
      showMoreLink="/trending"
      getYear={getYear}
      getTitle={getTitle}
      showEmptyState={true}
      contentType="tv_series"
      showDropdown={true}
      onWatchlistToggle={handleWatchlistToggle}
      getWatchlistStatus={getWatchlistStatus}
    />
  )
}

export default TrendingWebSeriesComponent



================================================================================
FILE: src/components/page/movie/movie-details-component.tsx
================================================================================
'use client'
import { CreatePostForm } from '@/components/forms/create-post-form'
import LogWatchingForm from '@/components/forms/log-watching-form'
import { AnimatePresence } from 'framer-motion'
import { Plus } from 'lucide-react'
import { useSession } from 'next-auth/react'
import Image from 'next/image'
import Link from 'next/link'
import { useRouter } from 'next/navigation'
import React, { useState } from 'react'
import AnimatePageWrapper from '../../animate-page-wrapper'
import { PostsSection } from '../../posts-section'
import AiRecommendationComponent from '../../ai-recommendation-component'
import MovieRecommendation from './movie-recommendation'
import MediaItemDropdown from '../../media-item-dropdown'
import { formatDate } from '@/lib'

import type { MovieDetails } from '@/types/tmdb'

interface MovieDetailsComponentProps {
  movie: MovieDetails | null
}

const MovieDetailsComponent: React.FC<MovieDetailsComponentProps> = ({
  movie,
}) => {
  const [showCreatePost, setShowCreatePost] = useState(false)
  const [showLogForm, setShowLogForm] = useState(false)
  const [refreshPosts, setRefreshPosts] = useState(0)
  const router = useRouter()
  const { data: session } = useSession()


  const formatRuntime = (minutes: number | null) => {
    if (!minutes) return 'N/A'
    const hours = Math.floor(minutes / 60)
    const mins = minutes % 60
    return `${hours}h ${mins}m`
  }


  const getImageUrl = (
    path: string | null,
    size: 'w500' | 'w780' | 'original' = 'w500'
  ) => {
    if (!path) return '/placeholder-movie.jpg'
    return `https://image.tmdb.org/t/p/${size}${path}`
  }

  const handleWatchlist = () => {
    if (!session) {
      router.push('/signin')
    }
    // Watchlist functionality not implemented yet
  }

    if (!movie) {
      return (
        <div className="h-full flex items-center justify-center">
          <div className="text-center">
            <h1 className="text-2xl font-bold text-white mb-2">
              Movie Not Found
            </h1>
            <p className="text-gray-300 mb-4">
              The movie you&apos;re looking for doesn&apos;t exist or has been
              removed.
            </p>
            <Link
              href="/"
              className="bg-dark-gray-hover text-white px-4 py-2 cursor-pointer"
            >
              Go back to Home
            </Link>
          </div>
        </div>
      )
    }

  const renderMobile = () => (
    <div className="md:hidden">
      <div className="flex items-start gap-4">
        <div className="w-[40%] max-w-[160px]">
          <Image
            src={getImageUrl(movie.poster_path)}
            alt={movie.title}
            height={240}
            width={160}
            className="w-full object-center"
          />
        </div>
        <div className="flex-1 text-gray-300">
          <div className="mb-2">
            <h2 className="text-2xl font-bold text-white mb-1">
              {movie.title}
            </h2>
            {movie.original_title !== movie.title && (
              <p className="text-base text-gray-200 mb-2">
                {movie.original_title}
              </p>
            )}
            {movie.tagline && (
              <p className="text-sm italic text-gray-400">
                &quot;{movie.tagline}&quot;
              </p>
            )}
          </div>
          <div className="flex flex-wrap items-center gap-3 mb-3">
            <div className="flex items-center gap-1">
              <svg
                className="w-4 h-4 text-yellow-400"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <span className="text-sm font-semibold">
                {movie.vote_average.toFixed(1)}
              </span>
              <span className="text-xs text-gray-400">
                ({movie.vote_count})
              </span>
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Runtime:</span>{' '}
              {formatRuntime(movie.runtime)}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Release:</span>{' '}
              {formatDate(movie.release_date)}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Status:</span> {movie.status}
            </div>
          </div>
          <div className="flex flex-wrap gap-2 mb-3">
            {movie.genres.map((genre) => (
              <span
                key={genre.id}
                className="px-2 py-0.5 bg-light-green/20 text-light-green text-xs font-medium border border-light-green/30"
              >
                {genre.name}
              </span>
            ))}
          </div>
          <div className="flex flex-wrap gap-2">
            <div className="relative group">
              <MediaItemDropdown
                item={{
                  id: movie.id,
                  title: movie.title,
                  poster_path: movie.poster_path,
                  release_date: movie.release_date
                }}
                contentType="movie"
                onWatchlistToggle={handleWatchlist}
                isInWatchlist={false}
                customButton={
                  <button
                    className="h-9 px-3 inline-flex items-center gap-2 text-sm bg-dark-gray-hover/80 text-gray-200 hover:text-white hover:bg-dark-gray-2 transition-colors"
                    aria-label="Create Post"
                  >
                    <Plus className="size-4" />
                    Create Post
                  </button>
                }
              />
            </div>
          </div>
        </div>
      </div>

      {/* The rest (overview, production, languages, links) under the header on small screens */}
      <div className="mt-6 text-gray-300">
        <div className="py-3">
          <h3 className="text-lg text-white font-semibold mb-2">Overview</h3>
          <p className="leading-relaxed text-sm">{movie.overview}</p>
        </div>

        <div className="grid grid-cols-1 gap-6">
          {movie.production_companies.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">
                Production Companies
              </h3>
              <div className="space-y-1 text-sm">
                {movie.production_companies.map((company) => (
                  <div key={company.id} className="flex items-center gap-2">
                    {company.logo_path && (
                      <Image
                        src={getImageUrl(company.logo_path)}
                        alt={company.name}
                        width={24}
                        height={24}
                        className="object-contain rounded"
                      />
                    )}
                    <span className="">{company.name}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          {movie.production_countries.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">
                Production Countries
              </h3>
              <div className="space-y-1 text-sm">
                {movie.production_countries.map((country) => (
                  <span key={country.iso_3166_1}>{country.name}</span>
                ))}
              </div>
            </div>
          )}

          {movie.spoken_languages.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">
                Spoken Languages
              </h3>
              <div className="space-y-1 text-sm">
                {movie.spoken_languages.map((language) => (
                  <span key={language.iso_639_1}>{language.english_name}</span>
                ))}
              </div>
            </div>
          )}
        </div>

        <div className="pt-6">
          <div className="flex gap-4">
            {movie.imdb_id && (
              <a
                href={`https://www.imdb.com/title/${movie.imdb_id}`}
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-300 hover:text-blue-400 font-medium underline-offset-4 hover:underline"
              >
                View on IMDb
              </a>
            )}
            {movie.homepage && (
              <a
                href={movie.homepage}
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-300 hover:text-blue-400 font-medium underline-offset-4 hover:underline"
              >
                Official Website
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
  )

  const renderDesktop = () => (
    <div className="hidden md:flex flex-col w-full lg:flex-row gap-8">
      {/* Poster */}
      <div className="md:sticky top-[70px] left-0 md:max-w-[20%] max-w-[50%] mx-auto w-full h-full">
        <Image
          src={getImageUrl(movie.poster_path)}
          alt={movie.title}
          height={300}
          width={300}
          className="w-full object-center"
        />
      </div>

      {/* Movie Details */}
      <div className="flex w-full">
        <div className="text-gray-300 w-full">
          {/* Title and Basic Info */}
          <div className="flex justify-between w-full">
            <div className="mb-2">
              <h1 className="text-4xl font-bold text-white mb-2">
                {movie.title}
              </h1>
              {movie.original_title !== movie.title && (
                <p className="text-xl text-white mb-4">
                  {movie.original_title}
                </p>
              )}
              {movie.tagline && (
                <p className="text-lg italic text-gray-300 mb-4">
                  &quot;{movie.tagline}&quot;
                </p>
              )}
            </div>
            <div className="relative group">
              <MediaItemDropdown
                item={{
                  id: movie.id,
                  title: movie.title,
                  poster_path: movie.poster_path,
                  release_date: movie.release_date
                }}
                contentType="movie"
                onWatchlistToggle={handleWatchlist}
                isInWatchlist={false}
                customButton={
                  <button
                    className="flex gap-1 justify-center items-center p-2 bg-dark-gray-hover text-gray-300 hover:text-white transition-all duration-300"
                    aria-label="More options"
                  >
                    <Plus className="size-5" />
                  </button>
                }
              />
            </div>
          </div>

          {/* Rating and Runtime */}
          <div className="flex flex-wrap gap-4">
            <div className="flex items-center gap-2">
              <div className="flex items-center">
                <svg
                  className="w-5 h-5 text-yellow-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                <span className="ml-1 text-lg font-semibold">
                  {movie.vote_average.toFixed(1)}
                </span>
              </div>
              <span className="">({movie.vote_count} votes)</span>
            </div>
            <div className="">
              <span className="font-medium">Runtime:</span>{' '}
              {formatRuntime(movie.runtime)}
            </div>
            <div className="">
              <span className="font-medium">Release Date:</span>{' '}
              {formatDate(movie.release_date)}
            </div>
            <div className="">
              <span className="font-medium">Status:</span> {movie.status}
            </div>
          </div>

          {/* Genres */}
          <div className="py-3">
            <h3 className="text-lg font-semibold text-white mb-2">Genres</h3>
            <div className="flex flex-wrap gap-2">
              {movie.genres.map((genre) => (
                <span
                  key={genre.id}
                  className="px-2 py-0.5 bg-light-green text-white text-xs font-medium"
                >
                  {genre.name}
                </span>
              ))}
            </div>
          </div>

          {/* Overview */}
          <div className="py-3">
            <h3 className="text-lg text-white font-semibold mb-2">Overview</h3>
            <p className="leading-relaxed text-sm">{movie.overview}</p>
          </div>

          {/* Production Details */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Production Companies */}
            {movie.production_companies.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">
                  Production Companies
                </h3>
                <div className="space-y-1 text-sm">
                  {movie.production_companies.map((company) => (
                    <div key={company.id} className="flex items-center gap-2">
                      {company.logo_path && (
                        <Image
                          src={getImageUrl(company.logo_path)}
                          alt={company.name}
                          width={24}
                          height={24}
                          className="object-contain"
                        />
                      )}
                      <span className="">{company.name}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Production Countries */}
            {movie.production_countries.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">
                  Production Countries
                </h3>
                <div className="space-y-1 text-sm">
                  {movie.production_countries.map((country) => (
                    <span key={country.iso_3166_1}>{country.name}</span>
                  ))}
                </div>
              </div>
            )}

            {/* Spoken Languages */}
            {movie.spoken_languages.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">
                  Spoken Languages
                </h3>
                <div className="space-y-1 text-sm">
                  {movie.spoken_languages.map((language) => (
                    <span key={language.iso_639_1}>
                      {language.english_name}
                    </span>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* External Links */}
          <div className="pt-6">
            <div className="flex gap-4">
              {movie.imdb_id && (
                <a
                  href={`https://www.imdb.com/title/${movie.imdb_id}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-300 hover:text-blue-400 font-medium"
                >
                  View on IMDb
                </a>
              )}
              {movie.homepage && (
                <a
                  href={movie.homepage}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-300 hover:text-blue-400 font-medium"
                >
                  Official Website
                </a>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  )



  return (
    <AnimatePageWrapper className="">
      <div className="px-4 md:px-0 py-4 ">
        {renderMobile()}
        {renderDesktop()}
      </div>
      <AiRecommendationComponent title={movie.title} />
      <MovieRecommendation id={movie.id} />

      {/* Posts Section */}
      <div className="px-4 md:px-0">
        <PostsSection
          movieId={movie.id.toString()}
          refreshTrigger={refreshPosts}
        />
      </div>

      {/* Create Post Popup */}
      <AnimatePresence mode="wait">
        {showCreatePost && (
          <CreatePostForm
            movieId={movie.id.toString()}
            movieTitle={movie.title}
            contentType="movie"
            posterPath={movie.poster_path}
            onClose={() => setShowCreatePost(false)}
            onSuccess={() => {
              setRefreshPosts((prev) => prev + 1)
            }}
          />
        )}
      </AnimatePresence>

      {/* Log Watching Form */}
      <AnimatePresence mode="wait">
        {showLogForm && movie && (
          <LogWatchingForm
            contentId={movie.id.toString()}
            contentType="movie"
            contentTitle={movie.title}
            posterPath={movie.poster_path || undefined}
            onClose={() => setShowLogForm(false)}
            onSuccess={() => {
              // Optionally refresh activity data or show success message
            }}
          />
        )}
      </AnimatePresence>
    </AnimatePageWrapper>
  )
}

export default MovieDetailsComponent



================================================================================
FILE: src/components/page/movie/movie-recommendation.tsx
================================================================================
'use client'

import React from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../types/media'

const MovieRecommendation = ({ id }: { id: number }) => {
  const getYear = (item: MediaItem) => {
    return new Date(item.release_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  return (
    <CinemaList
      title="Recommended Movies"
      apiUrl={`/api/recommendation/movie?id=${id}&page=1`}
      linkPath={(movieId) => `/movie/${movieId}`}
      scrollContainerClass="recommendations-scroll-container"
      getYear={getYear}
      getTitle={getTitle}
      showRating={true}
      showEmptyState={true}
      contentType="movie"
      showDropdown={true}
    />
  )
}

export default MovieRecommendation



================================================================================
FILE: src/components/page/post/post-info-component.tsx
================================================================================
import React from 'react'
import Link from 'next/link'
import Image from 'next/image'
import PostActions from '@/components/post-actions'
import type { RatingEnum } from '@/types/post'
import { getRatingLabel, formatDateTime } from '@/lib'

interface PostInfoProps {
  post: {
    id: string
    title: string | null
    content: string
    rating: RatingEnum | null
    isSpoiler: boolean
    createdAt: Date
    user: {
      id: string
      name: string | null
      username: string | null
      image: string | null
    } | null
    movie: {
      id: string
      type: string
      posterPath: string | null
    } | null
  }
  posterUrl: string | null
  likesCount: number
  dislikesCount: number
  commentsCount: number
  isLoggedIn: boolean
  userLiked: boolean
  userDisliked: boolean
}

const PostInfo: React.FC<PostInfoProps> = ({
  post,
  posterUrl,
  likesCount,
  dislikesCount,
  commentsCount,
  isLoggedIn,
  userLiked,
  userDisliked
}) => {


  return (
    <div className="flex flex-col md:flex-row gap-6 items-start">
      {posterUrl && (
        <div className="md:w-60 max-w-40 w-full md:flex-shrink-0">
          <Image
            src={posterUrl}
            alt={post.title ?? 'Poster'}
            width={240}
            height={360}
            className="w-full h-auto object-cover border border-dark-gray"
          />
        </div>
      )}

      <div className="flex-1">
        <div className="mb-4">
          <div className="flex items-center gap-3 mb-2">
            {/* User Avatar */}
            <div className="size-8 rounded-full bg-light-green flex items-center justify-center overflow-hidden">
              {post.user?.image ? (
                <Image
                  src={post.user.image}
                  alt={post.user.name || 'User'}
                  width={32}
                  height={32}
                  unoptimized={post.user.image.includes('dicebear')}
                  className="w-full h-full object-cover"
                />
              ) : (
                <span className="text-gray-400 text-sm font-medium">
                  {post.user?.name?.charAt(0).toUpperCase() || 'U'}
                </span>
              )}
            </div>

            <div className="flex flex-col">
              <div className="flex flex-col text-xs text-gray-300">
                <p className="font-medium text-sm">
                  {post.user?.name || 'Anonymous'}
                </p>
                <Link
                  href={`/u/${post.user?.username}`}
                  className="font-medium hover:text-light-green transition-colors"
                >
                  {'@' + post.user?.username || '@anonymous'}
                </Link>
              </div>
            </div>
          </div>

          {post.title && (
            <h1 className="text-2xl text-white font-semibold mt-1">
              {post.title}
            </h1>
          )}

          {post.rating != null && (
            <div className="mt-2 text-gray-300 flex items-center gap-1">
              <span className="text-xs bg-dark-gray-2 px-2 py-0.5">
                {getRatingLabel(post.rating)}
              </span>
              <div className="text-xs bg-dark-gray-2 px-2 py-0.5">
                <span>{post.movie?.type}</span>
              </div>
              {post.isSpoiler && (
                <div className="ml-2 h-full rounded-full flex bg-orange-500 items-center gap-1 text-white px-2 text-xs">
                  <span>has spoiler</span>
                </div>
              )}
            </div>
          )}
        </div>

        <div className="text-gray-300 leading-relaxed whitespace-pre-wrap">
          {post.content}
        </div>

        <span className="text-xs text-gray-400">
          {formatDateTime(post.createdAt)}
        </span>

        <PostActions
          postId={post.id}
          likesCount={likesCount}
          dislikesCount={dislikesCount}
          commentsCount={commentsCount}
          isLoggedIn={isLoggedIn}
          userLiked={userLiked}
          userDisliked={userDisliked}
        />
      </div>
    </div>
  )
}

export default PostInfo



================================================================================
FILE: src/components/page/profile/user-profile-tab-section.tsx
================================================================================
'use client'
import React from 'react'
import { useRouter, usePathname } from 'next/navigation'

const sections = ['profile', 'watchlist', 'lists', 'reviews', 'notifications']

const UserProfileTabSection = () => {
  const router = useRouter()
  const pathname = usePathname()

  const currentTab = pathname.split('/').pop() || 'profile'

  const handleTabClick = (section: string) => {
    if (section === 'profile') {
      router.push('/profile')
    } else {
      router.push(`/profile/${section}`)
    }
  }

  return (
    <div className="w-full py-6 scrollbar-hide overflow-x-scroll">
      <div className="flex text-gray-300 text-lg">
        {sections.map((section, index) => {
          const isActive =
            (section === 'profile' && currentTab === 'profile') ||
            (section !== 'profile' && currentTab === section)

          return (
            <button
              key={index + section}
              onClick={() => handleTabClick(section)}
              className={`px-5 py-1 cursor-pointer transition-colors capitalize ${
                isActive ? 'bg-light-green text-white' : 'hover:bg-dark-gray-hover'
              }`}
            >
              {section}
            </button>
          )
        })}
      </div>
    </div>
  )
}

export default UserProfileTabSection



================================================================================
FILE: src/components/page/search/index.ts
================================================================================
export { default as UserSearchResults } from './user-search-results'
export { default as MovieSearchResults } from './movie-search-results'
export { default as TVSearchResults } from './tv-search-results'
export { default as SearchResultsWrapper } from './search-results-wrapper'



================================================================================
FILE: src/components/page/search/movie-search-results.tsx
================================================================================
import Loader from '@/components/loader'
import Image from 'next/image'
import Link from 'next/link'

interface Movie {
  id: number
  title: string
  overview: string
  poster_path: string | null
  release_date: string
  vote_average: number
}

interface MovieSearchResultsProps {
  movies: Movie[]
  query: string
  isLoading?: boolean
}

const MovieSearchResults = ({ movies, query, isLoading = false }: MovieSearchResultsProps) => {

  const renderContent = () => {
    if (isLoading) {
      return (
        <div className="flex items-center justify-center p-5 ">
          <Loader text={`Searching ${query}`} />
        </div>
      )
    }

    if (movies.length === 0) {
      return (
        <p className="text-gray-400 text-sm">
          No movies related to &apos;{query}&apos; found
        </p>
      )
    }

    return (
      <div className="flex flex-col gap-1">
        {movies.map((movie) => (
          <Link href={`/movie/${movie.id}`} key={movie.id} className="flex gap-3 hover:bg-dark-gray-hover transition-colors cursor-pointer group">
            <div className="relative w-20 h-32 flex-shrink-0">
              <Image
                src={movie.poster_path
                  ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`
                  : '/placeholder-movie.jpg'
                }
                alt={movie.title}
                fill
                className="object-cover"
              />
            </div>
            <div className="flex-1 min-w-0 p-2">
              <h3 className="font-medium text-white mb-1 group-hover:text-gray-200 transition-colors line-clamp-1">
                {movie.title}
              </h3>
              <p className="text-gray-400 text-sm mb-2 line-clamp-2 leading-relaxed">
                {movie.overview}
              </p>
              <div className="flex items-center gap-4 text-xs text-gray-500">
                <span>{movie.release_date?.split('-')[0] || 'N/A'}</span>
                <span className="text-yellow-400">â˜… {movie.vote_average.toFixed(1)}</span>
              </div>
            </div>
          </Link>
        ))}
      </div>
    )
  }

  return (
    <div className="w-full">
      <h2 className="text-xl font-medium py-4">Movies related to &apos;{query}&apos;</h2>
      {renderContent()}
    </div>
  )
}

export default MovieSearchResults



================================================================================
FILE: src/components/page/search/search-results-wrapper.tsx
================================================================================
'use client'

import React, { useCallback, useEffect, useLayoutEffect, useRef, useState } from 'react'
import { useRouter, useSearchParams } from 'next/navigation'
import { motion } from 'framer-motion'
import MovieSearchResults from './movie-search-results'
import TVSearchResults from './tv-search-results'
import UserSearchResults from './user-search-results'
import { type Movie, type TVShow } from '@/app/(user)/search/tmdb-actions'
import { type SearchUserResult } from '@/app/(user)/search/action'

interface SearchResultsWrapperProps {
  movies: Movie[]
  tvShows: TVShow[]
  users: SearchUserResult[]
  query: string
  activeTab: 'movies' | 'shows' | 'users'
}

const SearchResultsWrapper = ({
  movies,
  tvShows,
  users,
  query,
  activeTab,
}: SearchResultsWrapperProps) => {
  const router = useRouter()
  const searchParams = useSearchParams()
  const containerRef = useRef<HTMLDivElement | null>(null)

  const handleTabChange = (tab: 'movies' | 'shows' | 'users') => {
    const params = new URLSearchParams(searchParams.toString())
    params.set('tab', tab)
    router.push(`/search?${params.toString()}`)
  }
  const movieBtnRef = useRef<HTMLButtonElement | null>(null)
  const tvBtnRef = useRef<HTMLButtonElement | null>(null)
  const userBtnRef = useRef<HTMLButtonElement | null>(null)
  const [indicator, setIndicator] = useState<{ left: number; width: number }>({
    left: 0,
    width: 0,
  })

  const updateIndicator = useCallback(() => {
    let target: HTMLButtonElement | null = null
    if (activeTab === 'movies') target = movieBtnRef.current
    else if (activeTab === 'shows') target = tvBtnRef.current
    else if (activeTab === 'users') target = userBtnRef.current

    const container = containerRef.current
    if (!target || !container) return

    const targetRect = target.getBoundingClientRect()
    const containerRect = container.getBoundingClientRect()
    const left = targetRect.left - containerRect.left
    const width = targetRect.width

    setIndicator({ left, width })
  }, [activeTab])

  useLayoutEffect(() => {
    updateIndicator()
  }, [updateIndicator])

  useEffect(() => {
    const onResize = () => updateIndicator()
    window.addEventListener('resize', onResize)
    return () => window.removeEventListener('resize', onResize)
  }, [updateIndicator])

  return (
    <div className="flex-1 px-2 md:px-0">
      <div className="flex flex-col gap-4">
        <div className="flex flex-col">
          <div ref={containerRef} className="relative flex items-center gap-4 text-gray-300">
            <button
              type="button"
              name='movies'
              ref={movieBtnRef}
              onClick={() => handleTabChange('movies')}
              className={'py-2 text-sm md:text-base transition-colors ' + `${activeTab==="movies" ? "text-white" : "text-gray-300"}`}
              aria-selected={activeTab === 'movies'}
              role="tab"
              >
              Movies
            </button>
            <button
              name='web-series'
              type="button"
              ref={tvBtnRef}
              onClick={() => handleTabChange('shows')}
              className={'py-2 text-sm md:text-base transition-colors ' + `${activeTab==="shows" ? "text-white" : "text-gray-300"}`}
              aria-selected={activeTab === 'shows'}
              role="tab"
            >
              TV Shows
            </button>
            <button
              name='users'
              type="button"
              ref={userBtnRef}
              onClick={() => handleTabChange('users')}
              className={'py-2 text-sm md:text-base transition-colors md:hidden ' + `${activeTab==="users" ? "text-white" : "text-gray-300"}`}
              aria-selected={activeTab === 'users'}
              role="tab"
            >
              Users
            </button>
            <motion.div
              aria-hidden
              className="pointer-events-none absolute -bottom-[2px] h-1 bg-gray-300"
              initial={false}
              animate={{
                left: indicator.left,
                width: indicator.width,
              }}
              transition={{
                type: "spring",
                stiffness: 300,
                damping: 30,
                mass: 0.8,
              }}
            />
          </div>
        </div>

        {activeTab === 'movies' && <MovieSearchResults movies={movies} query={query} />}
        {activeTab === 'shows' && <TVSearchResults tvShows={tvShows} query={query} />}
        {activeTab === 'users' && <UserSearchResults users={users} query={query} />}
      </div>
    </div>
  )
}

export default SearchResultsWrapper



================================================================================
FILE: src/components/page/search/tv-search-results.tsx
================================================================================
import React from 'react'
import Image from 'next/image'
import Link from 'next/link'
import Loader from '@/components/loader'

interface TVShow {
  id: number
  name: string
  overview: string
  poster_path: string | null
  first_air_date: string
  vote_average: number
}

interface TVSearchResultsProps {
  tvShows: TVShow[]
  query: string
  isLoading?: boolean
}

const TVSearchResults = ({
  tvShows,
  query,
  isLoading = false,
}: TVSearchResultsProps) => {
  const renderContent = () => {
    if (isLoading) {
      return (
        <div className="flex items-center justify-center p-5 ">
          <Loader text={`Searching ${query}`} />
        </div>
      )
    }

    if (tvShows.length === 0) {
      return (
        <p className="text-gray-400 text-sm">
          No TV shows related to &apos;{query}&apos; found
        </p>
      )
    }

    return (
      <div className="flex flex-col gap-1">
        {tvShows.map((show) => (
          <Link
            href={`/web-series/${show.id}`}
            key={show.id}
            className="flex gap-3 hover:bg-dark-gray-hover transition-colors cursor-pointer group"
          >
            <div className="relative w-20 h-32 flex-shrink-0">
              <Image
                src={
                  show.poster_path
                    ? `https://image.tmdb.org/t/p/w500${show.poster_path}`
                    : '/placeholder-tv.jpg'
                }
                alt={show.name}
                fill
                className="object-cover"
              />
            </div>
            <div className="flex-1 min-w-0 p-2">
              <h3 className="font-medium text-white mb-1 group-hover:text-gray-200 transition-colors line-clamp-1">
                {show.name}
              </h3>
              <p className="text-gray-400 text-sm mb-2 line-clamp-2 leading-relaxed">
                {show.overview}
              </p>
              <div className="flex items-center gap-4 text-xs text-gray-500">
                <span>{show.first_air_date?.split('-')[0] || 'N/A'}</span>
                <span className="text-yellow-400">
                  â˜… {show.vote_average.toFixed(1)}
                </span>
              </div>
            </div>
          </Link>
        ))}
      </div>
    )
  }

  return (
    <div className="w-full">
      <h2 className="text-xl font-medium py-4">
        TV Shows related to &apos;{query}&apos;
      </h2>
      {renderContent()}
    </div>
  )
}

export default TVSearchResults



================================================================================
FILE: src/components/page/search/user-search-results.tsx
================================================================================
"use client"
import React from 'react'
import Image from 'next/image'
import { type SearchUserResult } from '@/app/(user)/search/action'
import Link from 'next/link'

interface UserSearchResultsProps {
  users: SearchUserResult[]
  query: string
}

const UserSearchResults = ({ users, query }: UserSearchResultsProps) => {
  if (users.length === 0) {
    return (
      <div className="w-[30%] px-2 md:px-4">
        <h1 className="text-lg font-medium mb-4">Users related to &apos;{query}&apos;</h1>
        <p className="text-gray-400 text-sm">No users found</p>
      </div>
    )
  }

  return (
    <div className="w-full md:px-4 px-2">
      <h1 className="text-xl font-medium mb-4">Users related to &apos;{query}&apos;</h1>
      <div className='flex flex-col gap-1 py-4'>
        {users.map((user, index) => {
          return (
            <Link
              href={`/u/${user.username}`}
              key={index + user.id}
              className="hover:bg-dark-gray-hover p-3 cursor-pointer py-2  transition-colors"
            >
              <div className="flex gap-2 bg-light items-center">
                <Image
                  className="rounded-full bg-light-green"
                  src={user.image}
                  alt="user image"
                  width={48}
                  height={48}
                  unoptimized={user.image.includes("dicebear")}
                />
                <div>
                  <h1 className="font-medium">{user.name}</h1>
                  <p className="text-xs text-gray-400">{user.email}</p>
                </div>
              </div>
            </Link>
          )
        })}
      </div>
    </div>
  )
}

export default UserSearchResults



================================================================================
FILE: src/components/page/trending/right-sidebar.tsx
================================================================================
'use client'

import { TrendingItem } from '@/types/trending'
import Link from 'next/link'
import { useMemo } from 'react'
import { useQuery } from '@tanstack/react-query'
import { getMediaReleaseYear, getMediaTitle } from '@/lib'

const RightSidebar = () => {
  const { data, isLoading } = useQuery({
    queryKey: ['trending', 'sidebar', 'day'],
    queryFn: async () => {
      const [moviesResponse, tvResponse] = await Promise.all([
        fetch('/api/trending-movie?time_window=day', { method: 'GET' }),
        fetch('/api/trending-series?time_window=day', { method: 'GET' }),
      ])
      const [moviesData, tvData] = await Promise.all([
        moviesResponse.json(),
        tvResponse.json(),
      ])
      return {
        movies: (moviesData?.results ?? []).slice(0, 5) as TrendingItem[],
        tv: (tvData?.results ?? []).slice(0, 5) as TrendingItem[],
      }
    },
  })

  const trendingMovies = useMemo(() => data?.movies ?? [], [data])
  const trendingTV = useMemo(() => data?.tv ?? [], [data])

  return (
    <div className="flex max-md:hidden md:w-[30%] sticky top-20 right-0 flex-col gap-2 h-fit">
      <div className="py-8">
        {/* Trending Movies Section */}
        <div className="mb-8">
          <h1 className="text-gray-300 font-light text-xl pb-6">
            Trending movies
          </h1>
          <div className="flex flex-col gap-2">
            {isLoading ? (
              <MoviesSkeleton />
            ) : (
              trendingMovies.map((item, index) => (
                <Link
                  key={item.id}
                  className="flex text-gray-400 gap-5 mb-4 hover:drop-shadow-md group"
                  href={`/movie/${item.id}`}
                >
                  <h1 className="text-5xl font-extrabold group-hover:text-light-green text-white transition-all duration-500">
                    0{index + 1}
                  </h1>
                  <div>
                    <div className="flex flex-col items-start justify-center text-dark-grey">
                      <p className="line-clamp-1 group-hover:text-white">
                        {getMediaTitle(item)}
                      </p>
                      <p className="min-w-fit text-xs">
                        {getMediaReleaseYear(item)}
                      </p>
                    </div>
                  </div>
                </Link>
              ))
            )}
          </div>
        </div>

        {/* Trending TV Shows Section */}
        <div className="w-full">
          <h1 className="text-gray-300 font-light text-xl pb-6">
            Trending TV shows
          </h1>
          <div className="flex flex-col gap-2 w-full">
            {isLoading ? (
              <TVSkeleton />
            ) : (
              trendingTV.map((item, index) => (
                <Link
                  key={item.id}
                  className="flex text-gray-400 gap-5 mb-4 hover:drop-shadow-md group"
                  href={`/web-series/${item.id}`}
                >
                  <h1 className="text-5xl font-extrabold group-hover:text-light-green text-white transition-all duration-500">
                    0{index + 1}
                  </h1>
                  <div>
                    <div className="flex flex-col items-start justify-center text-dark-grey">
                      <p className="line-clamp-1 group-hover:text-white">
                        {getMediaTitle(item)}
                      </p>
                      <p className="min-w-fit text-xs">
                        {getMediaReleaseYear(item)}
                      </p>
                    </div>
                  </div>
                </Link>
              ))
            )}
          </div>
        </div>
      </div>
    </div>
  )
}

const TVSkeleton = () => (
  <div className="flex flex-col gap-2 w-full">
    {[1, 2, 3, 4, 5].map((index) => (
      <div
        key={`tv-skel-${index}`}
        className="w-full flex text-gray-400 gap-5 mb-4"
      >
        <h1 className="text-5xl font-extrabold text-dark-gray-2">0{index}</h1>
        <div>
          <div className="flex flex-col items-start justify-center text-dark-grey">
            <div className="w-24 h-4 bg-dark-gray-2 rounded animate-pulse"></div>
            <div className="w-16 h-3 bg-dark-gray-2 rounded animate-pulse mt-2"></div>
          </div>
        </div>
      </div>
    ))}
  </div>
)
const MoviesSkeleton = () => (
  <div className="flex flex-col gap-2">
    {[1, 2, 3, 4, 5].map((index) => (
      <div
        key={`movie-skel-${index}`}
        className="flex text-gray-400 gap-5 mb-4"
      >
        <h1 className="text-5xl font-extrabold text-dark-gray-2">0{index}</h1>
        <div>
          <div className="flex flex-col items-start justify-center text-dark-grey">
            <div className="w-24 h-4 bg-dark-gray-2 rounded animate-pulse"></div>
            <div className="w-16 h-3 bg-dark-gray-2 rounded animate-pulse mt-2"></div>
          </div>
        </div>
      </div>
    ))}
  </div>
)

export default RightSidebar



================================================================================
FILE: src/components/page/trending/trending-list-component.tsx
================================================================================
'use client'
import { TrendingItem } from '@/types/trending'
import { Calendar, ChevronDown, Star } from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import { useCallback } from 'react'
import Loader from '../../loader'
import { motion, type Variants } from 'framer-motion'
import { getMediaTitle, getMediaReleaseYear } from '@/lib'
import { useInfiniteQuery } from '@tanstack/react-query'

// Skeleton component for loading state
const Skeleton = () => (
  <div className="flex flex-col gap-2">
    {Array.from({ length: 10 }).map((_, index) => (
      <div key={index + 'skeleton'} className="animate-pulse">
        <div className="flex bg-dark-gray-2">
          {/* Poster Skeleton */}
          <div className="relative max-md:h-60 w-40 aspect-square md:h-52 flex-shrink-0">
            <div className="absolute inset-0 bg-dark-gray-hover" />
          </div>

          {/* Content Skeleton */}
          <div className="flex-1 p-6">
            <div className="flex items-start justify-between mb-3">
              <div className="flex max-md:flex-col md:items-center gap-4">
                <div className="w-8 h-8 bg-dark-gray rounded"></div>
                <div className="h-6 w-48 bg-dark-gray rounded"></div>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-5 h-5 bg-dark-gray rounded"></div>
                <div className="h-4 w-8 bg-dark-gray rounded"></div>
              </div>
            </div>

            <div className="space-y-2 mb-4">
              <div className="h-4 bg-dark-gray rounded w-full"></div>
              <div className="h-4 bg-dark-gray rounded w-4/5"></div>
              <div className="h-4 bg-dark-gray rounded w-3/5"></div>
            </div>

            <div className="flex items-center gap-6">
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 bg-dark-gray rounded"></div>
                <div className="h-4 w-12 bg-dark-gray rounded"></div>
              </div>
              <div className="h-4 w-16 bg-dark-gray rounded"></div>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>
)

const TrendingListComponent = () => {
  const {
    data,
    isLoading,
    isError,
    error,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
  } = useInfiniteQuery({
    queryKey: ['trending-all', 'day'],
    initialPageParam: 1,
    queryFn: async ({ pageParam }) => {
      const page = Number(pageParam) || 1
      const url = `/api/trending-all?page=${page}&time_window=day`
      const res = await fetch(url, { method: 'GET' })
      if (!res.ok) throw new Error('Failed to load trending items')
      return res.json() as Promise<{ results: TrendingItem[]; total_pages: number }>
    },
    getNextPageParam: (lastPage, allPages) => {
      const next = allPages.length + 1
      return next <= (lastPage?.total_pages ?? 0) ? next : undefined
    },
  })

  const trendingItems: TrendingItem[] = (data?.pages ?? []).flatMap(
    (p) => p?.results ?? [],
  )

  //Animations
  const containerVariants: Variants = {
    hidden: { opacity: 1 },
    show: {
      opacity: 1,
      transition: {
        staggerChildren: 0.08,
        delayChildren: 0.1,
      },
    },
  }
  const itemVariants: Variants = {
    hidden: { opacity: 0, y: 20 },
    show: {
      opacity: 1,
      y: 0,
      transition: { type: 'spring' as const, stiffness: 120, damping: 16 },
    },
  }

  const handleLoadMore = useCallback(() => {
    if (hasNextPage && !isFetchingNextPage) {
      void fetchNextPage()
    }
  }, [fetchNextPage, hasNextPage, isFetchingNextPage])

  const getTitle = (item: TrendingItem) => getMediaTitle(item)
  const getReleaseYear = (item: TrendingItem) => getMediaReleaseYear(item)

  if (isError) {
    return (
      <div className="w-full flex items-center justify-center py-20">
        <div className="text-red-400 text-center">
          <h2 className="text-xl mb-2">Error Loading Trending Content</h2>
          <p>{error instanceof Error ? error.message : String(error ?? 'Something went wrong')}</p>
        </div>
      </div>
    )
  }

  return (
    <div className="w-full">
      {/* Show skeleton for initial loading */}
      {isLoading ? (
        <Skeleton />
      ) : (
        <>
          {/* Trending List */}
          <motion.div
            variants={containerVariants}
            initial="hidden"
            animate="show"
            className="flex flex-col"
          >
            {trendingItems.map((item, index) => (
              <motion.div key={item.id + index} variants={itemVariants}>
                <Link
                  href={
                    item.media_type === 'movie'
                      ? `/movie/${item.id}`
                      : `/web-series/${item.id}`
                  }
                  className="group w-full transition-all duration-300 cursor-pointer"
                >
                  <div className="flex border-b border-dark-gray-2 hover:bg-dark-gray-2">
                    {/* Poster Image */}
                    <div className="relative max-md:h-60 w-40 aspect-square md:h-52 flex-shrink-0">
                      {item.poster_path ? (
                        <Image
                          src={`https://image.tmdb.org/t/p/w500${item.poster_path}`}
                          alt={getTitle(item)}
                          fill
                          className="object-center"
                        />
                      ) : (
                        <div className="w-full h-full bg-dark-gray flex items-center justify-center">
                          <div className="text-center text-gray-400">
                            <div className="w-16 h-24 mb-2 mx-auto bg-dark-gray-2 rounded"></div>
                            <p className="text-sm">No Image</p>
                          </div>
                        </div>
                      )}

                      {/* Media Type Badge */}
                      <div className="absolute top-2 left-2">
                        <span
                          className={`px-2 py-1 text-xs font-medium ${
                            item.media_type === 'movie'
                              ? 'bg-light-green text-white'
                              : 'bg-blue-600 text-white'
                          }`}
                        >
                          {item.media_type === 'movie' ? 'Movie' : 'TV'}
                        </span>
                      </div>
                    </div>

                    {/* Content Info */}
                    <div className="flex-1 p-6">
                      <div className="flex items-start justify-between mb-3">
                        <div className="flex max-md:flex-col md:items-center gap-4">
                          <span className="text-4xl font-extrabold text-gray-300 group-hover:text-light-green transition-colors">
                            #{index + 1}
                          </span>
                          <h3 className="text-xl text-gray-300 font-medium group-hover:text-white transition-colors">
                            {getTitle(item)}
                          </h3>
                        </div>
                        <div className="flex items-center gap-2">
                          <Star className="w-5 h-5 fill-light-green text-light-green" />
                          <span className="text-gray-300 font-medium">
                            {item?.vote_average?.toFixed(1)}
                          </span>
                        </div>
                      </div>

                      <p className="text-gray-400 text-sm mb-4 line-clamp-3 leading-relaxed">
                        {item.overview || 'No description available'}
                      </p>

                      <div className="flex items-center gap-6 text-sm text-gray-500">
                        <div className="flex items-center gap-2">
                          <Calendar className="w-4 h-4" />
                          <span>{getReleaseYear(item)}</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <span className="capitalize">{item.media_type}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </Link>
              </motion.div>
            ))}
          </motion.div>

          {/* Load More Button */}
          {hasNextPage && (
            <div className="mt-8 flex items-center justify-center">
              <button
                onClick={handleLoadMore}
                disabled={isFetchingNextPage}
                className={`px-4 py-2 text-gray-200 transition disabled:opacity-60 disabled:cursor-not-allowed`}
              >
                {isFetchingNextPage ? (
                  <Loader />
                ) : (
                  <div className="flex gap-1 items-center cursor-pointer">
                    Load more
                    <ChevronDown className="size-5" />
                  </div>
                )}
              </button>
            </div>
          )}
        </>
      )}
    </div>
  )
}

export default TrendingListComponent



================================================================================
FILE: src/components/page/tv-series/series-recommendation.tsx
================================================================================
'use client'

import React from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../types/media'

const SeriesRecommendation = ({ id }: { id: number }) => {
  const getYear = (item: MediaItem) => {
    return new Date(item.first_air_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  return (
    <CinemaList
      title="Recommended Series"
      apiUrl={`/api/recommendation/series?id=${id}&page=1`}
      linkPath={(seriesId) => `/web-series/${seriesId}`}
      scrollContainerClass="recommendations-scroll-container"
      getYear={getYear}
      getTitle={getTitle}
      showRating={true}
      showEmptyState={true}
      contentType="tv_series"
      showDropdown={true}
    />
  )
}

export default SeriesRecommendation


================================================================================
FILE: src/components/page/tv-series/tv-series-client.tsx
================================================================================
'use client'

import { useQuery } from '@tanstack/react-query'
import TVSeriesDetailsComponent from './tv-series-details-component'
import Link from 'next/link'
import Loader from '@/components/loader'

interface TVSeriesClientProps {
  seriesId: string
}

const TVSeriesClient: React.FC<TVSeriesClientProps> = ({ seriesId }) => {
  const base = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'

  const {
    data: series,
    isLoading,
    error,
  } = useQuery({
    queryKey: ['tv-series', seriesId],
    queryFn: async () => {
      const url = `${base}/api/tmdb/series?id=${encodeURIComponent(seriesId)}`
      const res = await fetch(url, { cache: 'no-store' })

      if (!res.ok) {
        throw new Error('Failed to fetch series details')
      }

      return res.json()
    },
    staleTime: 5 * 60 * 1000,
    retry: 2,
  })

  if (isLoading) {
    return (
      <div className="flex h-full items-center justify-center">
        <Loader text={`Loading ${seriesId} series details...`} size='lg' />
      </div>
    )
  }
  else if(error || !series) {
    return (
      <div className="h-full flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-white mb-2">
            Series with id{' '}
            <span className="text-light-green">&apos;{seriesId}&apos;</span> Not
            Found
          </h1>
          <p className="text-gray-300 mb-4">
            The series you&apos;re looking for doesn&apos;t exist or has been
            removed.
          </p>
          <Link
            href="/"
            className="bg-dark-gray-hover text-white px-4 py-2 cursor-pointer"
          >
            Go back to Home
          </Link>
        </div>
      </div>
    )
  }
  return <TVSeriesDetailsComponent series={series} />
}

export default TVSeriesClient



================================================================================
FILE: src/components/page/tv-series/tv-series-details-component.tsx
================================================================================
'use client'
import Image from 'next/image'
import React, { useState } from 'react'
import { CreatePostForm } from '@/components/forms/create-post-form'
import LogWatchingForm from '@/components/forms/log-watching-form'
import { PostsSection } from '@/components/posts-section'
import { AnimatePresence } from 'framer-motion'
import AnimatePageWrapper from '../../animate-page-wrapper'
import { Plus } from 'lucide-react'
import SeriesRecommendation from './series-recommendation'
import { useSession } from 'next-auth/react'
import { useRouter } from 'next/navigation'
import { formatDate } from '@/lib'
import MediaItemDropdown from '../../media-item-dropdown'
import type { TVSeriesDetails } from '@/types/tmdb'

interface TVSeriesDetailsComponentProps {
  series: TVSeriesDetails
}

const TVSeriesDetailsComponent: React.FC<TVSeriesDetailsComponentProps> = ({
  series,
}) => {
  const [showCreatePost, setShowCreatePost] = useState(false)
  const [showLogForm, setShowLogForm] = useState(false)
  const [refreshPosts, setRefreshPosts] = useState(0)
  const router = useRouter()
  const { data: session } = useSession()



  const getImageUrl = (
    path: string | null,
    size: 'w500' | 'w780' | 'original' = 'w500'
  ) => {
    if (!path) return '/placeholder-tv.jpg'
    return `https://image.tmdb.org/t/p/${size}${path}`
  }

  const formatEpisodeRuntime = (runtime: number[]) => {
    if (!runtime || runtime.length === 0) return 'N/A'
    const avgRuntime =
      runtime.reduce((sum, time) => sum + time, 0) / runtime.length
    return `${Math.round(avgRuntime)} min`
  }

  const handleWatchlist = () => {
    if (!session) {
      router.push('/signin')
      return
    }
    // TODO: Implement watchlist functionality
    console.log('Add to watchlist:', series.name)
  }

  const renderMobile = () => (
    <div className="md:hidden">
      <div className="flex items-start gap-4">
        <div className="w-[40%] max-w-[160px]">
          <Image
            src={getImageUrl(series.poster_path)}
            alt={series.name}
            height={240}
            width={160}
            className="w-full object-center"
          />
        </div>
        <div className="flex-1 text-gray-300">
          <div className="mb-2">
            <h2 className="text-2xl font-bold text-white mb-1">{series.name}</h2>
            {series.original_name !== series.name && (
              <p className="text-base text-gray-200 mb-2">{series.original_name}</p>
            )}
            {series.tagline && (
              <p className="text-sm italic text-gray-400">
                &quot;{series.tagline}&quot;
              </p>
            )}
          </div>
          <div className="flex flex-wrap items-center gap-3 mb-3">
            <div className="flex items-center gap-1">
              <svg className="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <span className="text-sm font-semibold">{series.vote_average.toFixed(1)}</span>
              <span className="text-xs text-gray-400">({series.vote_count})</span>
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Episodes:</span> {series.number_of_episodes}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Seasons:</span> {series.number_of_seasons}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Episode Runtime:</span> {formatEpisodeRuntime(series.episode_run_time)}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">First Air:</span> {formatDate(series.first_air_date)}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Status:</span> {series.status}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Type:</span> {series.type}
            </div>
          </div>
          <div className="flex flex-wrap gap-2 mb-3">
            {series.genres.map((genre) => (
              <span
                key={genre.id}
                className="px-2 py-0.5 bg-light-green/20 text-light-green text-xs font-medium border border-light-green/30"
              >
                {genre.name}
              </span>
            ))}
          </div>
          <div className="flex flex-wrap gap-2">
            <div className="relative group">
              <MediaItemDropdown
                item={{
                  id: series.id,
                  title: series.name,
                  poster_path: series.poster_path,
                  release_date: series.first_air_date
                }}
                contentType="tv_series"
                onWatchlistToggle={handleWatchlist}
                isInWatchlist={false}
                customButton={
                  <button
                    className="h-9 px-3 inline-flex items-center gap-2 text-sm bg-dark-gray-hover/80 text-gray-200 hover:text-white hover:bg-dark-gray-2 transition-colors"
                    aria-label="Create Post"
                  >
                    <Plus className="size-4" />
                    Create Post
                  </button>
                }
              />
            </div>
          </div>
        </div>
      </div>

      {/* Overview and details */}
      <div className="mt-6 text-gray-300">
        <div className="py-3">
          <h3 className="text-lg text-white font-semibold mb-2">Overview</h3>
          <p className="leading-relaxed text-sm">{series.overview}</p>
        </div>

        {/* Created By */}
        {series.created_by.length > 0 && (
          <div className="py-3">
            <h3 className="text-lg text-white font-semibold mb-2">Created By</h3>
            <div className="flex flex-wrap gap-2">
              {series.created_by.map((creator) => (
                <span key={creator.id} className="">{creator.name}</span>
              ))}
            </div>
          </div>
        )}

        {/* Networks */}
        {series.networks.length > 0 && (
          <div className="py-3">
            <h3 className="text-lg text-white font-semibold mb-2">Networks</h3>
            <div className="flex flex-wrap gap-4">
              {series.networks.map((network) => (
                <div key={network.id} className="flex items-center gap-2">
                  {network.logo_path && (
                    <Image
                      src={getImageUrl(network.logo_path)}
                      alt={network.name}
                      width={32}
                      height={32}
                      className="object-contain"
                    />
                  )}
                  <span className="">{network.name}</span>
                </div>
              ))}
            </div>
          </div>
        )}

        <div className="grid grid-cols-1 gap-6">
          {series.production_companies.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">Production Companies</h3>
              <div className="space-y-1 text-sm">
                {series.production_companies.map((company) => (
                  <div key={company.id} className="flex items-center gap-2">
                    {company.logo_path && (
                      <Image
                        src={getImageUrl(company.logo_path)}
                        alt={company.name}
                        width={24}
                        height={24}
                        className="object-contain rounded"
                      />
                    )}
                    <span className="">{company.name}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          {series.production_countries.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">Production Countries</h3>
              <div className="space-y-1 text-sm">
                {series.production_countries.map((country) => (
                  <span key={country.iso_3166_1}>{country.name}</span>
                ))}
              </div>
            </div>
          )}

          {series.spoken_languages.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">Spoken Languages</h3>
              <div className="space-y-1 text-sm">
                {series.spoken_languages.map((language) => (
                  <span key={language.iso_639_1}>{language.english_name}</span>
                ))}
              </div>
            </div>
          )}
        </div>

        {/* External Links */}
        <div className="pt-6">
          <div className="flex gap-4">
            {series.homepage && (
              <a
                href={series.homepage}
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-300 hover:text-blue-400 font-medium underline-offset-4 hover:underline"
              >
                Official Website
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
  )

  const renderDesktop = () => (
    <div className="hidden md:flex flex-col w-full lg:flex-row gap-8">
      {/* Poster */}
      <div className="sticky top-[70px] left-0 md:max-w-[20%] max-w-[40%] w-full h-full">
        <Image
          src={getImageUrl(series.poster_path)}
          alt={series.name}
          height={300}
          width={300}
          className="w-full"
        />
      </div>

      {/* TV Series Details */}
      <div className="flex">
        <div className="text-gray-300">
          {/* Title and Basic Info */}
          <div className="flex justify-between w-full">
            <div className="mb-2">
              <h1 className="text-4xl font-bold text-white mb-2">{series.name}</h1>
              {series.original_name !== series.name && (
                <p className="text-xl text-white mb-4">{series.original_name}</p>
              )}
              {series.tagline && (
                <p className="text-lg italic text-gray-300 mb-4">
                  &quot;{series.tagline}&quot;
                </p>
              )}
            </div>
            <div className="relative group">
              <MediaItemDropdown
                item={{
                  id: series.id,
                  title: series.name,
                  poster_path: series.poster_path,
                  release_date: series.first_air_date
                }}
                contentType="tv_series"
                onWatchlistToggle={handleWatchlist}
                isInWatchlist={false}
                customButton={
                  <button
                    className="flex gap-1 justify-center items-center p-2 bg-dark-gray-hover text-gray-300 hover:text-white transition-all duration-300"
                    aria-label="More options"
                  >
                    <Plus className="size-5" />
                  </button>
                }
              />
            </div>
          </div>

          {/* Rating and Series Info */}
          <div className="flex flex-wrap gap-4 mb-6">
            <div className="flex items-center gap-2">
              <div className="flex items-center">
                <svg className="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                <span className="ml-1 text-lg font-semibold">{series.vote_average.toFixed(1)}</span>
              </div>
              <span className="">({series.vote_count} votes)</span>
            </div>
            <div className="">
              <span className="font-medium">Episodes:</span> {series.number_of_episodes}
            </div>
            <div className="">
              <span className="font-medium">Seasons:</span> {series.number_of_seasons}
            </div>
            <div className="">
              <span className="font-medium">Episode Runtime:</span> {formatEpisodeRuntime(series.episode_run_time)}
            </div>
            <div className="">
              <span className="font-medium">First Air Date:</span> {formatDate(series.first_air_date)}
            </div>
            <div className="">
              <span className="font-medium">Status:</span> {series.status}
            </div>
            <div className="">
              <span className="font-medium">Type:</span> {series.type}
            </div>
          </div>

          {/* Genres */}
          <div className="py-3">
            <h3 className="text-lg font-semibold text-white mb-2">Genres</h3>
            <div className="flex flex-wrap gap-2">
              {series.genres.map((genre) => (
                <span key={genre.id} className="px-2 py-0.5 bg-light-green text-white text-xs font-medium">
                  {genre.name}
                </span>
              ))}
            </div>
          </div>

          {/* Overview */}
          <div className="py-3">
            <h3 className="text-lg text-white font-semibold mb-2">Overview</h3>
            <p className="leading-relaxed text-sm">{series.overview}</p>
          </div>

          {/* Created By */}
          {series.created_by.length > 0 && (
            <div className="py-3">
              <h3 className="text-lg text-white font-semibold mb-2">Created By</h3>
              <div className="flex flex-wrap gap-2">
                {series.created_by.map((creator) => (
                  <span key={creator.id} className="">{creator.name}</span>
                ))}
              </div>
            </div>
          )}

          {/* Networks */}
          {series.networks.length > 0 && (
            <div className="py-3">
              <h3 className="text-lg text-white font-semibold mb-2">Networks</h3>
              <div className="flex flex-wrap gap-4">
                {series.networks.map((network) => (
                  <div key={network.id} className="flex items-center gap-2">
                    {network.logo_path && (
                      <Image
                        src={getImageUrl(network.logo_path)}
                        alt={network.name}
                        width={32}
                        height={32}
                        className="object-contain"
                      />
                    )}
                    <span className="">{network.name}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Production Details */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Production Companies */}
            {series.production_companies.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">Production Companies</h3>
                <div className="space-y-1 text-sm">
                  {series.production_companies.map((company) => (
                    <div key={company.id} className="flex items-center gap-2">
                      {company.logo_path && (
                        <Image
                          src={getImageUrl(company.logo_path)}
                          alt={company.name}
                          width={24}
                          height={24}
                          className="object-contain"
                        />
                      )}
                      <span className="">{company.name}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Production Countries */}
            {series.production_countries.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">Production Countries</h3>
                <div className="space-y-1 text-sm">
                  {series.production_countries.map((country) => (
                    <span key={country.iso_3166_1}>{country.name}</span>
                  ))}
                </div>
              </div>
            )}

            {/* Spoken Languages */}
            {series.spoken_languages.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">Spoken Languages</h3>
                <div className="space-y-1 text-sm">
                  {series.spoken_languages.map((language) => (
                    <span key={language.iso_639_1}>{language.english_name}</span>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* External Links */}
          <div className="pt-6">
            <div className="flex gap-4">
              {series.homepage && (
                <a
                  href={series.homepage}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-300 hover:text-blue-400 font-medium"
                >
                  Official Website
                </a>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  )

  return (
    <AnimatePageWrapper className="">
      <div className="px-4 md:px-0 py-8">
        {renderMobile()}
        {renderDesktop()}
      </div>
      <SeriesRecommendation id={series.id} />

      {/* Posts Section */}
      <div className="px-4 md:px-0">
        <PostsSection
          movieId={series.id.toString()}
          refreshTrigger={refreshPosts}
        />
      </div>

      {/* Create Post Popup */}
      <AnimatePresence mode="wait">
        {showCreatePost && (
          <CreatePostForm
            movieId={series.id.toString()}
            movieTitle={series.name}
            contentType="tv_series"
            posterPath={series.poster_path}
            onClose={() => setShowCreatePost(false)}
            onSuccess={() => {
              // Trigger posts refresh instead of page reload
              setRefreshPosts((prev) => prev + 1)
            }}
          />
        )}
      </AnimatePresence>

      {/* Log Watching Form */}
      <AnimatePresence mode="wait">
        {showLogForm && (
          <LogWatchingForm
            contentId={series.id.toString()}
            contentType="tv_series"
            contentTitle={series.name}
            posterPath={series.poster_path || undefined}
            onClose={() => setShowLogForm(false)}
            onSuccess={() => {
              // Optionally refresh activity data or show success message
            }}
          />
        )}
      </AnimatePresence>
    </AnimatePageWrapper>
  )
}

export default TVSeriesDetailsComponent



================================================================================
FILE: src/components/page/user/user-detail-screen.tsx
================================================================================
'use client'
import React, { useState } from 'react'
import Link from 'next/link'
import Image from 'next/image'
import PostList from '@/components/post-list'
import { useMutation } from '@tanstack/react-query'
import type { GenericPost } from '@/types/post'

type UserDetailScreenProps = {
  userId: string
  viewerId: string | null
  name: string
  username: string
  image?: string
  followersCount: number
  followingCount: number
  initialIsFollowing: boolean
  posts: GenericPost[]
}

const UserDetailScreen: React.FC<UserDetailScreenProps> = ({
  userId,
  viewerId,
  name,
  username,
  image,
  followersCount,
  followingCount,
  initialIsFollowing,
  posts,
}) => {
  const [isFollowing, setIsFollowing] = useState<boolean>(initialIsFollowing)
  const [followers, setFollowers] = useState<number>(followersCount)
  const [following, setFollowing] = useState<number>(followingCount)

  const canFollow = !!viewerId && viewerId !== userId

  const followUserMutation = useMutation({
    mutationFn: async ({ targetUserId, action }: { targetUserId: string; action: 'follow' | 'unfollow' }) => {
      const res = await fetch('/api/user/follow', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ targetUserId, action }),
      })
      const data = await res.json()
      if (!res.ok || !data?.ok) {
        throw new Error(data?.error || 'Failed to follow/unfollow user')
      }
      return data
    },
  })

  const onToggleFollow = async () => {
    if (!canFollow || followUserMutation.isPending) return
    const action = isFollowing ? 'unfollow' : 'follow'

    setIsFollowing((prev) => !prev)
    setFollowers((prev) => prev + (action === 'follow' ? 1 : -1))

    try {
      const data = await followUserMutation.mutateAsync({
        targetUserId: userId,
        action,
      })

      setFollowers(data.followersCount)
      setFollowing(data.followingCount)
      setIsFollowing(Boolean(data.isFollowing))
    } catch (error) {
      setIsFollowing((prev) => !prev)
      setFollowers((prev) => prev + (action === 'follow' ? -1 : 1))
      console.error('Failed to follow/unfollow user:', error)
    }
  }

  return (
    <div className="flex max-md:flex-col-reverse max-md:px-2 items-start gap-4 text-gray-300">
      <div className="w-full md:w-[70%]">
        <div className="text-2xl font-light mb-4">Reviews</div>
        <PostList emptyText={`${username} has not reviewed any movies yet`} posts={posts} />
      </div>
      <div className="w-full md:w-[30%] md:sticky top-20 self-start right-0 flex flex-col items-center gap-4">
        <div className="flex items-center w-full gap-4">
          <Image
            src={image ?? ''}
            alt={username}
            width={64}
            className='bg-light-green rounded-full'
            height={64}
            unoptimized={image?.includes("dicebear")}
          />
          <div className="flex flex-col gap-1">
            <div>
              <div>{name}</div>
              <div className="text-sm text-gray-400">@{username}</div>
            </div>
            <div className="flex gap-3">
              <div className="flex gap-1 text-sm">Followers: {followers}</div>
              <div className="flex gap-1 text-sm">Following: {following}</div>
            </div>
          </div>
        </div>
        {!viewerId && (
          <Link href="/signin">
            <button>Sign in to follow</button>
          </Link>
        )}
        {viewerId && canFollow && (
          <button
            className="w-full p-1 cursor-pointer bg-light-green disabled:opacity-50 disabled:cursor-not-allowed"
            onClick={onToggleFollow}
            disabled={followUserMutation.isPending}
          >
            {(() => {
              if (followUserMutation.isPending) return 'Loading...'
              return isFollowing ? 'Unfollow' : 'Follow'
            })()}
          </button>
        )}
      </div>
    </div>
  )
}

export default UserDetailScreen



================================================================================
FILE: src/components/pathname-client.tsx
================================================================================



================================================================================
FILE: src/components/post-actions.tsx
================================================================================
'use client'

import { ThumbsUp, ThumbsDown, MessageCircle } from 'lucide-react'
import { useRouter } from 'next/navigation'
import { useState } from 'react'

interface PostActionsProps {
  postId: string
  likesCount: number
  dislikesCount: number
  commentsCount: number
  isLoggedIn: boolean
  userLiked?: boolean
  userDisliked?: boolean
}

export default function PostActions({
  postId,
  likesCount,
  dislikesCount,
  commentsCount,
  isLoggedIn,
  userLiked = false,
  userDisliked = false,
}: PostActionsProps) {
  const router = useRouter()
  const [likes, setLikes] = useState(likesCount)
  const [dislikes, setDislikes] = useState(dislikesCount)
  const [isLiked, setIsLiked] = useState(userLiked)
  const [isDisliked, setIsDisliked] = useState(userDisliked)
  const [isLoading, setIsLoading] = useState(false)

  const handleAction = async (action: 'like' | 'dislike') => {
    if (!isLoggedIn) {
      router.push('/signin')
      return
    }

    if (isLoading) return

    setIsLoading(true)

    try {
      const response = await fetch(`/api/post/${postId}/${action}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
      })

      if (!response.ok) {
        throw new Error('Failed to update reaction')
      }

      const data = await response.json()

      if (action === 'like') {
        if (data.action === 'added') {
          setLikes(prev => prev + 1)
          setIsLiked(true)
          if (isDisliked) {
            setDislikes(prev => prev - 1)
            setIsDisliked(false)
          }
        } else {
          setLikes(prev => prev - 1)
          setIsLiked(false)
        }
      } else {
        if (data.action === 'added') {
          setDislikes(prev => prev + 1)
          setIsDisliked(true)
          if (isLiked) {
            setLikes(prev => prev - 1)
            setIsLiked(false)
          }
        } else {
          setDislikes(prev => prev - 1)
          setIsDisliked(false)
        }
      }
    } catch (error) {
      console.error('Error updating reaction:', error)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="mt-4 max-md:gap-4 flex items-center">
      <button
        onClick={() => handleAction('like')}
        disabled={isLoading}
        className={`flex items-center gap-2 cursor-pointer hover:bg-dark-gray-hover md:p-2 md:px-4 text-gray-300 transition-colors  ${
          isLoading ? 'opacity-50 cursor-not-allowed' : ''
        }`}
      >
        <ThumbsUp
          className={`size-4 ${isLiked ? 'text-gray-300 fill-white' : ''}`}
          />
        <span className="text-sm font-medium">{likes}</span>
      </button>

      <button
        onClick={() => handleAction('dislike')}
        disabled={isLoading}
        className={`flex items-center gap-2 cursor-pointer hover:bg-dark-gray-hover md:p-2 md:px-4 text-gray-300 transition-colors ${
          isLoading ? 'opacity-50 cursor-not-allowed' : ''
        }`}
      >
        <ThumbsDown
          className={`size-4 ${isDisliked ? 'text-gray-300 fill-white' : ''}`}
        />
        <span className="text-sm font-medium">{dislikes}</span>
      </button>

      <div className="flex items-center gap-2 cursor-pointer hover:bg-dark-gray-hover md:p-2 md:px-4 text-gray-300">
        <MessageCircle className="size-4" />
        <span className="text-sm font-medium">{commentsCount}</span>
      </div>
    </div>
  )
}



================================================================================
FILE: src/components/post-list.tsx
================================================================================
'use client'
import { formatDateTime, getRatingLabel } from '@/lib'
import type { GenericPost } from '@/types/post'
import { AnimatePresence, motion } from 'framer-motion'
import {
  MessageCircle,
  ThumbsDown,
  ThumbsUp
} from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import React from 'react'

type Props = {
  posts: GenericPost[]
  emptyText?: string
}

const UserAvatar: React.FC<{
  user: { name: string | null; image: string | null }
}> = ({ user }) => {
  const getInitials = (name: string | null) => {
    if (!name) return 'U'
    return name
      .split(' ')
      .map((word) => word.charAt(0))
      .join('')
      .toUpperCase()
      .slice(0, 2)
  }

  return (
    <div className="w-10 h-10 rounded-full bg-light-green flex items-center justify-center overflow-hidden">
      {user.image ? (
        <Image
          src={user.image}
          alt={user.name || 'User'}
          width={40}
          height={40}
          unoptimized={user.image.includes('dicebear')}
          className="w-full h-full object-cover"
        />
      ) : (
        <span className="text-gray-400 text-sm font-medium">
          {getInitials(user.name)}
        </span>
      )}
    </div>
  )
}

const PostList: React.FC<Props> = ({ posts, emptyText = 'No posts yet' }) => {
  if (!posts || posts.length === 0) {
    return <div className="py-6 text-center text-gray-400">{emptyText}</div>
  }

  return (
    <div className="flex flex-col">
      <AnimatePresence mode="wait">
        {posts.map((post, index) => (
          <Link
            href={`/post/${post.id}`}
            key={post.id}
            className="cursor-pointer hover:bg-dark-gray-2 border-b border-dark-gray-2  bg-dark-gray-2/40 group transition-colors"
          >
            <motion.div
              initial={{ opacity: 0, y: -8 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{
                duration: 0.35,
                ease: 'easeOut',
                delay: (index + 1) * 0.05,
              }}
            >
              <div className="flex gap-4 ">
                {/* Poster (preferred) or fallback to user initial */}
                <div className="flex self-stretch">
                  <div className="relative w-40 h-full overflow-hidden">
                    <Image
                      src={post.posterUrl || '/logo.png'}
                      alt={post.title || 'Poster'}
                      fill
                      className="object-cover"
                    />
                  </div>
                </div>

                {/* Post Content */}
                <div className="flex flex-col py-4 min-w-0">
                  {/* User info with avatar */}
                  <div className="flex items-center gap-3 mb-3">
                    <UserAvatar user={post.user} />
                    <div className="flex-1">
                      <div className="flex items-center gap-2">
                        <span className="text-white font-medium">
                          {post.user?.name || 'Anonymous'}
                        </span>
                        {post.isSpoiler && (
                          <div className="flex bg-orange-500 rounded-full items-center gap-1 text-white px-2 text-xs">
                            <span>has spoiler</span>
                          </div>
                        )}
                      </div>
                      {post.createdAt && (
                        <div className="flex items-center gap-1 text-gray-400 text-xs mt-1">
                          <span>{formatDateTime(post.createdAt as Date)}</span>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* Title */}
                  {post.title && (
                    <h3 className="text-xl font-bold text-white mb-1">
                      {post.title}
                    </h3>
                  )}
                  {/* Rating and Movie Type */}
                  <div className="flex items-center text-xs text-gray-300 gap-1 mb-2">
                    {post.rating && (
                      <div className="flex items-center bg-dark-gray-2 w-fit px-2 py-0.5 gap-2">
                        {getRatingLabel(post.rating)}
                      </div>
                    )}
                    {post.movie && (
                      <div className="flex items-center h-full gap-1 text-xs bg-dark-gray-2 px-1 py-0.5">
                        <span className="capitalize">{post.movie.type}</span>
                      </div>
                    )}
                  </div>

                  {/* Content */}
                  <div className="mb-4">
                    <p className="text-gray-300 text-sm leading-relaxed">
                      {post.content.length > 150 ? post.content.substring(0, 100) + '...' : post.content}
                    </p>
                  </div>

                  {/* Reactions */}
                  <div className="flex items-center gap-6">
                    <button className="flex items-center gap-2 text-gray-300">
                      <ThumbsUp className="size-4" />
                      <span className="text-sm font-medium">
                        {post.likes?.length ?? 0}
                      </span>
                    </button>
                    <button className="flex items-center gap-2 text-gray-300">
                      <ThumbsDown className="size-4" />
                      <span className="text-sm font-medium">
                        {post.dislikes?.length ?? 0}
                      </span>
                    </button>
                    <div className="flex items-center gap-2 text-gray-300">
                      <MessageCircle className="size-4" />
                      <span className="text-sm font-medium">
                        {post._count?.comments ?? 0}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </motion.div>
          </Link>
        ))}
      </AnimatePresence>
    </div>
  )
}

export default PostList



================================================================================
FILE: src/components/posts-section.tsx
================================================================================
'use client'

import { getAllContentPosts as getAllMoviePosts } from '@/app/(user)/post/actions'
import PostList from '@/components/post-list'
import type { GenericPost } from '@/types/post'
import { useCallback, useEffect, useState } from 'react'




interface PostsSectionProps {
  readonly movieId: string
  readonly refreshTrigger?: number
}

export function PostsSection({ movieId, refreshTrigger }: PostsSectionProps) {
  const [posts, setPosts] = useState<GenericPost[]>([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  const fetchPosts = useCallback(async () => {
    try {
      setLoading(true)
      setError(null)
      const fetchedPosts = await getAllMoviePosts(movieId)
      // Prefer cached posterPath from DB; fall back to API route if missing
      const withPosters: GenericPost[] = await Promise.all(
        fetchedPosts.map(async (post) => {
          const posterPath = post.movie?.posterPath ?? null
          let posterUrl: string | null = null

          if (posterPath) {
            posterUrl = `https://image.tmdb.org/t/p/w500${posterPath}`
          } else {
            try {
              const typeParam = post.movie?.type === 'tv_series' ? 'tv' : 'movie'
              const contentId = post.movie?.id ?? movieId
              const res = await fetch(`/api/poster?id=${contentId}&type=${typeParam}`, { cache: 'no-store' })
              const data = await res.json()
              posterUrl = data?.posterUrl || '/logo.png'
            } catch {
              posterUrl = '/logo.png'
            }
          }

          return {
            id: post.id,
            title: post.title,
            content: post.content,
            rating: post.rating,
            isSpoiler: post.isSpoiler,
            createdAt: post.createdAt,
            posterUrl,
            user: {
              name: post.user?.name ?? null,
              image: post.user?.image ?? null
            },
            movie: post.movie ? {
              id: post.movie.id,
              type: post.movie.type,
              posterPath: post.movie.posterPath
            } : undefined,
            likes: post.likes,
            dislikes: post.dislikes,
            _count: { comments: post._count.comments },
          }
        })
      )
      setPosts(withPosters)
    } catch (err) {
      setError('Failed to load posts')
      console.error('Error fetching posts:', err)
    } finally {
      setLoading(false)
    }
  }, [movieId])

  useEffect(() => {
    fetchPosts()
  }, [fetchPosts])

  // Refetch posts when refreshTrigger changes
  useEffect(() => {
    if (refreshTrigger && refreshTrigger > 0) {
      fetchPosts()
    }
  }, [refreshTrigger, fetchPosts])

  if (loading) {
    return <PostList posts={[]} emptyText="Loading posts..." />
  }

  if (error) {
    return (
      <div className="py-8">
        <div className="text-center">
          <p className="text-center text-red-400 text-xl">Error</p>
          <p className="text-red-400 mb-4">{error}</p>
        </div>
      </div>
    )
  }

  return <PostList posts={posts} emptyText="Be the first to share your thoughts about this movie!" />
}



================================================================================
FILE: src/components/profile/sidebar.tsx
================================================================================
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { cn } from '@/lib/utils'
import { BookText, TvMinimal, User } from 'lucide-react'
import { useEffect, useState } from 'react'
import { motion } from 'framer-motion'

// Mobile: Only 3 main items
const mobileSidebarItems = [
  {
    name: 'Profile',
    href: '/profile',
    icon: <User className="size-5" />,
  },
  {
    name: 'Reviews',
    href: '/profile/reviews',
    icon: <BookText className="size-5" />,
  },
  {
    name: 'Watchlist',
    href: '/profile/watchlist',
    icon: <TvMinimal className="size-5" />,
  },
]

// Desktop: Simple profile navigation items
const profileItems = [
  { href: '/profile', label: 'Profile' },
  { href: '/profile/reviews', label: 'Reviews' },
  { href: '/profile/watchlist', label: 'Watchlist' },
  { href: '/profile/lists', label: 'Lists' },
  { href: '/profile/notifications', label: 'Notifications' },
]

export default function ProfileSidebar() {
  const pathname = usePathname()
  const [activeIndex, setActiveIndex] = useState(0)

  // Update active index when pathname changes
  useEffect(() => {
    const index = mobileSidebarItems.findIndex(item => item.href === pathname)
    if (index !== -1) {
      setActiveIndex(index)
    }
  }, [pathname])

  return (
    <div className="w-full md:w-40">
      {/* Mobile: Instagram-style horizontal navigation */}
      <div
        className="md:hidden fixed inset-x-0 bottom-2 backdrop-blur-3xl z-50 px-2"
        style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}
      >
        <div className="relative flex  rounded-full justify-around items-center bg-dark-gray-2 border-t border-dark-gray-hover h-14 w-full">
          {/* Animated background slider with Framer Motion */}
          <motion.div
            className={`absolute bg-light-green rounded-full h-full`}
            animate={{
              left: `${(activeIndex * 100) / mobileSidebarItems.length}%`,
            }}
            transition={{
              duration: 0.3,
              ease: 'easeOut',
            }}
            style={{
              width: `${100 / mobileSidebarItems.length}%`,
            }}
          />
          {mobileSidebarItems.map((item, index) => {
            const isActive = pathname === item.href
            return (
              <Link
                key={item.name + index}
                href={item.href}
                className={cn(
                  'relative z-10 flex flex-col items-center rounded-full justify-center py-3 transition-colors duration-200 min-w-0 flex-1',
                  isActive
                    ? 'text-white'
                    : 'text-gray-300 hover:text-light-green'
                )}
              >
                <div className="mb-0.5">{item.icon}</div>
                <span className="text-xs font-medium truncate">
                  {item.name}
                </span>
              </Link>
            )
          })}
        </div>
      </div>

      {/* Desktop: Simple vertical sidebar */}
      <aside className="hidden w-full shrink-0 md:block">
        <div className="sticky top-4 overflow-y-auto">
          <nav>
            {profileItems.map(({ href, label }) => {
              const base = 'block px-3 py-1.5 text-sm transition-colors'
              const active = 'text-white bg-light-green'
              const idle = 'hover:text-light-green hover:bg-dark-gray-hover'

              const isActive = pathname === href

              return (
                <Link
                  key={href}
                  href={href}
                  className={`${base} ${isActive ? active : idle}`}
                >
                  {label}
                </Link>
              )
            })}
          </nav>
        </div>
      </aside>
    </div>
  )
}



================================================================================
FILE: src/components/provider/auth-provider.tsx
================================================================================
'use client'
import { SessionProvider, useSession } from 'next-auth/react'

export function AuthProvider({ children }: { children: React.ReactNode }) {
  return (
    <SessionProvider
      refetchInterval={5 * 60}
      refetchOnWindowFocus={false}
    >
      {children}
    </SessionProvider>
  )
}

export function AuthGuard({ children }: { children: React.ReactNode }) {
  const { status } = useSession()
  if (status === 'loading') {
    return <LoadingSession />
  }
  if (status === 'unauthenticated') {
    return <UnauthenticatedSession />
  }
  return <>{children}</>
}

function LoadingSession() {
  return <div>Loading...</div>
}
function UnauthenticatedSession() {
  return <div>Unauthorized...</div>
}



================================================================================
FILE: src/components/provider/query-provider.tsx
================================================================================
'use client'

import { PropsWithChildren, useState } from 'react'
import {
  QueryClient,
  QueryClientProvider,
} from '@tanstack/react-query'
import { ReactQueryDevtools } from '@tanstack/react-query-devtools'

export function QueryProvider({ children }: PropsWithChildren) {
  const [client] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 60_000,
            gcTime: 5 * 60_000,
            refetchOnWindowFocus: false,
            retry: 2,
          },
          mutations: {
            retry: 0,
          },
        },
      }),
  )

  return (
    <QueryClientProvider client={client}>
      {children}
      <ReactQueryDevtools initialIsOpen={false} buttonPosition="bottom-left" />
    </QueryClientProvider>
  )
}





================================================================================
FILE: src/components/settings/sidebar.tsx
================================================================================
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'

const SECTIONS: { title: string; items: { href: string; label: string }[] }[] =
  [
    {
      title: 'Basic Info',
      items: [
        { href: '/settings', label: 'Overview' },
        { href: '/settings/username', label: 'Username' },
      ],
    },
    {
      title: 'Account',
      items: [
        { href: '/settings/security', label: 'Security' },
        { href: '/settings/delete-account', label: 'Delete Account' },
      ],
    },
    {
      title: 'Billing',
      items: [
        { href: '/settings/billing', label: 'Billing' },
      ],
    },
  ]

export default function SettingsSidebar() {
  const pathname = usePathname()

  const base = 'block px-3 py-1.5 text-sm transition-colors'
  const active = 'text-white bg-light-green'
  const idle =
    'hover:text-light-green hover:bg-dark-gray-hover'

  return (
    <aside className="hidden w-64 shrink-0 md:block">
      <div className="sticky top-18 max-h-[calc(100vh-4rem)] overflow-y-auto p-4">
        {SECTIONS.map((section) => (
          <div key={section.title} className="">
            <div className="mt-2 px-3 py-1.5 text-sm font-light uppercase tracking-wide text-zinc-400">
              {section.title}
            </div>
            <nav>
              {section.items.map(({ href, label }) => (
                <Link
                  key={href}
                  href={href}
                  className={`${base} ${pathname === href ? active : idle}`}
                >
                  {label}
                </Link>
              ))}
            </nav>
          </div>
        ))}
      </div>
    </aside>
  )
}



================================================================================
FILE: src/components/skeletons/cinema-list-loading-skeleton.tsx
================================================================================

import React from 'react'

interface CinemaListLoadingSkeletonProps {
  itemCount?: number
}

const CinemaListLoadingSkeleton: React.FC<CinemaListLoadingSkeletonProps> = ({ itemCount = 8 }) => {
  const bdList = [
    'bg-gradient-to-bl to-light-gray from-dark-gray-2',
    'bg-gradient-to-tr delay-100 from-light-gray to-dark-gray-2',
  ]
  return (
    <div className="w-full h-fit">
      <div className="flex gap-3 overflow-x-auto pb-2 scrollbar-hide">
        {Array.from({ length: itemCount }, (_, index) => (
          <div key={index + 'loading-skeleton'} className="flex-shrink-0 w-36">
            <div className={`${bdList[index % bdList.length]} overflow-hidden`}>
              <div className="flex flex-col w-full h-60">
                {/* Poster skeleton - large area for movie poster */}
                <div className="flex-1 flex items-center justify-center">
                  <div className="w-full h-full flex items-center justify-center bg-gradient-to-tr from-dark-gray-2 to-dark-gray animate-pulse">
                    {/* <Loader size="md" text="Loading..." /> */}
                  </div>
                </div>

                {/* Rating section skeleton */}
                <div className="flex items-center p-2 justify-between bg-dark-gray-2/90">
                  <div className="w-8 h-2.5 bg-dark-gray-hover animate-pulse"></div>
                  <div className="flex items-center gap-1">
                    <div className="w-4 h-2.5 bg-dark-gray-hover animate-pulse"></div>
                    <div className="w-6 h-2.5 bg-dark-gray-hover animate-pulse"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}

export default CinemaListLoadingSkeleton



================================================================================
FILE: src/components/text-area.tsx
================================================================================
import { cn } from '@/lib'
import React, { forwardRef } from 'react'

interface TextAreaProps {
  id?: string
  disabled?: boolean
  value?: string
  onChange: (e: React.ChangeEvent<HTMLTextAreaElement>) => void
  placeholder?: string
  required?: boolean
  className?: string
  variant?: 'primary' | 'secondary'
  size?: 'sm' | 'md' | 'lg'
  autoFocus?: boolean
  rows?: number
  cols?: number
}

const TextArea = forwardRef<HTMLTextAreaElement, TextAreaProps>(({
  id = '',
  disabled = false,
  value = '',
  onChange,
  required = false,
  placeholder,
  className = '',
  variant = 'primary',
  size = 'md',
  autoFocus = false,
  rows = 4,
  cols,
}, ref) => {
  const currentClassName = {
    primary:
      'text-white placeholder:text-gray-300 bg-dark-gray outline-none w-full resize-none',
    secondary:
      'text-white placeholder:text-gray-300 bg-dark-gray-2 outline-none w-full resize-none',
  }

  const sizeClasses = {
    sm: 'text-sm p-1.5 px-3',
    md: 'text-base p-2 px-4',
    lg: 'text-base p-3 px-5',
  }

  return (
    <textarea
      ref={ref}
      id={id}
      disabled={disabled}
      value={value}
      onChange={onChange}
      placeholder={placeholder}
      required={required}
      autoFocus={autoFocus}
      rows={rows}
      cols={cols}
      className={cn(className, currentClassName[variant], sizeClasses[size])}
    />
  )
})

TextArea.displayName = 'TextArea'

export default TextArea


================================================================================
FILE: src/components/vertical-cinema-list.tsx
================================================================================
'use client'

import { Star } from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import React, { useCallback, useMemo } from 'react'
import { motion } from 'framer-motion'
import { cn } from '@/lib'
import { MediaItem } from '../types/media'
import Header from './header'
import { useQuery } from '@tanstack/react-query'
import MediaItemDropdown from './media-item-dropdown'

interface VerticalCinemaListProps {
  title: string
  subHeading?:string
  items?: MediaItem[]
  apiUrl?: string
  showEmptyState?: boolean
  className?: string
  contentType?: 'movie' | 'tv_series'
  showDropdown?: boolean
  onWatchlistToggle?: (item: MediaItem) => void
  getWatchlistStatus?: (item: MediaItem) => boolean
}

const VerticalCinemaList: React.FC<VerticalCinemaListProps> = ({
  title,
  subHeading,
  items: itemsProp,
  apiUrl,
  showEmptyState = false,
  className,
  contentType = 'movie',
  showDropdown = false,
  onWatchlistToggle,
  getWatchlistStatus,
}) => {
  const shouldFetch = (!itemsProp || itemsProp.length === 0) && Boolean(apiUrl)

  const { data, isLoading, isError, error, refetch, isFetching } = useQuery<{ results?: MediaItem[] }>({
    queryKey: ['vertical-cinema-list', apiUrl],
    queryFn: async () => {
      if (!apiUrl) return { results: [] }
      const response = await fetch(apiUrl)
      if (!response.ok) {
        throw new Error('Failed to load data')
      }
      return response.json()
    },
    enabled: shouldFetch,
    retry: 3,
    retryDelay: (attempt) => Math.min(1000 * 2 ** attempt, 5000),
  })

  const fetchedItems = useMemo(() => data?.results ?? [], [data])
  const items: MediaItem[] = useMemo(() => {
    return itemsProp && itemsProp.length > 0 ? itemsProp : fetchedItems
  }, [itemsProp, fetchedItems])
  const getTitle = useCallback((item: MediaItem) => {
    return item.title as string
  }, [])

  const linkPath = useCallback((id: number) => {
    return `/movie/${id}`
  }, [])

  // Animation variants
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.1,
        delayChildren: 0.2,
      },
    },
  }

  const itemVariants = {
    hidden: {
      opacity: 0,
      y: 10,
    },
    visible: {
      opacity: 1,
      y: 0,
      transition: {
        type: 'spring' as const,
        stiffness: 100,
        damping: 12,
      },
    },
  }

  const skeletonKeys = useMemo(() => Array.from({ length: 12 }, () => Math.random().toString(36).slice(2)), [])

  const renderContent = () => {
    if (isLoading) {
      return (
        <div className="flex w-full flex-wrap gap-1 items-center justify-start py-2">
          {skeletonKeys.map((key) => (
            <div key={key} className="flex-shrink-0">
              <div className="relative aspect-[2/3] w-[108px] bg-dark-gray-2 overflow-hidden rounded-sm">
                <div className="absolute inset-0 bg-gradient-to-br from-dark-gray via-dark-gray-2 to-dark-gray animate-pulse" />

                <div className="absolute top-1 right-1 bg-black/40 px-1 py-0.5 flex items-center gap-1 text-xs text-white rounded">
                  <div className="size-2 bg-dark-gray-hover rounded-full animate-pulse" />
                  <div className="w-3 h-2 bg-dark-gray-hover animate-pulse" />
                </div>
              </div>
            </div>
          ))}
        </div>
      )
    }
    if (isError) {
      return (
        <div className="w-full flex flex-col items-center justify-center gap-4">
          <div className="text-red-400 text-center">
            <div className="text-lg mb-2">âš ï¸</div>
            <div className="text-sm">{(error instanceof Error ? error.message : 'Failed to load data')}</div>
          </div>
          <button
            onClick={() => { if (!isFetching) { void refetch() } }}
            disabled={isFetching}
            className="px-6 py-2 bg-light-green hover:bg-light-green/80 text-black font-medium rounded-lg disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200"
          >
            {isFetching ? 'Retrying...' : 'Try Again'}
          </button>
        </div>
      )
    }
    if (showEmptyState && items.length === 0) {
      return (
        <div className="w-full flex flex-col items-center justify-center gap-3">
          <div className="text-4xl">ðŸŽ¬</div>
          <div className="text-gray-400 text-center">
            <div className="text-sm font-medium">No upcoming movies</div>
            <div className="text-xs mt-1">
              Check back later for new releases
            </div>
          </div>
        </div>
      )
    }

    return (
      <motion.div
        className="flex w-full flex-wrap gap-1 items-center justify-start"
        variants={containerVariants}
        initial="hidden"
        animate="visible"
      >
        {items.map((item) => (
          <motion.div
            key={item.id}
            variants={itemVariants}
            className="flex-shrink-0"
          >
            <div className="flex flex-col items-center group cursor-pointer relative">
              <Link
                href={linkPath(item.id)}
                className="block"
              >
                <div className="relative aspect-[2/3] w-[108px] bg-dark-gray-2 overflow-hidden">
                {item.poster_path ? (
                  <Image
                    src={`https://image.tmdb.org/t/p/w500${item.poster_path}`}
                    alt={getTitle(item)}
                    fill
                    className="object-cover group-hover:scale-105 transition-transform duration-300"
                    priority={false}
                  />
                ) : (
                  <div className="w-full h-full flex flex-col items-center justify-center text-gray-500 text-xs bg-dark-gray-2">
                    <div className="text-xl mb-1">ðŸŽ¬</div>
                    <div className="text-center text-xs">No Image</div>
                  </div>
                )}

                <div className="absolute inset-0 bg-gradient-to-t from-dark-gray/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />

                {/* Rating badge */}
                <div className="absolute top-1 right-1 bg-black/70 px-1 py-0.5 flex items-center gap-1 text-xs text-white">
                  <Star className="size-2 fill-light-green text-light-green" />
                  <span className="font-medium">
                    {item.vote_average.toFixed(1)}
                  </span>
                </div>
                </div>
              </Link>

              {showDropdown && (
                <div className="absolute top-1 right-1">
                  <MediaItemDropdown
                    item={{
                      id: item.id,
                      title: getTitle(item),
                      poster_path: item.poster_path,
                      release_date: item.release_date,
                    }}
                    contentType={contentType}
                    onWatchlistToggle={() => onWatchlistToggle?.(item)}
                    isInWatchlist={getWatchlistStatus?.(item) || false}
                  />
                </div>
              )}
            </div>
          </motion.div>
        ))}
      </motion.div>
    )
  }

  return (
    <div className={cn('w-full', className)}>
      <Header title={title} subHeading={subHeading} />
      <div className="overflow-y-auto w-full scrollbar-hide">
        {renderContent()}
      </div>
    </div>
  )
}

export default VerticalCinemaList



================================================================================
FILE: src/components/watchlist/remove-button.tsx
================================================================================
'use client'

import { useRouter } from 'next/navigation'
import { useState } from 'react'

export default function RemoveWatchlistButton({ contentId }: { contentId: string }) {
  const router = useRouter()
  const [loading, setLoading] = useState(false)

  const onRemove = async () => {
    if (loading) return
    setLoading(true)
    try {
      const res = await fetch(`/api/user/watchlist/${contentId}`, { method: 'DELETE' })
      if (!res.ok) {
        // Optionally show a toast
      }
      router.refresh()
    } finally {
      setLoading(false)
    }
  }

  return (
    <button
      onClick={onRemove}
      disabled={loading}
      className="px-3 py-1 bg-dark-gray hover:bg-dark-gray-hover text-gray-200 text-sm disabled:opacity-60 disabled:cursor-not-allowed"
    >
      {loading ? 'Removing...' : 'Remove'}
    </button>
  )
}





================================================================================
FILE: src/components/watchlist/watchlist-item.tsx
================================================================================
import Image from 'next/image'
import Link from 'next/link'
import { WatchlistItem } from '@/services/watchlist'
import RemoveWatchlistButton from './remove-button'

interface WatchlistItemProps {
  item: WatchlistItem
}

export default function WatchlistItemComponent({ item }: WatchlistItemProps) {
  return (
    <div className="group flex items-center gap-3 p-3 rounded-lg bg-gray-800/30 hover:bg-gray-800/50 transition-colors">
      <Link href={item.href} className="flex items-center gap-3 flex-1 min-w-0">
        <div className="w-12 h-16 bg-gray-700 rounded-sm overflow-hidden flex-shrink-0">
          {item.movie.posterPath ? (
            <Image
              src={`https://image.tmdb.org/t/p/w154${item.movie.posterPath}`}
              alt={item.displayTitle}
              width={48}
              height={64}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full bg-gray-600" />
          )}
        </div>

        <div className="flex flex-col min-w-0 flex-1">
          <div className="flex items-center gap-2 mb-1">
            <h3 className="text-sm font-medium text-gray-100 truncate">
              {item.displayTitle}
            </h3>
            {item.year && (
              <span className="text-xs text-gray-400 flex-shrink-0">
                {item.year}
              </span>
            )}
          </div>

          <div className="flex items-center gap-2">
            <span className="text-xs text-gray-500">
              Added {new Date(item.createdAt).toLocaleDateString()}
            </span>
            <span className="text-xs px-1.5 py-0.5 rounded bg-gray-700 text-gray-400">
              {item.movie.type === 'tv_series' ? 'TV' : 'Movie'}
            </span>
          </div>
        </div>
      </Link>

      <RemoveWatchlistButton contentId={item.contentId} />
    </div>
  )
}



================================================================================
FILE: src/components/watchlist/watchlist-list.tsx
================================================================================
import { WatchlistItem } from '@/services/watchlist'
import WatchlistItemComponent from './watchlist-item'

interface WatchlistListProps {
  items: WatchlistItem[]
}

export default function WatchlistList({ items }: WatchlistListProps) {
  if (items.length === 0) {
    return (
      <div className="text-center py-12">
        <div className="text-gray-400 text-sm">Your watchlist is empty</div>
        <div className="text-gray-500 text-xs mt-1">
          Add movies and shows to get started
        </div>
      </div>
    )
  }

  return (
    <div className="space-y-2">
      {items.map((item) => (
        <WatchlistItemComponent key={item.contentId} item={item} />
      ))}
    </div>
  )
}





================================================================================
FILE: eslint.config.mjs
================================================================================
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;



================================================================================
FILE: hooks/use-tmdb-queries.ts
================================================================================
'use client';

import { useQuery } from '@tanstack/react-query';

interface MediaItem {
  id: number;
  title?: string;
  name?: string;
  poster_path: string | null;
  backdrop_path: string | null;
  overview: string;
  vote_average: number;
  release_date?: string;
  first_air_date?: string;
  media_type?: 'movie' | 'tv';
}

interface TmdbResponse {
  results: MediaItem[];
  page: number;
  total_pages: number;
}

async function fetchFromApi(endpoint: string): Promise<TmdbResponse> {
  const res = await fetch(endpoint);
  if (!res.ok) {
    throw new Error(`Failed to fetch data from ${endpoint}`);
  }
  return res.json();
}

export const useTrendingMovies = () => {
  return useQuery({
    queryKey: ['trending', 'movie'],
    queryFn: () => fetchFromApi('/api/trending-movie'),
  });
};

export const useTrendingSeries = () => {
  return useQuery({
    queryKey: ['trending', 'tv'],
    queryFn: () => fetchFromApi('/api/trending-series'),
  });
};

export const useNowPlayingMovies = () => {
  return useQuery({
    queryKey: ['movie', 'now-playing'],
    queryFn: () => fetchFromApi('/api/now-playing'),
  });
};

export const useUpcomingMovies = () => {
  return useQuery({
    queryKey: ['movie', 'upcoming'],
    queryFn: () => fetchFromApi('/api/upcoming'),
  });
};

export const usePopularMovies = () => {
  return useQuery({
    queryKey: ['movie', 'popular'],
    queryFn: () => fetchFromApi('/api/popular-movie'),
  });
};


================================================================================
FILE: hooks/useDebounce.ts
================================================================================
import { useEffect, useState } from 'react'

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value)

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value)
    }, delay)

    return () => {
      clearTimeout(handler)
    }
  }, [value, delay])

  return debouncedValue
}



================================================================================
FILE: next-env.d.ts
================================================================================
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.



================================================================================
FILE: next.config.ts
================================================================================
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'api.dicebear.com',
      },
      {
        protocol: 'https',
        hostname: 'image.tmdb.org',
      },
      {
        protocol: 'https',
        hostname: 'lh3.googleusercontent.com',
      },
    ],
  },
}

export default nextConfig



================================================================================
FILE: package.json
================================================================================
{
  "name": "yourreview",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:studio": "prisma studio"
  },
  "dependencies": {
    "@next-auth/prisma-adapter": "^1.0.7",
    "@prisma/client": "^6.14.0",
    "@tanstack/react-query": "^5.89.0",
    "@tanstack/react-query-devtools": "^5.89.0",
    "axios": "^1.12.0",
    "bcryptjs": "^3.0.2",
    "clsx": "^2.1.1",
    "dotenv": "^17.2.2",
    "framer-motion": "^12.23.12",
    "jsonwebtoken": "^9.0.3",
    "lucide-react": "^0.539.0",
    "next": "15.4.10",
    "next-auth": "^4.24.11",
    "openai": "^5.19.1",
    "pg": "^8.16.3",
    "prisma": "^6.14.0",
    "react": "19.1.0",
    "react-dom": "19.1.0",
    "tailwind-merge": "^3.3.1",
    "zod": "^3.25.76",
    "zustand": "^5.0.8"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@types/bcryptjs": "^2.4.6",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "concurrently": "^9.2.1",
    "eslint": "^9",
    "eslint-config-next": "15.4.6",
    "tailwindcss": "^4",
    "tsx": "^4.20.5",
    "typescript": "^5"
  }
}



================================================================================
FILE: postcss.config.mjs
================================================================================
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;



================================================================================
FILE: prisma/migrations/20250905113400_init/migration.sql
================================================================================
-- CreateTable
CREATE TABLE "public"."User" (
    "id" TEXT NOT NULL,
    "name" TEXT,
    "username" TEXT NOT NULL,
    "email" TEXT,
    "emailVerified" TIMESTAMP(3),
    "image" TEXT,
    "password" TEXT,
    "role" TEXT DEFAULT 'user',

    CONSTRAINT "User_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."Account" (
    "id" TEXT NOT NULL,
    "userId" TEXT NOT NULL,
    "type" TEXT NOT NULL,
    "provider" TEXT NOT NULL,
    "providerAccountId" TEXT NOT NULL,
    "refresh_token" TEXT,
    "access_token" TEXT,
    "expires_at" INTEGER,
    "token_type" TEXT,
    "scope" TEXT,
    "id_token" TEXT,
    "session_state" TEXT,

    CONSTRAINT "Account_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."Session" (
    "id" TEXT NOT NULL,
    "sessionToken" TEXT NOT NULL,
    "userId" TEXT NOT NULL,
    "expires" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "Session_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."VerificationToken" (
    "identifier" TEXT NOT NULL,
    "token" TEXT NOT NULL,
    "expires" TIMESTAMP(3) NOT NULL
);

-- CreateTable
CREATE TABLE "public"."Movie" (
    "id" TEXT NOT NULL,
    "type" TEXT NOT NULL DEFAULT 'movie',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "Movie_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."Post" (
    "id" TEXT NOT NULL,
    "title" TEXT,
    "content" TEXT NOT NULL,
    "rating" INTEGER,
    "isSpoiler" BOOLEAN NOT NULL DEFAULT false,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "contentId" TEXT NOT NULL,
    "userId" TEXT NOT NULL,

    CONSTRAINT "Post_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."Comment" (
    "id" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "isSpoiler" BOOLEAN NOT NULL DEFAULT false,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "postId" TEXT,
    "parentId" TEXT,
    "userId" TEXT NOT NULL,

    CONSTRAINT "Comment_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."Like" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" TEXT NOT NULL,
    "postId" TEXT,
    "commentId" TEXT,

    CONSTRAINT "Like_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."Dislike" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" TEXT NOT NULL,
    "postId" TEXT,
    "commentId" TEXT,

    CONSTRAINT "Dislike_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE UNIQUE INDEX "User_username_key" ON "public"."User"("username");

-- CreateIndex
CREATE UNIQUE INDEX "User_email_key" ON "public"."User"("email");

-- CreateIndex
CREATE UNIQUE INDEX "Account_provider_providerAccountId_key" ON "public"."Account"("provider", "providerAccountId");

-- CreateIndex
CREATE UNIQUE INDEX "Session_sessionToken_key" ON "public"."Session"("sessionToken");

-- CreateIndex
CREATE UNIQUE INDEX "VerificationToken_token_key" ON "public"."VerificationToken"("token");

-- CreateIndex
CREATE UNIQUE INDEX "VerificationToken_identifier_token_key" ON "public"."VerificationToken"("identifier", "token");

-- CreateIndex
CREATE INDEX "Post_contentId_idx" ON "public"."Post"("contentId");

-- CreateIndex
CREATE INDEX "Post_userId_idx" ON "public"."Post"("userId");

-- CreateIndex
CREATE INDEX "Post_createdAt_idx" ON "public"."Post"("createdAt");

-- CreateIndex
CREATE INDEX "Comment_postId_idx" ON "public"."Comment"("postId");

-- CreateIndex
CREATE INDEX "Comment_parentId_idx" ON "public"."Comment"("parentId");

-- CreateIndex
CREATE INDEX "Comment_userId_idx" ON "public"."Comment"("userId");

-- CreateIndex
CREATE INDEX "Comment_createdAt_idx" ON "public"."Comment"("createdAt");

-- CreateIndex
CREATE UNIQUE INDEX "Like_userId_postId_key" ON "public"."Like"("userId", "postId");

-- CreateIndex
CREATE UNIQUE INDEX "Like_userId_commentId_key" ON "public"."Like"("userId", "commentId");

-- CreateIndex
CREATE UNIQUE INDEX "Dislike_userId_postId_key" ON "public"."Dislike"("userId", "postId");

-- CreateIndex
CREATE UNIQUE INDEX "Dislike_userId_commentId_key" ON "public"."Dislike"("userId", "commentId");

-- AddForeignKey
ALTER TABLE "public"."Account" ADD CONSTRAINT "Account_userId_fkey" FOREIGN KEY ("userId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Session" ADD CONSTRAINT "Session_userId_fkey" FOREIGN KEY ("userId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Post" ADD CONSTRAINT "Post_contentId_fkey" FOREIGN KEY ("contentId") REFERENCES "public"."Movie"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Post" ADD CONSTRAINT "Post_userId_fkey" FOREIGN KEY ("userId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Comment" ADD CONSTRAINT "Comment_postId_fkey" FOREIGN KEY ("postId") REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Comment" ADD CONSTRAINT "Comment_parentId_fkey" FOREIGN KEY ("parentId") REFERENCES "public"."Comment"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Comment" ADD CONSTRAINT "Comment_userId_fkey" FOREIGN KEY ("userId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Like" ADD CONSTRAINT "Like_userId_fkey" FOREIGN KEY ("userId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Like" ADD CONSTRAINT "Like_postId_fkey" FOREIGN KEY ("postId") REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Like" ADD CONSTRAINT "Like_commentId_fkey" FOREIGN KEY ("commentId") REFERENCES "public"."Comment"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Dislike" ADD CONSTRAINT "Dislike_userId_fkey" FOREIGN KEY ("userId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Dislike" ADD CONSTRAINT "Dislike_postId_fkey" FOREIGN KEY ("postId") REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Dislike" ADD CONSTRAINT "Dislike_commentId_fkey" FOREIGN KEY ("commentId") REFERENCES "public"."Comment"("id") ON DELETE CASCADE ON UPDATE CASCADE;



================================================================================
FILE: prisma/migrations/20250907101408_follow_system/migration.sql
================================================================================
-- CreateTable
CREATE TABLE "public"."Follow" (
    "id" TEXT NOT NULL,
    "followerId" TEXT NOT NULL,
    "followingId" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "Follow_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE INDEX "Follow_followerId_idx" ON "public"."Follow"("followerId");

-- CreateIndex
CREATE INDEX "Follow_followingId_idx" ON "public"."Follow"("followingId");

-- CreateIndex
CREATE UNIQUE INDEX "Follow_followerId_followingId_key" ON "public"."Follow"("followerId", "followingId");

-- AddForeignKey
ALTER TABLE "public"."Follow" ADD CONSTRAINT "Follow_followerId_fkey" FOREIGN KEY ("followerId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Follow" ADD CONSTRAINT "Follow_followingId_fkey" FOREIGN KEY ("followingId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;



================================================================================
FILE: prisma/migrations/20250910094354_added_ratings_enum/migration.sql
================================================================================
/*
  Warnings:

  - The `rating` column on the `Post` table would be dropped and recreated. This will lead to data loss if there is data in the column.

*/
-- CreateEnum
CREATE TYPE "public"."Rating" AS ENUM ('TRASH', 'TIMEPASS', 'ONE_TIME_WATCH', 'MUST_WATCH', 'LEGENDARY');

-- AlterTable
ALTER TABLE "public"."Post" DROP COLUMN "rating",
ADD COLUMN     "rating" "public"."Rating";



================================================================================
FILE: prisma/migrations/20250912112243_add_poster_path/migration.sql
================================================================================
-- AlterTable
ALTER TABLE "public"."Movie" ADD COLUMN     "posterPath" TEXT;



================================================================================
FILE: prisma/migrations/20250916095241_added_chat_model/migration.sql
================================================================================
-- CreateTable
CREATE TABLE "public"."Conversation" (
    "id" TEXT NOT NULL,
    "isGroup" BOOLEAN NOT NULL DEFAULT false,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "Conversation_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."Message" (
    "id" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "type" TEXT NOT NULL DEFAULT 'text',
    "isRead" BOOLEAN NOT NULL DEFAULT false,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "conversationId" TEXT NOT NULL,
    "senderId" TEXT NOT NULL,

    CONSTRAINT "Message_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "public"."_ConversationToUser" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL,

    CONSTRAINT "_ConversationToUser_AB_pkey" PRIMARY KEY ("A","B")
);

-- CreateIndex
CREATE INDEX "Conversation_createdAt_idx" ON "public"."Conversation"("createdAt");

-- CreateIndex
CREATE INDEX "Message_conversationId_idx" ON "public"."Message"("conversationId");

-- CreateIndex
CREATE INDEX "Message_senderId_idx" ON "public"."Message"("senderId");

-- CreateIndex
CREATE INDEX "Message_createdAt_idx" ON "public"."Message"("createdAt");

-- CreateIndex
CREATE INDEX "_ConversationToUser_B_index" ON "public"."_ConversationToUser"("B");

-- AddForeignKey
ALTER TABLE "public"."Message" ADD CONSTRAINT "Message_conversationId_fkey" FOREIGN KEY ("conversationId") REFERENCES "public"."Conversation"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."Message" ADD CONSTRAINT "Message_senderId_fkey" FOREIGN KEY ("senderId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."_ConversationToUser" ADD CONSTRAINT "_ConversationToUser_A_fkey" FOREIGN KEY ("A") REFERENCES "public"."Conversation"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "public"."_ConversationToUser" ADD CONSTRAINT "_ConversationToUser_B_fkey" FOREIGN KEY ("B") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;



================================================================================
FILE: prisma/migrations/20250919181003_add_soft_delete_to_user/migration.sql
================================================================================
/*
  Warnings:

  - You are about to drop the `Conversation` table. If the table is not empty, all the data it contains will be lost.
  - You are about to drop the `Message` table. If the table is not empty, all the data it contains will be lost.
  - You are about to drop the `_ConversationToUser` table. If the table is not empty, all the data it contains will be lost.

*/
-- DropForeignKey
ALTER TABLE "public"."Message" DROP CONSTRAINT "Message_conversationId_fkey";

-- DropForeignKey
ALTER TABLE "public"."Message" DROP CONSTRAINT "Message_senderId_fkey";

-- DropForeignKey
ALTER TABLE "public"."_ConversationToUser" DROP CONSTRAINT "_ConversationToUser_A_fkey";

-- DropForeignKey
ALTER TABLE "public"."_ConversationToUser" DROP CONSTRAINT "_ConversationToUser_B_fkey";

-- AlterTable
ALTER TABLE "public"."User" ADD COLUMN     "deletedAt" TIMESTAMP(3),
ADD COLUMN     "isDeleted" BOOLEAN NOT NULL DEFAULT false;

-- DropTable
DROP TABLE "public"."Conversation";

-- DropTable
DROP TABLE "public"."Message";

-- DropTable
DROP TABLE "public"."_ConversationToUser";



================================================================================
FILE: prisma/migrations/20250919_remove_chat/migration.sql
================================================================================



================================================================================
FILE: prisma/migrations/20250921083729_add_user_activity_tracking/migration.sql
================================================================================
-- CreateTable
CREATE TABLE "public"."UserActivity" (
    "id" TEXT NOT NULL,
    "userId" TEXT NOT NULL,
    "activityDate" TIMESTAMP(3) NOT NULL,
    "activityType" TEXT NOT NULL,
    "contentId" TEXT,
    "metadata" JSONB,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "UserActivity_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE INDEX "UserActivity_userId_idx" ON "public"."UserActivity"("userId");

-- CreateIndex
CREATE INDEX "UserActivity_activityDate_idx" ON "public"."UserActivity"("activityDate");

-- CreateIndex
CREATE INDEX "UserActivity_userId_activityDate_idx" ON "public"."UserActivity"("userId", "activityDate");

-- CreateIndex
CREATE UNIQUE INDEX "UserActivity_userId_activityDate_activityType_key" ON "public"."UserActivity"("userId", "activityDate", "activityType");

-- AddForeignKey
ALTER TABLE "public"."UserActivity" ADD CONSTRAINT "UserActivity_userId_fkey" FOREIGN KEY ("userId") REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE;



================================================================================
FILE: prisma/migrations/20250921114900_remove_activity_unique_constraint/migration.sql
================================================================================
-- DropIndex
DROP INDEX "public"."UserActivity_userId_activityDate_activityType_key";



================================================================================
FILE: prisma/schema.prisma
================================================================================
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  name          String?
  username      String    @unique
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  password      String? // Hashed for local auth
  role          String?   @default("user") // Extendable for RBAC

  // Soft delete fields
  deletedAt DateTime? // When the user was soft deleted
  isDeleted Boolean   @default(false) // Quick check for deleted status

  accounts Account[]
  sessions Session[]

  activities     UserActivity[]
  watchlistItems WatchlistItem[]

  // User's posts and comments
  posts    Post[]
  comments Comment[]

  // User's interactions
  likes    Like[]
  dislikes Dislike[]

  // Follows
  followers Follow[] @relation("UserFollowedBy")
  following Follow[] @relation("UserFollows")
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WatchlistItem {
  id        String   @id @default(uuid())
  userId    String
  contentId String // references Movie.id
  createdAt DateTime @default(now())

  // Relations
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie Movie @relation(fields: [contentId], references: [id], onDelete: Cascade)

  // Ensure a user can save a movie only once
  @@unique([userId, contentId])
  // Helpful indexes
  @@index([userId])
  @@index([contentId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Movie {
  id         String   @id
  type       String   @default("movie") // "movie" or "tv_series"
  posterPath String? // TMDB poster_path cached to reduce API calls
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  posts         Post[]
  watchlistedBy WatchlistItem[]
}

model Post {
  id        String   @id @default(uuid())
  title     String?
  content   String
  rating    Rating?
  isSpoiler Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Foreign keys
  contentId String // Can be movieId or tvSeriesId
  userId    String

  // Relations
  movie Movie @relation(fields: [contentId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Comments and interactions
  comments Comment[]
  likes    Like[]
  dislikes Dislike[]

  // Indexes for better performance
  @@index([contentId])
  @@index([userId])
  @@index([createdAt])
}

model Comment {
  id        String   @id @default(uuid())
  content   String
  isSpoiler Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Foreign keys
  postId   String?
  parentId String? // For nested comments
  userId   String

  // Relations
  post    Post?     @relation(fields: [postId], references: [id], onDelete: Cascade)
  parent  Comment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies Comment[] @relation("CommentReplies")
  user    User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Interactions
  likes    Like[]
  dislikes Dislike[]

  // Indexes for better performance
  @@index([postId])
  @@index([parentId])
  @@index([userId])
  @@index([createdAt])
}

model Like {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  // Foreign keys
  userId    String
  postId    String?
  commentId String?

  // Relations
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  post    Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  comment Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)

  // Ensure one like per user per post/comment
  @@unique([userId, postId])
  @@unique([userId, commentId])
}

model Dislike {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  // Foreign keys
  userId    String
  postId    String?
  commentId String?

  // Relations
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  post    Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  comment Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)

  // Ensure one dislike per user per post/comment
  @@unique([userId, postId])
  @@unique([userId, commentId])
}

model Follow {
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())

  // Relations
  follower  User @relation("UserFollows", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("UserFollowedBy", fields: [followingId], references: [id], onDelete: Cascade)

  // Ensure a user can follow another user only once
  @@unique([followerId, followingId])
  // Helpful indexes
  @@index([followerId])
  @@index([followingId])
}

model UserActivity {
  id           String   @id @default(uuid())
  userId       String
  activityDate DateTime // The date this activity occurred (can be today or past date)
  activityType String // Type of activity: 'post_created', 'review_posted', 'movie_watched', etc.
  contentId    String? // Optional: ID of the content (movie, post, etc.)
  metadata     Json? // Optional: Additional data about the activity
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Indexes for better performance
  @@index([userId])
  @@index([activityDate])
  @@index([userId, activityDate])
}

enum Rating {
  TRASH
  TIMEPASS
  ONE_TIME_WATCH
  MUST_WATCH
  LEGENDARY
}



================================================================================
FILE: src/app/(auth)/layout.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import { getSession } from '@/lib'
import { redirect } from 'next/navigation'
import React from 'react'

const AuthLayout = async ({ children }: { children: React.ReactNode }) => {
  const session = await getSession()
  if (session) redirect('/');

  return (
    <AnimatePageWrapper className="page-gradient">
      {children}
    </AnimatePageWrapper>
  )
}

export default AuthLayout



================================================================================
FILE: src/app/(auth)/signin/page.tsx
================================================================================
import { SignInForm } from './signin-form'
import { GoogleButton } from '@/components/buttons/google-button'
import Link from 'next/link'
import AnimatePageWrapper from '@/components/animate-page-wrapper'

export default function SignIn() {
  return (
    <AnimatePageWrapper className="max-md:px-2 flex bg-light-gray text-gray-300 flex-col gap-2 items-center py-10 lg:py-32 min-h-screen">
      <div className="max-w-lg flex items-center justify-center flex-col gap-3 w-full">
        <div className="flex flex-col text-4xl py-2 gap-1 w-full font-light">
          <h1 className="">Hello Again!</h1>
          <h1 className="">Welcome</h1>
          <h1 className="">back</h1>
        </div>
        <SignInForm />
        <div className="">or</div>
        <GoogleButton />
        <div className="flex gap-1">
          <p>Don&apos;t have an account?</p>
          <Link href={'/signup'} className="underline">
            Register
          </Link>
        </div>
      </div>
    </AnimatePageWrapper>
  )
}



================================================================================
FILE: src/app/(auth)/signin/signin-form.tsx
================================================================================
'use client'

import Button from '@/components/ui/button'
import Input from '@/components/ui/input'
import Loader from '@/components/ui/loader'
import { AnimatePresence, motion } from 'framer-motion'
import { signIn } from 'next-auth/react'
import { useRouter } from 'next/navigation'
import { useEffect, useState, useCallback } from 'react'

type FormState = {
  email: string
  password: string
}

export function SignInForm() {
  const router = useRouter()
  const [formData, setFormData] = useState<FormState>({
    email: '',
    password: '',
  })

  const [error, setError] = useState('')
  const [loadingType, setLoadingType] = useState<'user' | 'guest' | null>(null)

  const isLoading = loadingType !== null
  const isFormValid =
    formData.email.trim() !== '' && formData.password.trim() !== ''

  const login = useCallback(
    async (email: string, password: string, type: 'user' | 'guest') => {
      if (isLoading) return
      setError('')
      setLoadingType(type)
      try {
        const result = await signIn('credentials', {
          redirect: false,
          email,
          password,
        })

        if (result?.error) {
          setError(result.error)
        } else {
          router.push('/')
        }
      } catch {
        setError('An unexpected error occurred')
      } finally {
        setLoadingType(null)
      }
    },
    [isLoading, router]
  )

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    if (!isFormValid) return
    login(formData.email, formData.password, 'user')
  }

  const handleGuestLogin = () => {
    login('guest@escape.com', 'guest', 'guest')
  }

  useEffect(() => {
    if (!error) return
    const timer = setTimeout(() => setError(''), 10000)
    return () => clearTimeout(timer)
  }, [error])

  return (
    <form onSubmit={handleSubmit} className="w-full flex flex-col gap-2">
      <Input
        disabled={isLoading}
        type="email"
        value={formData.email}
        onChange={(e) =>
          setFormData((prev) => ({ ...prev, email: e.target.value }))
        }
        placeholder="Email"
        required
        variant="primary"
      />

      <Input
        disabled={isLoading}
        type="password"
        value={formData.password}
        onChange={(e) =>
          setFormData((prev) => ({ ...prev, password: e.target.value }))
        }
        placeholder="Password"
        required
        variant="primary"
      />

      <Button
        type="submit"
        variant="primary"
        className={`mt-2 ${error ? 'bg-red-500' : ''}`}
        disabled={isLoading}
        onMouseEnter={() => setError('')}
      >
        <AnimatePresence mode="wait">
          {error ? (
            <motion.p
              key="error"
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
            >
              {error}
            </motion.p>
          ) : loadingType === 'user' ? (
            <motion.div
              key="loader"
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
            >
              <Loader color="#ffffff" size="sm" />
            </motion.div>
          ) : (
            <motion.p
              key="signin"
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
            >
              Sign In
            </motion.p>
          )}
        </AnimatePresence>
      </Button>

      <Button
        type="button"
        variant="secondary"
        disabled={isLoading}
        onClick={handleGuestLogin}
      >
        {loadingType === 'guest' ? (
          <Loader color="#ffffff" size="sm" />
        ) : (
          'Login as guest'
        )}
      </Button>
    </form>
  )
}



================================================================================
FILE: src/app/(auth)/signup/actions.ts
================================================================================
'use server'

import { generateUniqueUsernameFromEmail, prisma } from '@/lib'
import bcrypt from 'bcryptjs'

interface SignupData{
  name: string
  password: string
  email:string
}

export async function signup(data: SignupData) {
  const { name, password, email } = data;

  const existingUser = await prisma.user.findUnique({
    where: {
      email,
      isDeleted: false, // Only check non-deleted users
    }
  })
  if (existingUser) {
    throw new Error('User already exists')
  }

  const username = await generateUniqueUsernameFromEmail(email, prisma)

  const hashedPassword = await bcrypt.hash(password, 10)

  try {
    await prisma.user.create({
      data: {
        username,
        name,
        email,
        password: hashedPassword,
        image: 'https://api.dicebear.com/9.x/lorelei/svg?seed=' + username,
      },
    })

    return { success: true, email }
  } catch (error) {
    console.log('Error : ', error)
    throw new Error('Failed to create user')
  }
}



================================================================================
FILE: src/app/(auth)/signup/page.tsx
================================================================================
import { SignUpForm } from '@/app/(auth)/signup/signup-form'
import { GoogleButton } from '@/components/buttons/google-button'
import Link from 'next/link'
import AnimatePageWrapper from '@/components/animate-page-wrapper'

export default function SignUp() {
  return (
    <AnimatePageWrapper className="max-md:px-2 flex bg-light-gray text-gray-300 flex-col gap-2 items-center py-10 lg:py-32 min-h-screen">
      <div className="max-w-lg flex items-center justify-center flex-col gap-3 w-full">
        <div className="flex flex-col text-4xl py-2 gap-1 w-full font-light">
          <h1 className="">Join Us!</h1>
          <h1 className="">Create Your</h1>
          <h1 className="">Account</h1>
        </div>

        <SignUpForm />
        
        <div className="">or</div>
        <GoogleButton />
        
        <div className="flex gap-1">
          <p>Already have an account?</p>
          <Link href={'/signin'} className="underline">
            Sign In
          </Link>
        </div>
      </div>
    </AnimatePageWrapper>
  )
}


================================================================================
FILE: src/app/(auth)/signup/signup-form.tsx
================================================================================
'use client'

import { signup } from '@/app/(auth)/signup/actions'
import Button from '@/components/ui/button'
import Input from '@/components/ui/input'
import Loader from '@/components/ui/loader'
import { AnimatePresence, motion } from 'framer-motion'
import { signIn } from 'next-auth/react'
import { useRouter } from 'next/navigation'
import { useEffect, useState } from 'react'

export function SignUpForm() {
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
  })
  const router = useRouter()

  const isFormValid =
    formData.name.trim() !== '' &&
    formData.email.trim() !== '' &&
    formData.password.trim() !== ''

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()

    if (!isFormValid || isLoading) return

    setError('')
    setIsLoading(true)

    try {
      const result = await signup(formData)

      if (result?.success) {
        const loginResult = await signIn('credentials', {
          redirect: false,
          email: formData.email,
          password: formData.password,
        })

        if (loginResult?.error) {
          setError('Signup successful but login failed. Please try logging in manually.')
        } else {
          router.push('/')
        }
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Signup failed')
    } finally {
      setIsLoading(false)
    }
  }

  useEffect(() => {
    if (!error) return

    const timer = setTimeout(() => {
      setError('')
    }, 10000)

    return () => clearTimeout(timer)
  }, [error])

  return (
    <form onSubmit={handleSubmit} className="w-full flex flex-col gap-2">
      <Input
        disabled={isLoading}
        type="text"
        value={formData.name}
        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
        placeholder="Name"
        required
        variant="primary"
      />
      <Input
        disabled={isLoading}
        type="email"
        value={formData.email}
        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
        placeholder="Email"
        required
        variant="primary"
      />
      <Input
        disabled={isLoading}
        type="password"
        value={formData.password}
        onChange={(e) => setFormData({ ...formData, password: e.target.value })}
        placeholder="Password"
        required
        variant="primary"
      />
      <Button
        type="submit"
        variant="primary"
        disabled={!isFormValid || isLoading}
        className={`mt-2 h-10 ${error ? "bg-red-500" : ""}`}
        onMouseEnter={() => setError("")}
      >
        <AnimatePresence mode="wait">
          {error ? (
            <motion.p
              key="error"
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
            >
              {error}
            </motion.p>
          ) : isLoading ? (
            <motion.div
              key="loader"
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
            >
              <Loader color="#ffffff" size="sm" />
            </motion.div>
          ) : (
            <motion.p
              key="signup"
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
            >
              Sign Up
            </motion.p>
          )}
        </AnimatePresence>
      </Button>
    </form>
  )
}



================================================================================
FILE: src/app/(user)/(media)/movie/[id]/loading.tsx
================================================================================
import Loader from '@/components/ui/loader'
import React from 'react'

const LoadingMovie = () => {
  return (
    <div className="flex items-center justify-center h-full">
      <Loader text="Loading movie details..." />
    </div>
  )
}

export default LoadingMovie



================================================================================
FILE: src/app/(user)/(media)/movie/[id]/page.tsx
================================================================================
import MovieDetailsComponent from '@/components/page/movie/movie-details-component'

const page = async ({ params }: { params: Promise<{ id: string }> }) => {
  const { id } = await params

  const base = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'
  const url = `${base}/api/movie?id=${encodeURIComponent(id)}`
  const res = await fetch(url, { cache: 'no-store' })
  const movie = res.ok ? await res.json() : null

  return <MovieDetailsComponent movie={movie} />
}

export default page



================================================================================
FILE: src/app/(user)/(media)/movie/page.tsx
================================================================================
import Building from '@/components/page/building'
import React from 'react'

const page = () => {
  return (
    <Building />
  )
}

export default page


================================================================================
FILE: src/app/(user)/(media)/web-series/[id]/loading.tsx
================================================================================
import Loader from '@/components/ui/loader'
import React from 'react'

const LoadingSeries = () => {
  return (
    <div className="flex items-center justify-center h-full">
      <Loader text="Loading webseries details..." />
    </div>
  )
}

export default LoadingSeries



================================================================================
FILE: src/app/(user)/(media)/web-series/[id]/page.tsx
================================================================================
import React from 'react'
import TVSeriesClient from '@/components/page/tv-series/tv-series-client'

const page = async ({ params }: { params: Promise<{ id: string }> }) => {
  const { id } = await params

  return <TVSeriesClient seriesId={id} />
}

export default page


================================================================================
FILE: src/app/(user)/(media)/web-series/page.tsx
================================================================================
import React from 'react'

const WebSeries = () => {
  return (
    <div>WebSeries</div>
  )
}

export default WebSeries


================================================================================
FILE: src/app/(user)/feed/[slug]/page.tsx
================================================================================
import React from 'react'

const PostPage = () => {
  return (
    <div>PostPage</div>
  )
}

export default PostPage


================================================================================
FILE: src/app/(user)/feed/page.tsx
================================================================================
import React from 'react'

const FeedPage = () => {
  return (
    <div>FeedPage</div>
  )
}

export default FeedPage


================================================================================
FILE: src/app/(user)/layout.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import Navbar from '@/components/navbar'
import React from 'react'

const UserLayout = ({ children }: { children: React.ReactNode }) => {
  return (
    <AnimatePageWrapper className="page-gradient">
      <Navbar />
      <div className="flex justify-center w-full">
        <main className="w-full max-w-5xl py-4 min-h-[calc(100vh-52px)] md:min-h-[calc(100vh-56px)]">
          {children}
        </main>
      </div>
    </AnimatePageWrapper>
  )
}

export default UserLayout



================================================================================
FILE: src/app/(user)/lists/create/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import React from 'react'

const CreateListsPage = () => {
  return (
    <AnimatePageWrapper>CreateListsPage</AnimatePageWrapper>
  )
}

export default CreateListsPage


================================================================================
FILE: src/app/(user)/lists/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import React from 'react'

const ListsPage = () => {
  return (
    <AnimatePageWrapper>ListsPage</AnimatePageWrapper>
  )
}

export default ListsPage


================================================================================
FILE: src/app/(user)/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import CinemaList from '@/components/cinema-list'
import FeedComponent from '@/components/page/home/feed-component'
import InCinemaComponent from '@/components/page/home/in-cinema-component'
import TrendingMovieComponent from '@/components/page/home/trending-movie-component'
import TrendingWebSeriesComponent from '@/components/page/home/trending-web-series-component'
import VerticalCinemaList from '@/components/vertical-cinema-list'
import WelcomeMessage from '@/components/welcome-message'
import { getSession } from '@/lib'

const HomePage = async () => {
  const session = await getSession()
  return (
    <AnimatePageWrapper className="py-4 max-md:px-4">

      {session && (
        <WelcomeMessage username={session?.user?.name ?? ''} />
      )}

      <TrendingMovieComponent />
      <TrendingWebSeriesComponent />
      <InCinemaComponent />
      
      <div className="flex max-md:flex-col gap-4 relative">
        <FeedComponent />
        <VerticalCinemaList
          className="max-lg:hidden lg:max-w-84"
          title="Upcoming Movies"
          subHeading="Discover upcoming movies"
          apiUrl="/api/upcoming"
          showEmptyState={true}
          contentType="movie"
          showDropdown={true}
        />
        <CinemaList
          className="lg:hidden"
          subHeading="Discover upcoming movies"
          title="Upcoming Movies"
          apiUrl="/api/upcoming"
          showEmptyState={true}
          scrollContainerClass="upcoming-movie-scroll-container"
          contentType="movie"
          showDropdown={true}
        />
      </div>
    </AnimatePageWrapper>
  )
}

export default HomePage



================================================================================
FILE: src/app/(user)/post/[id]/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import PostInfo from '@/components/page/post/post-info-component'
import React from 'react'
import { prisma, getPosterUrl, getSession } from '@/lib'
import { notFound } from 'next/navigation'

const PostPage = async ({ params }: { params: Promise<{ id: string }> }) => {
  const session = await getSession()

  const { id } = await params

  //get post from database
  const post = await prisma.post.findUnique({
    where: { id },
    include: {
      user: {
        select: { id: true, name: true, username: true, image: true },
      },
      movie: {
        select: { id: true, type: true, posterPath: true },
      },
      likes: {
        select: { id: true, userId: true },
      },
      dislikes: {
        select: { id: true, userId: true },
      },
      _count: { select: { comments: true } },
    },
  })

  if (!post) return notFound()

  const posterUrl = getPosterUrl(post.movie?.posterPath ?? null, 'w500')

  // check if user liked/disliked post
  const userLiked = session?.user?.id
    ? post.likes.some((like) => like.userId === session.user.id)
    : false
  const userDisliked = session?.user?.id
    ? post.dislikes.some((dislike) => dislike.userId === session.user.id)
    : false


  return (
    <AnimatePageWrapper>
      <div className="py-6 max-md:px-4">
        <PostInfo
          post={post}
          posterUrl={posterUrl}
          likesCount={post.likes.length}
          dislikesCount={post.dislikes.length}
          commentsCount={post._count.comments}
          isLoggedIn={!!session?.user?.id}
          userLiked={userLiked}
          userDisliked={userDisliked}
        />
      </div>
    </AnimatePageWrapper>
  )
}

export default PostPage



================================================================================
FILE: src/app/(user)/post/actions.ts
================================================================================
'use server'

import { prisma, authOptions } from '@/lib'
import { getServerSession } from 'next-auth'
import { ActivityService } from '@/services/activity'
// Generic post mapping is now handled at call sites; no poster augmentation here

export type RatingEnum =
  | 'TRASH'
  | 'TIMEPASS'
  | 'ONE_TIME_WATCH'
  | 'MUST_WATCH'
  | 'LEGENDARY'

export interface CreatePostData {
  title?: string | null
  content: string
  rating?: RatingEnum | null
  isSpoiler: boolean
  contentId: string
  contentType?: 'movie' | 'tv_series'
  posterPath?: string | null
  activityDate?: Date // Optional custom date for activity logging
}

// Feed: fetch latest posts across all content types
export async function getAllFeedPosts() {
  try {
    const posts = await prisma.post.findMany({
      include: {
        user: {
          select: { id: true, name: true, image: true }
        },
        movie: {
          select: { id: true, type: true, posterPath: true }
        },
        likes: { select: { id: true, userId: true } },
        dislikes: { select: { id: true, userId: true } },
        _count: { select: { comments: true } }
      },
      orderBy: { createdAt: 'desc' },
      take: 20
    })

    return posts
  } catch (error) {
    console.error('Error fetching feed posts:', error)
    return []
  }
}

// Content page: fetch all posts for a specific content id
export async function getAllContentPosts(contentId: string) {
  try {
    const posts = await prisma.post.findMany({
      where: { contentId },
      include: {
        user: {
          select: { id: true, name: true, image: true }
        },
        movie: {
          select: { id: true, type: true, posterPath: true }
        },
        likes: { select: { id: true, userId: true } },
        dislikes: { select: { id: true, userId: true } },
        _count: { select: { comments: true } }
      },
      orderBy: { createdAt: 'desc' }
    })

    return posts
  } catch (error) {
    console.error('Error fetching content posts:', error)
    return []
  }
}


// Create post (works for movie or tv series based on existing Movie row.type)
export async function createPost(data: CreatePostData) {
  try {
    const session = await getServerSession(authOptions)

    if (!session?.user?.id) {
      throw new Error('You must be logged in to create a post')
    }

    if (!data.content?.trim()) {
      throw new Error('Post content is required')
    }
    if (!data.contentId) {
      throw new Error('Content ID is required')
    }

    const validRatings: RatingEnum[] = ['TRASH','TIMEPASS','ONE_TIME_WATCH','MUST_WATCH','LEGENDARY']
    if (data.rating && !validRatings.includes(data.rating)) {
      throw new Error('Invalid rating value')
    }

    // Ensure referenced content exists; if not, create as generic movie row.
    // The specific type (movie/tv_series) can be set by detail pages when first visited.
    await prisma.movie.upsert({
      where: { id: data.contentId },
      update: {
        type: data.contentType || 'movie',
        posterPath: data.posterPath || undefined
      },
      create: {
        id: data.contentId,
        type: data.contentType || 'movie',
        posterPath: data.posterPath || null
      }
    })

    const post = await prisma.post.create({
      data: {
        title: data.title,
        content: data.content.trim(),
        rating: data.rating,
        isSpoiler: data.isSpoiler,
        contentId: data.contentId,
        userId: session.user.id
      },
      include: {
        user: { select: { id: true, name: true, image: true } }
      }
    })

    // Log movie/series watching activity only if it's a review (has rating)
    if (data.rating) {
      try {
        const activityDate = data.activityDate || new Date()

        await ActivityService.logActivity({
          userId: session.user.id,
          activityType: data.contentType === 'tv_series' ? 'series_watched' : 'movie_watched',
          activityDate,
          contentId: data.contentId,
          metadata: {
            contentType: data.contentType || 'movie',
            rating: data.rating,
            isSpoiler: data.isSpoiler,
            reviewTitle: data.title,
            loggedAt: new Date().toISOString(),
          },
        })
      } catch (activityError) {
        // Don't fail the post creation if activity logging fails
        console.error('Error logging watching activity:', activityError)
      }
    }

    return post
  } catch (error) {
    console.error('Error creating post:', error)
    throw error
  }
}

// Shared function to fetch posts with poster information





================================================================================
FILE: src/app/(user)/profile/layout.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import ProfileSidebar from '@/components/profile-sidebar'
import { getSession, prisma } from '@/lib'
import Image from 'next/image'
import { redirect } from 'next/navigation'

export default async function ProfileLayout({
  children,
}: {
  readonly children: React.ReactNode
}) {
  const session = await getSession()

  if (!session) {
    redirect('/signin')
  }
  const userData = await prisma.user.findUnique({
    where: {
      id: session.user.id,
      isDeleted: false, // Exclude soft deleted users
    },
    select: {
      name: true,
      username: true,
      image: true,
      _count: {
        select: {
          followers: true,
          following: true,
        },
      },
    },
  })

  // Merge with actual follower/following counts from database
  const userDataWithCounts = userData
    ? {
        ...userData,
        follower: userData._count.followers,
        following: userData._count.following,
        Watched: 0, // You can add actual watched count logic here
      }
    : null

  return (
    <AnimatePageWrapper className="mx-auto text-gray-300 w-full">
      <div className="max-w-5xl w-full mx-auto py-8">
        <HeaderComponent userData={userDataWithCounts} />
      </div>
      <div className="flex flex-col gap-3 md:flex-row md:gap-4 pb-20 md:pb-0">
        <div className="w-full md:w-fit max-h-fit sticky top-13 md:top-18 left-0">
          <ProfileSidebar />
        </div>
        <main className="flex-1 p-2">{children}</main>
      </div>
    </AnimatePageWrapper>
  )
}
interface UserData {
  name: string | null
  username: string
  image: string | null
  follower?: number
  following?: number
  Watched?: number
}

const HeaderComponent = ({ userData }: { userData: UserData | null }) => {
  return (
    <div className="flex gap-3 max-md:flex-col items-start justify-between p-6 px-2 md:px-0">
      <div className="flex items-center gap-4">
        {userData?.image ? (
          <div className="w-16 h-16 rounded-full overflow-hidden">
            <Image
              src={userData.image}
              alt={`user profile picture`}
              width={64}
              height={64}
              unoptimized={userData.image.includes('dicebear')}
              className="w-full bg-light-green h-full object-cover"
            />
          </div>
        ) : (
          <div className="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white text-lg font-medium">
            {userData?.name?.charAt(0).toUpperCase() || 'U'}
          </div>
        )}
        <div className="flex flex-col ">
          <h1 className="text-2xl font-semibold text-white">
            {userData?.name || 'User'}
          </h1>
          <p className="text-sm text-gray-300 capitalize">
            @{userData?.username || 'username'}
          </p>
        </div>
      </div>
      <div className="flex text-sm max-md:p-2 text-gray-300 items-center justify-center gap-4">
        <div className="flex max-md:gap-2 md:flex-col items-center">
          <span>{userData?.follower || 0}</span>
          <span>Follower</span>
        </div>
        <div className="h-12 w-0.5 max-md:hidden bg-dark-gray-2" />
        <div className="flex max-md:gap-2 md:flex-col items-center">
          <span>{userData?.following || 0}</span>
          <span>Following</span>
        </div>
        <div className="h-12 w-0.5 max-md:hidden bg-dark-gray-2" />
        <div className="flex max-md:gap-2 md:flex-col items-center">
          <span>{userData?.Watched || 0}</span>
          <span>Watched</span>
        </div>
      </div>
    </div>
  )
}



================================================================================
FILE: src/app/(user)/profile/lists/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import Link from 'next/link'
import React from 'react'

const ListsPage = () => {
  const lists = []
  return (
    <AnimatePageWrapper className="text-gray-300 p-2">
      {lists.length <= 0 ? (
        <div>
          You don&apos;t have any lists yet.&nbsp;
          <Link href={"/lists/create"} className='underline'>Create list</Link>
        </div>
      ) : (
        <div>Reviews</div>
      )}
    </AnimatePageWrapper>
  )
}

export default ListsPage



================================================================================
FILE: src/app/(user)/profile/notifications/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import React from 'react'

const NotificationsPage = () => {
  return (
    <AnimatePageWrapper>NotificationsPage</AnimatePageWrapper>
  )
}

export default NotificationsPage


================================================================================
FILE: src/app/(user)/profile/page.tsx
================================================================================
import Activity from '@/components/ui/activity/activity'
import AnimatePageWrapper from '@/components/animate-page-wrapper'

export const revalidate = 0

const ProfilePage = async () => {


  return (
    <AnimatePageWrapper className="text-gray-300 p-2">
      <Activity />
    </AnimatePageWrapper>
  )
}

export default ProfilePage



================================================================================
FILE: src/app/(user)/profile/reviews/actions.ts
================================================================================
import { getSession, prisma, getPosterUrl } from '@/lib'
import type { GenericPost } from '../../../../../types/post'

export async function getUserReviews(): Promise<GenericPost[]> {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return []
    }

    const posts = await prisma.post.findMany({
      where: {
        userId: session.user.id,
      },
      select: {
        id: true,
        title: true,
        content: true,
        rating: true,
        isSpoiler: true,
        createdAt: true,
        contentId: true,
        user: {
          select: {
            name: true,
            image: true,
          },
        },
        likes: { select: { id: true, userId: true } },
        _count: { select: { comments: true } },
        movie: {
          select: {
            id: true,
            type: true,
            posterPath: true,
          },
        },
      },
      orderBy: {
        createdAt: 'desc',
      },
    })

    const results: GenericPost[] = posts.map((post) => {
      const posterUrl = getPosterUrl(post.movie?.posterPath ?? null, 'w500')
      return {
        id: post.id,
        title: post.title,
        content: post.content,
        rating: post.rating,
        isSpoiler: post.isSpoiler,
        createdAt: post.createdAt,
        posterUrl,
        user: {
          name: post.user?.name ?? null,
          image: post.user?.image ?? null,
        },
        likes: post.likes,
        _count: { comments: post._count.comments },
      }
    })

    return results
  } catch (error) {
    console.error('Error fetching user reviews:', error)
    return []
  }
}



================================================================================
FILE: src/app/(user)/profile/reviews/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import Link from 'next/link'
import React from 'react'
import { getUserReviews } from './actions'
import PostList from '@/components/post-list'

export const dynamic = 'force-dynamic'
export const revalidate = 0

const ReviewsPage = async () => {
  const reviews = await getUserReviews()
  return (
    <AnimatePageWrapper className="text-gray-300 p-2">
      {reviews.length <= 0 ? (
        <div>
          You don&apos;t have any reviews yet. Explore the&nbsp;
          <Link href={'/cinema'} className="underline">
            cinema page
          </Link>
          , watch it and give review on it.
        </div>
      ) : (
        <div>
          <h2 className="text-xl font-semibold mb-4">Your Reviews</h2>
          <PostList posts={reviews} emptyText="No reviews yet" />
        </div>
      )}
    </AnimatePageWrapper>
  )
}

export default ReviewsPage



================================================================================
FILE: src/app/(user)/profile/watchlist/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import { Metadata } from 'next'
import { getSession } from '@/lib'
import { WatchlistService } from '@/services/watchlist'
import WatchlistList from '@/components/ui/watchlist/watchlist-list'

export const metadata: Metadata = {
  title: 'Your Watchlist',
}

async function getWatchlist() {
  const session = await getSession()
  const userId = session?.user?.id
  if (!userId) return []

  return WatchlistService.getUserWatchlist(userId)
}

export default async function WatchList() {
  const items = await getWatchlist()

  return (
    <AnimatePageWrapper>
      <div className="space-y-6">
        <div>
          <h1 className="text-xl font-medium text-white">Watchlist</h1>
          <p className="text-sm text-gray-400 mt-1">
            {items.length} {items.length === 1 ? 'item' : 'items'}
          </p>
        </div>

        <WatchlistList items={items} />
      </div>
    </AnimatePageWrapper>
  )
}


================================================================================
FILE: src/app/(user)/search/action.ts
================================================================================
'use server'
import { prisma } from '@/lib'

export interface SearchUserResult {
  id: string
  name: string | null
  email: string | null
  image: string
  username: string | null
}

export async function searchUsers(query: string): Promise<SearchUserResult[]> {
  if (!query.trim()) {
    return []
  }
  try {
    const users = await prisma.user.findMany({
      where: {
        isDeleted: false, // Exclude soft deleted users
        OR: [
          {
            name: {
              contains: query,
              mode: 'insensitive',
            },
          },
          {
            email: {
              contains: query,
              mode: 'insensitive',
            },
          },
        ],
      },
      select: {
        id: true,
        name: true,
        email: true,
        image: true,
        username:true,
      },
      take: 20,
    })
    return users as SearchUserResult[]
  } catch (error) {
    console.error('Error searching users: ', error)
    return []
  }
}



================================================================================
FILE: src/app/(user)/search/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import React from 'react'
import { searchUsers, type SearchUserResult } from './action'
import {
  searchMovies,
  searchTVShows,
  type Movie,
  type TVShow,
} from './tmdb-actions'
import {
  SearchResultsWrapper,
  UserSearchResults,
} from '@/components/page/search'

interface SearchPageProps {
  searchParams: Promise<{ q?: string; tab?: string }>
}

const SearchPage = async ({ searchParams }: SearchPageProps) => {
  const params = await searchParams
  const query = params.q || ''
  const activeTab =
    params.tab === 'shows' || params.tab === 'movies' || params.tab === 'users'
      ? params.tab
      : 'movies'

  let userSearchResults: SearchUserResult[] = []
  let movieSearchResults: Movie[] = []
  let tvSearchResults: TVShow[] = []

  if (query.trim()) {
    // Search for users, movies, and TV shows in parallel
    const [users, movies, tvShows] = await Promise.all([
      searchUsers(query),
      searchMovies(query),
      searchTVShows(query),
    ])

    userSearchResults = users
    movieSearchResults = movies
    tvSearchResults = tvShows
  }

  return (
    <AnimatePageWrapper>
      <div className="py-8 max-md:px-2">
        <h1 className="text-3xl text-gray-300 font-light">Search Results</h1>
      </div>

      {query.trim() ? (
        <div className="flex max-md:flex-col-reverse w-full text-gray-300 gap-6">
          {/* Main content area for movies, TV shows, and users */}
          <SearchResultsWrapper
            movies={movieSearchResults}
            tvShows={tvSearchResults}
            users={userSearchResults}
            query={query}
            activeTab={activeTab}
          />

          <div className="max-md:hidden md:w-[30%]">
            <UserSearchResults users={userSearchResults} query={query} />
          </div>
        </div>
      ) : (
        <div className="text-center py-12">
          <p className="text-gray-400">
            Enter a search query to find movies, TV shows, and users
          </p>
        </div>
      )}
    </AnimatePageWrapper>
  )
}

export default SearchPage



================================================================================
FILE: src/app/(user)/search/tmdb-actions.ts
================================================================================
const TMDB_BASE_URL = 'https://api.themoviedb.org/3'
const TMDB_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJiNWUyYjQxN2E1YTBlMmVjODMxMWI5MmI2MDFlNTc0NyIsIm5iZiI6MTc1NTIwOTI1Mi42MDYwMDAyLCJzdWIiOiI2ODllNWUyNGEyOTE4ZDdkZWM4ZGJmMWIiLCJzY29wZXMiOlsiYXBpX3JlYWQiXSwidmVyc2lvbiI6MX0.6j_ocxIEWOsbgjBG_eYv80kApJeZvlX2aEOCK2Roctk'

export interface Movie {
  id: number
  title: string
  overview: string
  poster_path: string | null
  release_date: string
  vote_average: number
}

export interface TVShow {
  id: number
  name: string
  overview: string
  poster_path: string | null
  first_air_date: string
  vote_average: number
}

export interface TMDBResponse<T> {
  results: T[]
  total_pages: number
  total_results: number
  page: number
}

export async function searchMovies(query: string): Promise<Movie[]> {
  if (!query.trim()) return []

  try {
    const url = `${TMDB_BASE_URL}/search/movie?include_adult=false&language=hi-IN&page=1&query=${encodeURIComponent(query)}`
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'accept': 'application/json',
        'Authorization': `Bearer ${TMDB_TOKEN}`
      }
    })

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`)
    }

    const data: TMDBResponse<Movie> = await response.json()
    return data.results || []
  } catch (error) {
    console.error('Error searching movies:', error)
    return []
  }
}

export async function searchTVShows(query: string): Promise<TVShow[]> {
  if (!query.trim()) return []

  try {
    const url = `${TMDB_BASE_URL}/search/tv?include_adult=false&language=hi-IN&page=1&query=${encodeURIComponent(query)}`
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'accept': 'application/json',
        'Authorization': `Bearer ${TMDB_TOKEN}`
      }
    })

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`)
    }

    const data: TMDBResponse<TVShow> = await response.json()
    return data.results || []
  } catch (error) {
    console.error('Error searching TV shows:', error)
    return []
  }
}



================================================================================
FILE: src/app/(user)/settings/delete-account/page.tsx
================================================================================
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { signOut } from 'next-auth/react'
import Link from 'next/link'
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import Input from '@/components/ui/input'

export default function DeleteAccountPage() {
  const [isDeleting, setIsDeleting] = useState(false)
  const [confirmationText, setConfirmationText] = useState('')
  const [error, setError] = useState('')
  const router = useRouter()

  const handleDeleteAccount = async () => {
    if (confirmationText !== 'DELETE') {
      setError('Please type "DELETE" to confirm account deletion')
      return
    }

    setIsDeleting(true)
    setError('')

    try {
      const response = await fetch('/api/user/delete-account', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
        },
      })

      if (!response.ok) {
        const errorData = await response.json()
        throw new Error(errorData.error || 'Failed to delete account')
      }

      // Sign out the user immediately after successful deletion
      await signOut({ callbackUrl: '/signin' })
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred')
      setIsDeleting(false)
    }
  }

  return (
    <AnimatePageWrapper className="space-y-6 text-gray-300">
      <div className="max-w-2xl">
        <div className="mb-4">
          <Link
            href="/settings"
            className="inline-flex items-center text-sm text-gray-400 hover:text-white transition-colors mb-4"
          >
            <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
            Back to Settings
          </Link>
        </div>

        <div className="mb-6">
          <h1 className="text-2xl font-bold text-white">Delete Account</h1>
          <p className="text-sm">
            This action cannot be undone. Your account will be permanently
            deleted.
          </p>
        </div>

        <div className="bg-dark-gray-2 p-4">
          <h2 className="mb-2 text-base font-semibold ">
            What happens when you delete your account?
          </h2>
          <ul className="space-y-2 text-xs ">
            <li>â€¢ You will no longer be able to log in to your account</li>
            <li>
              â€¢ Your posts, comments, and interactions will remain visible
            </li>
            <li>â€¢ Your username will be permanently reserved</li>
            <li>â€¢ You will not receive any notifications</li>
            <li>â€¢ This action cannot be reversed</li>
          </ul>
        </div>

        <div className="mt-6">
          <div className=''>
            <label htmlFor="confirmation" className="block text-sm ">
              To confirm, type{' '}
              <span className="font-mono font-bold">DELETE</span> in the box
              below:
            </label>
            <Input
              id="confirmation"
              type="text"
              value={confirmationText}
              onChange={(e) => setConfirmationText(e.target.value)}
              variant='secondary'
              className='mt-2'
              placeholder="Type DELETE to confirm"
              disabled={isDeleting}
            />
          </div>

          {error && (
            <div className="">
              <p className="text-sm text-red-700 ">{error}</p>
            </div>
          )}

          <div className="flex gap-3 mt-4">
            <button
              onClick={handleDeleteAccount}
              disabled={isDeleting || confirmationText !== 'DELETE'}
              className="bg-red-700 hover:bg-red-600 py-2 px-3 transition-colors cursor-pointer"
            >
              {isDeleting ? 'Deleting Account...' : 'Delete My Account'}
            </button>
            <button
              onClick={() => router.back()}
              disabled={isDeleting}
              className="bg-dark-gray hover:bg-dark-gray-hover py-2 px-3 transition-colors cursor-pointer"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </AnimatePageWrapper>
  )
}



================================================================================
FILE: src/app/(user)/settings/layout.tsx
================================================================================
import { ReactNode } from 'react'
import SettingsSidebar from '@/components/settings-sidebar'
import AnimatePageWrapper from '@/components/animate-page-wrapper'

export default function SettingsLayout({
  children,
}: Readonly<{
  children: ReactNode
}>) {
  return (
    <AnimatePageWrapper className="mx-auto text-gray-300 w-full">
      <div className="flex flex-col gap-3 md:flex-row md:gap-4">
        <SettingsSidebar />
        <main className="flex-1 p-2">{children}</main>
      </div>
    </AnimatePageWrapper>
  )
}



================================================================================
FILE: src/app/(user)/settings/page.tsx
================================================================================
'use client'

import Link from 'next/link'
import AnimatePageWrapper from '@/components/animate-page-wrapper'

interface SettingItem {
  href: string
  label: string
  description: string
  isAvailable: boolean
}

interface SettingSection {
  title: string
  items: SettingItem[]
}

const SETTINGS: SettingSection[] = [
  {
    title: 'Basic Info',
    items: [
      {
        href: '/settings/profile',
        label: 'Profile',
        description: 'Manage your basic information like name, bio, and social links',
        isAvailable: true
      },
      {
        href: '/settings/username',
        label: 'Username',
        description: 'Update your public username (3-20 characters)',
        isAvailable: true
      }
    ]
  },
  {
    title: 'Account',
    items: [
      {
        href: '/settings/security',
        label: 'Security',
        description: 'Password, two-factor authentication, and login security',
        isAvailable: false
      },
      {
        href: '/settings/delete-account',
        label: 'Delete Account',
        description: 'Permanently delete your account and all data',
        isAvailable: true
      }
    ]
  },
  {
    title: 'Billing',
    items: [
      {
        href: '/settings/billing',
        label: 'Billing',
        description: 'Payment methods, subscription, and billing history',
        isAvailable: false
      },
    ]
  }
]

export default function SettingsHomePage() {
  return (
    <AnimatePageWrapper className="space-y-6">
      <div>
        <h1 className="text-lg text-white">Settings</h1>
        <p className="text-sm text-gray-300">
          Manage your account settings
        </p>
      </div>

      <div className="space-y-4">
        {SETTINGS.map((section) => (
          <div key={section.title} className="space-y-2">
            <h2 className="text-xs text-gray-400 uppercase tracking-wide">
              {section.title}
            </h2>
            <div className="space-y-1">
              {section.items.map((item) => (
                <Link
                  key={item.href}
                  href={item.isAvailable ? item.href : '#'}
                  className={`block p-3 transition-colors ${
                    item.isAvailable
                      ? 'hover:bg-dark-gray-hover'
                      : 'opacity-50 cursor-not-allowed'
                  }`}
                >
                  <div className="flex items-center justify-between">
                    <div>
                      <h3 className="text-sm text-white">
                        {item.label}
                      </h3>
                      <p className="text-xs text-gray-400 mt-0.5">
                        {item.description}
                      </p>
                    </div>
                    {!item.isAvailable && (
                      <span className="text-xs text-gray-500">
                        Soon
                      </span>
                    )}
                    {item.isAvailable && (
                      <span className="text-xs text-gray-400">
                        â†’
                      </span>
                    )}
                  </div>
                </Link>
              ))}
            </div>
          </div>
        ))}
      </div>

      {/* Quick Actions */}
      <div className="pt-4 border-t border-dark-gray">
        <h2 className="text-xs text-gray-400 uppercase tracking-wide mb-3">
          Quick Actions
        </h2>
        <div className="space-y-1">
          <Link
            href="/profile"
            className="block p-3 hover:bg-dark-gray-hover transition-colors"
          >
            <span className="text-sm text-white">View Profile</span>
          </Link>
          <Link
            href="/feed"
            className="block p-3 hover:bg-dark-gray-hover transition-colors"
          >
            <span className="text-sm text-white">Go to Feed</span>
          </Link>
        </div>
      </div>
    </AnimatePageWrapper>
  )
}




================================================================================
FILE: src/app/(user)/settings/username/page.tsx
================================================================================
import Link from 'next/link'
import AnimatePageWrapper from '@/components/animate-page-wrapper';

export default function UsernameSettingsPage() {
  return (
    <AnimatePageWrapper className="space-y-4">
      <div className="flex items-center space-x-3">
        <Link
          href="/settings"
          className="inline-flex items-center text-sm text-gray-400 hover:text-white transition-colors"
        >
          <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
          </svg>
          Back to Settings
        </Link>
      </div>

      <div>
        <h2 className="text-lg text-white">Username</h2>
        <p className="text-sm text-gray-400">
          Update your public username. It must be unique and 3â€“20 characters.
        </p>
      </div>

      {/* Replace with your actual form */}
      <div className="p-4 border border-dark-gray bg-dark-gray-2">
        <p className="text-sm text-gray-400">Username form goes here.</p>
      </div>
    </AnimatePageWrapper>
  )
}


================================================================================
FILE: src/app/(user)/trending/page.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import RightSidebar from '@/components/page/trending/right-sidebar'
import TrendingListComponent from '@/components/page/trending/trending-list-component'

const TrendingPage = () => {
  return (
    <AnimatePageWrapper className="flex">
      <div className="w-full md:w-[70%] p-2 md:p-6 md:pl-0">
        <div className="py-8">
          <h1 className="text-3xl text-gray-300 font-light mb-2">
            Trending List
          </h1>
          <p className="text-gray-400 text-sm pl-1">
            Discover what&apos;s popular in movies and TV shows
          </p>
        </div>
        <TrendingListComponent />
      </div>
      <RightSidebar />
    </AnimatePageWrapper>
  )
}

export default TrendingPage



================================================================================
FILE: src/app/(user)/u/[username]/loading.tsx
================================================================================
import Loader from '@/components/ui/loader'
import React from 'react'

const LoadingProfile = () => {
  return (
    <div className='flex items-center justify-center h-full'><Loader text='Loading...' /></div>
  )
}

export default LoadingProfile


================================================================================
FILE: src/app/(user)/u/[username]/page.tsx
================================================================================
import React from 'react'
import { prisma, getSession, getPosterUrl } from '@/lib'
import UserDetailScreen from '@/components/page/user/user-detail-screen'
import type { GenericPost } from '../../../../../types/post'

const page = async ({ params }: { params: Promise<{ username: string }> }) => {
  const { username } = await params

  const session = await getSession()
  const viewerId = session?.user?.id || null

  const user = await prisma.user.findUnique({
    where: {
      username,
      isDeleted: false, // Exclude soft deleted users
    },
    select: {
      id: true,
      name: true,
      username: true,
      email: true,
      image: true,
      posts: {
        select: {
          id: true,
          title: true,
          content: true,
          rating: true,
          isSpoiler: true,
          createdAt: true,
          user: { select: { name: true, image: true } },
          likes: { select: { id: true, userId: true } },
          _count: { select: { comments: true } },
          movie: { select: { id: true, type: true, posterPath: true } },
        },
        orderBy: { createdAt: 'desc' },
        take: 20,
      },
      _count: {
        select: {
          followers: true,
          following: true,
        },
      },
    },
  })

  if (!user) {
    return <div>User not found</div>
  }

  let initialIsFollowing = false
  if (viewerId && viewerId !== user.id) {
    const rel = await prisma.follow.findFirst({
      where: { followerId: viewerId, followingId: user.id },
      select: { id: true },
    })
    initialIsFollowing = Boolean(rel)
  }

  const postsWithPosters: GenericPost[] = user.posts.map((p) => ({
    id: p.id,
    title: p.title,
    content: p.content,
    rating: p.rating,
    isSpoiler: p.isSpoiler,
    createdAt: p.createdAt,
    posterUrl: getPosterUrl(p.movie?.posterPath ?? null, 'w500') ?? '/logo.png',
    user: {
      name: p.user?.name ?? null,
      image: p.user?.image ?? null,
    },
    likes: p.likes,
    _count: { comments: p._count.comments },
  }))

  return (
    <UserDetailScreen
      userId={user.id}
      viewerId={viewerId}
      name={user.name || user.username}
      username={user.username}
      image={user.image || undefined}
      followersCount={user._count.followers}
      followingCount={user._count.following}
      initialIsFollowing={initialIsFollowing}
      posts={postsWithPosters}
    />
  )
}

export default page



================================================================================
FILE: src/app/api/(tmdb)/movie/route.ts
================================================================================
import { NextResponse } from 'next/server'

const token = process.env.TMDB_TOKEN
const baseUrl = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'
export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url)
    const movieId = searchParams.get('id') || undefined
    if (!movieId || typeof movieId !== 'string') {
      return NextResponse.json(
        { error: 'Invalid or missing movie id' },
        { status: 400 }
      )
    }

    if (!token) {
      return NextResponse.json(
        { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
        { status: 500 }
      )
    }

    const url = `${baseUrl}/movie/${movieId}?language=hi-IN`
    const response = await fetch(url, {
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
      cache: 'no-store',
    })

    if (!response.ok) {
      const errorBody = await response.text()
      return NextResponse.json(
        { error: 'Failed to fetch movie details', details: errorBody },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data, { status: 200 })
  } catch (error: unknown) {
    return NextResponse.json(
      {
        error: 'Unexpected error fetching movie details',
        details: error instanceof Error ? error.message : String(error),
      },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/(tmdb)/now-playing/route.ts
================================================================================
import { NextResponse } from 'next/server'
import axios from 'axios'

const token = process.env.TMDB_TOKEN
const baseUrl = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'

export async function GET() {
  if (!token) {
    return NextResponse.json(
      { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
      { status: 500 }
    )
  }

  try {
    const url = `${baseUrl}/movie/now_playing?language=hi-IN&page=1&region=IN`
    const response = await axios.get(url, {
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
    })

    return NextResponse.json(response.data, { status: 200 })
  } catch (error: unknown) {
    if (axios.isAxiosError(error) && error.response) {
      return NextResponse.json(
        {
          error: 'Failed to fetch now playing from TMDB',
          details: error.response.data,
        },
        { status: error.response.status }
      )
    }

    return NextResponse.json(
      {
        error: 'Unexpected error fetching now playing',
        details: error instanceof Error ? error.message : String(error),
      },
      { status: 500 }
    )
  }
}


================================================================================
FILE: src/app/api/(tmdb)/popular-movie/route.ts
================================================================================
import { NextResponse } from 'next/server'

export async function GET() {
  try {
    const token = process.env.TMDB_TOKEN
    const baseUrl = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'

    if (!token) {
      return NextResponse.json(
        { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
        { status: 500 }
      )
    }

    const url = `${baseUrl}/movie/popular?language=hi-IN&page=1&region=IN`
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
      cache: 'no-store',
    })

    if (!response.ok) {
      let details: unknown
      try {
        details = await response.json()
      } catch {
        details = await response.text()
      }
      return NextResponse.json(
        { error: 'Failed to fetch popular movies from TMDB', details },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data, { status: 200 })
  } catch (error: unknown) {
    return NextResponse.json(
      { error: 'Unexpected error fetching popular movies', details: error instanceof Error ? error.message : String(error) },
      { status: 500 }
    )
  }
}





================================================================================
FILE: src/app/api/(tmdb)/recommendation/movie/route.ts
================================================================================
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url)
    const movieId = searchParams.get('id')
    const page = searchParams.get('page') || '1'

    if (!movieId) {
      return NextResponse.json(
        { error: 'Movie ID is required' },
        { status: 400 }
      )
    }

    const token = process.env.TMDB_TOKEN
    const baseUrl = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'

    if (!token) {
      return NextResponse.json(
        { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
        { status: 500 }
      )
    }

    const url = `${baseUrl}/movie/${movieId}/recommendations?language=hi-IN&page=${page}`

    const response = await fetch(url, {
      method: 'GET',
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
      cache: 'no-store',
    })

    if (!response.ok) {
      let details: unknown
      try {
        details = await response.json()
      } catch {
        details = await response.text()
      }
      return NextResponse.json(
        { error: 'Failed to fetch movie recommendations from TMDB', details },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data, { status: 200 })
  } catch (error: unknown) {
    return NextResponse.json(
      { error: 'Unexpected error fetching movie recommendations', details: error instanceof Error ? error.message : String(error) },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/(tmdb)/recommendation/series/route.ts
================================================================================
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url)
    const seriesId = searchParams.get('id')
    const page = searchParams.get('page') || '1'

    if (!seriesId) {
      return NextResponse.json(
        { error: 'Series ID is required' },
        { status: 400 }
      )
    }

    const token = process.env.TMDB_TOKEN
    const baseUrl = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'

    if (!token) {
      return NextResponse.json(
        { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
        { status: 500 }
      )
    }

    const url = `${baseUrl}/tv/${seriesId}/recommendations?language=hi-IN&page=${page}`

    const response = await fetch(url, {
      method: 'GET',
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
      cache: 'no-store',
    })

    if (!response.ok) {
      let details: unknown
      try {
        details = await response.json()
      } catch {
        details = await response.text()
      }
      return NextResponse.json(
        { error: 'Failed to fetch series recommendations from TMDB', details },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data, { status: 200 })
  } catch (error: unknown) {
    return NextResponse.json(
      { error: 'Unexpected error fetching series recommendations', details: error instanceof Error ? error.message : String(error) },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/(tmdb)/trending-all/route.ts
================================================================================
import { NextResponse } from 'next/server'


/**
 * @description Get trending all from TMDB
 * @query page: number
 * @query time_window: string
 * @returns
 */
export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url)
    const page = searchParams.get('page') || '1'
    const timeWindow = searchParams.get('time_window') || 'day'

    const token = process.env.TMDB_TOKEN
    if (!token) {
      return NextResponse.json(
        { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
        { status: 500 }
      )
    }

    const url = `${process.env.TMDB_BASE_URL}/trending/all/${timeWindow}?language=hi-IN&page=${page}`

    const response = await fetch(url, {
      method: 'GET',
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
      // Avoid serving cached errors while paginating
      cache: 'no-store',
    })

    if (!response.ok) {
      let details: unknown
      try {
        details = await response.json()
      } catch {
        details = await response.text()
      }
      return NextResponse.json(
        { error: 'Failed to fetch trending from TMDB', details },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data, {
      status: 200,
    })
  } catch (error: unknown) {
    return NextResponse.json(
      { error: 'Unexpected error fetching trending', details: error instanceof Error ? error.message : String(error) },
      { status: 500 }
    )
  }
}





================================================================================
FILE: src/app/api/(tmdb)/trending-movie/route.ts
================================================================================
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url)
    const page = searchParams.get('page') || '1'
    const timeWindow = searchParams.get('time_window') || 'day'

    const token = process.env.TMDB_TOKEN
    const baseUrl = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'

    if (!token) {
      return NextResponse.json(
        { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
        { status: 500 }
      )
    }

    const url = `${baseUrl}/trending/movie/${timeWindow}?language=hi-IN&page=${page}`

    const response = await fetch(url, {
      method: 'GET',
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
      cache: 'no-store',
    })

    if (!response.ok) {
      let details: unknown
      try {
        details = await response.json()
      } catch {
        details = await response.text()
      }
      return NextResponse.json(
        { error: 'Failed to fetch trending movies from TMDB', details },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data, { status: 200 })
  } catch (error: unknown) {
    return NextResponse.json(
      { error: 'Unexpected error fetching trending movies', details: error instanceof Error ? error.message : String(error) },
      { status: 500 }
    )
  }
}





================================================================================
FILE: src/app/api/(tmdb)/trending-series/route.ts
================================================================================
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url)
    const page = searchParams.get('page') || '1'
    const timeWindow = searchParams.get('time_window') || 'day'

    const token = process.env.TMDB_TOKEN
    const baseUrl = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'

    if (!token) {
      return NextResponse.json(
        { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
        { status: 500 }
      )
    }

    const url = `${baseUrl}/trending/tv/${timeWindow}?language=hi-IN&page=${page}`

    const response = await fetch(url, {
      method: 'GET',
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
      cache: 'no-store',
    })

    if (!response.ok) {
      let details: unknown
      try {
        details = await response.json()
      } catch {
        details = await response.text()
      }
      return NextResponse.json(
        { error: 'Failed to fetch trending TV from TMDB', details },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data, { status: 200 })
  } catch (error: unknown) {
    return NextResponse.json(
      { error: 'Unexpected error fetching trending TV', details: error instanceof Error ? error.message : String(error) },
      { status: 500 }
    )
  }
}





================================================================================
FILE: src/app/api/(tmdb)/upcoming/route.ts
================================================================================
import { NextRequest, NextResponse } from 'next/server'

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url)
    const page = searchParams.get('page') || '1'
    const language = searchParams.get('language') || 'en-US'

    const url = `${process.env.TMDB_BASE_URL}/movie/upcoming?language=${language}&page=${page}`

    const options = {
      method: 'GET',
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${process.env.TMDB_TOKEN}`,
      },
    }

    const response = await fetch(url, options)

    if (!response.ok) {
      throw new Error(`TMDB API error: ${response.status}`)
    }

    const data = await response.json()

    return NextResponse.json(data)
  } catch (error) {
    console.error('Upcoming movies API error:', error)
    return NextResponse.json(
      { error: 'Failed to fetch upcoming movies' },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/activity/heatmap/route.ts
================================================================================
import { NextRequest, NextResponse } from 'next/server'
import { getSession } from '@/lib'
import { ActivityService } from '@/services/activity'

export async function GET(request: NextRequest) {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const { searchParams } = new URL(request.url)
    const monthParam = searchParams.get('month')

    let targetMonth = new Date()
    if (monthParam) {
      targetMonth = new Date(monthParam)
    }

    const heatmapData = await ActivityService.getHeatmapDataForMonth(session.user.id, targetMonth)

    return NextResponse.json({
      activities: heatmapData.activities,
      startOfMonth: heatmapData.startOfMonth.toISOString(),
      endOfMonth: heatmapData.endOfMonth.toISOString(),
    })
  } catch (error) {
    console.error('Error fetching heatmap data:', error)
    return NextResponse.json(
      { error: 'Failed to fetch heatmap data' },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/activity/log/route.ts
================================================================================
import { ActivityService } from '@/services/activity'
import { NextRequest, NextResponse } from 'next/server'
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/config/auth'

export async function POST(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions)

    if (!session?.user?.id) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      )
    }

    const body = await request.json()
    const { activityType, activityDate, contentId, metadata } = body

    // Validate required fields
    if (!activityType || !activityDate) {
      return NextResponse.json(
        { error: 'Missing required fields: activityType and activityDate' },
        { status: 400 }
      )
    }

    // Validate activityType
    if (!['movie_watched', 'series_watched'].includes(activityType)) {
      return NextResponse.json(
        { error: 'Invalid activityType. Must be movie_watched or series_watched' },
        { status: 400 }
      )
    }

    const activity = await ActivityService.logActivity({
      userId: session.user.id,
      activityType,
      activityDate: new Date(activityDate),
      contentId,
      metadata,
    })

    return NextResponse.json({ success: true, activity })
  } catch (error) {
    console.error('Error logging activity:', error)
    return NextResponse.json(
      { error: 'Failed to log activity' },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/activity/stats/route.ts
================================================================================
import { getSession } from '@/lib'
import { ActivityService } from '@/services/activity'
import { NextResponse } from 'next/server'

export async function GET() {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const stats = await ActivityService.getUserActivityStats(session.user.id)
    return NextResponse.json(stats)
  } catch (error) {
    console.error('Error fetching activity stats:', error)
    return NextResponse.json(
      { error: 'Failed to fetch activity stats' },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/ai/recommendations/route.ts
================================================================================
import { NextRequest, NextResponse } from 'next/server'

export const dynamic = 'force-dynamic'

type RecommendationInput = {
  contextType?: 'movie' | 'tv'
  contextId?: string
  likedMovies?: string[]
  likedTV?: string[]
}

type NormalizedRecommendation = {
  type: 'movie' | 'tv'
  id: string
  title: string
}

function buildPrompt(input: RecommendationInput): string {
  const likedMovies =
    input.likedMovies && input.likedMovies.length > 0
      ? `Movies liked: ${input.likedMovies.join(', ')}`
      : ''
  const likedTV =
    input.likedTV && input.likedTV.length > 0
      ? `TV liked: ${input.likedTV.join(', ')}`
      : ''
  const ctx =
    input.contextType && input.contextId
      ? `Currently viewing ${input.contextType} with TMDB id ${input.contextId}.`
      : ''
  const wants =
    'Recommend a concise mixed list of movies and TV series the user is likely to enjoy.'
  const constraints =
    'Return JSON with an array under key "items", each item: {"type":"movie"|"tv","id":TMDB_id_string,"title":string}. No extra text.'
  return [wants, ctx, likedMovies, likedTV, constraints].filter(Boolean).join('\n')
}

export async function POST(req: NextRequest) {
  try {
    const body = (await req.json()) as RecommendationInput
    const apiKey = process.env.GEMINI_API_KEY
    if (!apiKey) {
      return NextResponse.json({ error: 'Missing GEMINI_API_KEY' }, { status: 500 })
    }

    const prompt = buildPrompt(body)

    const url =
      'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=' +
      encodeURIComponent(apiKey)

    const controller = new AbortController()
    const timeout = setTimeout(() => controller.abort(), 15000)

    let resp: Response
    try {
      resp = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [
            {
              role: 'user',
              parts: [{ text: prompt }]
            }
          ],
          generationConfig: {
            temperature: 0.6,
            maxOutputTokens: 512,
            responseMimeType: 'application/json'
          }
        }),
        signal: controller.signal
      })
    } catch (err) {
      clearTimeout(timeout)
      const message = err instanceof Error ? err.message : String(err)
      return NextResponse.json(
        { error: 'Upstream fetch failed', details: message },
        { status: 502 }
      )
    } finally {
      clearTimeout(timeout)
    }

    if (!resp.ok) {
      const text = await resp.text()
      console.error('Gemini upstream error:', resp.status, text)
      return NextResponse.json(
        { error: 'Gemini error', status: resp.status, details: text },
        { status: resp.status }
      )
    }

    const data: unknown = await resp.json().catch(() => null as unknown)

    // Try multiple extraction strategies depending on model response shape
    let rawText: string = ''
    try {
      type GeminiResponse = {
        candidates?: Array<{
          content?: { parts?: Array<{ text?: string }> }
        }>
      }
      const asGemini = data as GeminiResponse
      rawText = asGemini?.candidates?.[0]?.content?.parts?.[0]?.text ?? ''
    } catch {}

    if (rawText && rawText.trim().startsWith('```')) {
      const first = rawText.indexOf('```')
      const last = rawText.lastIndexOf('```')
      if (last > first) rawText = rawText.slice(first + 3, last)
    }

    if (!rawText || rawText.trim() === '') {
      try {
        rawText = JSON.stringify(data)
      } catch {
        rawText = ''
      }
    }

    let items: NormalizedRecommendation[] = []
    try {
      const parsed: unknown = JSON.parse(rawText)
      const parsedObj = parsed as { items?: unknown }
      const raw = Array.isArray(parsedObj.items) ? (parsedObj.items as unknown[]) : []
      items = raw
        .map((r: unknown): NormalizedRecommendation => {
          const rec = r as Record<string, unknown>
          const type: 'movie' | 'tv' = rec?.type === 'tv' ? 'tv' : 'movie'
          const idVal = rec['id']
          const titleVal = rec['title']
          const id = typeof idVal === 'string' || typeof idVal === 'number' ? String(idVal) : ''
          const title = typeof titleVal === 'string' ? titleVal : ''
          return { type, id, title }
        })
        .filter((r: NormalizedRecommendation) => Boolean(r.id && r.title))
    } catch {
      try {
        const start = rawText.indexOf('{')
        const end = rawText.lastIndexOf('}')
        if (start !== -1 && end !== -1) {
          const parsed: unknown = JSON.parse(rawText.slice(start, end + 1))
          const parsedObj = parsed as { items?: unknown }
          const raw = Array.isArray(parsedObj.items) ? (parsedObj.items as unknown[]) : []
          items = raw
            .map((r: unknown): NormalizedRecommendation => {
              const rec = r as Record<string, unknown>
              const type: 'movie' | 'tv' = rec?.type === 'tv' ? 'tv' : 'movie'
              const idVal = rec['id']
              const titleVal = rec['title']
              const id = typeof idVal === 'string' || typeof idVal === 'number' ? String(idVal) : ''
              const title = typeof titleVal === 'string' ? titleVal : ''
              return { type, id, title }
            })
            .filter((r: NormalizedRecommendation) => Boolean(r.id && r.title))
        }
      } catch {
        items = []
      }
    }

    return NextResponse.json({ items })
  } catch (e) {
    const message = e instanceof Error ? e.message : String(e)
    return NextResponse.json({ error: 'Unexpected error', details: message }, { status: 500 })
  }
}



================================================================================
FILE: src/app/api/auth/[...nextauth]/route.ts
================================================================================
import NextAuth from 'next-auth'
import { authOptions } from '@/lib'

const handler = NextAuth(authOptions)

export { handler as GET, handler as POST }



================================================================================
FILE: src/app/api/post/[id]/dislike/route.ts
================================================================================
import { NextRequest, NextResponse } from 'next/server'
import { getSession, prisma } from '@/lib'

export async function POST(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const { id: postId } = await params
    const userId = session.user.id

    // Check if post exists
    const post = await prisma.post.findUnique({
      where: { id: postId },
      select: { id: true }
    })

    if (!post) {
      return NextResponse.json({ error: 'Post not found' }, { status: 404 })
    }

    // Check if user already disliked this post
    const existingDislike = await prisma.dislike.findUnique({
      where: {
        userId_postId: {
          userId,
          postId
        }
      }
    })

    if (existingDislike) {
      // Remove the dislike
      await prisma.dislike.delete({
        where: {
          userId_postId: {
            userId,
            postId
          }
        }
      })
      return NextResponse.json({ action: 'removed', message: 'Dislike removed' })
    }

    // Remove any existing like first
    await prisma.like.deleteMany({
      where: {
        userId,
        postId
      }
    })

    // Add the dislike
    await prisma.dislike.create({
      data: {
        userId,
        postId
      }
    })

    return NextResponse.json({ action: 'added', message: 'Post disliked' })
  } catch (error) {
    console.error('Error in dislike route:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/post/[id]/like/route.ts
================================================================================
import { NextRequest, NextResponse } from 'next/server'
import { getSession, prisma } from '@/lib'

export async function POST(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const { id: postId } = await params
    const userId = session.user.id

    // Check if post exists
    const post = await prisma.post.findUnique({
      where: { id: postId },
      select: { id: true }
    })

    if (!post) {
      return NextResponse.json({ error: 'Post not found' }, { status: 404 })
    }

    // Check if user already liked this post
    const existingLike = await prisma.like.findUnique({
      where: {
        userId_postId: {
          userId,
          postId
        }
      }
    })

    if (existingLike) {
      // Remove the like
      await prisma.like.delete({
        where: {
          userId_postId: {
            userId,
            postId
          }
        }
      })
      return NextResponse.json({ action: 'removed', message: 'Like removed' })
    }

    // Remove any existing dislike first
    await prisma.dislike.deleteMany({
      where: {
        userId,
        postId
      }
    })

    // Add the like
    await prisma.like.create({
      data: {
        userId,
        postId
      }
    })


    return NextResponse.json({ action: 'added', message: 'Post liked' })
  } catch (error) {
    console.error('Error in like route:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/tmdb/series/route.ts
================================================================================
import { NextResponse } from 'next/server'

const token = process.env.TMDB_TOKEN
const baseUrl = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'

export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url)
    const seriesId = searchParams.get('id') || undefined
    if (!seriesId || typeof seriesId !== 'string') {
      return NextResponse.json(
        { error: 'Invalid or missing series id' },
        { status: 400 }
      )
    }

    if (!token) {
      return NextResponse.json(
        { error: 'Server misconfiguration: TMDB_TOKEN is not set' },
        { status: 500 }
      )
    }

    const url = `${baseUrl}/tv/${seriesId}?language=hi-IN`
    const response = await fetch(url, {
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${token}`,
      },
      cache: 'no-store',
    })

    if (!response.ok) {
      const errorBody = await response.text()
      return NextResponse.json(
        { error: 'Failed to fetch series details', details: errorBody },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data, { status: 200 })
  } catch (error: unknown) {
    return NextResponse.json(
      {
        error: 'Unexpected error fetching series details',
        details: error instanceof Error ? error.message : String(error),
      },
      { status: 500 }
    )
  }
}





================================================================================
FILE: src/app/api/user/delete-account/route.ts
================================================================================
import { NextResponse } from 'next/server'
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/config/auth'
import prisma from '@/lib/config/prisma'

export async function DELETE() {
  try {
    // Get the current session
    const session = await getServerSession(authOptions)

    if (!session?.user?.id) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      )
    }

    // Check if user is already deleted
    const existingUser = await prisma.user.findUnique({
      where: {
        id: session.user.id,
        isDeleted: false
      },
      select: { id: true }
    })

    if (!existingUser) {
      return NextResponse.json(
        { error: 'User not found or already deleted' },
        { status: 404 }
      )
    }

    // Soft delete the user
    await prisma.user.update({
      where: { id: session.user.id },
      data: {
        isDeleted: true,
        deletedAt: new Date(),
        // Clear sensitive data but keep posts/comments for data integrity
        email: null,
        password: null,
        name: 'Deleted User',
        image: null,
        // Invalidate all sessions by updating the user
        sessions: {
          deleteMany: {}
        }
      }
    })

    return NextResponse.json(
      { message: 'Account deleted successfully' },
      { status: 200 }
    )
  } catch (error) {
    console.error('Error deleting account:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/user/follow/route.ts
================================================================================
import { NextResponse } from 'next/server'
import { prisma, getSession } from '@/lib'

type FollowRequestBody = {
  targetUserId: string
  action: 'follow' | 'unfollow'
}

export async function POST(request: Request) {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const followerId = session.user.id;
    const { targetUserId, action } = await request.json() as FollowRequestBody

    if (!targetUserId || (action !== 'follow' && action !== 'unfollow')) {
      return NextResponse.json({ error: 'Invalid payload' }, { status: 400 })
    }

    if (targetUserId === followerId) {
      return NextResponse.json({ error: 'Cannot follow yourself' }, { status: 400 })
    }

    // Ensure target user exists and is not deleted
    const targetUser = await prisma.user.findUnique({
      where: {
        id: targetUserId,
        isDeleted: false, // Exclude soft deleted users
      },
      select: { id: true }
    })
    if (!targetUser) {
      return NextResponse.json({ error: 'User not found' }, { status: 404 })
    }

    if (action === 'follow') {
      await prisma.follow.upsert({
        where: { followerId_followingId: { followerId, followingId: targetUserId } },
        update: {},
        create: { followerId, followingId: targetUserId },
      })

    } else {
      await prisma.follow.deleteMany({ where: { followerId, followingId: targetUserId } })
    }

    const [followersCount, followingCount, isFollowing] = await Promise.all([
      prisma.follow.count({ where: { followingId: targetUserId } }),
      prisma.follow.count({ where: { followerId: targetUserId } }),
      prisma.follow.findFirst({ where: { followerId, followingId: targetUserId }, select: { id: true } }).then(Boolean),
    ])

    return NextResponse.json({
      ok: true,
      followersCount,
      followingCount,
      isFollowing,
    })
  } catch (error) {
    console.error('[FOLLOW_API_ERROR]', error)
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })
  }
}





================================================================================
FILE: src/app/api/user/search/route.ts
================================================================================
import { NextRequest, NextResponse } from 'next/server'
import { searchUsers } from '@/services/user'
import { UnauthorizedError, getUserId } from '@/services/auth'

export async function GET(req: NextRequest) {
  try {
    const userId = await getUserId()
    const query = req.nextUrl.searchParams.get('query') || ''
    const users = await searchUsers(query, userId)
    return NextResponse.json(users)
  } catch (err) {
    if (err instanceof UnauthorizedError)
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    return NextResponse.json(
      { error: 'Internal Server Error' },
      { status: 500 }
    )
  }
}



================================================================================
FILE: src/app/api/user/username/route.ts
================================================================================
import { isUsernameAvailable } from '@/services/user'
import { prisma, generateRandomUsername, UsernameSchema } from '@/lib'
import { NextRequest, NextResponse } from 'next/server'

export async function GET(req: NextRequest) {
  const searchParams = req.nextUrl.searchParams
  const username = (searchParams.get('username') || '').trim()

  if (username) {
    const parsed = UsernameSchema.safeParse(username)
    if (!parsed.success) {
      return NextResponse.json(
        {
          success: false,
          available: false,
          username: username.toLowerCase(),
          error: parsed.error.issues[0]?.message || 'Invalid username',
        },
        { status: 400 }
      )
    }

    const normalized = parsed.data
    const available = await isUsernameAvailable(normalized)
    return NextResponse.json({
      success: true,
      username: normalized,
      available,
      message: available ? 'Username is available' : 'Username is taken',
    })
  }

  const limit = 10
  const candidates = generateRandomUsername(limit * 2)
  const existing = await prisma.user.findMany({
    where: {
      username: { in: candidates },
      isDeleted: false, // Exclude soft deleted users
    },
    select: { username: true },
  })
  const taken = new Set(existing.map((u) => u.username))
  const available: string[] = candidates.filter((u) => !taken.has(u))

  const suggestions = available.slice(0, limit)
  return NextResponse.json({ success: true, usernames: suggestions, count: suggestions.length })
}



================================================================================
FILE: src/app/api/user/username/update/route.ts
================================================================================
import { getUserId, UnauthorizedError } from '@/services/auth'
import { updateUsername } from '@/services/user'
import { UsernameSchema } from '@/lib'
import { NextRequest, NextResponse } from 'next/server'

export async function POST(req: NextRequest) {
  try {
    const userId = await getUserId()
    const body = await req.json()
    const parsed = UsernameSchema.safeParse(body?.username)
    if (!parsed.success) {
      return NextResponse.json(
        { error: parsed.error.issues[0]?.message || 'Invalid username' },
        { status: 400 }
      )
    }

    const normalized = parsed.data
    const user = await updateUsername(userId, normalized)
    return NextResponse.json({ success: true, user })
  } catch (err) {
    if (err instanceof UnauthorizedError)
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    const message = err instanceof Error ? err.message : 'Internal Server Error'
    const status = message.toLowerCase().includes('taken') ? 409 : 500
    return NextResponse.json({ error: message }, { status })
  }
}



================================================================================
FILE: src/app/api/user/watchlist/[contentId]/route.ts
================================================================================
import { NextResponse } from 'next/server'
import { getSession, prisma } from '@/lib'

export async function DELETE(
  _request: Request,
  context: { params: Promise<{ contentId: string }> }
) {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const { contentId } = await context.params
    if (!contentId) {
      return NextResponse.json({ error: 'Missing contentId' }, { status: 400 })
    }

    await prisma.watchlistItem.delete({
      where: { userId_contentId: { userId: session.user.id, contentId } },
    }).catch(() => undefined)

    return NextResponse.json({ ok: true })
  } catch (error) {
    console.error('[WATCHLIST_DELETE_ERROR]', error)
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })
  }
}





================================================================================
FILE: src/app/api/user/watchlist/route.ts
================================================================================
import { NextResponse } from 'next/server'
import { getSession, prisma } from '@/lib'

type SaveToWatchlistRequestBody = {
  contentId: string
  contentType?: 'movie' | 'tv_series'
  posterPath?: string | null
}

// GET /api/user/watchlist
// Authenticated stub: returns Not Implemented for now
export async function GET() {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const items = await prisma.watchlistItem.findMany({
      where: { userId: session.user.id },
      orderBy: { createdAt: 'desc' },
      select: {
        contentId: true,
        createdAt: true,
        movie: { select: { id: true, type: true, posterPath: true } },
      },
    })

    return NextResponse.json({ items })
  } catch (error) {
    console.error('[WATCHLIST_GET_ERROR]', error)
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })
  }
}

// POST /api/user/watchlist
// Authenticated stub: accepts contentId, returns Not Implemented for now
export async function POST(request: Request) {
  try {
    const session = await getSession()
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const { contentId, contentType, posterPath } = await request.json() as SaveToWatchlistRequestBody
    if (!contentId) {
      return NextResponse.json({ error: 'Invalid payload: contentId is required' }, { status: 400 })
    }

    // Ensure Movie exists; upsert with minimal cached data including posterPath if provided
    await prisma.movie.upsert({
      where: { id: contentId },
      update: {
        type: contentType ?? 'movie',
        posterPath: posterPath ?? undefined,
      },
      create: {
        id: contentId,
        type: contentType ?? 'movie',
        posterPath: posterPath ?? null,
      },
    })

    const item = await prisma.watchlistItem.upsert({
      where: { userId_contentId: { userId: session.user.id, contentId } },
      update: {},
      create: { userId: session.user.id, contentId },
      select: { contentId: true, createdAt: true },
    })

    return NextResponse.json({ item }, { status: 201 })
  } catch (error) {
    console.error('[WATCHLIST_POST_ERROR]', error)
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })
  }
}





================================================================================
FILE: src/app/books/layout.tsx
================================================================================
import Navbar from '@/components/navbar'
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import React from 'react'

const BooksLayout = ({ children }: { children: React.ReactNode }) => {
  return (
    <AnimatePageWrapper className="page-gradient">
      <Navbar />
      <div className="flex justify-center w-full">
        <main className="w-full max-w-5xl py-4 min-h-[calc(100vh-52px)] md:min-h-[calc(100vh-56px)]">
          {children}
        </main>
      </div>
    </AnimatePageWrapper>
  )
}

export default BooksLayout



================================================================================
FILE: src/app/books/page.tsx
================================================================================
import Building from '@/components/page/building'

const BooksHomePage = async () => {

  return (
    <Building />
  )
}

export default BooksHomePage


================================================================================
FILE: src/app/globals.css
================================================================================
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;

  /* Dark grays */
  --dark-gray-2: #1a1a1a;
  --dark-gray: #242424;
  --dark-gray-hover: #2e2e2e;
  --light-gray: #303030;

  /* Accent */
  --light-green: #009D1A;

}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);

  /* Dark grays */
  --color-dark-gray-2: var(--dark-gray-2);
  --color-dark-gray: var(--dark-gray);
  --color-dark-gray-hover: var(--dark-gray-hover);
  --color-light-gray: var(--light-gray);

  /* Accent */
  --color-light-green: var(--light-green);


  --font-sans: var(--font-atkinson-hyperlegible);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

.text-input {
  @apply w-full px-3 py-2 bg-dark-gray text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-light-green focus:border-transparent resize-none
}
.text-input-2 {
  @apply w-full px-3 py-2 bg-dark-gray-2 text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-light-green focus:border-transparent resize-none
}

* {
  box-sizing: border-box;
}

.page-gradient {
  background: linear-gradient(to bottom,
      var(--dark-gray) 20%,
      var(--light-gray) 90%);
}

body {
  font-family: var(--font-atkinson-hyperlegible), sans-serif;
}

@keyframes dash {
  0% {
    stroke-dasharray: 1, 150;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 90, 150;
    stroke-dashoffset: -35;
  }
  100% {
    stroke-dasharray: 90, 150;
    stroke-dashoffset: -124;
  }
}

.animate-dash {
  animation: dash 1.5s ease-in-out infinite;
}

/* Hide scrollbar for horizontal scrolling */
.scrollbar-hide {
  -ms-overflow-style: none;  /* Internet Explorer 10+ */
  scrollbar-width: none;  /* Firefox */
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;  /* Safari and Chrome */
}

/* Line clamp utilities for text truncation */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}


================================================================================
FILE: src/app/layout.tsx
================================================================================
import type { Metadata } from 'next'
import { Atkinson_Hyperlegible } from 'next/font/google'
import { AuthProvider } from '@/components/provider/auth-provider'
import QueryProvider from '@/components/provider/query-provider'
import './globals.css'

const atkinsonHyperlegible = Atkinson_Hyperlegible({
  subsets: ['latin'],
  weight: ['400', '700'],
  style: ['normal', 'italic'],
  variable: '--font-atkinson-hyperlegible',
})

export const metadata: Metadata = {
  title: 'Escape',
  icons: {
    icon: '/logo-light.png',
  },
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en">
      <body className={`${atkinsonHyperlegible.variable} bg-black`}>
        <AuthProvider>
          <QueryProvider>
            {children}
          </QueryProvider>
        </AuthProvider>
      </body>
    </html>
  )
}



================================================================================
FILE: src/app/not-found.tsx
================================================================================
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import Link from 'next/link'

export default function ErrorBoundary() {
  return (
    <AnimatePageWrapper className="page-gradient flex flex-col items-center justify-center min-h-screen">
      <div className="flex gap-4 md:gap-8">
        <div className="bg-white h-[150px] md:h-[300px] aspect-square rounded-full -translate-y-8 flex items-center justify-end ">
          <div className="md:-translate-y-16 translate-y-6 -translate-x-3 md:-translate-x-8 bg-black h-[70px] md:h-[120px] rounded-full aspect-square" />
        </div>
        <div className="bg-white h-[150px] md:h-[300px] aspect-square rounded-full flex items-center justify-start ">
          <div className="translate-y-6 translate-x-3 md:-translate-y-16 md:translate-x-8 bg-black h-[70px] md:h-[120px] rounded-full aspect-square" />
        </div>
      </div>
      <div className="flex items-center justify-center flex-col py-2">
        <h1 className="text-3xl md:text-6xl font-extralight text-white">
          404 , Page Not Found
        </h1>
        <Link
          href={'/'}
          className="bg-dark-gray px-4 py-2 my-4 text-gray-300 cursor-pointer"
        >
          Please Take Me Home
        </Link>
      </div>
    </AnimatePageWrapper>
  )
}



================================================================================
FILE: src/app/tech/layout.tsx
================================================================================
import Navbar from '@/components/navbar'
import AnimatePageWrapper from '@/components/animate-page-wrapper'
import React from 'react'

const TechLayout = ({ children }: { children: React.ReactNode }) => {
  return (
    <AnimatePageWrapper className="page-gradient">
      <Navbar />
      <div className="flex justify-center w-full">
        <main className="w-full max-w-5xl py-4 min-h-[calc(100vh-52px)] md:min-h-[calc(100vh-56px)]">
          {children}
        </main>
      </div>
    </AnimatePageWrapper>
  )
}

export default TechLayout



================================================================================
FILE: src/app/tech/page.tsx
================================================================================
import Building from '@/components/page/building'

const TechHomePage = async () => {

    return (
        <Building />
    )
}

export default TechHomePage


================================================================================
FILE: src/components/ai-recommendation-component.tsx
================================================================================
'use client'
import { motion } from 'framer-motion';
import { Bot } from 'lucide-react';
import { useSession } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import { useMemo, useState } from 'react';
import { useMutation } from '@tanstack/react-query';

type Props = {
  contextType?: 'movie' | 'tv'
  contextId?: string
  likedMovies?: string[]
  likedTV?: string[]
  title?: string
}

type Rec = {
  type: 'movie' | 'tv'
  id: string
  title: string
}

const AiRecommendationComponent = ({
  contextType,
  contextId,
  likedMovies,
  likedTV,
  title,
}: Props) => {
  const [items, setItems] = useState<Rec[]>([])
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [hasFetched, setHasFetched] = useState(false)

  const body = useMemo(
    () => ({ contextType, contextId, likedMovies, likedTV }),
    [contextType, contextId, likedMovies, likedTV]
  )
  const { status } = useSession()
  const router = useRouter()

  const containerVariants = {
    hidden: {},
    show: {
      transition: {
        staggerChildren: 0.06,
        delayChildren: 0.06,
      },
    },
  }

  const itemVariants = {
    hidden: { opacity: 0, x: -4 },
    show: { opacity: 1, x: 0 },
  }

  const skeletonKeys = ['a','b','c','d','e','f','g','h']

  const { mutateAsync: generateRecs } = useMutation({
    mutationKey: ['ai', 'recommendations'],
    mutationFn: async (payload: unknown) => {
      const resp = await fetch('/api/ai/recommendations', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      })
      if (!resp.ok) throw new Error('Failed to fetch recommendations')
      return resp.json() as Promise<{ items?: Rec[] }>
    },
  })

  const fetchRecommendations = async () => {
    if (status !== 'authenticated') return

    try {
      setLoading(true)
      setError(null)
      const data = await generateRecs(body)
      setItems(Array.isArray(data?.items) ? data.items : [])
      setHasFetched(true)
    } catch (e) {
      const message = e instanceof Error ? e.message : String(e)
      setError(message)
    } finally {
      setLoading(false)
    }
  }

  if (status !== 'loading' && status !== 'authenticated')
    return null

  return (
    <div className="my-4 text-gray-300 max-md:px-4">
      {/* Content area that changes based on state */}
      <div className="min-h-[40px]">
        {!hasFetched && !loading && !error && (
          <button
            onClick={fetchRecommendations}
            className=" text-white cursor-pointer hover:text-light-green rounded-md text-sm font-medium transition-colors flex gap-1 items-center"
          >
            <Bot className="size-5" />
            <span>Get AI Recommendations for {title}</span>
          </button>
        )}

        {error && (
          <div className="text-red-400 text-sm">
            Failed to fetch recommendations.{' '}
            <button
              onClick={fetchRecommendations}
              className="ml-2 text-light-green hover:text-light-green/80 underline"
            >
              Try again
            </button>
          </div>
        )}

        {loading && (
          <div className="space-y-3">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <div className="animate-spin rounded-full h-4 w-4 border-2 border-light-green border-t-transparent"></div>
              <span>Generating AI recommendations...</span>
            </div>
            <div className="flex flex-wrap gap-2" aria-busy="true">
              {skeletonKeys.map((key) => (
                <div
                  key={`skeleton-${key}`}
                  className="animate-pulse bg-dark-gray-hover/60 h-7 w-24 rounded"
                />
              ))}
            </div>
          </div>
        )}

        {hasFetched && items.length > 0 && !loading && (
          <motion.div
            className="flex flex-wrap gap-2"
            variants={containerVariants}
            initial="hidden"
            animate="show"
          >
            {items.map((rec) => {
              const href = `/search?q=${encodeURIComponent(
                rec.title.toLowerCase()
              )}`
              return (
                <motion.button
                  key={`${rec.type}-${rec.id}`}
                  variants={itemVariants}
                  onClick={() => router.push(href)}
                  className="bg-dark-gray-hover text-white px-3 py-1 text-sm transition-colors hover:bg-dark-gray-hover/80 rounded"
                >
                  {rec.title}
                </motion.button>
              )
            })}
          </motion.div>
        )}

        {hasFetched && items.length === 0 && !loading && (
          <div className="text-gray-400 text-sm">
            No recommendations available at the moment.{' '}
            <button
              onClick={fetchRecommendations}
              className="ml-2 text-light-green hover:text-light-green/80 underline"
            >
              Try again
            </button>
          </div>
        )}
      </div>
    </div>
  )
}

export default AiRecommendationComponent



================================================================================
FILE: src/components/animate-page-wrapper.tsx
================================================================================
'use client'

import { cn } from '@/lib'
import { AnimatePresence, motion } from 'framer-motion'
import React from 'react'

interface AnimatePageWrapperProps {
  children: React.ReactNode
  className?: string
}

const AnimatePageWrapper: React.FC<AnimatePageWrapperProps> = ({
  children,
  className,
}) => {
  return (
    <AnimatePresence mode='wait'>
      <motion.div
        className={cn(className)}
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        transition={{ duration: 0.5, ease: 'easeInOut' }}
      >
        {children}
      </motion.div>
    </AnimatePresence>
  )
}

export default AnimatePageWrapper



================================================================================
FILE: src/components/buttons/google-button.tsx
================================================================================
'use client'
import { AnimatePresence, motion } from 'framer-motion'
import { signIn } from 'next-auth/react'
import Image from 'next/image'
import { useState } from 'react'
import Button from '../ui/button'
import Loader from '../ui/loader'

export function GoogleButton() {
  const [isLoading, setIsLoading] = useState(false)

  const handleGoogleSignIn = async () => {
    setIsLoading(true)
    try {
      await signIn('google', { callbackUrl: '/' })
    } catch (error) {
      console.error('Google sign in error:', error)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <Button
      variant='secondary-light'
      className='gap-2 h-11'
      onClick={handleGoogleSignIn}
      disabled={isLoading}
    >
      <Image
        alt="google"
        height={28}
        width={28}
        className="size-5"
        src={'/google.png'}
      />
      <AnimatePresence mode='wait'>

        {!isLoading ? (
          <motion.p
            key="continue"
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
          >
            Continue with Google
          </motion.p>
        ) : (
          <motion.span
            key="loading"
            className='gap-2 flex items-center justify-center'
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
          >
            Loading accounts...
            <Loader color="#ffffff" className="" size="sm" />
          </motion.span>
        )}
      </AnimatePresence>
    </Button>
  )
}



================================================================================
FILE: src/components/buttons/share-button.tsx
================================================================================
'use client'

import { motion } from 'framer-motion'
import { Share2 } from 'lucide-react'
import { useState } from 'react'

interface ShareButtonProps {
  className?: string
}

const ShareButton: React.FC<ShareButtonProps> = ({ className = '' }) => {
  const [copied, setCopied] = useState(false)
  const [shouldAnimate, setShouldAnimate] = useState(false)

  const handleShare = async () => {
    const urlToShare = typeof window !== 'undefined' ? window.location.href : ''

    try {
      await navigator.clipboard.writeText(urlToShare)
      setShouldAnimate(true)
      setCopied(true)

      // Reset after 2 seconds
      setTimeout(() => {
        setCopied(false)
      }, 2000)
    } catch (error) {
      console.error('Failed to copy URL:', error)
      // Fallback for older browsers
      const textArea = document.createElement('textarea')
      textArea.value = urlToShare
      document.body.appendChild(textArea)
      textArea.select()
      document.execCommand('copy')
      document.body.removeChild(textArea)
      setShouldAnimate(true)
      setCopied(true)

      setTimeout(() => {
        setCopied(false)
      }, 2000)
    }
  }

  return (
    <button
      onClick={handleShare}
      className={`flex items-center w-full gap-3 px-3 py-2 text-sm transition-colors ${className} ${
        copied
          ? 'text-light-green'
          : 'text-gray-300 hover:bg-dark-gray-hover hover:text-white'
      }`}
      title="Share URL"
    >
      <Share2 className="size-4" />
      <motion.span
        key={copied ? 'copied' : 'share'}
        initial={shouldAnimate ? { x: 20, opacity: 0 } : { x: 0, opacity: 1 }}
        animate={{ x: 0, opacity: 1 }}
        exit={shouldAnimate ? { x: -20, opacity: 0 } : { x: 0, opacity: 1 }}
        transition={{ duration: 0.4, ease: 'easeInOut' }}
      >
        {copied ? 'Copied!' : 'Share'}
      </motion.span>
    </button>
  )
}

export default ShareButton



================================================================================
FILE: src/components/buttons/signout-button.tsx
================================================================================
'use client'

import { signOut } from 'next-auth/react'

export function SignOutButton() {
  return (
    <button
      onClick={() => signOut({ callbackUrl: '/' })}
      className="bg-red-500 text-white px-4 py-2 rounded"
    >
      Sign Out
    </button>
  )
}



================================================================================
FILE: src/components/cinema-list-loading-skeleton.tsx
================================================================================

import React from 'react'

interface CinemaListLoadingSkeletonProps {
  itemCount?: number
}

const CinemaListLoadingSkeleton: React.FC<CinemaListLoadingSkeletonProps> = ({ itemCount = 8 }) => {
  const bdList = [
    'bg-gradient-to-bl to-light-gray from-dark-gray-2',
    'bg-gradient-to-tr delay-100 from-light-gray to-dark-gray-2',
  ]
  return (
    <div className="w-full h-fit">
      <div className="flex gap-3 overflow-x-auto pb-2 scrollbar-hide">
        {Array.from({ length: itemCount }, (_, index) => (
          <div key={index + 'loading-skeleton'} className="flex-shrink-0 w-36">
            <div className={`${bdList[index % bdList.length]} overflow-hidden`}>
              <div className="flex flex-col w-full h-60">
                {/* Poster skeleton - large area for movie poster */}
                <div className="flex-1 flex items-center justify-center">
                  <div className="w-full h-full flex items-center justify-center bg-gradient-to-tr from-dark-gray-2 to-dark-gray animate-pulse">
                    {/* <Loader size="md" text="Loading..." /> */}
                  </div>
                </div>

                {/* Rating section skeleton */}
                <div className="flex items-center p-2 justify-between bg-dark-gray-2/90">
                  <div className="w-8 h-2.5 bg-dark-gray-hover animate-pulse"></div>
                  <div className="flex items-center gap-1">
                    <div className="w-4 h-2.5 bg-dark-gray-hover animate-pulse"></div>
                    <div className="w-6 h-2.5 bg-dark-gray-hover animate-pulse"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}

export default CinemaListLoadingSkeleton



================================================================================
FILE: src/components/cinema-list.tsx
================================================================================
'use client'

import { MoveRight, Star } from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import React, { useCallback, useEffect, useMemo, useState } from 'react'
import { motion } from 'framer-motion'
import { MediaItem } from '../../types/media'
import CinemaListLoadingSkeleton from './cinema-list-loading-skeleton'
import { cn } from '@/lib'
import { useQuery } from '@tanstack/react-query'
import Header from './header'
import MediaItemDropdown from './media-item-dropdown'
interface CinemaListProps {
  title: string
  subHeading?: string
  items?: MediaItem[]
  apiUrl?: string
  linkPath?: (id: number) => string
  scrollContainerClass?: string
  showMoreLink?: string
  getYear?: (item: MediaItem) => number
  getTitle?: (item: MediaItem) => string
  showRating?: boolean
  showEmptyState?: boolean
  className?: string
  contentType?: 'movie' | 'tv_series'
  showDropdown?: boolean
  onWatchlistToggle?: (item: MediaItem) => void
  getWatchlistStatus?: (item: MediaItem) => boolean
}

const CinemaList: React.FC<CinemaListProps> = ({
  title,
  subHeading,
  items: itemsProp,
  apiUrl,
  linkPath,
  scrollContainerClass = 'cinema-scroll-container',
  showMoreLink,
  getYear,
  getTitle,
  showRating = true,
  showEmptyState = false,
  className,
  contentType = 'movie',
  showDropdown = false,
  onWatchlistToggle,
  getWatchlistStatus,
}) => {
  const [localWatchlistIds, setLocalWatchlistIds] = useState<Set<number>>(new Set())
  const shouldFetch = (!itemsProp || itemsProp.length === 0) && Boolean(apiUrl)

  const { data, isLoading, isError, error, refetch, isFetching } = useQuery<{
    results?: MediaItem[]
  }>({
    queryKey: ['cinema-list', apiUrl],
    queryFn: async () => {
      if (!apiUrl) return { results: [] }
      const response = await fetch(apiUrl)
      if (!response.ok) {
        throw new Error('Failed to load data')
      }
      return response.json()
    },
    enabled: shouldFetch,
    retry: 3,
    retryDelay: (attempt) => Math.min(1000 * 2 ** attempt, 5000),
  })

  const fetchedItems = useMemo(() => data?.results ?? [], [data])
  const items: MediaItem[] = useMemo(() => {
    return itemsProp && itemsProp.length > 0 ? itemsProp : fetchedItems
  }, [itemsProp, fetchedItems])

  // Prefetch saved status for current user so UI reflects saved/not-saved on open
  useEffect(() => {
    if (getWatchlistStatus) return
    let cancelled = false
    const load = async () => {
      try {
        const res = await fetch('/api/user/watchlist', { cache: 'no-store' })
        if (!res.ok) return
        const data = await res.json() as { items?: { contentId: string }[] }
        const ids = new Set<number>()
        for (const it of data.items ?? []) {
          const n = Number(it.contentId)
          if (!Number.isNaN(n)) ids.add(n)
        }
        if (!cancelled) setLocalWatchlistIds(ids)
      } catch {
        // ignore
      }
    }
    void load()
    return () => {
      cancelled = true
    }
  }, [getWatchlistStatus])

  const isSaved = useCallback(
    (item: MediaItem) => {
      if (getWatchlistStatus) return getWatchlistStatus(item)
      return localWatchlistIds.has(item.id)
    },
    [getWatchlistStatus, localWatchlistIds]
  )

  const toggleWatchlist = useCallback(
    async (item: MediaItem) => {
      const currentlySaved = isSaved(item)
      const idNum = item.id
      const idStr = String(idNum)

      // Optimistic update
      setLocalWatchlistIds(prev => {
        const next = new Set(prev)
        if (currentlySaved) next.delete(idNum)
        else next.add(idNum)
        return next
      })

      try {
        if (currentlySaved) {
          const res = await fetch(`/api/user/watchlist/${idStr}`, { method: 'DELETE' })
          if (!res.ok) throw new Error('Failed to remove from watchlist')
        } else {
          const res = await fetch(`/api/user/watchlist`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contentId: idStr,
              contentType,
              posterPath: item.poster_path ?? null,
            }),
          })
          if (!res.ok) throw new Error('Failed to save to watchlist')
        }
        onWatchlistToggle?.(item)
      } catch (err) {
        console.error('Watchlist toggle failed', err)
        // Revert optimistic update on failure
        setLocalWatchlistIds(prev => {
          const next = new Set(prev)
          if (currentlySaved) next.add(idNum)
          else next.delete(idNum)
          return next
        })
      }
    },
    [contentType, isSaved, onWatchlistToggle]
  )

  // Default helper functions
  const defaultGetYear = useCallback((item: MediaItem) => {
    return new Date(item.release_date as string).getFullYear()
  }, [])

  const defaultGetTitle = useCallback((item: MediaItem) => {
    return item.title as string
  }, [])

  const defaultLinkPath = useCallback((id: number) => {
    return `/movie/${id}`
  }, [])

  // Use provided functions or defaults
  const finalGetYear = getYear || defaultGetYear
  const finalGetTitle = getTitle || defaultGetTitle
  const finalLinkPath = linkPath || defaultLinkPath

  // fetching is handled by useQuery

  // Animation variants
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.1,
        delayChildren: 0.2,
      },
    },
  }

  const itemVariants = {
    hidden: {
      opacity: 0,
      x: 10,
    },
    visible: {
      opacity: 1,
      x: 0,
      transition: {
        type: 'spring' as const,
        stiffness: 100,
        damping: 12,
      },
    },
  }

  const handleScroll = (direction: 'left' | 'right') => {
    const container = document.querySelector(`.${scrollContainerClass}`)
    if (container) {
      const scrollAmount = direction === 'left' ? -400 : 400
      container.scrollBy({ left: scrollAmount, behavior: 'smooth' })
    }
  }

  const renderHeader = () => (
    <div className={`flex justify-between items-center`}>
      <Header className="mb-0" title={title} subHeading={subHeading} />
      <div className="flex gap-2 h-fit">
        <button
          onClick={() => handleScroll('left')}
          className="p-2 bg-dark-gray hover:bg-dark-gray-hover transition-colors"
          aria-label="Scroll left"
        >
          <svg
            className="w-5 h-5 text-gray-300"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <button
          onClick={() => handleScroll('right')}
          className="p-2 bg-dark-gray hover:bg-dark-gray-hover transition-colors"
          aria-label="Scroll right"
        >
          <svg
            className="w-5 h-5 text-gray-300"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M9 5l7 7-7 7"
            />
          </svg>
        </button>
      </div>
    </div>
  )

  const renderContent = () => {
    if (isLoading) {
      return <CinemaListLoadingSkeleton itemCount={8} />
    }
    if (isError) {
      return (
        <div className="w-full h-72 flex flex-col items-center justify-center gap-3">
          <div className="text-red-400">
            {error instanceof Error ? error.message : 'Failed to load data'}
          </div>
          <button
            onClick={() => {
              if (!isFetching) {
                void refetch()
              }
            }}
            disabled={isFetching}
            className={`px-4 py-2 bg-dark-gray hover:bg-dark-gray-hover text-gray-200 disabled:opacity-60 disabled:cursor-not-allowed transition-colors`}
          >
            {isFetching ? 'Retrying...' : 'Retry'}
          </button>
        </div>
      )
    }
    if (showEmptyState && items.length === 0) {
      return (
        <div className="w-full h-72 flex items-center justify-center">
          <div className="text-gray-400">No recommendations available</div>
        </div>
      )
    }

    return (
      <>
        <div className="w-full h-fit">
          <motion.div
            className={`${scrollContainerClass} flex gap-2 h-full overflow-x-auto scrollbar-hide`}
            variants={containerVariants}
            initial="hidden"
            animate="visible"
          >
            {items.map((item,index) => (
              <motion.div key={item.id} className={`${index===0 ? "md:ml-3":""}`} variants={itemVariants}>
                <div className="flex-shrink-0 group w-36 block h-full relative">
                  <div className="bg-dark-gray-2 overflow-hidden h-full">
                    <div className="flex flex-col w-full h-full">
                      <div className="h-full flex items-center justify-center overflow-hidden relative">
                        <Link
                          href={finalLinkPath(item.id)}
                          className="block w-full h-full"
                        >
                          {item.poster_path ? (
                            <Image
                              src={`https://image.tmdb.org/t/p/w500${item.poster_path}`}
                              alt={finalGetTitle(item)}
                              width={160}
                              height={240}
                              className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                            />
                          ) : (
                            <div className="text-center text-gray-400">
                              <div className="w-16 h-40 mb-2 mx-auto bg-gray-700"></div>
                              <p className="text-sm font-medium">No Image</p>
                            </div>
                          )}
                        </Link>
                      </div>

                      {showRating && (
                        <div className="flex items-center p-2 justify-between text-xs text-gray-500">
                          <span>{finalGetYear(item)}</span>
                          <span className="flex items-center gap-1">
                            <Star className="size-3 fill-light-green text-light-green" />
                            {item.vote_average.toFixed(1)}
                          </span>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* Dropdown Menu - positioned relative to the card container */}
                  {showDropdown && (
                    <div className="absolute top-1 right-1">
                      <MediaItemDropdown
                        item={{
                          id: item.id,
                          title: finalGetTitle(item),
                          poster_path: item.poster_path,
                          release_date: item.release_date,
                        }}
                        contentType={contentType}
                        onWatchlistToggle={() => toggleWatchlist(item)}
                        isInWatchlist={isSaved(item)}
                      />
                    </div>
                  )}
                </div>
              </motion.div>
            ))}
          </motion.div>
        </div>

        {showMoreLink && (
          <div className="flex justify-end">
            <Link
              href={showMoreLink}
              className="text-gray-300 hover:text-white text-sm transition-all flex gap-1 items-center justify-center"
            >
              See more
              <MoveRight className="size-5" />
            </Link>
          </div>
        )}
      </>
    )
  }

  return (
    <div
      className={cn(
        'relative w-full max-w-6xl flex flex-col gap-4 mb-6',
        className
      )}
    >
      {renderHeader()}
      {renderContent()}
    </div>
  )
}

export default CinemaList



================================================================================
FILE: src/components/footer.tsx
================================================================================
import { Facebook, Instagram, Twitter, Youtube } from 'lucide-react'
import Link from 'next/link'
import React from 'react'


const socialLinks = [
  {
    name: 'Instagram',
    link: 'https://instagram.com',
    icon: (
      <Instagram className='size-4' />
    ),
  },
  {
    name: 'Twitter',
    link: 'https://twitter.com',
    icon: (
      <Twitter className="size-4"
      />
    ),
  },
  {
    name: 'Facebook',
    link: 'https://facebook.com',
    icon: (
      <Facebook className="size-4" />
    ),
  },
  {
    name: 'YouTube',
    link: 'https://youtube.com',
    icon: (
      <Youtube className='size-4' />
    ),
  },
]

const Footer = () => {
  return (
    <footer className="flex items-center justify-center w-full text-gray-300">
      <div className="max-w-5xl w-full mx-auto px-4 md:px-0 py-3">
        <div className=" flex justify-between items-center">
          <div className="text-sm text-gray-400">
            Â© 2025 Escape. All rights reserved.
          </div>
          <div className="flex justify-center md:justify-start md:gap-2">
            {socialLinks.map((social, index) => (
              <Link
                key={index + social.name}
                href={social.link}
                target="_blank"
                rel="noopener noreferrer"
                className="text-gray-400 hover:text-white transition-colors duration-200 p-1 md:p-2"
                aria-label={social.name}
              >
                {social.icon}
              </Link>
            ))}
          </div>
        </div>
      </div>
    </footer>
  )
}

export default Footer



================================================================================
FILE: src/components/forms/create-post-form.tsx
================================================================================
'use client'

import { createPost, type RatingEnum } from '@/app/(user)/post/actions'
import { getRatingLabel } from '@/lib'
import { motion } from 'framer-motion'
import { X } from 'lucide-react'
import { useState } from 'react'
import Loader from '../ui/loader'
import Input from '../ui/input'
import TextArea from '@/components/ui/text-area'
import ActivityDatePicker from '../ui/activity/activity-date-picker'
interface CreatePostFormProps {
  movieId: string
  movieTitle: string
  contentType?: 'movie' | 'tv_series'
  posterPath?: string | null
  onClose: () => void
  onSuccess?: () => void
}

export function CreatePostForm({
  movieId,
  movieTitle,
  contentType = 'movie',
  posterPath = null,
  onClose,
  onSuccess,
}: Readonly<CreatePostFormProps>) {
  const [title, setTitle] = useState('')
  const [content, setContent] = useState('')
  const [rating, setRating] = useState<RatingEnum | null>(null)
  const [isSpoiler, setIsSpoiler] = useState(false)
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState('')
  const [activityDate, setActivityDate] = useState(new Date())
  const [useCustomDate, setUseCustomDate] = useState(false)

  const ratingOptions: RatingEnum[] = [
    'TRASH',
    'TIMEPASS',
    'ONE_TIME_WATCH',
    'MUST_WATCH',
    'LEGENDARY',
  ]

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      await createPost({
        title: title.trim() || null,
        content: content.trim(),
        rating: rating || null,
        isSpoiler,
        contentId: movieId,
        contentType,
        posterPath,
        activityDate: useCustomDate ? activityDate : undefined,
      })

      onSuccess?.()
      onClose()
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to create post')
    } finally {
      setIsLoading(false)
    }
  }

  const renderRatingSelect = () => (
    <select
      value={rating ?? ''}
      onChange={(e) => setRating((e.target.value || null) as RatingEnum | null)}
      className="text-white placeholder:text-gray-300 bg-dark-gray outline-none w-full p-2 px-4 text-base focus:ring-1 focus:ring-light-green"
    >
      <option value="">No rating</option>
      {ratingOptions.map((opt) => (
        <option key={opt} value={opt}>
          {getRatingLabel(opt)}
        </option>
      ))}
    </select>
  )

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 100 }}
      exit={{ opacity: 0 }}
      className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    >
      <div className="bg-dark-gray-2 max-w-xl w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          {/* Header */}
          <div className="flex justify-between items-center mb-2">
            <div className="py-2">
              <h2 className="text-2xl font-bold text-white">Create Post</h2>
              <p className="text-gray-400 text-sm">
                Share your thoughts about {movieTitle}
              </p>
            </div>
            <button
              onClick={onClose}
              className="text-gray-300 cursor-pointer hover:text-white transition-colors"
            >
              <X className="w-6 h-6" />
            </button>
          </div>

          {/* Form */}
          <form onSubmit={handleSubmit} className="">
            {/* Title */}
            <div className="flex flex-col gap-1 py-2">
              <label
                htmlFor="title"
                className="block text-sm font-medium text-gray-300 mb-2"
              >
                Title
              </label>
              <Input
                type="text"
                id="title"
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                placeholder="Give your post a catchy title..."
                className="focus:ring-1 focus:ring-light-green"
              />
            </div>

            {/* Rating */}
            <div className="flex flex-col gap-1 py-2">
              <label
                htmlFor="rating"
                className="block text-sm font-medium text-gray-300 mb-2"
              >
                Your Rating
              </label>
              <div id="rating">{renderRatingSelect()}</div>
            </div>

            {/* Content */}
            <div className="flex flex-col gap-1 py-2">
              <label
                htmlFor="content"
                className="block text-sm font-medium text-gray-300 mb-2"
              >
                Review Content
              </label>
              <TextArea
                id="content"
                value={content}
                onChange={(e) => setContent(e.target.value)}
                placeholder={`Share your thoughts about this ${
                  contentType === 'tv_series' ? 'TV series' : 'movie'
                }...`}
                required
                rows={6}
                className="focus:ring-1 focus:ring-light-green"
              />
            </div>

            {/* Spoiler Checkbox */}
            <div className="flex items-center gap-1 py-2">
              <Input
                type="checkbox"
                id="spoiler"
                checked={isSpoiler}
                onChange={(e) => setIsSpoiler(e.target.checked)}
                className="size-4 accent-light-green"
              />
              <label htmlFor="spoiler" className="ml-1 text-gray-300">
                has spoilers ?
              </label>
            </div>

            {/* Activity Date Section */}
            <div className="py-2">
              <div className="flex items-center gap-2 mb-3">
                <Input
                  type="checkbox"
                  id="useCustomDate"
                  checked={useCustomDate}
                  onChange={(e) => setUseCustomDate(e.target.checked)}
                  className="size-4 accent-light-green"
                />
                <label htmlFor="useCustomDate" className="text-gray-300">
                  Log this activity for a different date
                </label>
              </div>

              {useCustomDate && (
                <div className="ml-6">
                  <label htmlFor="activity-date" className="block text-sm font-medium text-gray-300 mb-2">
                    Activity Date
                  </label>
                  <ActivityDatePicker
                    selectedDate={activityDate}
                    onDateChange={setActivityDate}
                    disabled={isLoading}
                  />
                  <p className="text-xs text-gray-400 mt-1">
                    When did you actually watch this {contentType === 'tv_series' ? 'series' : 'movie'}?
                  </p>
                </div>
              )}
            </div>

            {/* Error Message */}
            {error && (
              <div className="text-red-400 text-sm bg-red-900/20 border border-red-500/30 rounded-md p-3">
                {error}
              </div>
            )}

            {/* Buttons */}
            <div className="flex gap-3 pt-4">
              <button
                type="button"
                onClick={onClose}
                className="flex-1 px-4 py-2 bg-dark-gray cursor-pointer text-white"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={isLoading || !content.trim()}
                className="flex-1 px-4 py-2 bg-light-green text-white cursor-pointer hover:bg-light-green disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                {isLoading ? <Loader color="white" size="sm" /> : 'Create Post'}
              </button>
            </div>
          </form>
        </div>
      </div>
    </motion.div>
  )
}



================================================================================
FILE: src/components/forms/log-watching-form.tsx
================================================================================
'use client'

import { Calendar, Film, Tv, X } from 'lucide-react'
import { useSession } from 'next-auth/react'
import React, { useState } from 'react'
import { motion } from 'framer-motion'
import Input from '../ui/input'
import Loader from '../ui/loader'

interface LogWatchingFormProps {
  contentId: string
  contentType: 'movie' | 'tv_series'
  contentTitle: string
  posterPath?: string
  onClose: () => void
  onSuccess?: () => void
}

export default function LogWatchingForm({
  contentId,
  contentType,
  contentTitle,
  posterPath,
  onClose,
  onSuccess,
}: Readonly<LogWatchingFormProps>) {
  const { data: session } = useSession()
  const [selectedDate, setSelectedDate] = useState(new Date())
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!session?.user?.id) {
      setError('You must be logged in to log watching activity')
      return
    }

    setIsSubmitting(true)
    setError(null)

    try {
      const response = await fetch('/api/activity/log', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          activityType: contentType === 'tv_series' ? 'series_watched' : 'movie_watched',
          activityDate: selectedDate.toISOString(),
          contentId,
          metadata: {
            contentType,
            contentTitle,
            posterPath,
            loggedAt: new Date().toISOString(),
          },
        }),
      })

      if (!response.ok) {
        const errorData = await response.json()
        throw new Error(errorData.error || 'Failed to log activity')
      }

      onSuccess?.()
      onClose()
    } catch (err) {
      console.error('Error logging watching activity:', err)
      setError('Failed to log watching activity. Please try again.')
    } finally {
      setIsSubmitting(false)
    }
  }

  const formatDate = (date: Date) => {
    return date.toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    })
  }

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 100 }}
      exit={{ opacity: 0 }}
      className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    >
      <div className="bg-dark-gray-2 max-w-xl w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          {/* Header */}
          <div className="flex justify-between items-center mb-2">
            <div className="py-2">
              <h2 className="text-2xl font-bold text-white">Log Watching Activity</h2>
              <p className="text-gray-400 text-sm">
                Track when you watched {contentTitle}
              </p>
            </div>
            <button
              onClick={onClose}
              className="text-gray-300 cursor-pointer hover:text-white transition-colors"
            >
              <X className="w-6 h-6" />
            </button>
          </div>

          {/* Form */}
          <form onSubmit={handleSubmit} className="">
            {/* Content Info */}
            <div className="flex flex-col gap-1 py-2">
              <div className="flex items-center gap-3 p-3 bg-dark-gray rounded-lg">
                {contentType === 'tv_series' ? (
                  <Tv className="w-5 h-5 text-blue-400" />
                ) : (
                  <Film className="w-5 h-5 text-blue-400" />
                )}
                <div>
                  <h4 className="text-white font-medium">{contentTitle}</h4>
                  <p className="text-sm text-gray-400 capitalize">
                    {contentType === 'tv_series' ? 'TV Series' : 'Movie'}
                  </p>
                </div>
              </div>
            </div>

            {/* Date Selection */}
            <div className="flex flex-col gap-1 py-2">
              <label htmlFor="watch-date" className="block text-sm font-medium text-gray-300 mb-2">
                When did you watch this?
              </label>
              <div className="relative">
                <Calendar className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
                <Input
                  id="watch-date"
                  type="date"
                  value={selectedDate.toISOString().split('T')[0]}
                  onChange={(e) => setSelectedDate(new Date(e.target.value))}
                  className="pl-10 focus:ring-1 focus:ring-light-green"
                  required
                />
              </div>
              <p className="text-xs text-gray-400 mt-1">
                Selected: {formatDate(selectedDate)}
              </p>
            </div>

            {/* Error Message */}
            {error && (
              <div className="text-red-400 text-sm bg-red-900/20 border border-red-500/30 rounded-md p-3">
                {error}
              </div>
            )}

            {/* Buttons */}
            <div className="flex gap-3 pt-4">
              <button
                type="button"
                onClick={onClose}
                className="flex-1 px-4 py-2 bg-dark-gray cursor-pointer text-white"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={isSubmitting}
                className="flex-1 px-4 py-2 bg-light-green text-white cursor-pointer hover:bg-light-green disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                {isSubmitting ? <Loader color="white" size="sm" /> : 'Log Activity'}
              </button>
            </div>
          </form>
        </div>
      </div>
    </motion.div>
  )
}



================================================================================
FILE: src/components/header.tsx
================================================================================
import { cn } from '@/lib'
import React from 'react'

interface HeaderProps {
  title: string
  subHeading?: string
  className?:string
}

const Header = ({ title, subHeading,className }: HeaderProps) => {
  return (
    <div className={cn('mb-6',className)}>
      <div className="flex items-center gap-3 mb-2">
        <div className="w-0.5 h-8 bg-light-green rounded-full"></div>
        <h1 className="text-2xl text-gray-200 font-light">{title}</h1>
      </div>
      {subHeading && <div className="max-md:hidden text-sm text-gray-400">{subHeading}</div>}
    </div>
  )
}

export default Header



================================================================================
FILE: src/components/media-item-dropdown.tsx
================================================================================
'use client'

import { Bookmark, Bug, Calendar, MoreVertical, Plus, X } from 'lucide-react'
import { useSession } from 'next-auth/react'
import { useRouter } from 'next/navigation'
import React, { useRef, useState, useEffect } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import LogWatchingForm from './forms/log-watching-form'
import { CreatePostForm } from './forms/create-post-form'
import ShareButton from './buttons/share-button'

/**
 * MediaItemDropdown - A reusable dropdown component for media items
 *
 * Features:
 * - Three-dot menu that appears on hover
 * - Review functionality
 * - Log Watching functionality with date selection
 * - Add/Remove from Watchlist functionality
 * - Share functionality (copies URL to clipboard)
 * - Report functionality
 * - Consistent styling with the rest of the app
 *
 * Usage:
 * <MediaItemDropdown
 *   item={{
 *     id: 123,
 *     title: "Movie Title",
 *     poster_path: "/path/to/poster.jpg",
 *     release_date: "2024-01-01"
 *   }}
 *   contentType="movie" // or "tv_series"
 *   onWatchlistToggle={() => console.log('Toggle watchlist')}
 *   isInWatchlist={false}
 * />
 */

interface MediaItemDropdownProps {
  item: {
    id: number
    title: string
    poster_path?: string | null
    release_date?: string
  }
  contentType: 'movie' | 'tv_series'
  onWatchlistToggle?: () => void
  isInWatchlist?: boolean
  customButton?: React.ReactNode
}

export default function MediaItemDropdown({
  item,
  contentType,
  onWatchlistToggle,
  isInWatchlist = false,
  customButton,
}: Readonly<MediaItemDropdownProps>) {
  const { data: session } = useSession()
  const router = useRouter()
  const [isOpen, setIsOpen] = useState(false)
  const [showLogForm, setShowLogForm] = useState(false)
  const [showCreatePost, setShowCreatePost] = useState(false)
  const [isSmallScreen, setIsSmallScreen] = useState(false)
  const dropdownRef = useRef<HTMLDivElement>(null)
  const buttonRef = useRef<HTMLButtonElement>(null)

  // Detect screen size
  useEffect(() => {
    const checkScreenSize = () => {
      setIsSmallScreen(window.innerWidth < 768) // md breakpoint
    }

    checkScreenSize()
    window.addEventListener('resize', checkScreenSize)

    return () => {
      window.removeEventListener('resize', checkScreenSize)
    }
  }, [])

  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        dropdownRef.current &&
        !dropdownRef.current.contains(event.target as Node)
      ) {
        setIsOpen(false)
      }
    }

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isOpen])

  const handleCreatePost = () => {
    setIsOpen(false)
    if (!session) {
      router.push('/signin')
      return
    }
    setShowCreatePost(true)
  }

  const handleLogWatching = () => {
    setIsOpen(false)
    if (!session) {
      router.push('/signin')
      return
    }
    setShowLogForm(true)
  }

  const handleWatchlist = () => {
    setIsOpen(false)
    if (!session) {
      router.push('/signin')
      return
    }
    onWatchlistToggle?.()
  }

  const handleReport = () => {
    setIsOpen(false)
    // For now, just show an alert. In a real app, this would open a report form or modal
    alert('Content reported. Thank you for your feedback!')
  }

  const handleButtonClick = () => {
    setIsOpen(!isOpen)
  }

  return (
    <>
      <div className="relative" ref={dropdownRef}>
        {customButton ? (
          <button type="button" onClick={handleButtonClick} className="inline-flex">
            {customButton}
          </button>
        ) : (
          <button
            ref={buttonRef}
            onClick={handleButtonClick}
            className={`absolute top-1 right-1 p-1 bg-dark-gray cursor-pointer ${
              isOpen
                ? 'opacity-100 md:opacity-100'
                : 'md:opacity-0 group-hover:opacity-100'
            } transition-opacity z-40`}
            aria-label="More options"
          >
            <MoreVertical className="size-4 text-white" />
          </button>
        )}

        <AnimatePresence mode="wait">
          {isOpen && (
            <>
              {isSmallScreen ? (
                // Full screen modal for small screens
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  transition={{ duration: 0.2 }}
                  className="fixed inset-0 bg-black/50 z-[100] flex items-end"
                  onClick={() => setIsOpen(false)}
                >
                  <motion.div
                    initial={{ y: '100%' }}
                    animate={{ y: 0 }}
                    exit={{ y: '100%' }}
                    transition={{ duration: 0.3, ease: 'easeOut' }}
                    className="w-full bg-dark-gray-2 border-t border-white/5 rounded-t-2xl py-6"
                    onClick={(e) => e.stopPropagation()}
                  >
                    {/* Header */}
                    <div className="flex items-center justify-between mb-6 px-6">
                      <h3 className="text-xl font-light text-white">Options</h3>
                      <button
                        onClick={() => setIsOpen(false)}
                        className="p-2 bg-dark-gray-hover transition-colors"
                      >
                        <X className="size-5 text-gray-300" />
                      </button>
                    </div>

                    {/* Menu Items */}
                    <div className="flex flex-col gap-2">
                      <motion.button
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.1, duration: 0.2 }}
                        onClick={handleCreatePost}
                        className="flex items-center gap-4 px-4 py-4 text-base text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                      >
                        <Plus className="size-5" />
                        Review
                      </motion.button>
                      <motion.button
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.15, duration: 0.2 }}
                        onClick={handleLogWatching}
                        className="flex items-center gap-4 px-4 py-4 text-base text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                      >
                        <Calendar className="size-5" />
                        Log
                      </motion.button>
                      <motion.button
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.2, duration: 0.2 }}
                        onClick={handleWatchlist}
                        className="flex items-center gap-4 px-4 py-4 text-base text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                      >
                        <Bookmark
                          className={`size-5 ${
                            isInWatchlist
                              ? 'fill-light-green text-light-green'
                              : ''
                          }`}
                        />
                        Save
                      </motion.button>
                      <motion.div
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.25, duration: 0.2 }}
                        className="px-4 py-4 hover:bg-dark-gray-hover transition-colors"
                      >
                        <ShareButton />
                      </motion.div>
                      <motion.button
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.3, duration: 0.2 }}
                        onClick={handleReport}
                        className="flex items-center gap-4 px-4 py-4 text-base text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                      >
                        <Bug className="size-5" />
                        Report
                      </motion.button>
                    </div>
                  </motion.div>
                </motion.div>
              ) : (
                // Regular dropdown for larger screens
                // Regular dropdown for larger screens
                <motion.div
                  initial={{ opacity: 0, scale: 0.95 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.95 }}
                  transition={{ duration: 0.15, ease: 'easeOut' }}
                  className="absolute right-1 translate-y-7 top-full bg-dark-gray-2 border border-white/15 z-40 w-[140px] shadow-sm"
                >
                  <div className="flex flex-col gap-1">
                    <motion.button
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.1, duration: 0.15 }}
                      onClick={handleCreatePost}
                      className="flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                    >
                      <Plus className="size-4" />
                      Review
                    </motion.button>
                    <motion.button
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.125, duration: 0.15 }}
                      onClick={handleLogWatching}
                      className="flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                    >
                      <Calendar className="size-4" />
                      Log
                    </motion.button>
                    <motion.button
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.15, duration: 0.15 }}
                      onClick={handleWatchlist}
                      className="flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                    >
                      <Bookmark
                        className={`size-4 ${
                          isInWatchlist
                            ? 'fill-light-green text-light-green'
                            : ''
                        }`}
                      />
                      Save
                    </motion.button>
                    <motion.div
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.175, duration: 0.15 }}
                    >
                      <ShareButton />
                    </motion.div>
                    <motion.button
                      initial={{ opacity: 0, x: -5 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: 0.2, duration: 0.15 }}
                      onClick={handleReport}
                      className="flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors"
                    >
                      <Bug className="size-4" />
                      Report
                    </motion.button>
                  </div>
                </motion.div>
              )}
            </>
          )}
        </AnimatePresence>
      </div>

      {/* Log Watching Form */}
      <AnimatePresence mode="wait">
        {showLogForm && (
          <LogWatchingForm
            contentId={item.id.toString()}
            contentType={contentType}
            contentTitle={item.title}
            posterPath={item.poster_path || undefined}
            onClose={() => setShowLogForm(false)}
            onSuccess={() => {
              // Optionally refresh data or show success message
            }}
          />
        )}
      </AnimatePresence>

      {/* Review Form */}
      <AnimatePresence mode="wait">
        {showCreatePost && (
          <CreatePostForm
            movieId={item.id.toString()}
            movieTitle={item.title}
            contentType={contentType}
            posterPath={item.poster_path}
            onClose={() => setShowCreatePost(false)}
            onSuccess={() => {
              // Optionally refresh data or show success message
            }}
          />
        )}
      </AnimatePresence>
    </>
  )
}



================================================================================
FILE: src/components/navbar.tsx
================================================================================
'use client'

import { ChevronDown, LogOut, Search, X } from 'lucide-react'
import { signOut, useSession } from 'next-auth/react'
import Image from 'next/image'
import Link from 'next/link'
import { useRouter } from 'next/navigation'
import { useEffect, useRef, useState } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import Loader from './ui/loader'
import Input from './ui/input'
import TypeSelector from './type-selector'

const navbarItems = [
  {
    name: 'lists',
    link: '/lists',
  },
  {
    name: 'trending',
    link: '/trending',
  },
]

const Navbar = () => {
  const [isSearchOpen, setIsSearchOpen] = useState(false)
  const [searchQuery, setSearchQuery] = useState('')
  const handleSearchToggle = () => {
    setIsSearchOpen(!isSearchOpen)
    if (isSearchOpen) {
      setSearchQuery('')
    }
  }
  const router = useRouter()
  const handleSearchSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    router.push('/search?q=' + searchQuery)
  }

  const searchInputRef = useRef<HTMLInputElement>(null)

  useEffect(() => {
    if (isSearchOpen && searchInputRef.current) {
      setTimeout(() => {
        searchInputRef.current?.focus()
      }, 50)
    }

    return () => {}
  }, [isSearchOpen])
  const container = useRef<HTMLDivElement>(null)
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        container.current &&
        !container.current.contains(event.target as Node) &&
        isSearchOpen
      ) {
        setIsSearchOpen(false)
      }
    }

    if (isSearchOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isSearchOpen])

  return (
    <div className="sticky max-md:px-2 max-md:pl-4 top-0 left-0 right-0 bg-dark-gray z-50 w-full ">
      <div className="w-full flex justify-center items-center">
        <div className="w-full max-w-5xl">
          <div className="flex items-center justify-between gap-2 md:gap-4 h-13 md:h-14 min-w-0">
            <div className="flex items-center gap-3">
              <Link href={'/'} className="flex items-center gap-2">
                <div className="flex space-x-1">
                  <Image
                    alt="logo"
                    className=""
                    src={'/logo-light.png'}
                    width={20}
                    height={20}
                  />
                </div>
                <span className="text-xl text-white max-md:hidden">Escape</span>
              </Link>
              <TypeSelector />
            </div>

            <div className="flex items-center gap-1 md:gap-2 min-w-0">
              <div
                className={`flex items-center gap-2 md:gap-3 font-light transition-all duration-300 ${
                  isSearchOpen
                    ? 'opacity-0 scale-95 translate-x-2 pointer-events-none'
                    : 'opacity-100 scale-100 translate-x-0'
                }`}
              >
                {navbarItems.map((item, index) => {
                  return (
                    <Link
                      key={index + item.name}
                      href={item.link}
                      className={`text-gray-300 capitalize hover:text-white transition-colors text-sm md:text-base ${isSearchOpen ? "hidden":""}`}
                    >
                      {item.name}
                    </Link>
                  )
                })}
              </div>

              {/* Search Input */}
              <div
                ref={container}
                className={`transition-all duration-300 ease-in-out ${
                  isSearchOpen
                    ? 'w-48 md:w-64 opacity-100 scale-100'
                    : 'w-0 opacity-0 scale-95 overflow-hidden'
                }`}
              >
                <form onSubmit={handleSearchSubmit} className="relative">
                  <Input
                    type="text"
                    ref={searchInputRef}
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    placeholder="Search..."
                    variant="secondary"
                    autoFocus={isSearchOpen}

                  />
                </form>
              </div>

              <button
                className={`flex gap-1 justify-center h-full items-center p-2 transition-all duration-300 ${
                  isSearchOpen ? 'bg-light-green text-white' : 'text-gray-300'
                }`}
                onClick={
                  !isSearchOpen ? handleSearchToggle : handleSearchSubmit
                }
              >
                <Search className="w-5 h-5" />
              </button>
              <RenderAuthSection />
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}

const RenderAuthSection = () => {
  const dropdownItems = [
    {
      name: 'profile',
      link: '/profile',
    },
    {
      name: 'watchlist',
      link: '/profile/watchlist',
    },
    {
      name: 'lists',
      link: '/profile/lists',
    },
    {
      name: 'reviews',
      link: '/profile/reviews',
    },
    {
      name: 'notifications',
      link: '/profile/notifications',
    },
    {
      name: 'settings',
      link: '/settings',
    },

  ]
  const { data: session, status } = useSession()
  const [isDropdownOpen, setIsDropdownOpen] = useState(false)
  const [isHovered, setIsHovered] = useState(false)

  // Handle click outside behavior for mobile
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      const target = event.target as Element
      const isMobile = window.innerWidth < 768

      if (isMobile) {
        if (!target.closest('.dropdown-container')) {
          setIsDropdownOpen(false)
        }
      }
    }

    if (isDropdownOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isDropdownOpen])

  if ( status === 'loading') {
    return (
      <div className="cursor-not-allowed w-10 max-md:rounded-full md:w-36 h-10 bg-dark-gray-hover flex items-center justify-center text-gray-600 gap-1 animate-pulse">
        <span className='max-md:hidden'>Loading</span>
        <Loader size="sm" />
      </div>
    )
  }

  if (session) {
    const userImage = session.user.image ?? ""
    const username = session.user?.name?.split(' ')[0]
    const menuVariants = {
      open: {
        transition: {
          staggerChildren: 0.05,
          delayChildren: 0,
        },
      },
      closed: {
        transition: {
          staggerChildren: 0.05,
          staggerDirection: -1,
        },
      },
    }
    const itemVariants = {
      closed: { opacity: 0, x: -10 },
      open: { opacity: 1, x: 0 },
    }
    return (
      <div
        className="relative w-10 md:w-36 group dropdown-container"
        onMouseEnter={() => {
          // Keep dropdown open when hovering over the entire container
          if (window.innerWidth >= 768) {
            setIsHovered(true)
          }
        }}
        onMouseLeave={() => {
          // Close on hover leave for desktop
          if (window.innerWidth >= 768) {
            setIsHovered(false)
          }
        }}
        role="menu"
        aria-label="User profile dropdown"
        tabIndex={-1}
      >
        <button
          className={`flex w-full max-md:rounded-full h-10 justify-center md:justify-around items-center md:space-x-2  md:p-4 transition-colors ${
            isDropdownOpen || isHovered
              ? 'bg-dark-gray-2'
              : 'bg-dark-gray-hover group-hover:bg-dark-gray-2'
          }`}
          onClick={() => {
            // Only toggle on mobile devices
            if (window.innerWidth < 768) {
              setIsDropdownOpen(!isDropdownOpen)
            }
          }}
        >
          <div className="md:size-8 size-10 bg-light-green rounded-full flex items-center justify-center">
            <Image
              src={userImage}
              className="rounded-full"
              alt="Profile"
              width={34}
              height={34}
              unoptimized={userImage.includes('dicebear')}
            />
          </div>
          <span className="text-gray-300 text-sm hidden md:block">
            {username || 'Profile'}
          </span>
          <motion.div
            animate={{ rotate: isDropdownOpen || isHovered ? 180 : 0 }}
            transition={{ duration: 0.2, ease: 'easeInOut' }}
          >
            <ChevronDown className="size-4 max-md:hidden text-gray-300" />
          </motion.div>
        </button>
        {/* Dropdown Menu */}
        <AnimatePresence mode="wait">
          {(isDropdownOpen || isHovered) && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, transition: { delay: innerWidth<768 ? 0.56 : 0 } }}
              transition={{
                ease: 'easeOut',
                type: 'spring',
                stiffness: 300,
                damping: 30,
              }}
              className="fixed md:absolute right-0 z-[100] border border-dark-gray-2 top-0 md:top-full inset-0 md:inset-auto h-screen md:h-auto w-screen md:w-36 bg-dark-gray-2"
            >
              <motion.div
                className="flex flex-col h-full md:h-auto pt-4 md:pt-0 px-0"
                variants={menuVariants}
                initial="closed"
                animate="open"
                exit="closed"
              >
                {/* Close Button */}
                <motion.div
                  className="flex justify-end mb-4 md:hidden pr-4"
                >
                  <button
                    onClick={() => {
                      setIsDropdownOpen(false)
                      setIsHovered(false)
                    }}
                    className="p-2 mr-2 text-gray-300 hover:text-white hover:bg-dark-gray-hover transition-colors"
                  >
                    <X className="w-6 h-6" />
                  </button>
                </motion.div>
                {dropdownItems.map((item, index) => {
                  return (
                    <motion.div key={item.name + index} variants={itemVariants}>
                      <Link
                        href={item.link}
                        className="block capitalize px-4 py-4 md:py-2 text-lg md:text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors border-b border-dark-gray-hover md:border-b-0 max-md:text-2xl"
                        onClick={() => {
                          // Close dropdown when clicking any menu item
                          setIsDropdownOpen(false)
                          setIsHovered(false)
                        }}
                      >
                        {item.name}
                      </Link>
                    </motion.div>
                  )
                })}
                <motion.div variants={itemVariants}>
                  <button
                    onClick={() => {
                      signOut({ callbackUrl: '/' })
                      // Close dropdown when clicking sign out
                      setIsDropdownOpen(false)
                      setIsHovered(false)
                    }}
                    className="w-full cursor-pointer text-left px-4 py-4 md:py-2 text-lg md:text-sm text-gray-300 hover:bg-dark-gray-hover hover:text-white transition-colors flex items-center space-x-2 border-b border-dark-gray-hover md:border-b-0 max-md:text-2xl"
                  >
                    <LogOut className="size-5 md:w-4 md:h-4" />
                    <span>Sign Out</span>
                  </button>
                </motion.div>
              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    )
  }

  return (
    <div className="flex w-20 md:w-36 items-center">
      <Link
        href="/signin"
        className="md:hidden w-full h-10 text-gray-300 bg-dark-gray-hover transition-colors px-2 flex items-center justify-center"
      >
        SignIn
      </Link>
      <Link
        href="/signin"
        className="max-md:hidden w-full h-10 text-gray-300 bg-dark-gray-hover transition-colors px-4 flex items-center justify-center"
      >
        Get Started
      </Link>
    </div>
  )
}

export default Navbar



================================================================================
FILE: src/components/page/building.tsx
================================================================================
import Link from 'next/link'

export const Building = () => {
  return (
    <section className="relative grid place-content-center overflow-hidden px-4 py-24 text-slate-200">
      <div className="relative z-10 flex flex-col items-center">
        <span className="text-4xl bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
          Building in progress
        </span>

        <p className="my-8 max-w-2xl text-center text-lg leading-relaxed text-slate-300 md:text-xl md:leading-relaxed">
          We&apos;re working hard to bring you an incredible experience. Come
          back later to explore this page.
        </p>
      </div>
      <Link
        href={'/'}
        className="bg-dark-gray w-fit mx-auto px-4 py-2 my-4 text-gray-300 cursor-pointer"
      >
        Please Take Me Home
      </Link>
    </section>
  )
}

export default Building



================================================================================
FILE: src/components/page/home/feed-component.tsx
================================================================================
import { getAllFeedPosts } from '@/app/(user)/post/actions'
import Header from '@/components/header'
import PostList from '@/components/post-list'
import { getPosterUrl, hideContent } from '@/lib'
import { Suspense } from 'react'

function FeedSkeleton() {
  return (
    <div className="w-full py-10">
      <h1 className="text-2xl text-gray-300 mb-4">Reviews</h1>
      <div className="flex flex-col gap-3">
        {Array.from({ length: 3 }, (_, i) => (
          <div key={`loading-skeleton-${i}`} className="p-6 px-4 animate-pulse">
            <div className="flex gap-4">
              <div className="flex-shrink-0">
                <div className="w-36 h-48 bg-dark-gray"></div>
              </div>
              <div className="flex flex-col min-w-0 w-full">
                <div className="flex items-center gap-1 mb-2">
                  <div className="w-8 h-8 bg-dark-gray rounded-full"></div>
                  <div className="h-4 bg-dark-gray w-20"></div>
                </div>
                <div className="mb-1">
                  <div className="h-6 bg-dark-gray w-48 mb-1"></div>
                  <div className="h-4 bg-dark-gray w-12"></div>
                </div>
                <div className="flex items-center gap-3 mb-1">
                  <div className="flex gap-1">
                    {Array.from({ length: 5 }, (_, j) => (
                      <div key={j} className="w-4 h-4 bg-dark-gray"></div>
                    ))}
                  </div>
                  <div className="flex items-center gap-1">
                    <div className="w-4 h-4 bg-dark-gray"></div>
                    <div className="h-4 bg-dark-gray w-6"></div>
                  </div>
                </div>
                <div className="mb-4">
                  <div className="h-3 bg-dark-gray w-full mb-1"></div>
                  <div className="h-3 bg-dark-gray w-5/6 mb-1"></div>
                  <div className="h-3 bg-dark-gray w-4/5"></div>
                </div>
                <div className="flex items-center gap-2">
                  <div className="flex items-center gap-2">
                    <div className="w-4 h-4 bg-dark-gray"></div>
                    <div className="h-4 bg-dark-gray w-20"></div>
                  </div>
                  <div className="h-4 bg-dark-gray w-12"></div>
                </div>
              </div>
            </div>
            <div className="mt-6 w-[80%] mx-auto h-0.5 bg-dark-gray"></div>
          </div>
        ))}
      </div>
    </div>
  )
}

async function FeedServer() {
  try {
    const posts = await getAllFeedPosts()

    if (posts.length === 0) {
      return (
        <div className="py-6 text-center ">
          <p className="text-gray-400">
            No reviews yet. Be the first to share your thoughts!
          </p>
        </div>
      )
    }

    const genericPosts = posts.map((post) => {
      const posterUrl = getPosterUrl(post.movie?.posterPath ?? null, 'w500')
      const isSpoiler = post.isSpoiler
      const safeTitle = isSpoiler
        ? hideContent(post.title ?? '')
        : post.title ?? null
      const safeContent = isSpoiler ? hideContent(post.content) : post.content

      return {
        id: post.id,
        title: safeTitle,
        content: safeContent,
        rating: post.rating,
        isSpoiler,
        createdAt: post.createdAt,
        posterUrl,
        user: {
          name: post.user?.name ?? null,
          image: post.user?.image ?? null,
        },
        movie: post.movie
          ? {
              id: post.movie.id,
              type: post.movie.type,
              posterPath: post.movie.posterPath,
            }
          : undefined,
        likes: post.likes,
        dislikes: post.dislikes,
        _count: { comments: post._count.comments },
      }
    })
    return (
      <div className="">
        <Header title="Reviews" subHeading='Discover top reviews' />
        <PostList
          posts={genericPosts}
          emptyText="No reviews yet. Be the first to share your thoughts!"
        />
      </div>
    )
  } catch (error) {
    console.error('Error fetching feed data:', error)
    return (
      <div className="py-6 text-center">
        <p className="text-red-400">Failed to load reviews</p>
      </div>
    )
  }
}

export default function FeedComponent() {
  return (
    <Suspense fallback={<FeedSkeleton />}>
      <div className="w-full">
        <FeedServer />
      </div>
    </Suspense>
  )
}



================================================================================
FILE: src/components/page/home/in-cinema-component.tsx
================================================================================
'use client'

import React from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../../types/media'

const InCinemaComponent = () => {
  const getYear = (item: MediaItem) => {
    return new Date(item.release_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  return (
    <CinemaList
      title="Now in Cinema"
      subHeading="Discover what's trending in cinema"
      apiUrl="/api/now-playing"
      linkPath={(id) => `/movie/${id}`}
      scrollContainerClass="cinema-scroll-container"
      showMoreLink="/cinema"
      getYear={getYear}
      getTitle={getTitle}
      showEmptyState={true}
      contentType="movie"
      showDropdown={true}
    />
  )
}

export default InCinemaComponent


================================================================================
FILE: src/components/page/home/trending-movie-component.tsx
================================================================================
'use client'

import { useState } from 'react'
import { MediaItem } from '../../../../types/media'
import CinemaList from '../../cinema-list'

const TrendingMovieComponent = () => {
  const [watchlistItems, setWatchlistItems] = useState<Set<number>>(new Set())

  const getYear = (item: MediaItem) => {
    return new Date(item.release_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  const handleWatchlistToggle = (item: MediaItem) => {
    setWatchlistItems(prev => {
      const newSet = new Set(prev)
      if (newSet.has(item.id)) {
        newSet.delete(item.id)
      } else {
        newSet.add(item.id)
      }
      return newSet
    })
  }

  const getWatchlistStatus = (item: MediaItem) => {
    return watchlistItems.has(item.id)
  }

  return (
    <CinemaList
      title="Trending Movies"
      subHeading="Discover trending movies"
      apiUrl="/api/popular-movie"
      linkPath={(id) => `/movie/${id}`}
      scrollContainerClass="trending-scroll-container"
      showMoreLink="/trending"
      getYear={getYear}
      getTitle={getTitle}
      showEmptyState={true}
      contentType="movie"
      showDropdown={true}
      onWatchlistToggle={handleWatchlistToggle}
      getWatchlistStatus={getWatchlistStatus}
    />
  )
}

export default TrendingMovieComponent



================================================================================
FILE: src/components/page/home/trending-web-series-component.tsx
================================================================================
'use client'

import React, { useState } from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../../types/media'

const TrendingWebSeriesComponent = () => {
  const [watchlistItems, setWatchlistItems] = useState<Set<number>>(new Set())

  const getYear = (item: MediaItem) => {
    return new Date(item.first_air_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  const handleWatchlistToggle = (item: MediaItem) => {
    setWatchlistItems(prev => {
      const newSet = new Set(prev)
      if (newSet.has(item.id)) {
        newSet.delete(item.id)
      } else {
        newSet.add(item.id)
      }
      return newSet
    })
  }

  const getWatchlistStatus = (item: MediaItem) => {
    return watchlistItems.has(item.id)
  }

  return (
    <CinemaList
      title="Trending Web Series"
      subHeading='Discover trending webseries'
      apiUrl="/api/trending-series"
      linkPath={(id) => `/web-series/${id}`}
      scrollContainerClass="trending-tv-scroll-container"
      showMoreLink="/trending"
      getYear={getYear}
      getTitle={getTitle}
      showEmptyState={true}
      contentType="tv_series"
      showDropdown={true}
      onWatchlistToggle={handleWatchlistToggle}
      getWatchlistStatus={getWatchlistStatus}
    />
  )
}

export default TrendingWebSeriesComponent



================================================================================
FILE: src/components/page/movie/movie-details-component.tsx
================================================================================
'use client'
import { CreatePostForm } from '@/components/forms/create-post-form'
import LogWatchingForm from '@/components/forms/log-watching-form'
import { AnimatePresence } from 'framer-motion'
import { Plus } from 'lucide-react'
import { useSession } from 'next-auth/react'
import Image from 'next/image'
import Link from 'next/link'
import { useRouter } from 'next/navigation'
import React, { useState } from 'react'
import AnimatePageWrapper from '../../animate-page-wrapper'
import { PostsSection } from '../../posts-section'
import AiRecommendationComponent from '../../ai-recommendation-component'
import MovieRecommendation from './movie-recommendation'
import MediaItemDropdown from '../../media-item-dropdown'
import { formatDate } from '@/lib'

import type { MovieDetails } from '../../../../types/tmdb'

interface MovieDetailsComponentProps {
  movie: MovieDetails | null
}

const MovieDetailsComponent: React.FC<MovieDetailsComponentProps> = ({
  movie,
}) => {
  const [showCreatePost, setShowCreatePost] = useState(false)
  const [showLogForm, setShowLogForm] = useState(false)
  const [refreshPosts, setRefreshPosts] = useState(0)
  const router = useRouter()
  const { data: session } = useSession()


  const formatRuntime = (minutes: number | null) => {
    if (!minutes) return 'N/A'
    const hours = Math.floor(minutes / 60)
    const mins = minutes % 60
    return `${hours}h ${mins}m`
  }


  const getImageUrl = (
    path: string | null,
    size: 'w500' | 'w780' | 'original' = 'w500'
  ) => {
    if (!path) return '/placeholder-movie.jpg'
    return `https://image.tmdb.org/t/p/${size}${path}`
  }

  const handleWatchlist = () => {
    if (!session) {
      router.push('/signin')
    }
    // Watchlist functionality not implemented yet
  }

    if (!movie) {
      return (
        <div className="h-full flex items-center justify-center">
          <div className="text-center">
            <h1 className="text-2xl font-bold text-white mb-2">
              Movie Not Found
            </h1>
            <p className="text-gray-300 mb-4">
              The movie you&apos;re looking for doesn&apos;t exist or has been
              removed.
            </p>
            <Link
              href="/"
              className="bg-dark-gray-hover text-white px-4 py-2 cursor-pointer"
            >
              Go back to Home
            </Link>
          </div>
        </div>
      )
    }

  const renderMobile = () => (
    <div className="md:hidden">
      <div className="flex items-start gap-4">
        <div className="w-[40%] max-w-[160px]">
          <Image
            src={getImageUrl(movie.poster_path)}
            alt={movie.title}
            height={240}
            width={160}
            className="w-full object-center"
          />
        </div>
        <div className="flex-1 text-gray-300">
          <div className="mb-2">
            <h2 className="text-2xl font-bold text-white mb-1">
              {movie.title}
            </h2>
            {movie.original_title !== movie.title && (
              <p className="text-base text-gray-200 mb-2">
                {movie.original_title}
              </p>
            )}
            {movie.tagline && (
              <p className="text-sm italic text-gray-400">
                &quot;{movie.tagline}&quot;
              </p>
            )}
          </div>
          <div className="flex flex-wrap items-center gap-3 mb-3">
            <div className="flex items-center gap-1">
              <svg
                className="w-4 h-4 text-yellow-400"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <span className="text-sm font-semibold">
                {movie.vote_average.toFixed(1)}
              </span>
              <span className="text-xs text-gray-400">
                ({movie.vote_count})
              </span>
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Runtime:</span>{' '}
              {formatRuntime(movie.runtime)}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Release:</span>{' '}
              {formatDate(movie.release_date)}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Status:</span> {movie.status}
            </div>
          </div>
          <div className="flex flex-wrap gap-2 mb-3">
            {movie.genres.map((genre) => (
              <span
                key={genre.id}
                className="px-2 py-0.5 bg-light-green/20 text-light-green text-xs font-medium border border-light-green/30"
              >
                {genre.name}
              </span>
            ))}
          </div>
          <div className="flex flex-wrap gap-2">
            <div className="relative group">
              <MediaItemDropdown
                item={{
                  id: movie.id,
                  title: movie.title,
                  poster_path: movie.poster_path,
                  release_date: movie.release_date
                }}
                contentType="movie"
                onWatchlistToggle={handleWatchlist}
                isInWatchlist={false}
                customButton={
                  <button
                    className="h-9 px-3 inline-flex items-center gap-2 text-sm bg-dark-gray-hover/80 text-gray-200 hover:text-white hover:bg-dark-gray-2 transition-colors"
                    aria-label="Create Post"
                  >
                    <Plus className="size-4" />
                    Create Post
                  </button>
                }
              />
            </div>
          </div>
        </div>
      </div>

      {/* The rest (overview, production, languages, links) under the header on small screens */}
      <div className="mt-6 text-gray-300">
        <div className="py-3">
          <h3 className="text-lg text-white font-semibold mb-2">Overview</h3>
          <p className="leading-relaxed text-sm">{movie.overview}</p>
        </div>

        <div className="grid grid-cols-1 gap-6">
          {movie.production_companies.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">
                Production Companies
              </h3>
              <div className="space-y-1 text-sm">
                {movie.production_companies.map((company) => (
                  <div key={company.id} className="flex items-center gap-2">
                    {company.logo_path && (
                      <Image
                        src={getImageUrl(company.logo_path)}
                        alt={company.name}
                        width={24}
                        height={24}
                        className="object-contain rounded"
                      />
                    )}
                    <span className="">{company.name}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          {movie.production_countries.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">
                Production Countries
              </h3>
              <div className="space-y-1 text-sm">
                {movie.production_countries.map((country) => (
                  <span key={country.iso_3166_1}>{country.name}</span>
                ))}
              </div>
            </div>
          )}

          {movie.spoken_languages.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">
                Spoken Languages
              </h3>
              <div className="space-y-1 text-sm">
                {movie.spoken_languages.map((language) => (
                  <span key={language.iso_639_1}>{language.english_name}</span>
                ))}
              </div>
            </div>
          )}
        </div>

        <div className="pt-6">
          <div className="flex gap-4">
            {movie.imdb_id && (
              <a
                href={`https://www.imdb.com/title/${movie.imdb_id}`}
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-300 hover:text-blue-400 font-medium underline-offset-4 hover:underline"
              >
                View on IMDb
              </a>
            )}
            {movie.homepage && (
              <a
                href={movie.homepage}
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-300 hover:text-blue-400 font-medium underline-offset-4 hover:underline"
              >
                Official Website
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
  )

  const renderDesktop = () => (
    <div className="hidden md:flex flex-col w-full lg:flex-row gap-8">
      {/* Poster */}
      <div className="md:sticky top-[70px] left-0 md:max-w-[20%] max-w-[50%] mx-auto w-full h-full">
        <Image
          src={getImageUrl(movie.poster_path)}
          alt={movie.title}
          height={300}
          width={300}
          className="w-full object-center"
        />
      </div>

      {/* Movie Details */}
      <div className="flex w-full">
        <div className="text-gray-300 w-full">
          {/* Title and Basic Info */}
          <div className="flex justify-between w-full">
            <div className="mb-2">
              <h1 className="text-4xl font-bold text-white mb-2">
                {movie.title}
              </h1>
              {movie.original_title !== movie.title && (
                <p className="text-xl text-white mb-4">
                  {movie.original_title}
                </p>
              )}
              {movie.tagline && (
                <p className="text-lg italic text-gray-300 mb-4">
                  &quot;{movie.tagline}&quot;
                </p>
              )}
            </div>
            <div className="relative group">
              <MediaItemDropdown
                item={{
                  id: movie.id,
                  title: movie.title,
                  poster_path: movie.poster_path,
                  release_date: movie.release_date
                }}
                contentType="movie"
                onWatchlistToggle={handleWatchlist}
                isInWatchlist={false}
                customButton={
                  <button
                    className="flex gap-1 justify-center items-center p-2 bg-dark-gray-hover text-gray-300 hover:text-white transition-all duration-300"
                    aria-label="More options"
                  >
                    <Plus className="size-5" />
                  </button>
                }
              />
            </div>
          </div>

          {/* Rating and Runtime */}
          <div className="flex flex-wrap gap-4">
            <div className="flex items-center gap-2">
              <div className="flex items-center">
                <svg
                  className="w-5 h-5 text-yellow-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                <span className="ml-1 text-lg font-semibold">
                  {movie.vote_average.toFixed(1)}
                </span>
              </div>
              <span className="">({movie.vote_count} votes)</span>
            </div>
            <div className="">
              <span className="font-medium">Runtime:</span>{' '}
              {formatRuntime(movie.runtime)}
            </div>
            <div className="">
              <span className="font-medium">Release Date:</span>{' '}
              {formatDate(movie.release_date)}
            </div>
            <div className="">
              <span className="font-medium">Status:</span> {movie.status}
            </div>
          </div>

          {/* Genres */}
          <div className="py-3">
            <h3 className="text-lg font-semibold text-white mb-2">Genres</h3>
            <div className="flex flex-wrap gap-2">
              {movie.genres.map((genre) => (
                <span
                  key={genre.id}
                  className="px-2 py-0.5 bg-light-green text-white text-xs font-medium"
                >
                  {genre.name}
                </span>
              ))}
            </div>
          </div>

          {/* Overview */}
          <div className="py-3">
            <h3 className="text-lg text-white font-semibold mb-2">Overview</h3>
            <p className="leading-relaxed text-sm">{movie.overview}</p>
          </div>

          {/* Production Details */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Production Companies */}
            {movie.production_companies.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">
                  Production Companies
                </h3>
                <div className="space-y-1 text-sm">
                  {movie.production_companies.map((company) => (
                    <div key={company.id} className="flex items-center gap-2">
                      {company.logo_path && (
                        <Image
                          src={getImageUrl(company.logo_path)}
                          alt={company.name}
                          width={24}
                          height={24}
                          className="object-contain"
                        />
                      )}
                      <span className="">{company.name}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Production Countries */}
            {movie.production_countries.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">
                  Production Countries
                </h3>
                <div className="space-y-1 text-sm">
                  {movie.production_countries.map((country) => (
                    <span key={country.iso_3166_1}>{country.name}</span>
                  ))}
                </div>
              </div>
            )}

            {/* Spoken Languages */}
            {movie.spoken_languages.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">
                  Spoken Languages
                </h3>
                <div className="space-y-1 text-sm">
                  {movie.spoken_languages.map((language) => (
                    <span key={language.iso_639_1}>
                      {language.english_name}
                    </span>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* External Links */}
          <div className="pt-6">
            <div className="flex gap-4">
              {movie.imdb_id && (
                <a
                  href={`https://www.imdb.com/title/${movie.imdb_id}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-300 hover:text-blue-400 font-medium"
                >
                  View on IMDb
                </a>
              )}
              {movie.homepage && (
                <a
                  href={movie.homepage}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-300 hover:text-blue-400 font-medium"
                >
                  Official Website
                </a>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  )



  return (
    <AnimatePageWrapper className="">
      <div className="px-4 md:px-0 py-4 ">
        {renderMobile()}
        {renderDesktop()}
      </div>
      <AiRecommendationComponent title={movie.title} />
      <MovieRecommendation id={movie.id} />

      {/* Posts Section */}
      <div className="px-4 md:px-0">
        <PostsSection
          movieId={movie.id.toString()}
          refreshTrigger={refreshPosts}
        />
      </div>

      {/* Create Post Popup */}
      <AnimatePresence mode="wait">
        {showCreatePost && (
          <CreatePostForm
            movieId={movie.id.toString()}
            movieTitle={movie.title}
            contentType="movie"
            posterPath={movie.poster_path}
            onClose={() => setShowCreatePost(false)}
            onSuccess={() => {
              setRefreshPosts((prev) => prev + 1)
            }}
          />
        )}
      </AnimatePresence>

      {/* Log Watching Form */}
      <AnimatePresence mode="wait">
        {showLogForm && movie && (
          <LogWatchingForm
            contentId={movie.id.toString()}
            contentType="movie"
            contentTitle={movie.title}
            posterPath={movie.poster_path || undefined}
            onClose={() => setShowLogForm(false)}
            onSuccess={() => {
              // Optionally refresh activity data or show success message
            }}
          />
        )}
      </AnimatePresence>
    </AnimatePageWrapper>
  )
}

export default MovieDetailsComponent



================================================================================
FILE: src/components/page/movie/movie-recommendation.tsx
================================================================================
'use client'

import React from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../../types/media'

const MovieRecommendation = ({ id }: { id: number }) => {
  const getYear = (item: MediaItem) => {
    return new Date(item.release_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  return (
    <CinemaList
      title="Recommended Movies"
      apiUrl={`/api/recommendation/movie?id=${id}&page=1`}
      linkPath={(movieId) => `/movie/${movieId}`}
      scrollContainerClass="recommendations-scroll-container"
      getYear={getYear}
      getTitle={getTitle}
      showRating={true}
      showEmptyState={true}
      contentType="movie"
      showDropdown={true}
    />
  )
}

export default MovieRecommendation



================================================================================
FILE: src/components/page/post/post-info-component.tsx
================================================================================
import React from 'react'
import Link from 'next/link'
import Image from 'next/image'
import PostActions from '@/components/post-actions'
import type { RatingEnum } from '../../../../types/post'
import { getRatingLabel, formatDateTime } from '@/lib'

interface PostInfoProps {
  post: {
    id: string
    title: string | null
    content: string
    rating: RatingEnum | null
    isSpoiler: boolean
    createdAt: Date
    user: {
      id: string
      name: string | null
      username: string | null
      image: string | null
    } | null
    movie: {
      id: string
      type: string
      posterPath: string | null
    } | null
  }
  posterUrl: string | null
  likesCount: number
  dislikesCount: number
  commentsCount: number
  isLoggedIn: boolean
  userLiked: boolean
  userDisliked: boolean
}

const PostInfo: React.FC<PostInfoProps> = ({
  post,
  posterUrl,
  likesCount,
  dislikesCount,
  commentsCount,
  isLoggedIn,
  userLiked,
  userDisliked
}) => {


  return (
    <div className="flex flex-col md:flex-row gap-6 items-start">
      {posterUrl && (
        <div className="md:w-60 max-w-40 w-full md:flex-shrink-0">
          <Image
            src={posterUrl}
            alt={post.title ?? 'Poster'}
            width={240}
            height={360}
            className="w-full h-auto object-cover border border-dark-gray"
          />
        </div>
      )}

      <div className="flex-1">
        <div className="mb-4">
          <div className="flex items-center gap-3 mb-2">
            {/* User Avatar */}
            <div className="size-8 rounded-full bg-light-green flex items-center justify-center overflow-hidden">
              {post.user?.image ? (
                <Image
                  src={post.user.image}
                  alt={post.user.name || 'User'}
                  width={32}
                  height={32}
                  unoptimized={post.user.image.includes('dicebear')}
                  className="w-full h-full object-cover"
                />
              ) : (
                <span className="text-gray-400 text-sm font-medium">
                  {post.user?.name?.charAt(0).toUpperCase() || 'U'}
                </span>
              )}
            </div>

            <div className="flex flex-col">
              <div className="flex flex-col text-xs text-gray-300">
                <p className="font-medium text-sm">
                  {post.user?.name || 'Anonymous'}
                </p>
                <Link
                  href={`/u/${post.user?.username}`}
                  className="font-medium hover:text-light-green transition-colors"
                >
                  {'@' + post.user?.username || '@anonymous'}
                </Link>
              </div>
            </div>
          </div>

          {post.title && (
            <h1 className="text-2xl text-white font-semibold mt-1">
              {post.title}
            </h1>
          )}

          {post.rating != null && (
            <div className="mt-2 text-gray-300 flex items-center gap-1">
              <span className="text-xs bg-dark-gray-2 px-2 py-0.5">
                {getRatingLabel(post.rating)}
              </span>
              <div className="text-xs bg-dark-gray-2 px-2 py-0.5">
                <span>{post.movie?.type}</span>
              </div>
              {post.isSpoiler && (
                <div className="ml-2 h-full rounded-full flex bg-orange-500 items-center gap-1 text-white px-2 text-xs">
                  <span>has spoiler</span>
                </div>
              )}
            </div>
          )}
        </div>

        <div className="text-gray-300 leading-relaxed whitespace-pre-wrap">
          {post.content}
        </div>

        <span className="text-xs text-gray-400">
          {formatDateTime(post.createdAt)}
        </span>

        <PostActions
          postId={post.id}
          likesCount={likesCount}
          dislikesCount={dislikesCount}
          commentsCount={commentsCount}
          isLoggedIn={isLoggedIn}
          userLiked={userLiked}
          userDisliked={userDisliked}
        />
      </div>
    </div>
  )
}

export default PostInfo



================================================================================
FILE: src/components/page/profile/user-profile-tab-section.tsx
================================================================================
'use client'
import React from 'react'
import { useRouter, usePathname } from 'next/navigation'

const sections = ['profile', 'watchlist', 'lists', 'reviews', 'notifications']

const UserProfileTabSection = () => {
  const router = useRouter()
  const pathname = usePathname()

  const currentTab = pathname.split('/').pop() || 'profile'

  const handleTabClick = (section: string) => {
    if (section === 'profile') {
      router.push('/profile')
    } else {
      router.push(`/profile/${section}`)
    }
  }

  return (
    <div className="w-full py-6 scrollbar-hide overflow-x-scroll">
      <div className="flex text-gray-300 text-lg">
        {sections.map((section, index) => {
          const isActive =
            (section === 'profile' && currentTab === 'profile') ||
            (section !== 'profile' && currentTab === section)

          return (
            <button
              key={index + section}
              onClick={() => handleTabClick(section)}
              className={`px-5 py-1 cursor-pointer transition-colors capitalize ${
                isActive ? 'bg-light-green text-white' : 'hover:bg-dark-gray-hover'
              }`}
            >
              {section}
            </button>
          )
        })}
      </div>
    </div>
  )
}

export default UserProfileTabSection



================================================================================
FILE: src/components/page/search/index.ts
================================================================================
export { default as UserSearchResults } from './user-search-results'
export { default as MovieSearchResults } from './movie-search-results'
export { default as TVSearchResults } from './tv-search-results'
export { default as SearchResultsWrapper } from './search-results-wrapper'



================================================================================
FILE: src/components/page/search/movie-search-results.tsx
================================================================================
import Loader from '@/components/ui/loader'
import Image from 'next/image'
import Link from 'next/link'

interface Movie {
  id: number
  title: string
  overview: string
  poster_path: string | null
  release_date: string
  vote_average: number
}

interface MovieSearchResultsProps {
  movies: Movie[]
  query: string
  isLoading?: boolean
}

const MovieSearchResults = ({ movies, query, isLoading = false }: MovieSearchResultsProps) => {

  const renderContent = () => {
    if (isLoading) {
      return (
        <div className="flex items-center justify-center p-5 ">
          <Loader text={`Searching ${query}`} />
        </div>
      )
    }

    if (movies.length === 0) {
      return (
        <p className="text-gray-400 text-sm">
          No movies related to &apos;{query}&apos; found
        </p>
      )
    }

    return (
      <div className="flex flex-col gap-1">
        {movies.map((movie) => (
          <Link href={`/movie/${movie.id}`} key={movie.id} className="flex gap-3 hover:bg-dark-gray-hover transition-colors cursor-pointer group">
            <div className="relative w-20 h-32 flex-shrink-0">
              <Image
                src={movie.poster_path
                  ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`
                  : '/placeholder-movie.jpg'
                }
                alt={movie.title}
                fill
                className="object-cover"
              />
            </div>
            <div className="flex-1 min-w-0 p-2">
              <h3 className="font-medium text-white mb-1 group-hover:text-gray-200 transition-colors line-clamp-1">
                {movie.title}
              </h3>
              <p className="text-gray-400 text-sm mb-2 line-clamp-2 leading-relaxed">
                {movie.overview}
              </p>
              <div className="flex items-center gap-4 text-xs text-gray-500">
                <span>{movie.release_date?.split('-')[0] || 'N/A'}</span>
                <span className="text-yellow-400">â˜… {movie.vote_average.toFixed(1)}</span>
              </div>
            </div>
          </Link>
        ))}
      </div>
    )
  }

  return (
    <div className="w-full">
      <h2 className="text-xl font-medium py-4">Movies related to &apos;{query}&apos;</h2>
      {renderContent()}
    </div>
  )
}

export default MovieSearchResults



================================================================================
FILE: src/components/page/search/search-results-wrapper.tsx
================================================================================
'use client'

import React, { useCallback, useEffect, useLayoutEffect, useRef, useState } from 'react'
import { useRouter, useSearchParams } from 'next/navigation'
import { motion } from 'framer-motion'
import MovieSearchResults from './movie-search-results'
import TVSearchResults from './tv-search-results'
import UserSearchResults from './user-search-results'
import { type Movie, type TVShow } from '@/app/(user)/search/tmdb-actions'
import { type SearchUserResult } from '@/app/(user)/search/action'

interface SearchResultsWrapperProps {
  movies: Movie[]
  tvShows: TVShow[]
  users: SearchUserResult[]
  query: string
  activeTab: 'movies' | 'shows' | 'users'
}

const SearchResultsWrapper = ({
  movies,
  tvShows,
  users,
  query,
  activeTab,
}: SearchResultsWrapperProps) => {
  const router = useRouter()
  const searchParams = useSearchParams()
  const containerRef = useRef<HTMLDivElement | null>(null)

  const handleTabChange = (tab: 'movies' | 'shows' | 'users') => {
    const params = new URLSearchParams(searchParams.toString())
    params.set('tab', tab)
    router.push(`/search?${params.toString()}`)
  }
  const movieBtnRef = useRef<HTMLButtonElement | null>(null)
  const tvBtnRef = useRef<HTMLButtonElement | null>(null)
  const userBtnRef = useRef<HTMLButtonElement | null>(null)
  const [indicator, setIndicator] = useState<{ left: number; width: number }>({
    left: 0,
    width: 0,
  })

  const updateIndicator = useCallback(() => {
    let target: HTMLButtonElement | null = null
    if (activeTab === 'movies') target = movieBtnRef.current
    else if (activeTab === 'shows') target = tvBtnRef.current
    else if (activeTab === 'users') target = userBtnRef.current

    const container = containerRef.current
    if (!target || !container) return

    const targetRect = target.getBoundingClientRect()
    const containerRect = container.getBoundingClientRect()
    const left = targetRect.left - containerRect.left
    const width = targetRect.width

    setIndicator({ left, width })
  }, [activeTab])

  useLayoutEffect(() => {
    updateIndicator()
  }, [updateIndicator])

  useEffect(() => {
    const onResize = () => updateIndicator()
    window.addEventListener('resize', onResize)
    return () => window.removeEventListener('resize', onResize)
  }, [updateIndicator])

  return (
    <div className="flex-1 px-2 md:px-0">
      <div className="flex flex-col gap-4">
        <div className="flex flex-col">
          <div ref={containerRef} className="relative flex items-center gap-4 text-gray-300">
            <button
              type="button"
              name='movies'
              ref={movieBtnRef}
              onClick={() => handleTabChange('movies')}
              className={'py-2 text-sm md:text-base transition-colors ' + `${activeTab==="movies" ? "text-white" : "text-gray-300"}`}
              aria-selected={activeTab === 'movies'}
              role="tab"
              >
              Movies
            </button>
            <button
              name='web-series'
              type="button"
              ref={tvBtnRef}
              onClick={() => handleTabChange('shows')}
              className={'py-2 text-sm md:text-base transition-colors ' + `${activeTab==="shows" ? "text-white" : "text-gray-300"}`}
              aria-selected={activeTab === 'shows'}
              role="tab"
            >
              TV Shows
            </button>
            <button
              name='users'
              type="button"
              ref={userBtnRef}
              onClick={() => handleTabChange('users')}
              className={'py-2 text-sm md:text-base transition-colors md:hidden ' + `${activeTab==="users" ? "text-white" : "text-gray-300"}`}
              aria-selected={activeTab === 'users'}
              role="tab"
            >
              Users
            </button>
            <motion.div
              aria-hidden
              className="pointer-events-none absolute -bottom-[2px] h-1 bg-gray-300"
              initial={false}
              animate={{
                left: indicator.left,
                width: indicator.width,
              }}
              transition={{
                type: "spring",
                stiffness: 300,
                damping: 30,
                mass: 0.8,
              }}
            />
          </div>
        </div>

        {activeTab === 'movies' && <MovieSearchResults movies={movies} query={query} />}
        {activeTab === 'shows' && <TVSearchResults tvShows={tvShows} query={query} />}
        {activeTab === 'users' && <UserSearchResults users={users} query={query} />}
      </div>
    </div>
  )
}

export default SearchResultsWrapper



================================================================================
FILE: src/components/page/search/tv-search-results.tsx
================================================================================
import React from 'react'
import Image from 'next/image'
import Link from 'next/link'
import Loader from '@/components/ui/loader'

interface TVShow {
  id: number
  name: string
  overview: string
  poster_path: string | null
  first_air_date: string
  vote_average: number
}

interface TVSearchResultsProps {
  tvShows: TVShow[]
  query: string
  isLoading?: boolean
}

const TVSearchResults = ({
  tvShows,
  query,
  isLoading = false,
}: TVSearchResultsProps) => {
  const renderContent = () => {
    if (isLoading) {
      return (
        <div className="flex items-center justify-center p-5 ">
          <Loader text={`Searching ${query}`} />
        </div>
      )
    }

    if (tvShows.length === 0) {
      return (
        <p className="text-gray-400 text-sm">
          No TV shows related to &apos;{query}&apos; found
        </p>
      )
    }

    return (
      <div className="flex flex-col gap-1">
        {tvShows.map((show) => (
          <Link
            href={`/web-series/${show.id}`}
            key={show.id}
            className="flex gap-3 hover:bg-dark-gray-hover transition-colors cursor-pointer group"
          >
            <div className="relative w-20 h-32 flex-shrink-0">
              <Image
                src={
                  show.poster_path
                    ? `https://image.tmdb.org/t/p/w500${show.poster_path}`
                    : '/placeholder-tv.jpg'
                }
                alt={show.name}
                fill
                className="object-cover"
              />
            </div>
            <div className="flex-1 min-w-0 p-2">
              <h3 className="font-medium text-white mb-1 group-hover:text-gray-200 transition-colors line-clamp-1">
                {show.name}
              </h3>
              <p className="text-gray-400 text-sm mb-2 line-clamp-2 leading-relaxed">
                {show.overview}
              </p>
              <div className="flex items-center gap-4 text-xs text-gray-500">
                <span>{show.first_air_date?.split('-')[0] || 'N/A'}</span>
                <span className="text-yellow-400">
                  â˜… {show.vote_average.toFixed(1)}
                </span>
              </div>
            </div>
          </Link>
        ))}
      </div>
    )
  }

  return (
    <div className="w-full">
      <h2 className="text-xl font-medium py-4">
        TV Shows related to &apos;{query}&apos;
      </h2>
      {renderContent()}
    </div>
  )
}

export default TVSearchResults



================================================================================
FILE: src/components/page/search/user-search-results.tsx
================================================================================
"use client"
import React from 'react'
import Image from 'next/image'
import { type SearchUserResult } from '@/app/(user)/search/action'
import Link from 'next/link'

interface UserSearchResultsProps {
  users: SearchUserResult[]
  query: string
}

const UserSearchResults = ({ users, query }: UserSearchResultsProps) => {
  if (users.length === 0) {
    return (
      <div className="w-[30%] px-2 md:px-4">
        <h1 className="text-lg font-medium mb-4">Users related to &apos;{query}&apos;</h1>
        <p className="text-gray-400 text-sm">No users found</p>
      </div>
    )
  }

  return (
    <div className="w-full md:px-4 px-2">
      <h1 className="text-xl font-medium mb-4">Users related to &apos;{query}&apos;</h1>
      <div className='flex flex-col gap-1 py-4'>
        {users.map((user, index) => {
          return (
            <Link
              href={`/u/${user.username}`}
              key={index + user.id}
              className="hover:bg-dark-gray-hover p-3 cursor-pointer py-2  transition-colors"
            >
              <div className="flex gap-2 bg-light items-center">
                <Image
                  className="rounded-full bg-light-green"
                  src={user.image}
                  alt="user image"
                  width={48}
                  height={48}
                  unoptimized={user.image.includes("dicebear")}
                />
                <div>
                  <h1 className="font-medium">{user.name}</h1>
                  <p className="text-xs text-gray-400">{user.email}</p>
                </div>
              </div>
            </Link>
          )
        })}
      </div>
    </div>
  )
}

export default UserSearchResults



================================================================================
FILE: src/components/page/trending/right-sidebar.tsx
================================================================================
'use client'

import { TrendingItem } from '../../../../types/trending'
import Link from 'next/link'
import { useMemo } from 'react'
import { useQuery } from '@tanstack/react-query'
import { getMediaReleaseYear, getMediaTitle } from '@/lib'

const RightSidebar = () => {
  const { data, isLoading } = useQuery({
    queryKey: ['trending', 'sidebar', 'day'],
    queryFn: async () => {
      const [moviesResponse, tvResponse] = await Promise.all([
        fetch('/api/trending-movie?time_window=day', { method: 'GET' }),
        fetch('/api/trending-series?time_window=day', { method: 'GET' }),
      ])
      const [moviesData, tvData] = await Promise.all([
        moviesResponse.json(),
        tvResponse.json(),
      ])
      return {
        movies: (moviesData?.results ?? []).slice(0, 5) as TrendingItem[],
        tv: (tvData?.results ?? []).slice(0, 5) as TrendingItem[],
      }
    },
  })

  const trendingMovies = useMemo(() => data?.movies ?? [], [data])
  const trendingTV = useMemo(() => data?.tv ?? [], [data])

  return (
    <div className="flex max-md:hidden md:w-[30%] sticky top-20 right-0 flex-col gap-2 h-fit">
      <div className="py-8">
        {/* Trending Movies Section */}
        <div className="mb-8">
          <h1 className="text-gray-300 font-light text-xl pb-6">
            Trending movies
          </h1>
          <div className="flex flex-col gap-2">
            {isLoading ? (
              <MoviesSkeleton />
            ) : (
              trendingMovies.map((item, index) => (
                <Link
                  key={item.id}
                  className="flex text-gray-400 gap-5 mb-4 hover:drop-shadow-md group"
                  href={`/movie/${item.id}`}
                >
                  <h1 className="text-5xl font-extrabold group-hover:text-light-green text-white transition-all duration-500">
                    0{index + 1}
                  </h1>
                  <div>
                    <div className="flex flex-col items-start justify-center text-dark-grey">
                      <p className="line-clamp-1 group-hover:text-white">
                        {getMediaTitle(item)}
                      </p>
                      <p className="min-w-fit text-xs">
                        {getMediaReleaseYear(item)}
                      </p>
                    </div>
                  </div>
                </Link>
              ))
            )}
          </div>
        </div>

        {/* Trending TV Shows Section */}
        <div className="w-full">
          <h1 className="text-gray-300 font-light text-xl pb-6">
            Trending TV shows
          </h1>
          <div className="flex flex-col gap-2 w-full">
            {isLoading ? (
              <TVSkeleton />
            ) : (
              trendingTV.map((item, index) => (
                <Link
                  key={item.id}
                  className="flex text-gray-400 gap-5 mb-4 hover:drop-shadow-md group"
                  href={`/web-series/${item.id}`}
                >
                  <h1 className="text-5xl font-extrabold group-hover:text-light-green text-white transition-all duration-500">
                    0{index + 1}
                  </h1>
                  <div>
                    <div className="flex flex-col items-start justify-center text-dark-grey">
                      <p className="line-clamp-1 group-hover:text-white">
                        {getMediaTitle(item)}
                      </p>
                      <p className="min-w-fit text-xs">
                        {getMediaReleaseYear(item)}
                      </p>
                    </div>
                  </div>
                </Link>
              ))
            )}
          </div>
        </div>
      </div>
    </div>
  )
}

const TVSkeleton = () => (
  <div className="flex flex-col gap-2 w-full">
    {[1, 2, 3, 4, 5].map((index) => (
      <div
        key={`tv-skel-${index}`}
        className="w-full flex text-gray-400 gap-5 mb-4"
      >
        <h1 className="text-5xl font-extrabold text-dark-gray-2">0{index}</h1>
        <div>
          <div className="flex flex-col items-start justify-center text-dark-grey">
            <div className="w-24 h-4 bg-dark-gray-2 rounded animate-pulse"></div>
            <div className="w-16 h-3 bg-dark-gray-2 rounded animate-pulse mt-2"></div>
          </div>
        </div>
      </div>
    ))}
  </div>
)
const MoviesSkeleton = () => (
  <div className="flex flex-col gap-2">
    {[1, 2, 3, 4, 5].map((index) => (
      <div
        key={`movie-skel-${index}`}
        className="flex text-gray-400 gap-5 mb-4"
      >
        <h1 className="text-5xl font-extrabold text-dark-gray-2">0{index}</h1>
        <div>
          <div className="flex flex-col items-start justify-center text-dark-grey">
            <div className="w-24 h-4 bg-dark-gray-2 rounded animate-pulse"></div>
            <div className="w-16 h-3 bg-dark-gray-2 rounded animate-pulse mt-2"></div>
          </div>
        </div>
      </div>
    ))}
  </div>
)

export default RightSidebar



================================================================================
FILE: src/components/page/trending/trending-list-component.tsx
================================================================================
'use client'
import { TrendingItem } from '../../../../types/trending'
import { Calendar, ChevronDown, Star } from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import { useCallback } from 'react'
import Loader from '../../ui/loader'
import { motion, type Variants } from 'framer-motion'
import { getMediaTitle, getMediaReleaseYear } from '@/lib'
import { useInfiniteQuery } from '@tanstack/react-query'

// Skeleton component for loading state
const Skeleton = () => (
  <div className="flex flex-col gap-2">
    {Array.from({ length: 10 }).map((_, index) => (
      <div key={index + 'skeleton'} className="animate-pulse">
        <div className="flex bg-dark-gray-2">
          {/* Poster Skeleton */}
          <div className="relative max-md:h-60 w-40 aspect-square md:h-52 flex-shrink-0">
            <div className="absolute inset-0 bg-dark-gray-hover" />
          </div>

          {/* Content Skeleton */}
          <div className="flex-1 p-6">
            <div className="flex items-start justify-between mb-3">
              <div className="flex max-md:flex-col md:items-center gap-4">
                <div className="w-8 h-8 bg-dark-gray rounded"></div>
                <div className="h-6 w-48 bg-dark-gray rounded"></div>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-5 h-5 bg-dark-gray rounded"></div>
                <div className="h-4 w-8 bg-dark-gray rounded"></div>
              </div>
            </div>

            <div className="space-y-2 mb-4">
              <div className="h-4 bg-dark-gray rounded w-full"></div>
              <div className="h-4 bg-dark-gray rounded w-4/5"></div>
              <div className="h-4 bg-dark-gray rounded w-3/5"></div>
            </div>

            <div className="flex items-center gap-6">
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 bg-dark-gray rounded"></div>
                <div className="h-4 w-12 bg-dark-gray rounded"></div>
              </div>
              <div className="h-4 w-16 bg-dark-gray rounded"></div>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>
)

const TrendingListComponent = () => {
  const {
    data,
    isLoading,
    isError,
    error,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
  } = useInfiniteQuery({
    queryKey: ['trending-all', 'day'],
    initialPageParam: 1,
    queryFn: async ({ pageParam }) => {
      const page = Number(pageParam) || 1
      const url = `/api/trending-all?page=${page}&time_window=day`
      const res = await fetch(url, { method: 'GET' })
      if (!res.ok) throw new Error('Failed to load trending items')
      return res.json() as Promise<{ results: TrendingItem[]; total_pages: number }>
    },
    getNextPageParam: (lastPage, allPages) => {
      const next = allPages.length + 1
      return next <= (lastPage?.total_pages ?? 0) ? next : undefined
    },
  })

  const trendingItems: TrendingItem[] = (data?.pages ?? []).flatMap(
    (p) => p?.results ?? [],
  )

  //Animations
  const containerVariants: Variants = {
    hidden: { opacity: 1 },
    show: {
      opacity: 1,
      transition: {
        staggerChildren: 0.08,
        delayChildren: 0.1,
      },
    },
  }
  const itemVariants: Variants = {
    hidden: { opacity: 0, y: 20 },
    show: {
      opacity: 1,
      y: 0,
      transition: { type: 'spring' as const, stiffness: 120, damping: 16 },
    },
  }

  const handleLoadMore = useCallback(() => {
    if (hasNextPage && !isFetchingNextPage) {
      void fetchNextPage()
    }
  }, [fetchNextPage, hasNextPage, isFetchingNextPage])

  const getTitle = (item: TrendingItem) => getMediaTitle(item)
  const getReleaseYear = (item: TrendingItem) => getMediaReleaseYear(item)

  if (isError) {
    return (
      <div className="w-full flex items-center justify-center py-20">
        <div className="text-red-400 text-center">
          <h2 className="text-xl mb-2">Error Loading Trending Content</h2>
          <p>{error instanceof Error ? error.message : String(error ?? 'Something went wrong')}</p>
        </div>
      </div>
    )
  }

  return (
    <div className="w-full">
      {/* Show skeleton for initial loading */}
      {isLoading ? (
        <Skeleton />
      ) : (
        <>
          {/* Trending List */}
          <motion.div
            variants={containerVariants}
            initial="hidden"
            animate="show"
            className="flex flex-col"
          >
            {trendingItems.map((item, index) => (
              <motion.div key={item.id + index} variants={itemVariants}>
                <Link
                  href={
                    item.media_type === 'movie'
                      ? `/movie/${item.id}`
                      : `/web-series/${item.id}`
                  }
                  className="group w-full transition-all duration-300 cursor-pointer"
                >
                  <div className="flex border-b border-dark-gray-2 hover:bg-dark-gray-2">
                    {/* Poster Image */}
                    <div className="relative max-md:h-60 w-40 aspect-square md:h-52 flex-shrink-0">
                      {item.poster_path ? (
                        <Image
                          src={`https://image.tmdb.org/t/p/w500${item.poster_path}`}
                          alt={getTitle(item)}
                          fill
                          className="object-center"
                        />
                      ) : (
                        <div className="w-full h-full bg-dark-gray flex items-center justify-center">
                          <div className="text-center text-gray-400">
                            <div className="w-16 h-24 mb-2 mx-auto bg-dark-gray-2 rounded"></div>
                            <p className="text-sm">No Image</p>
                          </div>
                        </div>
                      )}

                      {/* Media Type Badge */}
                      <div className="absolute top-2 left-2">
                        <span
                          className={`px-2 py-1 text-xs font-medium ${
                            item.media_type === 'movie'
                              ? 'bg-light-green text-white'
                              : 'bg-blue-600 text-white'
                          }`}
                        >
                          {item.media_type === 'movie' ? 'Movie' : 'TV'}
                        </span>
                      </div>
                    </div>

                    {/* Content Info */}
                    <div className="flex-1 p-6">
                      <div className="flex items-start justify-between mb-3">
                        <div className="flex max-md:flex-col md:items-center gap-4">
                          <span className="text-4xl font-extrabold text-gray-300 group-hover:text-light-green transition-colors">
                            #{index + 1}
                          </span>
                          <h3 className="text-xl text-gray-300 font-medium group-hover:text-white transition-colors">
                            {getTitle(item)}
                          </h3>
                        </div>
                        <div className="flex items-center gap-2">
                          <Star className="w-5 h-5 fill-light-green text-light-green" />
                          <span className="text-gray-300 font-medium">
                            {item?.vote_average?.toFixed(1)}
                          </span>
                        </div>
                      </div>

                      <p className="text-gray-400 text-sm mb-4 line-clamp-3 leading-relaxed">
                        {item.overview || 'No description available'}
                      </p>

                      <div className="flex items-center gap-6 text-sm text-gray-500">
                        <div className="flex items-center gap-2">
                          <Calendar className="w-4 h-4" />
                          <span>{getReleaseYear(item)}</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <span className="capitalize">{item.media_type}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </Link>
              </motion.div>
            ))}
          </motion.div>

          {/* Load More Button */}
          {hasNextPage && (
            <div className="mt-8 flex items-center justify-center">
              <button
                onClick={handleLoadMore}
                disabled={isFetchingNextPage}
                className={`px-4 py-2 text-gray-200 transition disabled:opacity-60 disabled:cursor-not-allowed`}
              >
                {isFetchingNextPage ? (
                  <Loader />
                ) : (
                  <div className="flex gap-1 items-center cursor-pointer">
                    Load more
                    <ChevronDown className="size-5" />
                  </div>
                )}
              </button>
            </div>
          )}
        </>
      )}
    </div>
  )
}

export default TrendingListComponent



================================================================================
FILE: src/components/page/tv-series/series-recommendation.tsx
================================================================================
'use client'

import React from 'react'
import CinemaList from '../../cinema-list'
import { MediaItem } from '../../../../types/media'

const SeriesRecommendation = ({ id }: { id: number }) => {
  const getYear = (item: MediaItem) => {
    return new Date(item.first_air_date || '').getFullYear()
  }

  const getTitle = (item: MediaItem) => {
    return item.title || item.name || 'Unknown'
  }

  return (
    <CinemaList
      title="Recommended Series"
      apiUrl={`/api/recommendation/series?id=${id}&page=1`}
      linkPath={(seriesId) => `/web-series/${seriesId}`}
      scrollContainerClass="recommendations-scroll-container"
      getYear={getYear}
      getTitle={getTitle}
      showRating={true}
      showEmptyState={true}
      contentType="tv_series"
      showDropdown={true}
    />
  )
}

export default SeriesRecommendation


================================================================================
FILE: src/components/page/tv-series/tv-series-client.tsx
================================================================================
'use client'

import { useQuery } from '@tanstack/react-query'
import TVSeriesDetailsComponent from './tv-series-details-component'
import Link from 'next/link'
import Loader from '@/components/ui/loader'

interface TVSeriesClientProps {
  seriesId: string
}

const TVSeriesClient: React.FC<TVSeriesClientProps> = ({ seriesId }) => {
  const base = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'

  const {
    data: series,
    isLoading,
    error,
  } = useQuery({
    queryKey: ['tv-series', seriesId],
    queryFn: async () => {
      const url = `${base}/api/tmdb/series?id=${encodeURIComponent(seriesId)}`
      const res = await fetch(url, { cache: 'no-store' })

      if (!res.ok) {
        throw new Error('Failed to fetch series details')
      }

      return res.json()
    },
    staleTime: 5 * 60 * 1000,
    retry: 2,
  })

  if (isLoading) {
    return (
      <div className="flex h-full items-center justify-center">
        <Loader text={`Loading ${seriesId} series details...`} size='lg' />
      </div>
    )
  }
  else if(error || !series) {
    return (
      <div className="h-full flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-white mb-2">
            Series with id{' '}
            <span className="text-light-green">&apos;{seriesId}&apos;</span> Not
            Found
          </h1>
          <p className="text-gray-300 mb-4">
            The series you&apos;re looking for doesn&apos;t exist or has been
            removed.
          </p>
          <Link
            href="/"
            className="bg-dark-gray-hover text-white px-4 py-2 cursor-pointer"
          >
            Go back to Home
          </Link>
        </div>
      </div>
    )
  }
  return <TVSeriesDetailsComponent series={series} />
}

export default TVSeriesClient



================================================================================
FILE: src/components/page/tv-series/tv-series-details-component.tsx
================================================================================
'use client'
import Image from 'next/image'
import React, { useState } from 'react'
import { CreatePostForm } from '@/components/forms/create-post-form'
import LogWatchingForm from '@/components/forms/log-watching-form'
import { PostsSection } from '@/components/posts-section'
import { AnimatePresence } from 'framer-motion'
import AnimatePageWrapper from '../../animate-page-wrapper'
import { Plus } from 'lucide-react'
import SeriesRecommendation from './series-recommendation'
import { useSession } from 'next-auth/react'
import { useRouter } from 'next/navigation'
import { formatDate } from '@/lib'
import MediaItemDropdown from '../../media-item-dropdown'
import type { TVSeriesDetails } from '../../../../types/tmdb'

interface TVSeriesDetailsComponentProps {
  series: TVSeriesDetails
}

const TVSeriesDetailsComponent: React.FC<TVSeriesDetailsComponentProps> = ({
  series,
}) => {
  const [showCreatePost, setShowCreatePost] = useState(false)
  const [showLogForm, setShowLogForm] = useState(false)
  const [refreshPosts, setRefreshPosts] = useState(0)
  const router = useRouter()
  const { data: session } = useSession()



  const getImageUrl = (
    path: string | null,
    size: 'w500' | 'w780' | 'original' = 'w500'
  ) => {
    if (!path) return '/placeholder-tv.jpg'
    return `https://image.tmdb.org/t/p/${size}${path}`
  }

  const formatEpisodeRuntime = (runtime: number[]) => {
    if (!runtime || runtime.length === 0) return 'N/A'
    const avgRuntime =
      runtime.reduce((sum, time) => sum + time, 0) / runtime.length
    return `${Math.round(avgRuntime)} min`
  }

  const handleWatchlist = () => {
    if (!session) {
      router.push('/signin')
      return
    }
    // TODO: Implement watchlist functionality
    console.log('Add to watchlist:', series.name)
  }

  const renderMobile = () => (
    <div className="md:hidden">
      <div className="flex items-start gap-4">
        <div className="w-[40%] max-w-[160px]">
          <Image
            src={getImageUrl(series.poster_path)}
            alt={series.name}
            height={240}
            width={160}
            className="w-full object-center"
          />
        </div>
        <div className="flex-1 text-gray-300">
          <div className="mb-2">
            <h2 className="text-2xl font-bold text-white mb-1">{series.name}</h2>
            {series.original_name !== series.name && (
              <p className="text-base text-gray-200 mb-2">{series.original_name}</p>
            )}
            {series.tagline && (
              <p className="text-sm italic text-gray-400">
                &quot;{series.tagline}&quot;
              </p>
            )}
          </div>
          <div className="flex flex-wrap items-center gap-3 mb-3">
            <div className="flex items-center gap-1">
              <svg className="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <span className="text-sm font-semibold">{series.vote_average.toFixed(1)}</span>
              <span className="text-xs text-gray-400">({series.vote_count})</span>
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Episodes:</span> {series.number_of_episodes}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Seasons:</span> {series.number_of_seasons}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Episode Runtime:</span> {formatEpisodeRuntime(series.episode_run_time)}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">First Air:</span> {formatDate(series.first_air_date)}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Status:</span> {series.status}
            </div>
            <div className="text-xs uppercase tracking-wide text-gray-400">
              <span className="text-gray-300">Type:</span> {series.type}
            </div>
          </div>
          <div className="flex flex-wrap gap-2 mb-3">
            {series.genres.map((genre) => (
              <span
                key={genre.id}
                className="px-2 py-0.5 bg-light-green/20 text-light-green text-xs font-medium border border-light-green/30"
              >
                {genre.name}
              </span>
            ))}
          </div>
          <div className="flex flex-wrap gap-2">
            <div className="relative group">
              <MediaItemDropdown
                item={{
                  id: series.id,
                  title: series.name,
                  poster_path: series.poster_path,
                  release_date: series.first_air_date
                }}
                contentType="tv_series"
                onWatchlistToggle={handleWatchlist}
                isInWatchlist={false}
                customButton={
                  <button
                    className="h-9 px-3 inline-flex items-center gap-2 text-sm bg-dark-gray-hover/80 text-gray-200 hover:text-white hover:bg-dark-gray-2 transition-colors"
                    aria-label="Create Post"
                  >
                    <Plus className="size-4" />
                    Create Post
                  </button>
                }
              />
            </div>
          </div>
        </div>
      </div>

      {/* Overview and details */}
      <div className="mt-6 text-gray-300">
        <div className="py-3">
          <h3 className="text-lg text-white font-semibold mb-2">Overview</h3>
          <p className="leading-relaxed text-sm">{series.overview}</p>
        </div>

        {/* Created By */}
        {series.created_by.length > 0 && (
          <div className="py-3">
            <h3 className="text-lg text-white font-semibold mb-2">Created By</h3>
            <div className="flex flex-wrap gap-2">
              {series.created_by.map((creator) => (
                <span key={creator.id} className="">{creator.name}</span>
              ))}
            </div>
          </div>
        )}

        {/* Networks */}
        {series.networks.length > 0 && (
          <div className="py-3">
            <h3 className="text-lg text-white font-semibold mb-2">Networks</h3>
            <div className="flex flex-wrap gap-4">
              {series.networks.map((network) => (
                <div key={network.id} className="flex items-center gap-2">
                  {network.logo_path && (
                    <Image
                      src={getImageUrl(network.logo_path)}
                      alt={network.name}
                      width={32}
                      height={32}
                      className="object-contain"
                    />
                  )}
                  <span className="">{network.name}</span>
                </div>
              ))}
            </div>
          </div>
        )}

        <div className="grid grid-cols-1 gap-6">
          {series.production_companies.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">Production Companies</h3>
              <div className="space-y-1 text-sm">
                {series.production_companies.map((company) => (
                  <div key={company.id} className="flex items-center gap-2">
                    {company.logo_path && (
                      <Image
                        src={getImageUrl(company.logo_path)}
                        alt={company.name}
                        width={24}
                        height={24}
                        className="object-contain rounded"
                      />
                    )}
                    <span className="">{company.name}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          {series.production_countries.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">Production Countries</h3>
              <div className="space-y-1 text-sm">
                {series.production_countries.map((country) => (
                  <span key={country.iso_3166_1}>{country.name}</span>
                ))}
              </div>
            </div>
          )}

          {series.spoken_languages.length > 0 && (
            <div>
              <h3 className="text-lg text-white font-semibold mb-2">Spoken Languages</h3>
              <div className="space-y-1 text-sm">
                {series.spoken_languages.map((language) => (
                  <span key={language.iso_639_1}>{language.english_name}</span>
                ))}
              </div>
            </div>
          )}
        </div>

        {/* External Links */}
        <div className="pt-6">
          <div className="flex gap-4">
            {series.homepage && (
              <a
                href={series.homepage}
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-300 hover:text-blue-400 font-medium underline-offset-4 hover:underline"
              >
                Official Website
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
  )

  const renderDesktop = () => (
    <div className="hidden md:flex flex-col w-full lg:flex-row gap-8">
      {/* Poster */}
      <div className="sticky top-[70px] left-0 md:max-w-[20%] max-w-[40%] w-full h-full">
        <Image
          src={getImageUrl(series.poster_path)}
          alt={series.name}
          height={300}
          width={300}
          className="w-full"
        />
      </div>

      {/* TV Series Details */}
      <div className="flex">
        <div className="text-gray-300">
          {/* Title and Basic Info */}
          <div className="flex justify-between w-full">
            <div className="mb-2">
              <h1 className="text-4xl font-bold text-white mb-2">{series.name}</h1>
              {series.original_name !== series.name && (
                <p className="text-xl text-white mb-4">{series.original_name}</p>
              )}
              {series.tagline && (
                <p className="text-lg italic text-gray-300 mb-4">
                  &quot;{series.tagline}&quot;
                </p>
              )}
            </div>
            <div className="relative group">
              <MediaItemDropdown
                item={{
                  id: series.id,
                  title: series.name,
                  poster_path: series.poster_path,
                  release_date: series.first_air_date
                }}
                contentType="tv_series"
                onWatchlistToggle={handleWatchlist}
                isInWatchlist={false}
                customButton={
                  <button
                    className="flex gap-1 justify-center items-center p-2 bg-dark-gray-hover text-gray-300 hover:text-white transition-all duration-300"
                    aria-label="More options"
                  >
                    <Plus className="size-5" />
                  </button>
                }
              />
            </div>
          </div>

          {/* Rating and Series Info */}
          <div className="flex flex-wrap gap-4 mb-6">
            <div className="flex items-center gap-2">
              <div className="flex items-center">
                <svg className="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                <span className="ml-1 text-lg font-semibold">{series.vote_average.toFixed(1)}</span>
              </div>
              <span className="">({series.vote_count} votes)</span>
            </div>
            <div className="">
              <span className="font-medium">Episodes:</span> {series.number_of_episodes}
            </div>
            <div className="">
              <span className="font-medium">Seasons:</span> {series.number_of_seasons}
            </div>
            <div className="">
              <span className="font-medium">Episode Runtime:</span> {formatEpisodeRuntime(series.episode_run_time)}
            </div>
            <div className="">
              <span className="font-medium">First Air Date:</span> {formatDate(series.first_air_date)}
            </div>
            <div className="">
              <span className="font-medium">Status:</span> {series.status}
            </div>
            <div className="">
              <span className="font-medium">Type:</span> {series.type}
            </div>
          </div>

          {/* Genres */}
          <div className="py-3">
            <h3 className="text-lg font-semibold text-white mb-2">Genres</h3>
            <div className="flex flex-wrap gap-2">
              {series.genres.map((genre) => (
                <span key={genre.id} className="px-2 py-0.5 bg-light-green text-white text-xs font-medium">
                  {genre.name}
                </span>
              ))}
            </div>
          </div>

          {/* Overview */}
          <div className="py-3">
            <h3 className="text-lg text-white font-semibold mb-2">Overview</h3>
            <p className="leading-relaxed text-sm">{series.overview}</p>
          </div>

          {/* Created By */}
          {series.created_by.length > 0 && (
            <div className="py-3">
              <h3 className="text-lg text-white font-semibold mb-2">Created By</h3>
              <div className="flex flex-wrap gap-2">
                {series.created_by.map((creator) => (
                  <span key={creator.id} className="">{creator.name}</span>
                ))}
              </div>
            </div>
          )}

          {/* Networks */}
          {series.networks.length > 0 && (
            <div className="py-3">
              <h3 className="text-lg text-white font-semibold mb-2">Networks</h3>
              <div className="flex flex-wrap gap-4">
                {series.networks.map((network) => (
                  <div key={network.id} className="flex items-center gap-2">
                    {network.logo_path && (
                      <Image
                        src={getImageUrl(network.logo_path)}
                        alt={network.name}
                        width={32}
                        height={32}
                        className="object-contain"
                      />
                    )}
                    <span className="">{network.name}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Production Details */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Production Companies */}
            {series.production_companies.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">Production Companies</h3>
                <div className="space-y-1 text-sm">
                  {series.production_companies.map((company) => (
                    <div key={company.id} className="flex items-center gap-2">
                      {company.logo_path && (
                        <Image
                          src={getImageUrl(company.logo_path)}
                          alt={company.name}
                          width={24}
                          height={24}
                          className="object-contain"
                        />
                      )}
                      <span className="">{company.name}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Production Countries */}
            {series.production_countries.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">Production Countries</h3>
                <div className="space-y-1 text-sm">
                  {series.production_countries.map((country) => (
                    <span key={country.iso_3166_1}>{country.name}</span>
                  ))}
                </div>
              </div>
            )}

            {/* Spoken Languages */}
            {series.spoken_languages.length > 0 && (
              <div>
                <h3 className="text-lg text-white font-semibold mb-2">Spoken Languages</h3>
                <div className="space-y-1 text-sm">
                  {series.spoken_languages.map((language) => (
                    <span key={language.iso_639_1}>{language.english_name}</span>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* External Links */}
          <div className="pt-6">
            <div className="flex gap-4">
              {series.homepage && (
                <a
                  href={series.homepage}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-300 hover:text-blue-400 font-medium"
                >
                  Official Website
                </a>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  )

  return (
    <AnimatePageWrapper className="">
      <div className="px-4 md:px-0 py-8">
        {renderMobile()}
        {renderDesktop()}
      </div>
      <SeriesRecommendation id={series.id} />

      {/* Posts Section */}
      <div className="px-4 md:px-0">
        <PostsSection
          movieId={series.id.toString()}
          refreshTrigger={refreshPosts}
        />
      </div>

      {/* Create Post Popup */}
      <AnimatePresence mode="wait">
        {showCreatePost && (
          <CreatePostForm
            movieId={series.id.toString()}
            movieTitle={series.name}
            contentType="tv_series"
            posterPath={series.poster_path}
            onClose={() => setShowCreatePost(false)}
            onSuccess={() => {
              // Trigger posts refresh instead of page reload
              setRefreshPosts((prev) => prev + 1)
            }}
          />
        )}
      </AnimatePresence>

      {/* Log Watching Form */}
      <AnimatePresence mode="wait">
        {showLogForm && (
          <LogWatchingForm
            contentId={series.id.toString()}
            contentType="tv_series"
            contentTitle={series.name}
            posterPath={series.poster_path || undefined}
            onClose={() => setShowLogForm(false)}
            onSuccess={() => {
              // Optionally refresh activity data or show success message
            }}
          />
        )}
      </AnimatePresence>
    </AnimatePageWrapper>
  )
}

export default TVSeriesDetailsComponent



================================================================================
FILE: src/components/page/user/user-detail-screen.tsx
================================================================================
'use client'
import React, { useState } from 'react'
import Link from 'next/link'
import Image from 'next/image'
import PostList from '@/components/post-list'
import { useMutation } from '@tanstack/react-query'
import type { GenericPost } from '../../../../types/post'

type UserDetailScreenProps = {
  userId: string
  viewerId: string | null
  name: string
  username: string
  image?: string
  followersCount: number
  followingCount: number
  initialIsFollowing: boolean
  posts: GenericPost[]
}

const UserDetailScreen: React.FC<UserDetailScreenProps> = ({
  userId,
  viewerId,
  name,
  username,
  image,
  followersCount,
  followingCount,
  initialIsFollowing,
  posts,
}) => {
  const [isFollowing, setIsFollowing] = useState<boolean>(initialIsFollowing)
  const [followers, setFollowers] = useState<number>(followersCount)
  const [following, setFollowing] = useState<number>(followingCount)

  const canFollow = !!viewerId && viewerId !== userId

  const followUserMutation = useMutation({
    mutationFn: async ({ targetUserId, action }: { targetUserId: string; action: 'follow' | 'unfollow' }) => {
      const res = await fetch('/api/user/follow', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ targetUserId, action }),
      })
      const data = await res.json()
      if (!res.ok || !data?.ok) {
        throw new Error(data?.error || 'Failed to follow/unfollow user')
      }
      return data
    },
  })

  const onToggleFollow = async () => {
    if (!canFollow || followUserMutation.isPending) return
    const action = isFollowing ? 'unfollow' : 'follow'

    setIsFollowing((prev) => !prev)
    setFollowers((prev) => prev + (action === 'follow' ? 1 : -1))

    try {
      const data = await followUserMutation.mutateAsync({
        targetUserId: userId,
        action,
      })

      setFollowers(data.followersCount)
      setFollowing(data.followingCount)
      setIsFollowing(Boolean(data.isFollowing))
    } catch (error) {
      setIsFollowing((prev) => !prev)
      setFollowers((prev) => prev + (action === 'follow' ? -1 : 1))
      console.error('Failed to follow/unfollow user:', error)
    }
  }

  return (
    <div className="flex max-md:flex-col-reverse max-md:px-2 items-start gap-4 text-gray-300">
      <div className="w-full md:w-[70%]">
        <div className="text-2xl font-light mb-4">Reviews</div>
        <PostList emptyText={`${username} has not reviewed any movies yet`} posts={posts} />
      </div>
      <div className="w-full md:w-[30%] md:sticky top-20 self-start right-0 flex flex-col items-center gap-4">
        <div className="flex items-center w-full gap-4">
          <Image
            src={image ?? ''}
            alt={username}
            width={64}
            className='bg-light-green rounded-full'
            height={64}
            unoptimized={image?.includes("dicebear")}
          />
          <div className="flex flex-col gap-1">
            <div>
              <div>{name}</div>
              <div className="text-sm text-gray-400">@{username}</div>
            </div>
            <div className="flex gap-3">
              <div className="flex gap-1 text-sm">Followers: {followers}</div>
              <div className="flex gap-1 text-sm">Following: {following}</div>
            </div>
          </div>
        </div>
        {!viewerId && (
          <Link href="/signin">
            <button>Sign in to follow</button>
          </Link>
        )}
        {viewerId && canFollow && (
          <button
            className="w-full p-1 cursor-pointer bg-light-green disabled:opacity-50 disabled:cursor-not-allowed"
            onClick={onToggleFollow}
            disabled={followUserMutation.isPending}
          >
            {(() => {
              if (followUserMutation.isPending) return 'Loading...'
              return isFollowing ? 'Unfollow' : 'Follow'
            })()}
          </button>
        )}
      </div>
    </div>
  )
}

export default UserDetailScreen



================================================================================
FILE: src/components/pathname-client.tsx
================================================================================



================================================================================
FILE: src/components/post-actions.tsx
================================================================================
'use client'

import { ThumbsUp, ThumbsDown, MessageCircle } from 'lucide-react'
import { useRouter } from 'next/navigation'
import { useState } from 'react'

interface PostActionsProps {
  postId: string
  likesCount: number
  dislikesCount: number
  commentsCount: number
  isLoggedIn: boolean
  userLiked?: boolean
  userDisliked?: boolean
}

export default function PostActions({
  postId,
  likesCount,
  dislikesCount,
  commentsCount,
  isLoggedIn,
  userLiked = false,
  userDisliked = false,
}: PostActionsProps) {
  const router = useRouter()
  const [likes, setLikes] = useState(likesCount)
  const [dislikes, setDislikes] = useState(dislikesCount)
  const [isLiked, setIsLiked] = useState(userLiked)
  const [isDisliked, setIsDisliked] = useState(userDisliked)
  const [isLoading, setIsLoading] = useState(false)

  const handleAction = async (action: 'like' | 'dislike') => {
    if (!isLoggedIn) {
      router.push('/signin')
      return
    }

    if (isLoading) return

    setIsLoading(true)

    try {
      const response = await fetch(`/api/post/${postId}/${action}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
      })

      if (!response.ok) {
        throw new Error('Failed to update reaction')
      }

      const data = await response.json()

      if (action === 'like') {
        if (data.action === 'added') {
          setLikes(prev => prev + 1)
          setIsLiked(true)
          if (isDisliked) {
            setDislikes(prev => prev - 1)
            setIsDisliked(false)
          }
        } else {
          setLikes(prev => prev - 1)
          setIsLiked(false)
        }
      } else {
        if (data.action === 'added') {
          setDislikes(prev => prev + 1)
          setIsDisliked(true)
          if (isLiked) {
            setLikes(prev => prev - 1)
            setIsLiked(false)
          }
        } else {
          setDislikes(prev => prev - 1)
          setIsDisliked(false)
        }
      }
    } catch (error) {
      console.error('Error updating reaction:', error)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="mt-4 max-md:gap-4 flex items-center">
      <button
        onClick={() => handleAction('like')}
        disabled={isLoading}
        className={`flex items-center gap-2 cursor-pointer hover:bg-dark-gray-hover md:p-2 md:px-4 text-gray-300 transition-colors  ${
          isLoading ? 'opacity-50 cursor-not-allowed' : ''
        }`}
      >
        <ThumbsUp
          className={`size-4 ${isLiked ? 'text-gray-300 fill-white' : ''}`}
          />
        <span className="text-sm font-medium">{likes}</span>
      </button>

      <button
        onClick={() => handleAction('dislike')}
        disabled={isLoading}
        className={`flex items-center gap-2 cursor-pointer hover:bg-dark-gray-hover md:p-2 md:px-4 text-gray-300 transition-colors ${
          isLoading ? 'opacity-50 cursor-not-allowed' : ''
        }`}
      >
        <ThumbsDown
          className={`size-4 ${isDisliked ? 'text-gray-300 fill-white' : ''}`}
        />
        <span className="text-sm font-medium">{dislikes}</span>
      </button>

      <div className="flex items-center gap-2 cursor-pointer hover:bg-dark-gray-hover md:p-2 md:px-4 text-gray-300">
        <MessageCircle className="size-4" />
        <span className="text-sm font-medium">{commentsCount}</span>
      </div>
    </div>
  )
}



================================================================================
FILE: src/components/post-list.tsx
================================================================================
'use client'
import { formatDateTime, getRatingLabel } from '@/lib'
import type { GenericPost } from '../../types/post'
import { AnimatePresence, motion } from 'framer-motion'
import {
  MessageCircle,
  ThumbsDown,
  ThumbsUp
} from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import React from 'react'

type Props = {
  posts: GenericPost[]
  emptyText?: string
}

const UserAvatar: React.FC<{
  user: { name: string | null; image: string | null }
}> = ({ user }) => {
  const getInitials = (name: string | null) => {
    if (!name) return 'U'
    return name
      .split(' ')
      .map((word) => word.charAt(0))
      .join('')
      .toUpperCase()
      .slice(0, 2)
  }

  return (
    <div className="w-10 h-10 rounded-full bg-light-green flex items-center justify-center overflow-hidden">
      {user.image ? (
        <Image
          src={user.image}
          alt={user.name || 'User'}
          width={40}
          height={40}
          unoptimized={user.image.includes('dicebear')}
          className="w-full h-full object-cover"
        />
      ) : (
        <span className="text-gray-400 text-sm font-medium">
          {getInitials(user.name)}
        </span>
      )}
    </div>
  )
}

const PostList: React.FC<Props> = ({ posts, emptyText = 'No posts yet' }) => {
  if (!posts || posts.length === 0) {
    return <div className="py-6 text-center text-gray-400">{emptyText}</div>
  }

  return (
    <div className="flex flex-col">
      <AnimatePresence mode="wait">
        {posts.map((post, index) => (
          <Link
            href={`/post/${post.id}`}
            key={post.id}
            className="cursor-pointer hover:bg-dark-gray-2 border-b border-dark-gray-2  bg-dark-gray-2/40 group transition-colors"
          >
            <motion.div
              initial={{ opacity: 0, y: -8 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{
                duration: 0.35,
                ease: 'easeOut',
                delay: (index + 1) * 0.05,
              }}
            >
              <div className="flex gap-4 ">
                {/* Poster (preferred) or fallback to user initial */}
                <div className="flex self-stretch">
                  <div className="relative w-40 h-full overflow-hidden">
                    <Image
                      src={post.posterUrl || '/logo.png'}
                      alt={post.title || 'Poster'}
                      fill
                      className="object-cover"
                    />
                  </div>
                </div>

                {/* Post Content */}
                <div className="flex flex-col py-4 min-w-0">
                  {/* User info with avatar */}
                  <div className="flex items-center gap-3 mb-3">
                    <UserAvatar user={post.user} />
                    <div className="flex-1">
                      <div className="flex items-center gap-2">
                        <span className="text-white font-medium">
                          {post.user?.name || 'Anonymous'}
                        </span>
                        {post.isSpoiler && (
                          <div className="flex bg-orange-500 rounded-full items-center gap-1 text-white px-2 text-xs">
                            <span>has spoiler</span>
                          </div>
                        )}
                      </div>
                      {post.createdAt && (
                        <div className="flex items-center gap-1 text-gray-400 text-xs mt-1">
                          <span>{formatDateTime(post.createdAt as Date)}</span>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* Title */}
                  {post.title && (
                    <h3 className="text-xl font-bold text-white mb-1">
                      {post.title}
                    </h3>
                  )}
                  {/* Rating and Movie Type */}
                  <div className="flex items-center text-xs text-gray-300 gap-1 mb-2">
                    {post.rating && (
                      <div className="flex items-center bg-dark-gray-2 w-fit px-2 py-0.5 gap-2">
                        {getRatingLabel(post.rating)}
                      </div>
                    )}
                    {post.movie && (
                      <div className="flex items-center h-full gap-1 text-xs bg-dark-gray-2 px-1 py-0.5">
                        <span className="capitalize">{post.movie.type}</span>
                      </div>
                    )}
                  </div>

                  {/* Content */}
                  <div className="mb-4">
                    <p className="text-gray-300 text-sm leading-relaxed">
                      {post.content.length > 150 ? post.content.substring(0, 100) + '...' : post.content}
                    </p>
                  </div>

                  {/* Reactions */}
                  <div className="flex items-center gap-6">
                    <button className="flex items-center gap-2 text-gray-300">
                      <ThumbsUp className="size-4" />
                      <span className="text-sm font-medium">
                        {post.likes?.length ?? 0}
                      </span>
                    </button>
                    <button className="flex items-center gap-2 text-gray-300">
                      <ThumbsDown className="size-4" />
                      <span className="text-sm font-medium">
                        {post.dislikes?.length ?? 0}
                      </span>
                    </button>
                    <div className="flex items-center gap-2 text-gray-300">
                      <MessageCircle className="size-4" />
                      <span className="text-sm font-medium">
                        {post._count?.comments ?? 0}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </motion.div>
          </Link>
        ))}
      </AnimatePresence>
    </div>
  )
}

export default PostList



================================================================================
FILE: src/components/posts-section.tsx
================================================================================
'use client'

import { getAllContentPosts as getAllMoviePosts } from '@/app/(user)/post/actions'
import PostList from '@/components/post-list'
import type { GenericPost } from '../../types/post'
import { useCallback, useEffect, useState } from 'react'




interface PostsSectionProps {
  readonly movieId: string
  readonly refreshTrigger?: number
}

export function PostsSection({ movieId, refreshTrigger }: PostsSectionProps) {
  const [posts, setPosts] = useState<GenericPost[]>([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  const fetchPosts = useCallback(async () => {
    try {
      setLoading(true)
      setError(null)
      const fetchedPosts = await getAllMoviePosts(movieId)
      // Prefer cached posterPath from DB; fall back to API route if missing
      const withPosters: GenericPost[] = await Promise.all(
        fetchedPosts.map(async (post) => {
          const posterPath = post.movie?.posterPath ?? null
          let posterUrl: string | null = null

          if (posterPath) {
            posterUrl = `https://image.tmdb.org/t/p/w500${posterPath}`
          } else {
            try {
              const typeParam = post.movie?.type === 'tv_series' ? 'tv' : 'movie'
              const contentId = post.movie?.id ?? movieId
              const res = await fetch(`/api/poster?id=${contentId}&type=${typeParam}`, { cache: 'no-store' })
              const data = await res.json()
              posterUrl = data?.posterUrl || '/logo.png'
            } catch {
              posterUrl = '/logo.png'
            }
          }

          return {
            id: post.id,
            title: post.title,
            content: post.content,
            rating: post.rating,
            isSpoiler: post.isSpoiler,
            createdAt: post.createdAt,
            posterUrl,
            user: {
              name: post.user?.name ?? null,
              image: post.user?.image ?? null
            },
            movie: post.movie ? {
              id: post.movie.id,
              type: post.movie.type,
              posterPath: post.movie.posterPath
            } : undefined,
            likes: post.likes,
            dislikes: post.dislikes,
            _count: { comments: post._count.comments },
          }
        })
      )
      setPosts(withPosters)
    } catch (err) {
      setError('Failed to load posts')
      console.error('Error fetching posts:', err)
    } finally {
      setLoading(false)
    }
  }, [movieId])

  useEffect(() => {
    fetchPosts()
  }, [fetchPosts])

  // Refetch posts when refreshTrigger changes
  useEffect(() => {
    if (refreshTrigger && refreshTrigger > 0) {
      fetchPosts()
    }
  }, [refreshTrigger, fetchPosts])

  if (loading) {
    return <PostList posts={[]} emptyText="Loading posts..." />
  }

  if (error) {
    return (
      <div className="py-8">
        <div className="text-center">
          <p className="text-center text-red-400 text-xl">Error</p>
          <p className="text-red-400 mb-4">{error}</p>
        </div>
      </div>
    )
  }

  return <PostList posts={posts} emptyText="Be the first to share your thoughts about this movie!" />
}



================================================================================
FILE: src/components/profile-sidebar.tsx
================================================================================
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { cn } from '@/lib/utils'
import { BookText, TvMinimal, User } from 'lucide-react'
import { useEffect, useState } from 'react'
import { motion } from 'framer-motion'

// Mobile: Only 3 main items
const mobileSidebarItems = [
  {
    name: 'Profile',
    href: '/profile',
    icon: <User className="size-5" />,
  },
  {
    name: 'Reviews',
    href: '/profile/reviews',
    icon: <BookText className="size-5" />,
  },
  {
    name: 'Watchlist',
    href: '/profile/watchlist',
    icon: <TvMinimal className="size-5" />,
  },
]

// Desktop: Simple profile navigation items
const profileItems = [
  { href: '/profile', label: 'Profile' },
  { href: '/profile/reviews', label: 'Reviews' },
  { href: '/profile/watchlist', label: 'Watchlist' },
  { href: '/profile/lists', label: 'Lists' },
  { href: '/profile/notifications', label: 'Notifications' },
]

export default function ProfileSidebar() {
  const pathname = usePathname()
  const [activeIndex, setActiveIndex] = useState(0)

  // Update active index when pathname changes
  useEffect(() => {
    const index = mobileSidebarItems.findIndex(item => item.href === pathname)
    if (index !== -1) {
      setActiveIndex(index)
    }
  }, [pathname])

  return (
    <div className="w-full md:w-40">
      {/* Mobile: Instagram-style horizontal navigation */}
      <div
        className="md:hidden fixed inset-x-0 bottom-2 backdrop-blur-3xl z-50 px-2"
        style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}
      >
        <div className="relative flex  rounded-full justify-around items-center bg-dark-gray-2 border-t border-dark-gray-hover h-14 w-full">
          {/* Animated background slider with Framer Motion */}
          <motion.div
            className={`absolute bg-light-green rounded-full h-full`}
            animate={{
              left: `${(activeIndex * 100) / mobileSidebarItems.length}%`,
            }}
            transition={{
              duration: 0.3,
              ease: 'easeOut',
            }}
            style={{
              width: `${100 / mobileSidebarItems.length}%`,
            }}
          />
          {mobileSidebarItems.map((item, index) => {
            const isActive = pathname === item.href
            return (
              <Link
                key={item.name + index}
                href={item.href}
                className={cn(
                  'relative z-10 flex flex-col items-center rounded-full justify-center py-3 transition-colors duration-200 min-w-0 flex-1',
                  isActive
                    ? 'text-white'
                    : 'text-gray-300 hover:text-light-green'
                )}
              >
                <div className="mb-0.5">{item.icon}</div>
                <span className="text-xs font-medium truncate">
                  {item.name}
                </span>
              </Link>
            )
          })}
        </div>
      </div>

      {/* Desktop: Simple vertical sidebar */}
      <aside className="hidden w-full shrink-0 md:block">
        <div className="sticky top-4 overflow-y-auto">
          <nav>
            {profileItems.map(({ href, label }) => {
              const base = 'block px-3 py-1.5 text-sm transition-colors'
              const active = 'text-white bg-light-green'
              const idle = 'hover:text-light-green hover:bg-dark-gray-hover'

              const isActive = pathname === href

              return (
                <Link
                  key={href}
                  href={href}
                  className={`${base} ${isActive ? active : idle}`}
                >
                  {label}
                </Link>
              )
            })}
          </nav>
        </div>
      </aside>
    </div>
  )
}



================================================================================
FILE: src/components/provider/auth-provider.tsx
================================================================================
'use client'
import { SessionProvider, useSession } from 'next-auth/react'

export function AuthProvider({ children }: { children: React.ReactNode }) {
  return (
    <SessionProvider
      refetchInterval={5 * 60}
      refetchOnWindowFocus={false}
    >
      {children}
    </SessionProvider>
  )
}

export function AuthGuard({ children }: { children: React.ReactNode }) {
  const { status } = useSession()
  if (status === 'loading') {
    return <LoadingSession />
  }
  if (status === 'unauthenticated') {
    return <UnauthenticatedSession />
  }
  return <>{children}</>
}

function LoadingSession() {
  return <div>Loading...</div>
}
function UnauthenticatedSession() {
  return <div>Unauthorized...</div>
}



================================================================================
FILE: src/components/provider/query-provider.tsx
================================================================================
'use client';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import React, { useState } from 'react';

export default function QueryProvider({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 1000 * 60 * 15, // data is considered fresh for 15 minutes 
            gcTime: 1000 * 60 * 30,
            refetchOnWindowFocus: false, // disable refetch on window focus
            retry: 1,
          },
        },
      })
  );

  return (
    <QueryClientProvider client={queryClient}>
      {children}
      <ReactQueryDevtools initialIsOpen={false} buttonPosition="bottom-right" />
    </QueryClientProvider>
  );
}


================================================================================
FILE: src/components/settings-sidebar.tsx
================================================================================
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'

const SECTIONS: { title: string; items: { href: string; label: string }[] }[] =
  [
    {
      title: 'Basic Info',
      items: [
        { href: '/settings', label: 'Overview' },
        { href: '/settings/username', label: 'Username' },
      ],
    },
    {
      title: 'Account',
      items: [
        { href: '/settings/security', label: 'Security' },
        { href: '/settings/delete-account', label: 'Delete Account' },
      ],
    },
    {
      title: 'Billing',
      items: [
        { href: '/settings/billing', label: 'Billing' },
      ],
    },
  ]

export default function SettingsSidebar() {
  const pathname = usePathname()

  const base = 'block px-3 py-1.5 text-sm transition-colors'
  const active = 'text-white bg-light-green'
  const idle =
    'hover:text-light-green hover:bg-dark-gray-hover'

  return (
    <aside className="hidden w-64 shrink-0 md:block">
      <div className="sticky top-18 max-h-[calc(100vh-4rem)] overflow-y-auto p-4">
        {SECTIONS.map((section) => (
          <div key={section.title} className="">
            <div className="mt-2 px-3 py-1.5 text-sm font-light uppercase tracking-wide text-zinc-400">
              {section.title}
            </div>
            <nav>
              {section.items.map(({ href, label }) => (
                <Link
                  key={href}
                  href={href}
                  className={`${base} ${pathname === href ? active : idle}`}
                >
                  {label}
                </Link>
              ))}
            </nav>
          </div>
        ))}
      </div>
    </aside>
  )
}



================================================================================
FILE: src/components/type-selector.tsx
================================================================================
'use client'

import { ChevronDown, Monitor, BookOpen, Clapperboard } from 'lucide-react'
import { usePathname, useRouter } from 'next/navigation'
import { useState, useEffect, useRef } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import { cn } from '@/lib/utils'

interface ContentType {
  name: string
  label: string
  icon: React.ElementType
  path: string
}

const contentTypes: ContentType[] = [
  { name: 'movies', label: 'Movies', icon: Clapperboard, path: '/' },
  { name: 'books', label: 'Books', icon: BookOpen, path: '/books' },
  { name: 'tech', label: 'Tech', icon: Monitor, path: '/tech' },
]

const TypeSelector = () => {
  const [isOpen, setIsOpen] = useState(false)
  const pathname = usePathname()
  const router = useRouter()
  const containerRef = useRef<HTMLDivElement>(null)

  // Determine current active type based on pathname
  const getCurrentType = () => {
    if (pathname?.startsWith('/books')) return contentTypes[1]
    if (pathname?.startsWith('/tech')) return contentTypes[2]
    return contentTypes[0]
  }

  const currentType = getCurrentType()

  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {
        setIsOpen(false)
      }
    }

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isOpen])

  const handleTypeChange = (path: string) => {
    router.push(path)
    setIsOpen(false)
  }

  return (
    <div ref={containerRef} className="relative z-50">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className={cn(
          "flex items-center gap-1 rounded-full px-3 py-1 mt-1 transition-all",
          isOpen
            ? "bg-white/5 text-white"
            : "cursor-pointer hover:bg-white/5 text-gray-200"
        )}
      >
        <span className="flex items-center gap-2 text-xs font-medium">
          {currentType.label}
        </span>
        <motion.div
          animate={{ rotate: isOpen ? 180 : 0 }}
          transition={{ duration: 0.2 }}
        >
          <ChevronDown className="w-3.5 h-3.5 opacity-70" />
        </motion.div>
      </button>

      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, y: 8, scale: 0.95 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: 8, scale: 0.95 }}
            transition={{ duration: 0.15 }}
            className="absolute top-full left-0 shadow-2xl mt-2 min-w-28 w-fit bg-dark-gray-2 border-transparent overflow-hidden"
          >
            <div className="p-1 flex flex-col gap-0.5">
              {contentTypes.map((type) => {
                const isActive = type.name === currentType.name
                const Icon = type.icon
                
                return (
                  <button
                    key={type.name}
                    onClick={() => handleTypeChange(type.path)}
                    className={cn(
                      "flex items-center cursor-pointer gap-3 w-full px-2 py-1.5 text-xs transition-colors",
                      isActive
                        ? "bg-white/10 text-white font-medium"
                        : "text-gray-400 hover:text-gray-200"
                    )}
                  >
                    <Icon className="w-4 h-4" />
                    {type.label}
                  </button>
                )
              })}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  )
}

export default TypeSelector


================================================================================
FILE: src/components/ui/activity/activity-date-picker.tsx
================================================================================
'use client'

import React, { useState } from 'react'
import { Calendar, Clock } from 'lucide-react'

interface ActivityDatePickerProps {
  selectedDate: Date
  onDateChange: (date: Date) => void
  className?: string
  disabled?: boolean
}

export default function ActivityDatePicker({
  selectedDate,
  onDateChange,
  className = '',
  disabled = false
}: Readonly<ActivityDatePickerProps>) {
  const [isOpen, setIsOpen] = useState(false)
  const [tempDate, setTempDate] = useState(selectedDate)

  const today = new Date()
  const maxDate = today.toISOString().split('T')[0]
  const minDate = new Date(today.getFullYear() - 1, 0, 1).toISOString().split('T')[0]

  const handleDateChange = (dateString: string) => {
    const newDate = new Date(dateString)
    setTempDate(newDate)
  }

  const handleConfirm = () => {
    onDateChange(tempDate)
    setIsOpen(false)
  }

  const handleCancel = () => {
    setTempDate(selectedDate)
    setIsOpen(false)
  }

  const formatDisplayDate = (date: Date) => {
    const isToday = date.toDateString() === today.toDateString()
    const isYesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000).toDateString() === date.toDateString()

    if (isToday) return 'Today'
    if (isYesterday) return 'Yesterday'

    return date.toLocaleDateString('en-US', {
      weekday: 'short',
      month: 'short',
      day: 'numeric',
      year: date.getFullYear() !== today.getFullYear() ? 'numeric' : undefined
    })
  }

  return (
    <div className={`relative ${className}`}>
      <button
        type="button"
        onClick={() => !disabled && setIsOpen(!isOpen)}
        onKeyDown={(e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault()
            if (!disabled) {
              setIsOpen(!isOpen)
            }
          }
        }}
        disabled={disabled}
        className={`
          flex items-center gap-2 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg
          text-sm text-gray-300 hover:bg-gray-700 hover:border-gray-600
          transition-colors duration-200
          ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}
          ${isOpen ? 'bg-gray-700 border-gray-600' : ''}
        `}
      >
        <Calendar className="w-4 h-4" />
        <span>{formatDisplayDate(selectedDate)}</span>
        <Clock className="w-3 h-3" />
      </button>

      {isOpen && (
        <>
          {/* Backdrop */}
          <div
            className="fixed inset-0 z-10"
            onClick={handleCancel}
            onKeyDown={(e) => {
              if (e.key === 'Escape') {
                handleCancel()
              }
            }}
            role="button"
            tabIndex={0}
            aria-label="Close date picker"
          />

          {/* Date picker modal */}
          <div className="absolute top-full left-0 mt-2 z-20 bg-gray-800 border border-gray-700 rounded-lg shadow-xl p-4 min-w-64">
            <div className="mb-4">
              <h3 className="text-sm font-medium text-white mb-2">
                Select Activity Date
              </h3>
              <p className="text-xs text-gray-400">
                Choose the date when this activity occurred
              </p>
            </div>

            <div className="mb-4">
              <label htmlFor="activity-date-input" className="block text-xs font-medium text-gray-300 mb-2">
                Date
              </label>
              <input
                id="activity-date-input"
                type="date"
                value={tempDate.toISOString().split('T')[0]}
                onChange={(e) => handleDateChange(e.target.value)}
                min={minDate}
                max={maxDate}
                className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
              />
            </div>

            <div className="mb-4">
              <label htmlFor="activity-time-input" className="block text-xs font-medium text-gray-300 mb-2">
                Time (Optional)
              </label>
              <input
                id="activity-time-input"
                type="time"
                value={tempDate.toTimeString().slice(0, 5)}
                onChange={(e) => {
                  const [hours, minutes] = e.target.value.split(':')
                  const newDate = new Date(tempDate)
                  newDate.setHours(parseInt(hours) || 0, parseInt(minutes) || 0)
                  setTempDate(newDate)
                }}
                className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
              />
            </div>

            <div className="flex gap-2 justify-end">
              <button
                type="button"
                onClick={handleCancel}
                className="px-3 py-1.5 text-xs text-gray-400 hover:text-white transition-colors"
              >
                Cancel
              </button>
              <button
                type="button"
                onClick={handleConfirm}
                className="px-3 py-1.5 bg-green-600 text-white text-xs rounded-lg hover:bg-green-700 transition-colors"
              >
                Confirm
              </button>
            </div>
          </div>
        </>
      )}
    </div>
  )
}



================================================================================
FILE: src/components/ui/activity/activity-heatmap.tsx
================================================================================
'use client'

import { useSession } from 'next-auth/react'
import React from 'react'
import MovieDetailPanel from './movie-detail-panel'
import { MovieDetail } from './types'
import { ChevronLeft, ChevronRight } from 'lucide-react'
import { useDebounce } from '../../../../hooks/useDebounce'

interface HeatmapData {
  activities: Record<string, MovieDetail[]>
  startOfMonth: string
  endOfMonth: string
}

interface ActivityHeatmapProps {
  className?: string
}

export default function ActivityHeatmap({
  className = '',
}: Readonly<ActivityHeatmapProps>) {
  const { data: session } = useSession()
  const userId = session?.user?.id
  const [data, setData] = React.useState<HeatmapData | null>(null)
  const [loading, setLoading] = React.useState(true)
  const [selectedDate, setSelectedDate] = React.useState<string | null>(null)
  const [selectedMovies, setSelectedMovies] = React.useState<MovieDetail[]>([])
  const [currentMonth, setCurrentMonth] = React.useState(new Date())
  const today = new Date()
  const debouncedMonth = useDebounce(currentMonth, 400)

  React.useEffect(() => {
    if (!userId) {
      setLoading(false)
      return
    }

    const fetchHeatmapData = async () => {
      try {
        const response = await fetch(
          `/api/activity/heatmap?month=${debouncedMonth.toISOString()}`
        )
        if (!response.ok) {
          throw new Error('Failed to fetch heatmap data')
        }
        const result = await response.json()
        setData(result)
      } catch (error) {
        console.error('Error fetching heatmap data:', error)
      } finally {
        setLoading(false)
      }
    }

    // Show loading state when refetching (e.g., when month changes)
    setLoading(true)
    fetchHeatmapData()
  }, [userId, debouncedMonth])

  const handleDateClick = (dateStr: string, movies: MovieDetail[]) => {
    setSelectedDate(dateStr)
    setSelectedMovies(movies)
  }

  const closeModal = () => {
    setSelectedDate(null)
    setSelectedMovies([])
  }

  const goToPreviousMonth = () => {
    setCurrentMonth(
      new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1)
    )
  }

  const goToNextMonth = () => {
    setCurrentMonth(
      new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1)
    )
  }

  const goToCurrentMonth = () => {
    setCurrentMonth(new Date(today.getFullYear(), today.getMonth(), 1))
  }

  if (loading) {
    return (
      <div className={`activity-heatmap ${className}`}>
        <div className="bg-dark-gray-2 p-4 animate-pulse">
          <div className="h-6 ml-auto bg-dark-gray mb-4 w-32"></div>
          <div className="h-[250px] md:h-[300px] w-full bg-dark-gray"></div>
        </div>
      </div>
    )
  }

  if (!userId) {
    return (
      <div className={`activity-heatmap ${className}`}>
        <div className="text-center text-gray-500 py-4">
          Please log in to view activity calendar
        </div>
      </div>
    )
  }

  if (!data) {
    return (
      <div className={`activity-heatmap ${className}`}>
        <div className="text-center text-gray-500 py-4">No activity data</div>
      </div>
    )
  }

  const generateCalendarGrid = () => {
    const startDate = new Date(data.startOfMonth)
    const endDate = new Date(data.endOfMonth)
    const today = new Date()

    const grid = []
    const currentDate = new Date(startDate)

    // Add empty cells for days before the first day of the month
    const firstDayOfWeek = startDate.getDay()
    for (let i = 0; i < firstDayOfWeek; i++) {
      grid.push({ date: null, count: 0, movies: [], isToday: false })
    }

    while (currentDate <= endDate) {
      const dateStr = currentDate.toISOString().split('T')[0]
      const movies = data.activities[dateStr] || []
      const count = movies.length
      const isToday = currentDate.toDateString() === today.toDateString()

      grid.push({
        date: new Date(currentDate),
        dateStr,
        count,
        movies,
        isToday,
      })

      currentDate.setDate(currentDate.getDate() + 1)
    }

    return grid
  }

  const calendarGrid = generateCalendarGrid()

  const getIntensityClass = (count: number) => {
    if (count === 0) return 'bg-dark-gray'
    if (count === 1) return 'bg-light-green/50'
    if (count === 2) return 'bg-light-green/70'
    if (count >= 3) return 'bg-light-green'
    return 'bg-light-green'
  }

  return (
    <div className={`activity-heatmap ${className}`}>
      <div className="bg-dark-gray-2">
        {/* Header */}
        <div className="flex items-center justify-end pt-4 px-4 mb-6 gap-2">
          <h3 className="text-lg font-semibold mr-2">
            {currentMonth.toLocaleDateString('en-US', {
              month: 'long',
              year: 'numeric',
            })}
          </h3>
          <button
            onClick={goToCurrentMonth}
            className="px-2 py-1 bg-dark-gray text-sm hover:bg-dark-gray-hover"
            disabled={
              currentMonth.getFullYear() === today.getFullYear() &&
              currentMonth.getMonth() === today.getMonth()
            }
          >
            Today
          </button>
          <button onClick={goToPreviousMonth} className="p-1 bg-dark-gray ">
            <ChevronLeft className="size-5" />
          </button>
          <button onClick={goToNextMonth} className="p-1 bg-dark-gray ">
            <ChevronRight className="size-5" />
          </button>
        </div>

        {/* Day labels */}
        <div className="grid grid-cols-7 gap-1 mb-2">
          {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day) => (
            <div
              key={day}
              className="text-center text-xs font-medium text-gray-300"
            >
              {day}
            </div>
          ))}
        </div>

        {/* Calendar grid */}
        <div className="grid grid-cols-7">
          {calendarGrid.map((day, index) => (
            <button
              key={`day-${day.date?.toISOString() || index}`}
              onClick={() =>
                day.date && handleDateClick(day.dateStr, day.movies)
              }
              disabled={!day.date}
              className={`
                p-3 md:p-5 text-sm
                ${day.date ? getIntensityClass(day.count) : 'bg-dark-gray-2'}
                ${day.isToday ? 'bg-dark-gray-hover' : ''}
                ${day.date ? 'cursor-pointer' : 'cursor-default'}
              `}
              title={
                day.date
                  ? `${day.date.toLocaleDateString()}: ${
                      day.count
                    } movies watched`
                  : ''
              }
            >
              <div className="flex items-center justify-center h-full">
                {day.date ? day.date.getDate() : ''}
              </div>
            </button>
          ))}
        </div>

        {/* Modal */}
        {selectedDate && (
          <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-10">
            <div className="bg-dark-gray-2 p-4 max-w-sm w-full max-h-[70vh] overflow-auto">
              <MovieDetailPanel
                date={selectedDate}
                movies={selectedMovies}
                onClose={closeModal}
              />
            </div>
          </div>
        )}
      </div>
    </div>
  )
}



================================================================================
FILE: src/components/ui/activity/activity-stats.tsx
================================================================================
'use client'

import React from 'react'

interface ActivityStatsProps {
  userId: string
  className?: string
}

interface ActivityStatsData {
  totalActivities: number
  yearActivities: number
  monthActivities: number
  weekActivities: number
}

export default function ActivityStats({
  userId,
  className = '',
}: Readonly<ActivityStatsProps>) {
  const [stats, setStats] = React.useState<ActivityStatsData | null>(null)
  const [loading, setLoading] = React.useState(true)

  React.useEffect(() => {
    const fetchStats = async () => {
      try {
        const response = await fetch('/api/activity/stats')
        if (!response.ok) {
          throw new Error('Failed to fetch activity stats')
        }
        const data = await response.json()
        setStats(data)
      } catch (error) {
        console.error('Error fetching activity stats:', error)
      } finally {
        setLoading(false)
      }
    }

    fetchStats()
  }, [userId])

  if (loading) {
    return (
      <div className={`activity-stats ${className}`}>
        <div className="grid grid-cols-4 gap-3">
          {['total', 'year', 'month', 'week'].map((type) => (
            <div
              key={`loading-skeleton-${type}`}
              className="bg-dark-gray-2 p-3 animate-pulse"
            >
              <div className="h-10 bg-dark-gray"></div>
            </div>
          ))}
        </div>
      </div>
    )
  }

  if (!stats) {
    return (
      <div className={`activity-stats ${className}`}>
        <div className="text-center text-gray-500 py-4">No activity data</div>
      </div>
    )
  }

  const statItems = [
    { label: 'Total', value: stats.totalActivities },
    { label: 'This Year', value: stats.yearActivities },
    { label: 'This Month', value: stats.monthActivities },
    { label: 'This Week', value: stats.weekActivities },
  ]

  return (
    <div className={`activity-stats ${className}`}>
      <div className="grid grid-cols-4 gap-3">
        {statItems.map((item) => (
          <div key={item.label} className="bg-dark-gray-hover p-3">
            <div className="text-center">
              <div className="text-xl font-semibold text-gray-300">
                {item.value}
              </div>
              <div className="text-sm text-gray-500">{item.label}</div>
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}



================================================================================
FILE: src/components/ui/activity/activity.tsx
================================================================================
import React from 'react'
import ActivityStats from './activity-stats'
import { getSession } from '@/lib'
import ActivityHeatmap from './activity-heatmap'

const Activity = async () => {
  const session = await getSession()

  return (
    <div className="space-y-8">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-white mb-2">Welcome back!</h1>
        <p className="text-gray-300">
          Here&apos;s an overview of your movie and series watching activity
        </p>
      </div>

      {/* Activity Overview */}
      <div className="space-y-8">
        <div>
          <ActivityStats userId={session?.user.id || ''} />
        </div>

        <div>
          <ActivityHeatmap />
        </div>
      </div>

    </div>
  )
}

export default Activity



================================================================================
FILE: src/components/ui/activity/movie-detail-panel.tsx
================================================================================
'use client'

import React from 'react'
import { X, Star, Film, Tv } from 'lucide-react'
import { MovieDetail, formatDate, getRatingColor, getRatingStars } from './types'

interface MovieDetailPanelProps {
  date: string
  movies: MovieDetail[]
  onClose: () => void
}

export default function MovieDetailPanel({
  date,
  movies,
  onClose
}: Readonly<MovieDetailPanelProps>) {

  return (
    <div className="p-4">
      {/* Header */}
      <div className="flex items-center justify-between mb-4 border-b border-gray-200 pb-3">
        <div className="flex items-center gap-2">
          <h4 className="text-lg font-semibold text-gray-900">
            {formatDate(date)}
          </h4>
          <span className="text-sm text-gray-500">
            ({movies.length} {movies.length === 1 ? 'movie' : 'movies'})
          </span>
        </div>
        <button
          onClick={onClose}
          className="p-1 hover:bg-gray-100 rounded transition-colors"
        >
          <X className="w-5 h-5 text-gray-500" />
        </button>
      </div>

      {/* Content */}
      <div className="max-h-64 overflow-y-auto">
        {movies.length === 0 ? (
          <div className="text-center text-gray-500 py-8 text-sm">
            No movies watched on this date
          </div>
        ) : (
          <div className="space-y-3">
            {movies.map((movie, index) => (
              <div
                key={`${movie.contentId}-${index}`}
                className="bg-gray-50 rounded-lg p-3 hover:bg-gray-100 transition-colors border border-gray-200"
              >
                <div className="flex items-center gap-3">
                  <div className="flex-shrink-0">
                    {movie.metadata.contentType === 'tv_series' ? (
                      <Tv className="w-5 h-5 text-blue-600" />
                    ) : (
                      <Film className="w-5 h-5 text-blue-600" />
                    )}
                  </div>

                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <h5 className="font-medium text-gray-900 truncate text-sm">
                        {movie.metadata.reviewTitle || `Content ${movie.contentId.slice(0, 8)}`}
                      </h5>
                      {movie.metadata.isSpoiler && (
                        <span className="px-2 py-1 text-xs bg-red-100 text-red-700 rounded">
                          Spoiler
                        </span>
                      )}
                    </div>

                    <div className="flex items-center gap-3 text-xs text-gray-600">
                      <span className="capitalize">
                        {movie.metadata.contentType || 'movie'}
                      </span>

                      {movie.metadata.rating && (
                        <div className="flex items-center gap-1">
                          <Star className="w-3 h-3" />
                          <span className={getRatingColor(movie.metadata.rating)}>
                            {getRatingStars(movie.metadata.rating)}/5
                          </span>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}



================================================================================
FILE: src/components/ui/activity/types.ts
================================================================================
export interface MovieDetail {
  contentId: string
  metadata: {
    contentType?: 'movie' | 'tv_series'
    rating?: string
    isSpoiler?: boolean
    reviewTitle?: string
    loggedAt?: string
  }
  activityType: string
}

export const formatDate = (dateStr: string) => {
  return new Date(dateStr).toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
}

export const getRatingColor = (rating: string) => {
  switch (rating) {
    case 'LEGENDARY': return 'text-yellow-400'
    case 'MUST_WATCH': return 'text-green-400'
    case 'ONE_TIME_WATCH': return 'text-blue-400'
    case 'TIMEPASS': return 'text-orange-400'
    case 'TRASH': return 'text-red-400'
    default: return 'text-gray-400'
  }
}

export const getRatingStars = (rating: string) => {
  const ratingMap: Record<string, number> = {
    'TRASH': 1,
    'TIMEPASS': 2,
    'ONE_TIME_WATCH': 3,
    'MUST_WATCH': 4,
    'LEGENDARY': 5
  }
  return ratingMap[rating] || 0
}



================================================================================
FILE: src/components/ui/avatar.tsx
================================================================================
/* FILE: src/components/ui/avatar.tsx */
import { cn } from '@/lib'
import Image from 'next/image'
import React from 'react'

interface AvatarProps {
  src?: string | null
  alt?: string | null
  size?: 'sm' | 'md' | 'lg' | 'xl'
  className?: string
}

const Avatar: React.FC<AvatarProps> = ({
  src,
  alt,
  size = 'md',
  className,
}) => {
  const sizeClasses = {
    sm: 'w-8 h-8 text-xs',
    md: 'w-10 h-10 text-sm',
    lg: 'w-16 h-16 text-lg',
    xl: 'w-32 h-32 text-2xl',
  }

  const getInitials = (name?: string | null) => {
    if (!name) return 'U'
    return name
      .split(' ')
      .map((word) => word.charAt(0))
      .join('')
      .toUpperCase()
      .slice(0, 2)
  }

  return (
    <div
      className={cn(
        'relative inline-flex shrink-0 overflow-hidden rounded-full bg-light-green',
        sizeClasses[size],
        className
      )}
    >
      {src ? (
        <Image
          src={src}
          alt={alt || 'Avatar'}
          fill
          className="aspect-square h-full w-full object-cover"
          unoptimized={src.includes('dicebear')}
        />
      ) : (
        <div className="flex h-full w-full items-center justify-center font-medium text-white">
          {getInitials(alt)}
        </div>
      )}
    </div>
  )
}

export default Avatar


================================================================================
FILE: src/components/ui/button.tsx
================================================================================
"use client"
import { cn } from '@/lib/utils'
import { Loader2 } from 'lucide-react'
import { ButtonHTMLAttributes, forwardRef } from 'react'

export interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'secondary-light' | 'outline' | 'ghost' | 'danger'
  size?: 'default' | 'sm' | 'lg' | 'icon'
  isLoading?: boolean
  fullWidth?: boolean
  leftIcon?: React.ReactNode
  rightIcon?: React.ReactNode
}

const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  (
    {
      className,
      variant = 'primary',
      size = 'default',
      isLoading = false,
      fullWidth = false,
      leftIcon,
      rightIcon,
      children,
      disabled,
      ...props
    },
    ref
  ) => {
    const baseStyles =
      'inline-flex items-center justify-center transition-colors outline-none disabled:pointer-events-none disabled:opacity-70 cursor-pointer'

    const variants = {
      primary: 'bg-light-green text-white hover:bg-opacity-90',
      secondary: 'bg-dark-gray-2 text-white cursor-pointer w-full',
      "secondary-light": "bg-dark-gray text-gray-300 cursor-pointer w-full",
      outline:
        'border border-gray-600 bg-transparent text-gray-300 hover:bg-dark-gray-2 hover:text-white',
      ghost: 'hover:bg-dark-gray-2 hover:text-white text-gray-300',
      danger: 'bg-red-600 text-white hover:bg-red-700',
    }

    const sizes = {
      default: 'p-2 h-10 text-base',
      sm: 'p-1 h-8 text-sm',
      lg: 'p-3 h-12 text-base',
      icon: 'h-9 w-9 p-0',
    }

    return (
      <button
        ref={ref}
        className={cn(
          baseStyles,
          variants[variant],
          sizes[size],
          fullWidth ? 'w-full' : '',
          className
        )}
        disabled={isLoading || disabled}
        {...props}
      >
        {isLoading ? (
          <Loader2 className="h-5 w-5 animate-spin text-white" />
        ) : (
          <>
            {leftIcon && <span className="mr-2">{leftIcon}</span>}
            {children}
            {rightIcon && <span className="ml-2">{rightIcon}</span>}
          </>
        )}
      </button>
    )
  }
)

Button.displayName = 'Button'

export default Button


================================================================================
FILE: src/components/ui/input.tsx
================================================================================
import { cn } from '@/lib'
import React, { forwardRef } from 'react'

interface InputProps {
  id?: string
  disabled?: boolean
  value?: string
  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void
  placeholder?: string
  required?: boolean
  type?: 'text' | 'checkbox' | 'email' | 'password' | 'date'
  className?: string
  variant?: 'primary' | 'secondary'
  size?: 'sm' | 'md' | 'lg'
  autoFocus?: boolean
  checked?: boolean
}

const Input = forwardRef<HTMLInputElement, InputProps>(({
  id = '',
  disabled = false,
  type = 'text',
  value = '',
  onChange,
  required = false,
  placeholder,
  className = '',
  variant = 'primary',
  size = 'md',
  checked = false,
  autoFocus = false,
}, ref) => {
  const currentClassName = {
    primary:
      'text-white placeholder:text-gray-300 bg-dark-gray outline-none w-full',
    secondary:
      'text-white placeholder:text-gray-300 bg-dark-gray-2 outline-none w-full',
  }

  const sizeClasses = {
    sm: 'text-sm p-1.5 h-9 px-3',
    md: 'text-base p-2 h-11 px-4',
    lg: 'text-base p-3 h-13 px-5',
  }
  return (
    <input
      ref={ref}
      id={id}
      disabled={disabled}
      type={type}
      value={value}
      onChange={onChange}
      placeholder={placeholder}
      required={required}
      checked={checked}
      autoFocus={autoFocus}
      className={cn(currentClassName[variant], sizeClasses[size], className)}
    />
  )
})

Input.displayName = 'Input'

export default Input



================================================================================
FILE: src/components/ui/loader.tsx
================================================================================
import React from 'react'

interface LoaderProps {
  size?: 'sm' | 'md' | 'lg' | 'xl'
  color?: string
  className?: string,
  text?:string
}

const Loader: React.FC<LoaderProps> = ({
  size = 'lg',
  color = '#009D1A',
  className = '',
  text,
}) => {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-6 h-6',
    lg: 'w-8 h-8',
    xl: 'w-12 h-12',
  }
  const textSize = {
    sm: "text-xs",
    md: "text-xs",
    lg:"text-sm",
    xl:"text-base"
  }

  return (
    <div className={`inline-block w-fit ${sizeClasses[size]} ${className}`}>
      <svg
        className={`animate-spin w-full h-full`}
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle
          cx="12"
          cy="12"
          r="10"
          stroke={color}
          strokeWidth="2"
          strokeLinecap="round"
          strokeDasharray="31.416"
          strokeDashoffset="31.416"
          className="animate-dash"
        />
      </svg>
      <span className={`text-gray-300 ${textSize[size]}`}>{text}</span>
    </div>
  )
}

export default Loader


================================================================================
FILE: src/components/ui/modal.tsx
================================================================================
/* FILE: src/components/ui/modal.tsx */
"use client"
import { AnimatePresence, motion } from 'framer-motion'
import { X } from 'lucide-react'
import React, { useEffect } from 'react'
import { createPortal } from 'react-dom'

interface ModalProps {
  isOpen: boolean
  onClose: () => void
  children: React.ReactNode
  title?: string
}

const Modal: React.FC<ModalProps> = ({ isOpen, onClose, children, title }) => {
  // Prevent body scroll when modal is open
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = 'hidden'
    } else {
      document.body.style.overflow = 'unset'
    }
    return () => {
      document.body.style.overflow = 'unset'
    }
  }, [isOpen])

  if (!isOpen) return null

  // Ensure we are in the browser
  if (typeof window === 'undefined') return null

  return createPortal(
    <AnimatePresence>
      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          {/* Backdrop */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="absolute inset-0 bg-black/80 backdrop-blur-sm"
          />

          {/* Modal Content */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 10 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.95, y: 10 }}
            transition={{ duration: 0.2 }}
            className="relative w-full max-w-xl overflow-hidden rounded-lg bg-dark-gray-2 shadow-xl ring-1 ring-white/10"
          >
            {/* Header */}
            <div className="flex items-center justify-between border-b border-white/10 px-6 py-4">
              {title && (
                <h2 className="text-lg font-semibold text-white">{title}</h2>
              )}
              <button
                onClick={onClose}
                className="rounded-full p-1 text-gray-400 hover:bg-white/10 hover:text-white transition-colors"
              >
                <X className="h-5 w-5" />
              </button>
            </div>

            {/* Body */}
            <div className="max-h-[85vh] overflow-y-auto px-6 py-4">
              {children}
            </div>
          </motion.div>
        </div>
      )}
    </AnimatePresence>,
    document.body
  )
}

export default Modal


================================================================================
FILE: src/components/ui/text-area.tsx
================================================================================
import { cn } from '@/lib'
import React, { forwardRef } from 'react'

interface TextAreaProps {
  id?: string
  disabled?: boolean
  value?: string
  onChange: (e: React.ChangeEvent<HTMLTextAreaElement>) => void
  placeholder?: string
  required?: boolean
  className?: string
  variant?: 'primary' | 'secondary'
  size?: 'sm' | 'md' | 'lg'
  autoFocus?: boolean
  rows?: number
  cols?: number
}

const TextArea = forwardRef<HTMLTextAreaElement, TextAreaProps>(({
  id = '',
  disabled = false,
  value = '',
  onChange,
  required = false,
  placeholder,
  className = '',
  variant = 'primary',
  size = 'md',
  autoFocus = false,
  rows = 4,
  cols,
}, ref) => {
  const currentClassName = {
    primary:
      'text-white placeholder:text-gray-300 bg-dark-gray outline-none w-full resize-none',
    secondary:
      'text-white placeholder:text-gray-300 bg-dark-gray-2 outline-none w-full resize-none',
  }

  const sizeClasses = {
    sm: 'text-sm p-1.5 px-3',
    md: 'text-base p-2 px-4',
    lg: 'text-base p-3 px-5',
  }

  return (
    <textarea
      ref={ref}
      id={id}
      disabled={disabled}
      value={value}
      onChange={onChange}
      placeholder={placeholder}
      required={required}
      autoFocus={autoFocus}
      rows={rows}
      cols={cols}
      className={cn(className, currentClassName[variant], sizeClasses[size])}
    />
  )
})

TextArea.displayName = 'TextArea'

export default TextArea


================================================================================
FILE: src/components/ui/watchlist/remove-button.tsx
================================================================================
'use client'

import { useRouter } from 'next/navigation'
import { useState } from 'react'

export default function RemoveWatchlistButton({ contentId }: { contentId: string }) {
  const router = useRouter()
  const [loading, setLoading] = useState(false)

  const onRemove = async () => {
    if (loading) return
    setLoading(true)
    try {
      const res = await fetch(`/api/user/watchlist/${contentId}`, { method: 'DELETE' })
      if (!res.ok) {
        // Optionally show a toast
      }
      router.refresh()
    } finally {
      setLoading(false)
    }
  }

  return (
    <button
      onClick={onRemove}
      disabled={loading}
      className="px-3 py-1 bg-dark-gray hover:bg-dark-gray-hover text-gray-200 text-sm disabled:opacity-60 disabled:cursor-not-allowed"
    >
      {loading ? 'Removing...' : 'Remove'}
    </button>
  )
}





================================================================================
FILE: src/components/ui/watchlist/watchlist-item.tsx
================================================================================
import Image from 'next/image'
import Link from 'next/link'
import { WatchlistItem } from '@/services/watchlist'
import RemoveWatchlistButton from './remove-button'

interface WatchlistItemProps {
  item: WatchlistItem
}

export default function WatchlistItemComponent({ item }: WatchlistItemProps) {
  return (
    <div className="group flex items-center gap-3 p-3 rounded-lg bg-gray-800/30 hover:bg-gray-800/50 transition-colors">
      <Link href={item.href} className="flex items-center gap-3 flex-1 min-w-0">
        <div className="w-12 h-16 bg-gray-700 rounded-sm overflow-hidden flex-shrink-0">
          {item.movie.posterPath ? (
            <Image
              src={`https://image.tmdb.org/t/p/w154${item.movie.posterPath}`}
              alt={item.displayTitle}
              width={48}
              height={64}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full bg-gray-600" />
          )}
        </div>

        <div className="flex flex-col min-w-0 flex-1">
          <div className="flex items-center gap-2 mb-1">
            <h3 className="text-sm font-medium text-gray-100 truncate">
              {item.displayTitle}
            </h3>
            {item.year && (
              <span className="text-xs text-gray-400 flex-shrink-0">
                {item.year}
              </span>
            )}
          </div>

          <div className="flex items-center gap-2">
            <span className="text-xs text-gray-500">
              Added {new Date(item.createdAt).toLocaleDateString()}
            </span>
            <span className="text-xs px-1.5 py-0.5 rounded bg-gray-700 text-gray-400">
              {item.movie.type === 'tv_series' ? 'TV' : 'Movie'}
            </span>
          </div>
        </div>
      </Link>

      <RemoveWatchlistButton contentId={item.contentId} />
    </div>
  )
}



================================================================================
FILE: src/components/ui/watchlist/watchlist-list.tsx
================================================================================
import { WatchlistItem } from '@/services/watchlist'
import WatchlistItemComponent from './watchlist-item'

interface WatchlistListProps {
  items: WatchlistItem[]
}

export default function WatchlistList({ items }: WatchlistListProps) {
  if (items.length === 0) {
    return (
      <div className="text-center py-12">
        <div className="text-gray-400 text-sm">Your watchlist is empty</div>
        <div className="text-gray-500 text-xs mt-1">
          Add movies and shows to get started
        </div>
      </div>
    )
  }

  return (
    <div className="space-y-2">
      {items.map((item) => (
        <WatchlistItemComponent key={item.contentId} item={item} />
      ))}
    </div>
  )
}



================================================================================
FILE: src/components/vertical-cinema-list.tsx
================================================================================
'use client'

import { Star } from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import React, { useCallback, useMemo } from 'react'
import { motion } from 'framer-motion'
import { cn } from '@/lib'
import { MediaItem } from '../../types/media'
import Header from './header'
import { useQuery } from '@tanstack/react-query'
import MediaItemDropdown from './media-item-dropdown'

interface VerticalCinemaListProps {
  title: string
  subHeading?:string
  items?: MediaItem[]
  apiUrl?: string
  showEmptyState?: boolean
  className?: string
  contentType?: 'movie' | 'tv_series'
  showDropdown?: boolean
  onWatchlistToggle?: (item: MediaItem) => void
  getWatchlistStatus?: (item: MediaItem) => boolean
}

const VerticalCinemaList: React.FC<VerticalCinemaListProps> = ({
  title,
  subHeading,
  items: itemsProp,
  apiUrl,
  showEmptyState = false,
  className,
  contentType = 'movie',
  showDropdown = false,
  onWatchlistToggle,
  getWatchlistStatus,
}) => {
  const shouldFetch = (!itemsProp || itemsProp.length === 0) && Boolean(apiUrl)

  const { data, isLoading, isError, error, refetch, isFetching } = useQuery<{ results?: MediaItem[] }>({
    queryKey: ['vertical-cinema-list', apiUrl],
    queryFn: async () => {
      if (!apiUrl) return { results: [] }
      const response = await fetch(apiUrl)
      if (!response.ok) {
        throw new Error('Failed to load data')
      }
      return response.json()
    },
    enabled: shouldFetch,
    retry: 3,
    retryDelay: (attempt) => Math.min(1000 * 2 ** attempt, 5000),
  })

  const fetchedItems = useMemo(() => data?.results ?? [], [data])
  const items: MediaItem[] = useMemo(() => {
    return itemsProp && itemsProp.length > 0 ? itemsProp : fetchedItems
  }, [itemsProp, fetchedItems])
  const getTitle = useCallback((item: MediaItem) => {
    return item.title as string
  }, [])

  const linkPath = useCallback((id: number) => {
    return `/movie/${id}`
  }, [])

  // Animation variants
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.1,
        delayChildren: 0.2,
      },
    },
  }

  const itemVariants = {
    hidden: {
      opacity: 0,
      y: 10,
    },
    visible: {
      opacity: 1,
      y: 0,
      transition: {
        type: 'spring' as const,
        stiffness: 100,
        damping: 12,
      },
    },
  }

  const skeletonKeys = useMemo(() => Array.from({ length: 12 }, () => Math.random().toString(36).slice(2)), [])

  const renderContent = () => {
    if (isLoading) {
      return (
        <div className="flex w-full flex-wrap gap-1 items-center justify-start py-2">
          {skeletonKeys.map((key) => (
            <div key={key} className="flex-shrink-0">
              <div className="relative aspect-[2/3] w-[108px] bg-dark-gray-2 overflow-hidden rounded-sm">
                <div className="absolute inset-0 bg-gradient-to-br from-dark-gray via-dark-gray-2 to-dark-gray animate-pulse" />

                <div className="absolute top-1 right-1 bg-black/40 px-1 py-0.5 flex items-center gap-1 text-xs text-white rounded">
                  <div className="size-2 bg-dark-gray-hover rounded-full animate-pulse" />
                  <div className="w-3 h-2 bg-dark-gray-hover animate-pulse" />
                </div>
              </div>
            </div>
          ))}
        </div>
      )
    }
    if (isError) {
      return (
        <div className="w-full flex flex-col items-center justify-center gap-4">
          <div className="text-red-400 text-center">
            <div className="text-lg mb-2">âš ï¸</div>
            <div className="text-sm">{(error instanceof Error ? error.message : 'Failed to load data')}</div>
          </div>
          <button
            onClick={() => { if (!isFetching) { void refetch() } }}
            disabled={isFetching}
            className="px-6 py-2 bg-light-green hover:bg-light-green/80 text-black font-medium rounded-lg disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200"
          >
            {isFetching ? 'Retrying...' : 'Try Again'}
          </button>
        </div>
      )
    }
    if (showEmptyState && items.length === 0) {
      return (
        <div className="w-full flex flex-col items-center justify-center gap-3">
          <div className="text-4xl">ðŸŽ¬</div>
          <div className="text-gray-400 text-center">
            <div className="text-sm font-medium">No upcoming movies</div>
            <div className="text-xs mt-1">
              Check back later for new releases
            </div>
          </div>
        </div>
      )
    }

    return (
      <motion.div
        className="flex w-full flex-wrap gap-1 items-center justify-start"
        variants={containerVariants}
        initial="hidden"
        animate="visible"
      >
        {items.map((item) => (
          <motion.div
            key={item.id}
            variants={itemVariants}
            className="flex-shrink-0"
          >
            <div className="flex flex-col items-center group cursor-pointer relative">
              <Link
                href={linkPath(item.id)}
                className="block"
              >
                <div className="relative aspect-[2/3] w-[108px] bg-dark-gray-2 overflow-hidden">
                {item.poster_path ? (
                  <Image
                    src={`https://image.tmdb.org/t/p/w500${item.poster_path}`}
                    alt={getTitle(item)}
                    fill
                    className="object-cover group-hover:scale-105 transition-transform duration-300"
                    priority={false}
                  />
                ) : (
                  <div className="w-full h-full flex flex-col items-center justify-center text-gray-500 text-xs bg-dark-gray-2">
                    <div className="text-xl mb-1">ðŸŽ¬</div>
                    <div className="text-center text-xs">No Image</div>
                  </div>
                )}

                <div className="absolute inset-0 bg-gradient-to-t from-dark-gray/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />

                {/* Rating badge */}
                <div className="absolute top-1 right-1 bg-black/70 px-1 py-0.5 flex items-center gap-1 text-xs text-white">
                  <Star className="size-2 fill-light-green text-light-green" />
                  <span className="font-medium">
                    {item.vote_average.toFixed(1)}
                  </span>
                </div>
                </div>
              </Link>

              {showDropdown && (
                <div className="absolute top-1 right-1">
                  <MediaItemDropdown
                    item={{
                      id: item.id,
                      title: getTitle(item),
                      poster_path: item.poster_path,
                      release_date: item.release_date,
                    }}
                    contentType={contentType}
                    onWatchlistToggle={() => onWatchlistToggle?.(item)}
                    isInWatchlist={getWatchlistStatus?.(item) || false}
                  />
                </div>
              )}
            </div>
          </motion.div>
        ))}
      </motion.div>
    )
  }

  return (
    <div className={cn('w-full', className)}>
      <Header title={title} subHeading={subHeading} />
      <div className="overflow-y-auto w-full scrollbar-hide">
        {renderContent()}
      </div>
    </div>
  )
}

export default VerticalCinemaList



================================================================================
FILE: src/components/welcome-message.tsx
================================================================================
import React from 'react'

const WelcomeMessage = ({ username }: { username: string }) => {

    return (
        <div className="text-center pb-4">
            <h1 className="text-lg font-light text-gray-400">
                Welcome back,{' '}
                <span className="text-light-green">{username}</span>.
                Enjoy reviewing , rating and watching...
            </h1>
        </div>
    )
}

export default WelcomeMessage


================================================================================
FILE: src/lib/config/auth.ts
================================================================================
import { AuthOptions, getServerSession } from 'next-auth'
import { PrismaAdapter } from '@next-auth/prisma-adapter'
import prisma from './prisma'
import GoogleProvider from 'next-auth/providers/google'
import CredentialsProvider from 'next-auth/providers/credentials'
import bcrypt from 'bcryptjs'
import {
  generateUniqueUsernameFromEmail,
  generateRandomUsername,
} from '../user/username'

const customAdapter = {
  ...PrismaAdapter(prisma),
  async createUser(user: { id: string; name?: string | null; email?: string | null; emailVerified?: Date | null; image?: string | null; username?: string }) {
    let username = user.username
    if (!username && user.email) {
      username = await generateUniqueUsernameFromEmail(user.email, prisma)
    }

    if (!username) {
      // Generate few candidates and pick the first available using Prisma directly
      const candidates = generateRandomUsername()
      const existing = await prisma.user.findMany({
        where: { username: { in: candidates } },
        select: { username: true },
      })
      const taken = new Set(existing.map(u => u.username))
      username = candidates.find(u => !taken.has(u)) || `user${Date.now().toString(36).slice(-6)}`
    }

    return prisma.user.create({
      data: {
        id: user.id,
        name: user.name,
        email: user.email,
        emailVerified: user.emailVerified,
        image: user.image,
        username: username,
      },
    })
  },
}

export const authOptions: AuthOptions = {
  adapter: customAdapter,
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
    CredentialsProvider({
      name: 'Credentials',
      credentials: {
        email: { label: 'Email', type: 'email' },
        password: { label: 'Password', type: 'password' },
      },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) {
          throw new Error('Missing credentials')
        }

        const user = await prisma.user.findUnique({
          where: { email: credentials.email },
        })

        if (!user?.password) {
          throw new Error('Invalid credentials')
        }

        const isValid = await bcrypt.compare(
          credentials.password,
          user.password
        )

        if (!isValid) {
          throw new Error('Invalid credentials')
        }

        return {
          id: user.id,
          name: user.name,
          email: user.email,
          role: user.role || undefined,
          username: user.username || undefined,
          image: user.image || undefined,
        }
      },
    }),
  ],
  session: {
    strategy: 'jwt', // Use JWT for sessions with credentials provider
    maxAge: 30 * 24 * 60 * 60, // 30 days
    updateAge: 24 * 60 * 60, // Update every 24 hours
  },
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.id = user.id
        token.role = user.role
        token.username = user.username
        token.image = user.image ?? token.image ?? null
      } else if (token.id) {
        // Ensure image (and username) are present on token when missing
        const needsImage = token.image == null
        const needsUsername = !token.username
        if (needsImage || needsUsername) {
          const dbUser = await prisma.user.findUnique({
            where: { id: token.id as string },
            select: { username: true, image: true },
          })
          if (needsUsername) {
            token.username = dbUser?.username
          }
          if (needsImage) {
            const dicebear = token.username
              ? `https://api.dicebear.com/9.x/lorelei/svg?seed=${token.username}`
              : null
            token.image = dbUser?.image ?? token.image ?? dicebear
          }
        }
      }
      return token
    },
    async session({ session, token }) {
      if (session.user) {
        session.user.id = token.id as string
        session.user.role = token.role as string | undefined
        session.user.username = token.username as string | undefined
        session.user.image = token.image ?? undefined
      }
      return session
    },
  },
  pages: {
    signIn: '/signin',
    error: '/signin',
  },
  secret: process.env.NEXTAUTH_SECRET,
  debug: process.env.NODE_ENV === 'development',
}

export const getSession = async () => {
  const session = await getServerSession(authOptions)
  return session
}



================================================================================
FILE: src/lib/config/prisma.ts
================================================================================
import { PrismaClient } from '@prisma/client'

const prismaClientSingleton = () => {
  return new PrismaClient()
}

declare global {
  var prisma: undefined | ReturnType<typeof prismaClientSingleton>
}

const prisma = globalThis.prisma ?? prismaClientSingleton()

if (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma

export default prisma



================================================================================
FILE: src/lib/config/tmdb.ts
================================================================================
const TMDB_IMAGE_BASE_URL = 'https://image.tmdb.org/t/p'

export function getPosterUrl(
  posterPath: string | null,
  size: 'w92' | 'w154' | 'w185' | 'w342' | 'w500' | 'w780' | 'original' = 'w500'
): string | null {
  if (!posterPath) return null
  return `${TMDB_IMAGE_BASE_URL}/${size}${posterPath}`
}



================================================================================
FILE: src/lib/index.ts
================================================================================
// Configuration exports
export { authOptions, getSession } from './config/auth'
export { default as prisma } from './config/prisma'
export { getPosterUrl } from './config/tmdb'


// User utilities exports
export * from './user/username'

export * from './utils'



================================================================================
FILE: src/lib/user/username.ts
================================================================================
import { PrismaClient } from '@prisma/client'
import { z } from 'zod'

export const UsernameSchema = z
  .string()
  .trim()
  .toLowerCase()
  .min(3, 'Username must be at least 3 characters')
  .max(20, 'Username must be at most 20 characters')
  .regex(/^[a-zA-Z0-9_-]+$/, 'Only letters, numbers, underscores, and hyphens allowed')


export function generateRandomUsername(count: number = 10): string[] {
  const usernames: string[] = []
  const used = new Set<string>()

  while (usernames.length < count) {
    const timePart = Date.now().toString(36)
    const randPart = Math.random().toString(36).slice(2, 8)
    const suffix = (timePart + randPart).slice(-8)
    const username = `user${suffix}`
    if (!used.has(username)) {
      used.add(username)
      usernames.push(username)
    }
  }

  return usernames
}

// Single public API: generate a deterministic username from email and ensure uniqueness

export async function generateUniqueUsernameFromEmail(email: string, prisma: PrismaClient): Promise<string> {
  const emailPrefix = email.split('@')[0]

  const cleanPrefix = emailPrefix
    .toLowerCase()
    .replace(/[^a-z0-9_-]/g, '')

  const base = (cleanPrefix.length >= 3 ? cleanPrefix : 'user').slice(0, 20)

  // Try the base first
  const existingBase = await prisma.user.findUnique({
    where: {
      username: base,
      isDeleted: true,
    },
    select: { username: true }
  })
  if (!existingBase) return base

  // Then append small numeric suffixes while respecting 20-char max
  for (let suffixNumber = 1; suffixNumber <= 100; suffixNumber++) {
    const suffix = String(suffixNumber)
    const trimmedBase = base.slice(0, 20 - suffix.length)
    const candidate = `${trimmedBase}${suffix}`

    const existing = await prisma.user.findUnique({
      where: {
        username: candidate,
        isDeleted: false, // Exclude soft deleted users
      },
      select: { username: true }
    })
    if (!existing) return candidate
  }

  // Fallback: short deterministic-ish suffix based on time
  const timeSuffix = Date.now().toString(36).slice(-4)
  const fallbackBase = base.slice(0, 20 - timeSuffix.length)
  return `${fallbackBase}${timeSuffix}`
}

// Removed async random generator in favor of using generateUsernameCombinations + availability checks


================================================================================
FILE: src/lib/utils.ts
================================================================================
import { type ClassValue, clsx } from 'clsx'
import { twMerge } from 'tailwind-merge'
import type { RatingEnum } from '../../types/post'

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}


export const ratingLabelMap: Record<RatingEnum, string> = {
  TRASH: 'Trash',
  TIMEPASS: 'Timepass',
  ONE_TIME_WATCH: 'One-time watch',
  MUST_WATCH: 'Must watch',
  LEGENDARY: 'Legendary',
}

export function getRatingLabel(rating: RatingEnum): string {
  return ratingLabelMap[rating]
}

export function hideContent(content: string) {
  const texts = content.split(" ");
  const updatedTextArray = texts.map((text) => {
    if (text.length === 0) return text;
    return text.split("").map((char, index) => {
      return index % 2 === 0 ? char : "*";
    }).join("");
  })
  const output = updatedTextArray.join(' ');
  return output;
}

export function formatDate(dateString: string): string {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  })
}

export function formatDateTime(date: Date): string {
  return new Date(date).toLocaleString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  })
}


// Media helpers (DRY across components)
export function getMediaTitle(item: { title?: string | null; name?: string | null }): string {
  return (item.title || item.name || 'Unknown') as string
}

export function getMediaReleaseYear(item: { release_date?: string | null; first_air_date?: string | null }): string {
  const date = item.release_date || item.first_air_date
  return date ? String(new Date(date).getFullYear()) : 'N/A'
}




================================================================================
FILE: src/services/activity.ts
================================================================================
import prisma from '@/lib/config/prisma'
import { Prisma } from '@prisma/client'

export type ActivityType = 'movie_watched' | 'series_watched'

export interface CreateActivityData {
  userId: string
  activityType: ActivityType
  activityDate: Date
  contentId?: string
  metadata?: Record<string, unknown>
}

export interface ActivityHeatmapData {
  date: string // YYYY-MM-DD format
  count: number
  level: number // 0-4 for heatmap intensity
}

export class ActivityService {
  /**
   * Log a user activity for a specific date
   */
  static async logActivity(data: CreateActivityData) {
    try {
      // Normalize the date to start of day to ensure consistent grouping
      const normalizedDate = new Date(data.activityDate)
      normalizedDate.setHours(0, 0, 0, 0)

      const activity = await prisma.userActivity.create({
        data: {
          userId: data.userId,
          activityType: data.activityType,
          activityDate: normalizedDate,
          contentId: data.contentId,
          metadata: data.metadata as Prisma.InputJsonValue,
        },
      })

      return activity
    } catch (error) {
      console.error('Error logging activity:', error)
      throw error
    }
  }

  /**
   * Get user activity statistics
   */
  static async getUserActivityStats(userId: string) {
    try {
      const now = new Date()
      const startOfYear = new Date(now.getFullYear(), 0, 1)
      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1)
      const startOfWeek = new Date(now)
      startOfWeek.setDate(now.getDate() - now.getDay())
      startOfWeek.setHours(0, 0, 0, 0)

      // Only count movie/series watching activities
      const watchingActivitiesFilter = {
        activityType: {
          in: ['movie_watched', 'series_watched'],
        },
      }

      const runCounts = async () => {
        return await Promise.all([
          prisma.userActivity.count({
            where: {
              userId,
              ...watchingActivitiesFilter,
            },
          }),
          prisma.userActivity.count({
            where: {
              userId,
              activityDate: { gte: startOfYear },
              ...watchingActivitiesFilter,
            },
          }),
          prisma.userActivity.count({
            where: {
              userId,
              activityDate: { gte: startOfMonth },
              ...watchingActivitiesFilter,
            },
          }),
          prisma.userActivity.count({
            where: {
              userId,
              activityDate: { gte: startOfWeek },
              ...watchingActivitiesFilter,
            },
          }),
        ])
      }

      let totalActivities: number,
        yearActivities: number,
        monthActivities: number,
        weekActivities: number

      try {
        ;[totalActivities, yearActivities, monthActivities, weekActivities] =
          await runCounts()
      } catch (error: unknown) {
        // Handle transient connection closure (P1017) by reconnecting once
        const maybePrismaError = error as { code?: string }
        if (maybePrismaError?.code === 'P1017') {
          try {
            await prisma.$disconnect()
          } catch {}
          await prisma.$connect()
          ;[totalActivities, yearActivities, monthActivities, weekActivities] =
            await runCounts()
        } else {
          throw error
        }
      }

      return {
        totalActivities,
        yearActivities,
        monthActivities,
        weekActivities,
      }
    } catch (error) {
      console.error('Error fetching activity stats:', error)
      throw error
    }
  }

  /**
   * Get heatmap data for current and last month
   */
  static async getHeatmapData(userId: string) {
    try {
      const now = new Date()
      const currentMonth = now.getMonth()
      const currentYear = now.getFullYear()

      // Get start of last month
      const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1
      const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear
      const startOfLastMonth = new Date(lastMonthYear, lastMonth, 1)


      // Get end of current month
      const endOfCurrentMonth = new Date(currentYear, currentMonth + 1, 0)

      // Only count movie/series watching activities
      const watchingActivitiesFilter = {
        activityType: {
          in: ['movie_watched', 'series_watched'],
        },
      }

      const activities = await prisma.userActivity.findMany({
        where: {
          userId,
          activityDate: {
            gte: startOfLastMonth,
            lte: endOfCurrentMonth,
          },
          ...watchingActivitiesFilter,
        },
        select: {
          activityDate: true,
          contentId: true,
          metadata: true,
        },
        orderBy: {
          activityDate: 'desc',
        },
      })

      // Group activities by date with detailed info
      const activityMap: Record<string, Array<{
        contentId: string
        metadata: Record<string, unknown>
        activityType: string
      }>> = {}

      activities.forEach(activity => {
        const dateStr = activity.activityDate.toISOString().split('T')[0]
        if (!activityMap[dateStr]) {
          activityMap[dateStr] = []
        }
        activityMap[dateStr].push({
          contentId: activity.contentId || '',
          metadata: (activity.metadata as Record<string, unknown>) || {},
          activityType: 'movie_watched' // We know it's one of the watching types
        })
      })

      return {
        activities: activityMap,
        startOfLastMonth,
        endOfCurrentMonth,
      }
    } catch (error) {
      console.error('Error fetching heatmap data:', error)
      throw error
    }
  }

  /**
   * Get heatmap data for a specific month
   */
  static async getHeatmapDataForMonth(userId: string, targetMonth: Date) {
    try {
      const year = targetMonth.getFullYear()
      const month = targetMonth.getMonth()

      // Get start and end of the target month
      const startOfMonth = new Date(year, month, 1)
      const endOfMonth = new Date(year, month + 1, 0)

      // Only count movie/series watching activities
      const watchingActivitiesFilter = {
        activityType: {
          in: ['movie_watched', 'series_watched'],
        },
      }

      const activities = await prisma.userActivity.findMany({
        where: {
          userId,
          activityDate: {
            gte: startOfMonth,
            lte: endOfMonth,
          },
          ...watchingActivitiesFilter,
        },
        select: {
          activityDate: true,
          contentId: true,
          metadata: true,
        },
        orderBy: {
          activityDate: 'desc',
        },
      })

      // Group activities by date with detailed info
      const activityMap: Record<string, Array<{
        contentId: string
        metadata: Record<string, unknown>
        activityType: string
      }>> = {}

      activities.forEach(activity => {
        const dateStr = activity.activityDate.toISOString().split('T')[0]
        if (!activityMap[dateStr]) {
          activityMap[dateStr] = []
        }
        activityMap[dateStr].push({
          contentId: activity.contentId || '',
          metadata: (activity.metadata as Record<string, unknown>) || {},
          activityType: 'movie_watched' // We know it's one of the watching types
        })
      })

      return {
        activities: activityMap,
        startOfMonth,
        endOfMonth,
      }
    } catch (error) {
      console.error('Error fetching heatmap data for month:', error)
      throw error
    }
  }
}


================================================================================
FILE: src/services/auth.ts
================================================================================
import { getSession } from '@/lib/config/auth'

export class UnauthorizedError extends Error {}

export async function getUserId() {
  const session = await getSession()
  const userId = session?.user?.id
  if (!userId) throw new UnauthorizedError('Unauthorized')
  return userId
}



================================================================================
FILE: src/services/user.ts
================================================================================
import { prisma } from '@/lib'

export async function searchUsers(query: string, currentUserId: string) {
  const q = query.trim()
  if (!q) return []

  return prisma.user.findMany({
    where: {
      id: { not: currentUserId },
      isDeleted: false, // Exclude soft deleted users
      OR: [
        { username: { contains: q, mode: 'insensitive' } },
        { name: { contains: q, mode: 'insensitive' } },
      ],
    },
    select: { id: true, username: true, name: true, image: true },
    take: 10,
    orderBy: { username: 'asc' },
  })
}

export async function isUsernameAvailable(username: string) {
  const existing = await prisma.user.findUnique({
    where: {
      username,
      isDeleted: false, // Only check non-deleted users
    },
    select: { id: true },
  })
  return !existing
}

export async function updateUsername(userId: string, username: string) {
  const normalized = username.trim().toLowerCase()
  const usernameRegex = /^[a-zA-Z0-9_-]{3,20}$/
  if (!usernameRegex.test(normalized)) {
    throw new Error(
      'Username must be 3-20 chars: letters, numbers, underscores, hyphens'
    )
  }

  const available = await isUsernameAvailable(normalized)
  if (!available) {
    throw new Error('Username is already taken')
  }

  return prisma.user.update({
    where: { id: userId },
    data: { username: normalized },
    select: { id: true, username: true, name: true, image: true },
  })
}



================================================================================
FILE: src/services/watchlist.ts
================================================================================
import prisma from '@/lib/config/prisma'

export interface WatchlistItem {
  contentId: string
  createdAt: string
  movie: {
    id: string
    type: string
    posterPath: string | null
  }
  displayTitle: string
  year: number | null
  href: string
}

type DbWatchlistItem = {
  contentId: string
  createdAt: Date
  movie: {
    id: string
    type: string
    posterPath: string | null
  }
}

type TmdbMovieResponse = {
  title?: string
  name?: string
  release_date?: string
  first_air_date?: string
  poster_path?: string | null
} | null

export class WatchlistService {
  private static readonly TMDB_TOKEN = process.env.TMDB_TOKEN
  private static readonly TMDB_BASE_URL = process.env.TMDB_BASE_URL || 'https://api.themoviedb.org/3'

  static async getUserWatchlist(userId: string): Promise<WatchlistItem[]> {
    const items = await prisma.watchlistItem.findMany({
      where: { userId },
      orderBy: { createdAt: 'desc' },
      select: {
        contentId: true,
        createdAt: true,
        movie: {
          select: { id: true, type: true, posterPath: true },
        },
      },
    })

    return this.enrichItems(items)
  }

  private static async enrichItems(items: DbWatchlistItem[]): Promise<WatchlistItem[]> {
    if (!this.TMDB_TOKEN) {
      return this.createBasicItems(items)
    }

    const enrichedItems: WatchlistItem[] = []

    await Promise.all(
      items.map(async (item) => {
        const enriched = await this.enrichSingleItem(item)
        enrichedItems.push(enriched)
      })
    )

    return enrichedItems
  }

  private static async enrichSingleItem(item: DbWatchlistItem): Promise<WatchlistItem> {
    let displayTitle = item.movie.id
    let year: number | null = null

    try {
      const tmdbData = await this.fetchTmdbData(item.movie.id, item.movie.type)
      if (tmdbData) {
        displayTitle = tmdbData.title || tmdbData.name || item.movie.id
        year = this.extractYear(tmdbData.release_date || tmdbData.first_air_date)

        if (!item.movie.posterPath && tmdbData.poster_path) {
          await this.updatePosterPath(item.movie.id, tmdbData.poster_path)
          item.movie.posterPath = tmdbData.poster_path
        }
      }
    } catch {
      // Fallback to basic data
    }

    return {
      contentId: item.contentId,
      createdAt: item.createdAt.toISOString(),
      movie: item.movie,
      displayTitle,
      year,
      href: this.buildHref(item.movie.type, item.contentId),
    }
  }

  private static async fetchTmdbData(id: string, type: string): Promise<TmdbMovieResponse> {
    const endpoint = type === 'tv_series'
      ? `${this.TMDB_BASE_URL}/tv/${id}?language=hi-IN`
      : `${this.TMDB_BASE_URL}/movie/${id}?language=hi-IN`

    const response = await fetch(endpoint, {
      headers: {
        accept: 'application/json',
        Authorization: `Bearer ${this.TMDB_TOKEN}`,
      },
      cache: 'no-store',
    })

    if (!response.ok) return null
    return response.json()
  }

  private static extractYear(dateStr?: string): number | null {
    return dateStr ? new Date(dateStr).getFullYear() : null
  }

  private static async updatePosterPath(id: string, posterPath: string) {
    await prisma.movie.update({
      where: { id },
      data: { posterPath },
    })
  }

  private static buildHref(type: string, contentId: string): string {
    return type === 'tv_series' ? `/web-series/${contentId}` : `/movie/${contentId}`
  }

  private static createBasicItems(items: DbWatchlistItem[]): WatchlistItem[] {
    return items.map(item => ({
      contentId: item.contentId,
      createdAt: item.createdAt.toISOString(),
      movie: item.movie,
      displayTitle: item.movie.id,
      year: null,
      href: this.buildHref(item.movie.type, item.contentId),
    }))
  }
}



================================================================================
FILE: tsconfig.json
================================================================================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}



================================================================================
FILE: types/media.d.ts
================================================================================
export interface MediaItem {
  id: number
  title?: string
  name?: string
  overview: string
  poster_path: string
  release_date?: string
  first_air_date?: string
  vote_average: number
}



================================================================================
FILE: types/next-auth.d.ts
================================================================================
import { DefaultSession } from 'next-auth'

declare module 'next-auth' {
  interface Session {
    user: {
      id: string
      role?: string
      username?: string
    } & DefaultSession['user']
  }

  interface User {
    role?: string
    username?: string
    image?: string | null
  }
}

declare module 'next-auth/jwt' {
  interface JWT {
    id: string
    role?: string
    username?: string
    image?: string | null
  }
}



================================================================================
FILE: types/post.d.ts
================================================================================
export type RatingEnum =
  | 'TRASH'
  | 'TIMEPASS'
  | 'ONE_TIME_WATCH'
  | 'MUST_WATCH'
  | 'LEGENDARY'

  export type GenericPost = {
    id: string
    title?: string | null
    content: string
    rating: RatingEnum | null
    isSpoiler?: boolean
    createdAt?: Date | string
    posterUrl?: string | null
    user: {
      name: string | null
      image: string | null
    }
    movie?: {
      id: string
      type: string
      posterPath?: string | null
    }
    likes?: Array<{ id: string; userId: string }>
    dislikes?: Array<{ id: string; userId: string }>
    _count?: {
      comments: number
    }
  }
  interface Post {
    id: string
    title: string | null
    content: string
    rating: RatingEnum | null
    isSpoiler: boolean
    createdAt: Date
    movie?: { id: string; type: string; posterPath?: string | null }
    posterUrl?: string | null
    user: {
      id: string
      name: string | null
      image: string | null
    }
    likes: Array<{ id: string; userId: string }>
    _count: {
      comments: number
    }
  }


================================================================================
FILE: types/tmdb.d.ts
================================================================================
export interface TMDBMovieDetails {
  id: number
  title: string
  original_title: string
  overview: string
  poster_path: string | null
  backdrop_path: string | null
  release_date: string
  vote_average: number
  vote_count: number
  runtime: number | null
  genres: Array<{
    id: number
    name: string
  }>
  production_companies: Array<{
    id: number
    name: string
    logo_path: string | null
  }>
}
export interface TMDBMoviePoster {
  movieId: string
  title: string
  posterUrl: string | null
  releaseYear: string | null
}

export interface TMDBTVSeriesDetails {
  id: number
  name: string
  original_name: string
  overview: string
  poster_path: string | null
  backdrop_path: string | null
  first_air_date: string
  vote_average: number
  vote_count: number
  genres: Array<{
    id: number
    name: string
  }>
}

export interface TMDBTVSeriesPoster {
  seriesId: string
  title: string
  posterUrl: string | null
  releaseYear: string | null
}

// Shared detailed types used by components
export interface Genre {
  id: number
  name: string
}

export interface ProductionCompany {
  id: number
  logo_path: string | null
  name: string
  origin_country?: string
}

export interface ProductionCountry {
  iso_3166_1: string
  name: string
}

export interface SpokenLanguage {
  english_name: string
  iso_639_1: string
  name: string
}

export interface Network {
  id: number
  logo_path: string | null
  name: string
  origin_country: string
}

export interface Season {
  air_date: string | null
  episode_count: number
  id: number
  name: string
  overview: string
  poster_path: string | null
  season_number: number
  vote_average: number
}

export interface MovieDetails {
  adult: boolean
  backdrop_path: string | null
  belongs_to_collection: unknown
  budget: number
  genres: Genre[]
  homepage: string
  id: number
  imdb_id: string | null
  origin_country?: string[]
  original_language: string
  original_title: string
  overview: string
  popularity: number
  poster_path: string | null
  production_companies: ProductionCompany[]
  production_countries: ProductionCountry[]
  release_date: string
  revenue: number
  runtime: number | null
  spoken_languages: SpokenLanguage[]
  status: string
  tagline: string
  title: string
  video: boolean
  vote_average: number
  vote_count: number
}

export interface TVSeriesDetails {
  adult: boolean
  backdrop_path: string | null
  created_by: Array<{
    id: number
    credit_id: string
    name: string
    gender: number
    profile_path: string | null
  }>
  episode_run_time: number[]
  first_air_date: string
  genres: Genre[]
  homepage: string
  id: number
  in_production: boolean
  languages: string[]
  last_air_date: string
  last_episode_to_air: {
    id: number
    name: string
    overview: string
    vote_average: number
    vote_count: number
    air_date: string
    episode_number: number
    production_code: string
    runtime: number | null
    season_number: number
    show_id: number
    still_path: string | null
  } | null
  name: string
  next_episode_to_air: {
    id: number
    name: string
    overview: string
    vote_average: number
    vote_count: number
    air_date: string
    episode_number: number
    production_code: string
    runtime: number | null
    season_number: number
    show_id: number
    still_path: string | null
  } | null
  networks: Network[]
  number_of_episodes: number
  number_of_seasons: number
  origin_country: string[]
  original_language: string
  original_name: string
  overview: string
  popularity: number
  poster_path: string | null
  production_companies: ProductionCompany[]
  production_countries: ProductionCountry[]
  seasons: Season[]
  spoken_languages: SpokenLanguage[]
  status: string
  tagline: string
  type: string
  vote_average: number
  vote_count: number
}


================================================================================
FILE: types/trending.d.ts
================================================================================
export interface TrendingItem {
  id: number
  title?: string
  name?: string
  overview: string
  poster_path: string
  release_date?: string
  first_air_date?: string
  vote_average: number
  media_type: string
}


